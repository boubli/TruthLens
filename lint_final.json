[{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\actions\\ai-actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\access-codes\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\access-codes\\page.tsx:58:13\n  56 |     useEffect(() => {\n  57 |         if (userProfile?.role === 'admin') {\n> 58 |             loadCodes();\n     |             ^^^^^^^^^ Avoid calling setState() directly within an effect\n  59 |         }\n  60 |     }, [userProfile, loadCodes]);\n  61 |","line":58,"column":13,"nodeType":null,"endLine":58,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n    Box, Typography, Paper, TextField, Button, Table, TableBody,\r\n    TableCell, TableContainer, TableHead, TableRow, Chip, IconButton,\r\n    Dialog, DialogTitle, DialogContent, DialogActions, FormControl,\r\n    InputLabel, Select, MenuItem, Switch, CircularProgress, Alert\r\n} from '@mui/material';\r\nimport AddIcon from '@mui/icons-material/Add';\r\nimport ContentCopyIcon from '@mui/icons-material/ContentCopy';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport RefreshIcon from '@mui/icons-material/Refresh';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { useRouter } from 'next/navigation';\r\nimport { createAccessCode, getAllAccessCodes, toggleAccessCodeStatus } from '@/services/accessRequestService';\r\nimport { AccessCode, AccessCodeTier } from '@/types/accessRequest';\r\n\r\nexport default function AdminAccessCodesPage() {\r\n    const { userProfile, loading: authLoading } = useAuth();\r\n    const router = useRouter();\r\n\r\n    const [codes, setCodes] = useState<AccessCode[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [openDialog, setOpenDialog] = useState(false);\r\n    const [error, setError] = useState('');\r\n    const [success, setSuccess] = useState('');\r\n\r\n    // New code form\r\n    const [newCode, setNewCode] = useState('');\r\n    const [newTier, setNewTier] = useState<AccessCodeTier>('plus');\r\n    const [newType, setNewType] = useState<'student' | 'general'>('general');\r\n    const [newLimit, setNewLimit] = useState(100);\r\n    const [newExpiry, setNewExpiry] = useState('');\r\n    const [creating, setCreating] = useState(false);\r\n\r\n    // Auth check\r\n    useEffect(() => {\r\n        if (!authLoading && userProfile?.role !== 'admin') {\r\n            router.push('/');\r\n        }\r\n    }, [authLoading, userProfile, router]);\r\n\r\n    // Load codes\r\n    const loadCodes = useCallback(async () => {\r\n        setLoading(true);\r\n        try {\r\n            const data = await getAllAccessCodes();\r\n            setCodes(data);\r\n        } catch (err) {\r\n            console.error('Error loading codes:', err);\r\n        }\r\n        setLoading(false);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (userProfile?.role === 'admin') {\r\n            loadCodes();\r\n        }\r\n    }, [userProfile, loadCodes]);\r\n\r\n    const generateRandomCode = () => {\r\n        const prefix = newType === 'student' ? 'TL-STU' : 'TL-ACC';\r\n        const random = Math.random().toString(36).substring(2, 8).toUpperCase();\r\n        setNewCode(`${prefix}-${random}`);\r\n    };\r\n\r\n    const handleCreateCode = async () => {\r\n        if (!newCode.trim()) {\r\n            setError('Code is required');\r\n            return;\r\n        }\r\n\r\n        setCreating(true);\r\n        setError('');\r\n\r\n        try {\r\n            await createAccessCode(\r\n                newCode,\r\n                newTier,\r\n                newType,\r\n                newLimit,\r\n                newExpiry ? new Date(newExpiry) : null,\r\n                userProfile?.uid || ''\r\n            );\r\n            setSuccess('Code created successfully!');\r\n            setOpenDialog(false);\r\n            setNewCode('');\r\n            loadCodes();\r\n        } catch (err: unknown) {\r\n            const message = err instanceof Error ? err.message : 'Failed to create code';\r\n            setError(message);\r\n        }\r\n\r\n        setCreating(false);\r\n    };\r\n\r\n    const handleToggleActive = async (codeId: string, currentActive: boolean) => {\r\n        try {\r\n            await toggleAccessCodeStatus(codeId, !currentActive);\r\n            loadCodes();\r\n        } catch (err) {\r\n            console.error('Error toggling code:', err);\r\n        }\r\n    };\r\n\r\n    const copyToClipboard = (text: string) => {\r\n        navigator.clipboard.writeText(text);\r\n        setSuccess('Code copied to clipboard!');\r\n        setTimeout(() => setSuccess(''), 2000);\r\n    };\r\n\r\n    const getTierColor = (tier: string) => {\r\n        switch (tier) {\r\n            case 'plus': return 'primary';\r\n            case 'pro': return 'secondary';\r\n            case 'ultimate': return 'warning';\r\n            default: return 'default';\r\n        }\r\n    };\r\n\r\n    if (authLoading || loading) {\r\n        return (\r\n            <Box sx={{ p: 4, display: 'flex', justifyContent: 'center' }}>\r\n                <CircularProgress />\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Box sx={{ p: 3 }}>\r\n            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>\r\n                <Typography variant=\"h5\" fontWeight=\"bold\">\r\n                    ≡ƒöæ Access Codes\r\n                </Typography>\r\n                <Box>\r\n                    <Button startIcon={<RefreshIcon />} onClick={loadCodes} sx={{ mr: 1 }}>\r\n                        Refresh\r\n                    </Button>\r\n                    <Button variant=\"contained\" startIcon={<AddIcon />} onClick={() => setOpenDialog(true)}>\r\n                        Generate Code\r\n                    </Button>\r\n                </Box>\r\n            </Box>\r\n\r\n            {success && <Alert severity=\"success\" sx={{ mb: 2 }}>{success}</Alert>}\r\n\r\n            <TableContainer component={Paper}>\r\n                <Table>\r\n                    <TableHead>\r\n                        <TableRow>\r\n                            <TableCell>Code</TableCell>\r\n                            <TableCell>Tier</TableCell>\r\n                            <TableCell>Type</TableCell>\r\n                            <TableCell>Usage</TableCell>\r\n                            <TableCell>Expires</TableCell>\r\n                            <TableCell>Active</TableCell>\r\n                            <TableCell>Actions</TableCell>\r\n                        </TableRow>\r\n                    </TableHead>\r\n                    <TableBody>\r\n                        {codes.map((code) => (\r\n                            <TableRow key={code.id}>\r\n                                <TableCell>\r\n                                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                                        <Typography fontFamily=\"monospace\" fontWeight=\"bold\">\r\n                                            {code.code}\r\n                                        </Typography>\r\n                                        <IconButton size=\"small\" onClick={() => copyToClipboard(code.code)}>\r\n                                            <ContentCopyIcon fontSize=\"small\" />\r\n                                        </IconButton>\r\n                                    </Box>\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    <Chip label={code.tier.toUpperCase()} color={getTierColor(code.tier)} size=\"small\" />\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    <Chip\r\n                                        label={code.type === 'student' ? '≡ƒÄô Student' : '≡ƒæñ General'}\r\n                                        variant=\"outlined\"\r\n                                        size=\"small\"\r\n                                    />\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    {code.usedCount} / {code.usageLimit === 0 ? 'Γê₧' : code.usageLimit}\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    {code.expiresAt\r\n                                        ? new Date(code.expiresAt).toLocaleDateString()\r\n                                        : 'Never'}\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    <Switch\r\n                                        checked={code.active}\r\n                                        onChange={() => handleToggleActive(code.id, code.active)}\r\n                                        color=\"success\"\r\n                                    />\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    <IconButton color=\"error\" size=\"small\">\r\n                                        <DeleteIcon fontSize=\"small\" />\r\n                                    </IconButton>\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        ))}\r\n                        {codes.length === 0 && (\r\n                            <TableRow>\r\n                                <TableCell colSpan={7} align=\"center\" sx={{ py: 4 }}>\r\n                                    <Typography color=\"text.secondary\">No access codes yet</Typography>\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        )}\r\n                    </TableBody>\r\n                </Table>\r\n            </TableContainer>\r\n\r\n            {/* Create Code Dialog */}\r\n            <Dialog open={openDialog} onClose={() => setOpenDialog(false)} maxWidth=\"sm\" fullWidth>\r\n                <DialogTitle>Generate Access Code</DialogTitle>\r\n                <DialogContent>\r\n                    {error && <Alert severity=\"error\" sx={{ mb: 2 }}>{error}</Alert>}\r\n\r\n                    <Box sx={{ display: 'flex', gap: 1, mb: 2, mt: 1 }}>\r\n                        <TextField\r\n                            fullWidth\r\n                            label=\"Code\"\r\n                            value={newCode}\r\n                            onChange={(e) => setNewCode(e.target.value.toUpperCase())}\r\n                            placeholder=\"TL-ACC-XXXXXX\"\r\n                        />\r\n                        <Button variant=\"outlined\" onClick={generateRandomCode}>\r\n                            Generate\r\n                        </Button>\r\n                    </Box>\r\n\r\n                    <FormControl fullWidth sx={{ mb: 2 }}>\r\n                        <InputLabel>Tier to Grant</InputLabel>\r\n                        <Select value={newTier} label=\"Tier to Grant\" onChange={(e) => setNewTier(e.target.value as AccessCodeTier)}>\r\n                            <MenuItem value=\"plus\">Plus</MenuItem>\r\n                            <MenuItem value=\"pro\">Pro</MenuItem>\r\n                            <MenuItem value=\"ultimate\">Ultimate</MenuItem>\r\n                        </Select>\r\n                    </FormControl>\r\n\r\n                    <FormControl fullWidth sx={{ mb: 2 }}>\r\n                        <InputLabel>Code Type</InputLabel>\r\n                        <Select value={newType} label=\"Code Type\" onChange={(e) => setNewType(e.target.value as 'student' | 'general')}>\r\n                            <MenuItem value=\"general\">General</MenuItem>\r\n                            <MenuItem value=\"student\">Student (auto-approve with proof)</MenuItem>\r\n                        </Select>\r\n                    </FormControl>\r\n\r\n                    <TextField\r\n                        fullWidth\r\n                        type=\"number\"\r\n                        label=\"Usage Limit (0 = unlimited)\"\r\n                        value={newLimit}\r\n                        onChange={(e) => setNewLimit(parseInt(e.target.value) || 0)}\r\n                        sx={{ mb: 2 }}\r\n                    />\r\n\r\n                    <TextField\r\n                        fullWidth\r\n                        type=\"date\"\r\n                        label=\"Expiry Date (optional)\"\r\n                        value={newExpiry}\r\n                        onChange={(e) => setNewExpiry(e.target.value)}\r\n                        InputLabelProps={{ shrink: true }}\r\n                    />\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => setOpenDialog(false)}>Cancel</Button>\r\n                    <Button variant=\"contained\" onClick={handleCreateCode} disabled={creating}>\r\n                        {creating ? <CircularProgress size={20} /> : 'Create Code'}\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\access-requests\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\access-requests\\page.tsx:59:13\n  57 |     useEffect(() => {\n  58 |         if (userProfile?.role === 'admin') {\n> 59 |             loadRequests();\n     |             ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  60 |         }\n  61 |     }, [userProfile, loadRequests]);\n  62 |","line":59,"column":13,"nodeType":null,"endLine":59,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n    Box, Typography, Paper, Tabs, Tab, Table, TableBody, TableCell,\r\n    TableContainer, TableHead, TableRow, Chip, IconButton, Button,\r\n    Dialog, DialogTitle, DialogContent, DialogActions, TextField,\r\n    CircularProgress, Alert, Avatar\r\n} from '@mui/material';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport CancelIcon from '@mui/icons-material/Cancel';\r\nimport VisibilityIcon from '@mui/icons-material/Visibility';\r\nimport RefreshIcon from '@mui/icons-material/Refresh';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { useRouter } from 'next/navigation';\r\nimport { getAllRequests, approveRequest, denyRequest } from '@/services/accessRequestService';\r\nimport { FreeAccessRequest } from '@/types/accessRequest';\r\n\r\nexport default function AdminAccessRequestsPage() {\r\n    const { userProfile, loading: authLoading } = useAuth();\r\n    const router = useRouter();\r\n\r\n    const [requests, setRequests] = useState<FreeAccessRequest[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [tab, setTab] = useState(0);\r\n    const [success, setSuccess] = useState('');\r\n    const [error, setError] = useState('');\r\n\r\n    // Deny dialog\r\n    const [denyDialogOpen, setDenyDialogOpen] = useState(false);\r\n    const [denyReason, setDenyReason] = useState('');\r\n    const [selectedRequest, setSelectedRequest] = useState<FreeAccessRequest | null>(null);\r\n    const [processing, setProcessing] = useState(false);\r\n\r\n    // Detail dialog\r\n    const [detailDialogOpen, setDetailDialogOpen] = useState(false);\r\n\r\n    // Auth check\r\n    useEffect(() => {\r\n        if (!authLoading && userProfile?.role !== 'admin') {\r\n            router.push('/');\r\n        }\r\n    }, [authLoading, userProfile, router]);\r\n\r\n    // Load requests\r\n    const loadRequests = useCallback(async () => {\r\n        setLoading(true);\r\n        try {\r\n            const data = await getAllRequests();\r\n            setRequests(data);\r\n        } catch (error) {\r\n            console.error('Error loading requests:', error);\r\n        }\r\n        setLoading(false);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (userProfile?.role === 'admin') {\r\n            loadRequests();\r\n        }\r\n    }, [userProfile, loadRequests]);\r\n\r\n    const filteredRequests = requests.filter(r => {\r\n        if (tab === 0) return r.status === 'pending';\r\n        if (tab === 1) return r.status === 'approved';\r\n        return r.status === 'denied';\r\n    });\r\n\r\n    const handleApprove = async (request: FreeAccessRequest) => {\r\n        setProcessing(true);\r\n        try {\r\n            const success = await approveRequest(request.id, userProfile?.uid || '');\r\n            if (success) {\r\n                setSuccess(`Approved request for ${request.fullName}`);\r\n                loadRequests();\r\n            }\r\n        } catch (error) {\r\n            console.error('Error approving request:', error);\r\n            setError('Failed to approve request');\r\n        }\r\n        setProcessing(false);\r\n    };\r\n\r\n    const handleDenyClick = (request: FreeAccessRequest) => {\r\n        setSelectedRequest(request);\r\n        setDenyReason('');\r\n        setDenyDialogOpen(true);\r\n    };\r\n\r\n    const handleDenyConfirm = async () => {\r\n        if (!selectedRequest || !denyReason.trim()) return;\r\n\r\n        setProcessing(true);\r\n        try {\r\n            const success = await denyRequest(selectedRequest.id, userProfile?.uid || '', denyReason);\r\n            if (success) {\r\n                setSuccess(`Denied request for ${selectedRequest.fullName}`);\r\n                setDenyDialogOpen(false);\r\n                loadRequests();\r\n            }\r\n        } catch (error) {\r\n            console.error('Error denying request:', error);\r\n            setError('Failed to deny request');\r\n        }\r\n        setProcessing(false);\r\n    };\r\n\r\n    const handleViewDetails = (request: FreeAccessRequest) => {\r\n        setSelectedRequest(request);\r\n        setDetailDialogOpen(true);\r\n    };\r\n\r\n    const getStatusColor = (status: string) => {\r\n        switch (status) {\r\n            case 'pending': return 'warning';\r\n            case 'approved': return 'success';\r\n            case 'denied': return 'error';\r\n            default: return 'default';\r\n        }\r\n    };\r\n\r\n    const getTierColor = (tier: string) => {\r\n        switch (tier) {\r\n            case 'plus': return 'primary';\r\n            case 'pro': return 'secondary';\r\n            case 'ultimate': return 'warning';\r\n            default: return 'default';\r\n        }\r\n    };\r\n\r\n    if (authLoading || loading) {\r\n        return (\r\n            <Box sx={{ p: 4, display: 'flex', justifyContent: 'center' }}>\r\n                <CircularProgress />\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Box sx={{ p: 3 }}>\r\n            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>\r\n                <Typography variant=\"h5\" fontWeight=\"bold\">\r\n                    ≡ƒôï Access Requests\r\n                </Typography>\r\n                <Button startIcon={<RefreshIcon />} onClick={loadRequests}>\r\n                    Refresh\r\n                </Button>\r\n            </Box>\r\n\r\n            {success && <Alert severity=\"success\" sx={{ mb: 2 }} onClose={() => setSuccess('')}>{success}</Alert>}\r\n            {error && <Alert severity=\"error\" sx={{ mb: 2 }} onClose={() => setError('')}>{error}</Alert>}\r\n\r\n            <Paper sx={{ mb: 3 }}>\r\n                <Tabs value={tab} onChange={(_, v) => setTab(v)}>\r\n                    <Tab label={`Pending (${requests.filter(r => r.status === 'pending').length})`} />\r\n                    <Tab label={`Approved (${requests.filter(r => r.status === 'approved').length})`} />\r\n                    <Tab label={`Denied (${requests.filter(r => r.status === 'denied').length})`} />\r\n                </Tabs>\r\n            </Paper>\r\n\r\n            <TableContainer component={Paper}>\r\n                <Table>\r\n                    <TableHead>\r\n                        <TableRow>\r\n                            <TableCell>User</TableCell>\r\n                            <TableCell>Email</TableCell>\r\n                            <TableCell>Phone</TableCell>\r\n                            <TableCell>Tier</TableCell>\r\n                            <TableCell>Student</TableCell>\r\n                            <TableCell>Date</TableCell>\r\n                            <TableCell>Status</TableCell>\r\n                            <TableCell>Actions</TableCell>\r\n                        </TableRow>\r\n                    </TableHead>\r\n                    <TableBody>\r\n                        {filteredRequests.map((req) => (\r\n                            <TableRow key={req.id}>\r\n                                <TableCell>\r\n                                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                                        <Avatar sx={{ width: 32, height: 32 }}>{req.fullName[0]}</Avatar>\r\n                                        <Box>\r\n                                            <Typography variant=\"body2\" fontWeight=\"bold\">{req.fullName}</Typography>\r\n                                            <Typography variant=\"caption\" color=\"text.secondary\">@{req.username}</Typography>\r\n                                        </Box>\r\n                                    </Box>\r\n                                </TableCell>\r\n                                <TableCell>{req.email}</TableCell>\r\n                                <TableCell>{req.phone}</TableCell>\r\n                                <TableCell>\r\n                                    <Chip label={req.codeTier.toUpperCase()} color={getTierColor(req.codeTier)} size=\"small\" />\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    {req.isStudent ? (\r\n                                        <Chip label=\"≡ƒÄô Student\" size=\"small\" color=\"info\" />\r\n                                    ) : '-'}\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    {new Date(req.createdAt).toLocaleDateString()}\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    <Chip label={req.status} color={getStatusColor(req.status)} size=\"small\" />\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    <IconButton size=\"small\" onClick={() => handleViewDetails(req)}>\r\n                                        <VisibilityIcon fontSize=\"small\" />\r\n                                    </IconButton>\r\n                                    {req.status === 'pending' && (\r\n                                        <>\r\n                                            <IconButton\r\n                                                size=\"small\"\r\n                                                color=\"success\"\r\n                                                onClick={() => handleApprove(req)}\r\n                                                disabled={processing}\r\n                                            >\r\n                                                <CheckCircleIcon fontSize=\"small\" />\r\n                                            </IconButton>\r\n                                            <IconButton\r\n                                                size=\"small\"\r\n                                                color=\"error\"\r\n                                                onClick={() => handleDenyClick(req)}\r\n                                            >\r\n                                                <CancelIcon fontSize=\"small\" />\r\n                                            </IconButton>\r\n                                        </>\r\n                                    )}\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        ))}\r\n                        {filteredRequests.length === 0 && (\r\n                            <TableRow>\r\n                                <TableCell colSpan={8} align=\"center\" sx={{ py: 4 }}>\r\n                                    <Typography color=\"text.secondary\">No requests in this category</Typography>\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        )}\r\n                    </TableBody>\r\n                </Table>\r\n            </TableContainer>\r\n\r\n            {/* Deny Dialog */}\r\n            <Dialog open={denyDialogOpen} onClose={() => setDenyDialogOpen(false)} maxWidth=\"sm\" fullWidth>\r\n                <DialogTitle>Deny Request</DialogTitle>\r\n                <DialogContent>\r\n                    <Typography sx={{ mb: 2 }}>\r\n                        You are denying the request from <strong>{selectedRequest?.fullName}</strong>.\r\n                    </Typography>\r\n                    <TextField\r\n                        fullWidth\r\n                        multiline\r\n                        rows={3}\r\n                        label=\"Reason for Denial\"\r\n                        value={denyReason}\r\n                        onChange={(e) => setDenyReason(e.target.value)}\r\n                        placeholder=\"This reason will be shown to the user\"\r\n                        required\r\n                    />\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => setDenyDialogOpen(false)}>Cancel</Button>\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        color=\"error\"\r\n                        onClick={handleDenyConfirm}\r\n                        disabled={!denyReason.trim() || processing}\r\n                    >\r\n                        {processing ? <CircularProgress size={20} /> : 'Deny Request'}\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n\r\n            {/* Detail Dialog */}\r\n            <Dialog open={detailDialogOpen} onClose={() => setDetailDialogOpen(false)} maxWidth=\"sm\" fullWidth>\r\n                <DialogTitle>Request Details</DialogTitle>\r\n                <DialogContent>\r\n                    {selectedRequest && (\r\n                        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2, mt: 1 }}>\r\n                            <Box>\r\n                                <Typography variant=\"caption\" color=\"text.secondary\">Full Name</Typography>\r\n                                <Typography fontWeight=\"bold\">{selectedRequest.fullName}</Typography>\r\n                            </Box>\r\n                            <Box>\r\n                                <Typography variant=\"caption\" color=\"text.secondary\">Username</Typography>\r\n                                <Typography>@{selectedRequest.username}</Typography>\r\n                            </Box>\r\n                            <Box>\r\n                                <Typography variant=\"caption\" color=\"text.secondary\">Email</Typography>\r\n                                <Typography>{selectedRequest.email}</Typography>\r\n                            </Box>\r\n                            <Box>\r\n                                <Typography variant=\"caption\" color=\"text.secondary\">Phone</Typography>\r\n                                <Typography>{selectedRequest.phone}</Typography>\r\n                            </Box>\r\n                            <Box>\r\n                                <Typography variant=\"caption\" color=\"text.secondary\">Reason</Typography>\r\n                                <Typography sx={{ bgcolor: 'background.default', p: 2, borderRadius: 1 }}>\r\n                                    {selectedRequest.reason}\r\n                                </Typography>\r\n                            </Box>\r\n                            <Box>\r\n                                <Typography variant=\"caption\" color=\"text.secondary\">Code Used</Typography>\r\n                                <Typography fontFamily=\"monospace\">{selectedRequest.codeUsed}</Typography>\r\n                            </Box>\r\n                            {selectedRequest.isStudent && selectedRequest.studentProofUrl && (\r\n                                <Box>\r\n                                    <Typography variant=\"caption\" color=\"text.secondary\">Student Proof</Typography>\r\n                                    <Button\r\n                                        variant=\"outlined\"\r\n                                        href={selectedRequest.studentProofUrl}\r\n                                        target=\"_blank\"\r\n                                        fullWidth\r\n                                    >\r\n                                        View Document\r\n                                    </Button>\r\n                                </Box>\r\n                            )}\r\n                            {selectedRequest.status === 'denied' && selectedRequest.denialReason && (\r\n                                <Alert severity=\"error\">\r\n                                    <Typography variant=\"caption\" fontWeight=\"bold\">Denial Reason:</Typography>\r\n                                    <Typography>{selectedRequest.denialReason}</Typography>\r\n                                </Alert>\r\n                            )}\r\n                        </Box>\r\n                    )}\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => setDetailDialogOpen(false)}>Close</Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\cancellations\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\chat\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\events\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SIDEBAR_WIDTH' is assigned a value but never used.","line":20,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Box, AppBar, Toolbar, Typography, IconButton, useTheme, useMediaQuery, alpha } from '@mui/material';\r\nimport { usePathname } from 'next/navigation';\r\nimport { AnimatePresence } from 'framer-motion';\r\nimport PageTransition from '@/components/animation/PageTransition';\r\nimport AdminSidebar from '@/components/admin/AdminSidebar';\r\nimport Footer from '@/components/layout/Footer';\r\nimport MenuIcon from '@mui/icons-material/MenuRounded';\r\nimport CloseIcon from '@mui/icons-material/CloseRounded';\r\nimport NotificationsIcon from '@mui/icons-material/NotificationsNoneRounded';\r\n\r\nimport { Badge } from '@mui/material';\r\nimport { listenForAdminUnreadCount } from '@/services/supportService';\r\n\r\nimport AdminNotificationsMenu from '@/components/admin/AdminNotificationsMenu';\r\nimport { getPendingRequests } from '@/services/accessRequestService';\r\n\r\nconst SIDEBAR_WIDTH = 280;\r\n\r\nexport default function AdminLayout({ children }: { children: React.ReactNode }) {\r\n    const pathname = usePathname();\r\n    const [mobileOpen, setMobileOpen] = useState(false);\r\n    const [desktopOpen, setDesktopOpen] = useState(true);\r\n    const [unreadCount, setUnreadCount] = useState(0);\r\n    const [notificationAnchor, setNotificationAnchor] = useState<null | HTMLElement>(null);\r\n    const theme = useTheme();\r\n    const isMobile = useMediaQuery(theme.breakpoints.down('md'));\r\n\r\n    useEffect(() => {\r\n        // Listen for chat messages\r\n        const unsubscribe = listenForAdminUnreadCount((count) => {\r\n            // Also fetch pending requests count to update total badge\r\n            getPendingRequests().then(requests => {\r\n                setUnreadCount(count + requests.length);\r\n            }).catch(() => {\r\n                setUnreadCount(count);\r\n            });\r\n        });\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    const handleDrawerToggle = () => {\r\n        if (isMobile) {\r\n            setMobileOpen(!mobileOpen);\r\n        } else {\r\n            setDesktopOpen(!desktopOpen);\r\n        }\r\n    };\r\n\r\n    const handleNotificationClick = (event: React.MouseEvent<HTMLElement>) => {\r\n        setNotificationAnchor(event.currentTarget);\r\n    };\r\n\r\n    const handleNotificationClose = () => {\r\n        setNotificationAnchor(null);\r\n    };\r\n\r\n    const getPageTitle = (path: string) => {\r\n        const parts = path.split('/').filter(Boolean);\r\n        if (parts.length === 1 && parts[0] === 'admin') return 'Dashboard';\r\n        const lastPart = parts[parts.length - 1];\r\n        return lastPart.charAt(0).toUpperCase() + lastPart.slice(1);\r\n    };\r\n\r\n    return (\r\n        <Box sx={{ display: 'flex', minHeight: '100vh', bgcolor: 'background.default' }}>\r\n            {/* Sidebar Navigation */}\r\n            <AdminSidebar\r\n                mobileOpen={mobileOpen}\r\n                setMobileOpen={setMobileOpen}\r\n                desktopOpen={desktopOpen} // Pass desktop state\r\n                unreadCount={unreadCount}\r\n            />\r\n\r\n            {/* Main Content Area */}\r\n            <Box\r\n                component=\"main\"\r\n                sx={{\r\n                    flexGrow: 1,\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    minHeight: '100vh',\r\n                    minWidth: 0, // Critical for text truncation in flex children\r\n                    transition: 'width 0.3s ease',\r\n                }}\r\n            >\r\n                {/* Glassmorphic AppBar */}\r\n                <AppBar\r\n                    position=\"sticky\"\r\n                    elevation={0}\r\n                    sx={{\r\n                        bgcolor: alpha(theme.palette.background.default, 0.8),\r\n                        backdropFilter: 'blur(12px)',\r\n                        borderBottom: '1px solid',\r\n                        borderColor: 'divider',\r\n                        color: 'text.primary',\r\n                        transition: 'width 0.3s ease',\r\n                    }}\r\n                >\r\n                    <Toolbar sx={{ minHeight: { xs: 64, md: 72 } }}>\r\n                        {/* Hamburger Menu (Visible on both now) */}\r\n                        <IconButton\r\n                            color=\"inherit\"\r\n                            aria-label=\"open drawer\"\r\n                            edge=\"start\"\r\n                            onClick={handleDrawerToggle}\r\n                            sx={{\r\n                                mr: 2,\r\n                                // display: { md: 'none' }, // Removed to show on desktop\r\n                                bgcolor: alpha('#0F172A', 0.05),\r\n                                borderRadius: '12px',\r\n                                '&:hover': {\r\n                                    bgcolor: alpha('#0F172A', 0.1),\r\n                                },\r\n                            }}\r\n                        >\r\n                            {(isMobile ? mobileOpen : desktopOpen) ? <CloseIcon /> : <MenuIcon />}\r\n                        </IconButton>\r\n\r\n                        <Typography variant=\"h6\" component=\"h1\" sx={{ flexGrow: 1, fontWeight: 700, letterSpacing: 0.5 }}>\r\n                            {getPageTitle(pathname)}\r\n                        </Typography>\r\n\r\n                        {/* Right Side Actions */}\r\n                        <IconButton\r\n                            onClick={handleNotificationClick}\r\n                            sx={{\r\n                                color: 'text.secondary',\r\n                                '&:hover': { color: 'text.primary', bgcolor: 'action.hover' }\r\n                            }}\r\n                        >\r\n                            <Badge badgeContent={unreadCount} color=\"error\">\r\n                                <NotificationsIcon />\r\n                            </Badge>\r\n                        </IconButton>\r\n\r\n                        <AdminNotificationsMenu\r\n                            anchorEl={notificationAnchor}\r\n                            open={Boolean(notificationAnchor)}\r\n                            onClose={handleNotificationClose}\r\n                        />\r\n                    </Toolbar>\r\n                </AppBar>\r\n\r\n                {/* Page Content Container */}\r\n                <Box\r\n                    sx={{\r\n                        flexGrow: 1,\r\n                        p: { xs: 2.5, sm: 4, md: 5 },\r\n                        maxWidth: '100%',\r\n                        overflowX: 'hidden', // Prevent horizontal scroll on mobile\r\n                    }}\r\n                >\r\n                    <AnimatePresence mode=\"wait\">\r\n                        <PageTransition key={pathname}>\r\n                            {children}\r\n                        </PageTransition>\r\n                    </AnimatePresence>\r\n                </Box>\r\n\r\n                {/* Footer */}\r\n                <Box sx={{ mt: 'auto' }}>\r\n                    <Footer />\r\n                </Box>\r\n            </Box>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Paper' is defined but never used.","line":7,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CircularProgress' is defined but never used.","line":10,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n    Container,\r\n    Grid,\r\n    Paper,\r\n    Typography,\r\n    Box,\r\n    CircularProgress,\r\n    Skeleton,\r\n    Dialog,\r\n    DialogContent,\r\n    DialogTitle,\r\n    IconButton,\r\n} from '@mui/material';\r\nimport StatsCard from '@/components/admin/StatsCard';\r\nimport PeopleIcon from '@mui/icons-material/People';\r\nimport PaymentIcon from '@mui/icons-material/Payment';\r\nimport ScannerIcon from '@mui/icons-material/QrCodeScanner';\r\nimport TrendingUpIcon from '@mui/icons-material/TrendingUp';\r\nimport CloseIcon from '@mui/icons-material/Close';\r\nimport UpgradeRequestList from '@/components/admin/UpgradeRequestList';\r\nimport ActiveUsersGraph from '@/components/admin/ActiveUsersGraph';\r\nimport { getDashboardStats, DashboardStats, getUserActivityData, ActivityData } from '@/services/statsService';\r\n\r\nexport default function AdminDashboardPage() {\r\n    const [stats, setStats] = useState<DashboardStats | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [graphOpen, setGraphOpen] = useState(false);\r\n    const [activityData, setActivityData] = useState<ActivityData[]>([]);\r\n    const [graphLoading, setGraphLoading] = useState(false);\r\n\r\n    const handleOpenGraph = async () => {\r\n        setGraphOpen(true);\r\n        if (activityData.length === 0) {\r\n            setGraphLoading(true);\r\n            const data = await getUserActivityData();\r\n            setActivityData(data);\r\n            setGraphLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        const fetchStats = async () => {\r\n            try {\r\n                const data = await getDashboardStats();\r\n                setStats(data);\r\n            } catch (error) {\r\n                console.error('Failed to fetch stats:', error);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        fetchStats();\r\n    }, []);\r\n\r\n    const formatNumber = (num: number): string => {\r\n        if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';\r\n        if (num >= 1000) return (num / 1000).toFixed(1) + 'K';\r\n        return num.toLocaleString();\r\n    };\r\n\r\n    return (\r\n        <Container maxWidth=\"xl\">\r\n            <Box sx={{ mb: 4 }}>\r\n                <Typography variant=\"h4\" fontWeight=\"bold\" gutterBottom>\r\n                    Dashboard\r\n                </Typography>\r\n                <Typography variant=\"body1\" color=\"text.secondary\">\r\n                    Welcome to your admin dashboard\r\n                </Typography>\r\n            </Box>\r\n\r\n            <Grid container spacing={3}>\r\n                <Grid size={{ xs: 12, sm: 6, md: 3 }}>\r\n                    {loading ? (\r\n                        <Skeleton variant=\"rounded\" height={140} />\r\n                    ) : (\r\n                        <StatsCard\r\n                            title=\"Total Users\"\r\n                            value={formatNumber(stats?.totalUsers || 0)}\r\n                            icon={PeopleIcon}\r\n                            trend={stats?.userGrowth || 0}\r\n                            color=\"#6C63FF\"\r\n                            onClick={handleOpenGraph}\r\n                        />\r\n                    )}\r\n                </Grid>\r\n                <Grid size={{ xs: 12, sm: 6, md: 3 }}>\r\n                    {loading ? (\r\n                        <Skeleton variant=\"rounded\" height={140} />\r\n                    ) : (\r\n                        <StatsCard\r\n                            title=\"Revenue\"\r\n                            value={`$${formatNumber(stats?.totalRevenue || 0)}`}\r\n                            icon={PaymentIcon}\r\n                            trend={stats?.revenueGrowth || 0}\r\n                            color=\"#00F0FF\"\r\n                        />\r\n                    )}\r\n                </Grid>\r\n                <Grid size={{ xs: 12, sm: 6, md: 3 }}>\r\n                    {loading ? (\r\n                        <Skeleton variant=\"rounded\" height={140} />\r\n                    ) : (\r\n                        <StatsCard\r\n                            title=\"Total Scans\"\r\n                            value={formatNumber(stats?.totalScans || 0)}\r\n                            icon={ScannerIcon}\r\n                            trend={stats?.scanGrowth || 0}\r\n                            color=\"#FCD34D\"\r\n                        />\r\n                    )}\r\n                </Grid>\r\n                <Grid size={{ xs: 12, sm: 6, md: 3 }}>\r\n                    {loading ? (\r\n                        <Skeleton variant=\"rounded\" height={140} />\r\n                    ) : (\r\n                        <StatsCard\r\n                            title=\"Growth\"\r\n                            value={`${stats?.userGrowth || 0}%`}\r\n                            icon={TrendingUpIcon}\r\n                            trend={stats?.userGrowth || 0}\r\n                            color=\"#10B981\"\r\n                        />\r\n                    )}\r\n                </Grid>\r\n\r\n                <Grid container spacing={3} sx={{ mt: 1 }}>\r\n                    <Grid size={{ xs: 12 }}>\r\n                        <UpgradeRequestList />\r\n                    </Grid>\r\n                </Grid>\r\n\r\n                <Dialog\r\n                    open={graphOpen}\r\n                    onClose={() => setGraphOpen(false)}\r\n                    maxWidth=\"md\"\r\n                    fullWidth\r\n                    PaperProps={{\r\n                        sx: { borderRadius: 3, p: 1 }\r\n                    }}\r\n                >\r\n                    <DialogTitle sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', pb: 0 }}>\r\n                        <Typography variant=\"h6\" fontWeight=\"bold\">User Activity Analysis</Typography>\r\n                        <IconButton onClick={() => setGraphOpen(false)} size=\"small\">\r\n                            <CloseIcon />\r\n                        </IconButton>\r\n                    </DialogTitle>\r\n                    <DialogContent>\r\n                        <ActiveUsersGraph data={activityData} loading={graphLoading} />\r\n                    </DialogContent>\r\n                </Dialog>\r\n            </Grid>\r\n        </Container>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\payments\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkAdminRole'. Either include it or remove the dependency array.","line":81,"column":8,"nodeType":"ArrayExpression","endLine":81,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [user, router, checkAdminRole]","fix":{"range":[2505,2519],"text":"[user, router, checkAdminRole]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n    Container,\r\n    Paper,\r\n    Typography,\r\n    Box,\r\n    Button,\r\n    Chip,\r\n    Tab,\r\n    Tabs,\r\n    Card,\r\n    CardContent,\r\n    CardActions,\r\n    Grid,\r\n    TextField,\r\n    Dialog,\r\n    DialogTitle,\r\n    DialogContent,\r\n    DialogActions,\r\n    CircularProgress,\r\n    Alert,\r\n} from '@mui/material';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport CancelIcon from '@mui/icons-material/Cancel';\r\nimport PendingIcon from '@mui/icons-material/Pending';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport {\r\n    getAllPaymentRequests,\r\n    approvePaymentRequest,\r\n    rejectPaymentRequest,\r\n} from '@/services/paymentService';\r\nimport { PaymentRequest, PaymentStatus } from '@/types/payment';\r\n\r\nexport default function AdminPaymentsPage() {\r\n    const router = useRouter();\r\n    const { user } = useAuth();\r\n    const [loading, setLoading] = useState(true);\r\n    const [requests, setRequests] = useState<PaymentRequest[]>([]);\r\n    const [tabValue, setTabValue] = useState<number>(0);\r\n    const [rejectDialogOpen, setRejectDialogOpen] = useState(false);\r\n    const [selectedRequest, setSelectedRequest] = useState<PaymentRequest | null>(null);\r\n    const [rejectReason, setRejectReason] = useState('');\r\n    const [processing, setProcessing] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [isAdmin, setIsAdmin] = useState(false);\r\n\r\n    const checkAdminRole = async () => {\r\n        if (!user) return;\r\n        // In a real app, check claims. Here we assume manual check or proceed.\r\n        // For now, we will just set isAdmin to true if they are on this page (middleware should handle it)\r\n        // Or fetch profile again.\r\n        setIsAdmin(true);\r\n    };\r\n\r\n    const loadRequests = async () => {\r\n        setLoading(true);\r\n        setError(null);\r\n        try {\r\n            const allRequests = await getAllPaymentRequests();\r\n            setRequests(allRequests);\r\n        } catch (error) {\r\n            console.error('Error loading  payments:', error);\r\n            setError('Failed to load payment requests');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (!user) {\r\n            router.push('/login');\r\n            return;\r\n        }\r\n\r\n        checkAdminRole().then(() => {\r\n            loadRequests();\r\n        });\r\n    }, [user, router]);\r\n\r\n    const handleApprove = async (request: PaymentRequest) => {\r\n        if (!user || !request.id) return;\r\n\r\n        setProcessing(true);\r\n        setError(null);\r\n        try {\r\n            await approvePaymentRequest(request.id, user.uid);\r\n            await loadRequests(); // Reload list\r\n        } catch (error: unknown) {\r\n            const message = error instanceof Error ? error.message : 'Failed to approve request';\r\n            setError(message);\r\n        } finally {\r\n            setProcessing(false);\r\n        }\r\n    };\r\n\r\n    const handleRejectClick = (request: PaymentRequest) => {\r\n        setSelectedRequest(request);\r\n        setRejectDialogOpen(true);\r\n    };\r\n\r\n    const handleRejectConfirm = async () => {\r\n        if (!selectedRequest || !selectedRequest.id || !rejectReason.trim()) return;\r\n\r\n        setProcessing(true);\r\n        setError(null);\r\n        try {\r\n            await rejectPaymentRequest(selectedRequest.id, rejectReason);\r\n            setRejectDialogOpen(false);\r\n            setRejectReason('');\r\n            setSelectedRequest(null);\r\n            await loadRequests();\r\n        } catch (error: unknown) {\r\n            const message = error instanceof Error ? error.message : 'Failed to reject request';\r\n            setError(message);\r\n        } finally {\r\n            setProcessing(false);\r\n        }\r\n    };\r\n\r\n    const getFilteredRequests = () => {\r\n        const statusMap: Record<number, PaymentStatus | 'all'> = {\r\n            0: 'all',\r\n            1: 'pending',\r\n            2: 'approved',\r\n            3: 'rejected',\r\n        };\r\n\r\n        const filterStatus = statusMap[tabValue];\r\n        if (filterStatus === 'all') return requests;\r\n        return requests.filter(req => req.status === filterStatus);\r\n    };\r\n\r\n    const getStatusColor = (status: PaymentStatus) => {\r\n        switch (status) {\r\n            case 'pending':\r\n                return 'warning';\r\n            case 'approved':\r\n            case 'completed':\r\n                return 'success';\r\n            case 'rejected':\r\n                return 'error';\r\n            default:\r\n                return 'default';\r\n        }\r\n    };\r\n\r\n    const getStatusIcon = (status: PaymentStatus) => {\r\n        switch (status) {\r\n            case 'pending':\r\n                return <PendingIcon />;\r\n            case 'approved':\r\n            case 'completed':\r\n                return <CheckCircleIcon />;\r\n            case 'rejected':\r\n                return <CancelIcon />;\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <Container maxWidth=\"lg\" sx={{ mt: 5, textAlign: 'center' }}>\r\n                <CircularProgress />\r\n                <Typography variant=\"body2\" sx={{ mt: 2 }}>\r\n                    Verifying admin access...\r\n                </Typography>\r\n            </Container>\r\n        );\r\n    }\r\n\r\n    if (!isAdmin) {\r\n        return (\r\n            <Container maxWidth=\"md\" sx={{ mt: 5 }}>\r\n                <Alert severity=\"error\">\r\n                    <Typography variant=\"h6\" gutterBottom>\r\n                        Access Denied\r\n                    </Typography>\r\n                    <Typography variant=\"body2\">\r\n                        You do not have administrator privileges. This page is restricted to admin users only.\r\n                    </Typography>\r\n                    <Button\r\n                        variant=\"outlined\"\r\n                        onClick={() => router.push('/profile')}\r\n                        sx={{ mt: 2 }}\r\n                    >\r\n                        Go to Profile\r\n                    </Button>\r\n                </Alert>\r\n            </Container>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Container maxWidth=\"lg\" sx={{ mt: 5, mb: 10 }}>\r\n            <Typography variant=\"h4\" fontWeight=\"bold\" gutterBottom>\r\n                Free Access Requests\r\n            </Typography>\r\n\r\n            {error && (\r\n                <Alert severity=\"error\" sx={{ mb: 3 }} onClose={() => setError(null)}>\r\n                    {error}\r\n                </Alert>\r\n            )}\r\n\r\n            <Paper sx={{ mb: 3 }}>\r\n                <Tabs value={tabValue} onChange={(e, val) => setTabValue(val)} variant=\"fullWidth\">\r\n                    <Tab label=\"All\" />\r\n                    <Tab label=\"Pending\" />\r\n                    <Tab label=\"Approved\" />\r\n                    <Tab label=\"Rejected\" />\r\n                </Tabs>\r\n            </Paper>\r\n\r\n            <Grid container spacing={3}>\r\n                {getFilteredRequests().map((request) => (\r\n                    <Grid size={{ xs: 12, md: 6 }} key={request.id}>\r\n                        <Card>\r\n                            <CardContent>\r\n                                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\r\n                                    <Typography variant=\"h6\" fontWeight=\"bold\">\r\n                                        {request.userName}\r\n                                    </Typography>\r\n                                    <Chip\r\n                                        icon={getStatusIcon(request.status)}\r\n                                        label={request.status.toUpperCase()}\r\n                                        color={getStatusColor(request.status)}\r\n                                        size=\"small\"\r\n                                    />\r\n                                </Box>\r\n\r\n                                <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>\r\n                                    Email: {request.userEmail}\r\n                                </Typography>\r\n                                <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>\r\n                                    Tier: {request.tier.toUpperCase()}\r\n                                </Typography>\r\n                                <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>\r\n                                    Price: ${request.price.toFixed(2)}\r\n                                </Typography>\r\n                                <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>\r\n                                    Requested: {request.createdAt instanceof Date ? request.createdAt.toLocaleDateString() : 'N/A'}\r\n                                </Typography>\r\n\r\n                                {request.status === 'approved' && request.approvedAt && (\r\n                                    <Typography variant=\"caption\" color=\"success.main\" display=\"block\">\r\n                                        Approved on {request.approvedAt instanceof Date ? request.approvedAt.toLocaleDateString() : 'N/A'}\r\n                                    </Typography>\r\n                                )}\r\n\r\n                                {request.status === 'rejected' && request.rejectedReason && (\r\n                                    <Alert severity=\"error\" sx={{ mt: 2 }}>\r\n                                        <Typography variant=\"caption\">\r\n                                            Reason: {request.rejectedReason}\r\n                                        </Typography>\r\n                                    </Alert>\r\n                                )}\r\n                            </CardContent>\r\n\r\n                            {request.status === 'pending' && (\r\n                                <CardActions sx={{ justifyContent: 'flex-end', gap: 1 }}>\r\n                                    <Button\r\n                                        variant=\"outlined\"\r\n                                        color=\"error\"\r\n                                        size=\"small\"\r\n                                        startIcon={<CancelIcon />}\r\n                                        onClick={() => handleRejectClick(request)}\r\n                                        disabled={processing}\r\n                                    >\r\n                                        Reject\r\n                                    </Button>\r\n                                    <Button\r\n                                        variant=\"contained\"\r\n                                        color=\"success\"\r\n                                        size=\"small\"\r\n                                        startIcon={<CheckCircleIcon />}\r\n                                        onClick={() => handleApprove(request)}\r\n                                        disabled={processing}\r\n                                    >\r\n                                        Approve\r\n                                    </Button>\r\n                                </CardActions>\r\n                            )}\r\n                        </Card>\r\n                    </Grid>\r\n                ))}\r\n\r\n                {getFilteredRequests().length === 0 && (\r\n                    <Grid size={{ xs: 12 }}>\r\n                        <Typography variant=\"body1\" textAlign=\"center\" color=\"text.secondary\" sx={{ mt: 4 }}>\r\n                            No access requests found\r\n                        </Typography>\r\n                    </Grid>\r\n                )}\r\n            </Grid>\r\n\r\n            {/* Reject Dialog */}\r\n            <Dialog open={rejectDialogOpen} onClose={() => !processing && setRejectDialogOpen(false)} maxWidth=\"sm\" fullWidth>\r\n                <DialogTitle>Reject Payment Request</DialogTitle>\r\n                <DialogContent>\r\n                    <Typography variant=\"body2\" gutterBottom>\r\n                        Please provide a reason for rejecting this request:\r\n                    </Typography>\r\n                    <TextField\r\n                        autoFocus\r\n                        margin=\"dense\"\r\n                        label=\"Rejection Reason\"\r\n                        fullWidth\r\n                        multiline\r\n                        rows={3}\r\n                        value={rejectReason}\r\n                        onChange={(e) => setRejectReason(e.target.value)}\r\n                        disabled={processing}\r\n                    />\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => setRejectDialogOpen(false)} disabled={processing}>\r\n                        Cancel\r\n                    </Button>\r\n                    <Button\r\n                        onClick={handleRejectConfirm}\r\n                        color=\"error\"\r\n                        variant=\"contained\"\r\n                        disabled={processing || !rejectReason.trim()}\r\n                    >\r\n                        {processing ? <CircularProgress size={20} /> : 'Confirm Reject'}\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        </Container>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\pc-requests\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FormControl' is defined but never used.","line":17,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'InputLabel' is defined but never used.","line":18,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Select' is defined but never used.","line":19,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MenuItem' is defined but never used.","line":20,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":33,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4985,4988],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4985,4988],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n    Container,\r\n    Paper,\r\n    Typography,\r\n    Box,\r\n    Button,\r\n    Grid,\r\n    TextField,\r\n    CircularProgress,\r\n    Alert,\r\n    Divider,\r\n    Stack,\r\n    Chip,\r\n    FormControl,\r\n    InputLabel,\r\n    Select,\r\n    MenuItem\r\n} from '@mui/material';\r\nimport SaveIcon from '@mui/icons-material/Save';\r\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport { doc, getDoc, updateDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { db } from '@/lib/firebase';\r\nimport { PCBuildRequest, AdminBuildResponse, PCBuildRequestStatus, PCComponent } from '@/types/pcBuilder';\r\nimport { useAuth } from '@/context/AuthContext';\r\n\r\nexport default function AdminPCRequestDetail() {\r\n    const params = useParams();\r\n    const router = useRouter();\r\n    const { user } = useAuth();\r\n    const requestId = params.id as string;\r\n\r\n    const [loading, setLoading] = useState(true);\r\n    const [saving, setSaving] = useState(false);\r\n    const [request, setRequest] = useState<PCBuildRequest | null>(null);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [successMsg, setSuccessMsg] = useState<string | null>(null);\r\n\r\n    // Admin Response State\r\n    const [adminResponse, setAdminResponse] = useState<AdminBuildResponse>({\r\n        buildName: '',\r\n        totalPrice: 0,\r\n        components: [], // Starts empty, admin can type JSON or we can build a UI\r\n        adminNotes: '',\r\n        youtubeLink: '',\r\n        purchaseLinks: [],\r\n        createdAt: new Date().toISOString() // Placeholder\r\n    });\r\n\r\n    // For simple component entry for now (JSON string)\r\n    const [componentsJson, setComponentsJson] = useState('[]');\r\n\r\n    useEffect(() => {\r\n        const fetchRequest = async () => {\r\n            if (!requestId) return;\r\n            try {\r\n                const docRef = doc(db, 'pc_build_requests', requestId);\r\n                const docSnap = await getDoc(docRef);\r\n\r\n                if (docSnap.exists()) {\r\n                    const data = docSnap.data() as PCBuildRequest;\r\n                    setRequest(data);\r\n\r\n                    if (data.adminResponse) {\r\n                        setAdminResponse(data.adminResponse);\r\n                        setComponentsJson(JSON.stringify(data.adminResponse.components, null, 2));\r\n                    } else {\r\n                        // Initialize empty response\r\n                        setAdminResponse(prev => ({\r\n                            ...prev,\r\n                            // Inherit budget as initial price guess?\r\n                            totalPrice: data.formData?.budget || 0\r\n                        }));\r\n                    }\r\n                } else {\r\n                    setError('Request not found');\r\n                }\r\n            } catch (err) {\r\n                console.error(err);\r\n                setError('Failed to load request');\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchRequest();\r\n    }, [requestId]);\r\n\r\n    const handleStatusChange = async (newStatus: PCBuildRequestStatus) => {\r\n        if (!request) return;\r\n        try {\r\n            await updateDoc(doc(db, 'pc_build_requests', requestId), {\r\n                status: newStatus,\r\n                updatedAt: serverTimestamp()\r\n            });\r\n            setRequest(prev => prev ? { ...prev, status: newStatus } : null);\r\n            setSuccessMsg(`Status updated to ${newStatus}`);\r\n        } catch (err) {\r\n            console.error(err);\r\n            setError('Failed to update status');\r\n        }\r\n    };\r\n\r\n    const handleSaveResponse = async () => {\r\n        if (!request) return;\r\n        setSaving(true);\r\n        setError(null);\r\n        setSuccessMsg(null);\r\n\r\n        try {\r\n            // Parse components JSON\r\n            let parsedComponents: PCComponent[] = [];\r\n            try {\r\n                parsedComponents = JSON.parse(componentsJson);\r\n            } catch (error) {\r\n                console.error('Invalid JSON for components:', error);\r\n                throw new Error('Invalid JSON for components');\r\n            }\r\n\r\n            const responseToSave: AdminBuildResponse = {\r\n                ...adminResponse,\r\n                components: parsedComponents,\r\n                createdAt: new Date().toISOString() // Update timestamp\r\n            };\r\n\r\n            await updateDoc(doc(db, 'pc_build_requests', requestId), {\r\n                adminResponse: responseToSave,\r\n                status: 'completed', // Auto-complete on save? Or separate? Let's keep manual status control or set to Reviewing\r\n                updatedAt: serverTimestamp()\r\n            });\r\n\r\n            // Also update request local state\r\n            setRequest(prev => prev ? { ...prev, adminResponse: responseToSave } : null);\r\n            setSuccessMsg('Build plan saved');\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            setError(err.message || 'Failed to save response');\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    if (loading) return <Container sx={{ mt: 5, textAlign: 'center' }}><CircularProgress /></Container>;\r\n    if (error && !request) return <Container sx={{ mt: 5 }}><Alert severity=\"error\">{error}</Alert></Container>;\r\n    if (!request) return <Container sx={{ mt: 5 }}><Alert severity=\"info\">Request not found.</Alert></Container>;\r\n\r\n    return (\r\n        <Container maxWidth=\"lg\" sx={{ mt: 5, mb: 10 }}>\r\n            <Button startIcon={<ArrowBackIcon />} onClick={() => router.push('/admin/pc-requests')} sx={{ mb: 2 }}>\r\n                Back to List\r\n            </Button>\r\n\r\n            <Grid container spacing={3}>\r\n                {/* Left Column: User Request Details */}\r\n                <Grid size={{ xs: 12, md: 5 }}>\r\n                    <Paper sx={{ p: 3, position: 'sticky', top: 20 }}>\r\n                        <Typography variant=\"h6\" gutterBottom fontWeight=\"bold\">User Requirement</Typography>\r\n                        <Divider sx={{ mb: 2 }} />\r\n\r\n                        <Stack spacing={2}>\r\n                            <Box>\r\n                                <Typography variant=\"subtitle2\" color=\"text.secondary\">User</Typography>\r\n                                <Typography variant=\"body1\">{request.userEmail}</Typography>\r\n                            </Box>\r\n\r\n                            <Box>\r\n                                <Typography variant=\"subtitle2\" color=\"text.secondary\">Status</Typography>\r\n                                <Chip\r\n                                    label={request.status.toUpperCase()}\r\n                                    color={request.status === 'completed' ? 'success' : 'warning'}\r\n                                    size=\"small\"\r\n                                    sx={{ mt: 0.5 }}\r\n                                />\r\n                            </Box>\r\n\r\n                            <Box>\r\n                                <Typography variant=\"subtitle2\" color=\"text.secondary\">Update Status To</Typography>\r\n                                <Stack direction=\"row\" spacing={1} sx={{ mt: 1 }}>\r\n                                    <Button size=\"small\" variant=\"outlined\" onClick={() => handleStatusChange('reviewing')}>Reviewing</Button>\r\n                                    <Button size=\"small\" variant=\"outlined\" color=\"success\" onClick={() => handleStatusChange('completed')}>Completed</Button>\r\n                                </Stack>\r\n                            </Box>\r\n\r\n                            <Divider />\r\n\r\n                            {request.formData ? (\r\n                                <>\r\n                                    <Box>\r\n                                        <Typography variant=\"subtitle2\" color=\"text.secondary\">Budget</Typography>\r\n                                        <Typography variant=\"h5\" color=\"primary.main\">\r\n                                            {request.formData.currency} {request.formData.budget}\r\n                                        </Typography>\r\n                                    </Box>\r\n\r\n                                    <Box>\r\n                                        <Typography variant=\"subtitle2\" color=\"text.secondary\">Usage</Typography>\r\n                                        <Typography variant=\"body1\">{request.formData.usage}</Typography>\r\n                                    </Box>\r\n\r\n                                    <Box>\r\n                                        <Typography variant=\"subtitle2\" color=\"text.secondary\">Monitor Setup</Typography>\r\n                                        <Typography variant=\"body1\">\r\n                                            {request.formData.monitors}x Monitor(s) @ {request.formData.resolution}\r\n                                        </Typography>\r\n                                    </Box>\r\n\r\n                                    <Box>\r\n                                        <Typography variant=\"subtitle2\" color=\"text.secondary\">Peripherals</Typography>\r\n                                        <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 0.5, mt: 0.5 }}>\r\n                                            {request.formData.peripherals.length > 0 ? (\r\n                                                request.formData.peripherals.map((p, i) => <Chip key={i} label={p} size=\"small\" />)\r\n                                            ) : (\r\n                                                <Typography variant=\"body2\">None requested</Typography>\r\n                                            )}\r\n                                        </Box>\r\n                                    </Box>\r\n\r\n                                    <Box>\r\n                                        <Typography variant=\"subtitle2\" color=\"text.secondary\">Preferences / Notes</Typography>\r\n                                        <Paper variant=\"outlined\" sx={{ p: 2, mt: 1, bgcolor: 'background.default' }}>\r\n                                            <Typography variant=\"body2\" sx={{ whiteSpace: 'pre-wrap' }}>\r\n                                                {request.formData.preferences || 'No additional notes.'}\r\n                                            </Typography>\r\n                                        </Paper>\r\n                                    </Box>\r\n                                </>\r\n                            ) : (\r\n                                <Alert severity=\"warning\">User has not filled out the form yet.</Alert>\r\n                            )}\r\n                        </Stack>\r\n                    </Paper>\r\n                </Grid>\r\n\r\n                {/* Right Column: Admin Build Plan */}\r\n                <Grid size={{ xs: 12, md: 7 }}>\r\n                    <Paper sx={{ p: 3 }}>\r\n                        <Typography variant=\"h6\" gutterBottom fontWeight=\"bold\">Proposed Build</Typography>\r\n                        <Divider sx={{ mb: 3 }} />\r\n\r\n                        {successMsg && <Alert severity=\"success\" sx={{ mb: 3 }}>{successMsg}</Alert>}\r\n                        {error && <Alert severity=\"error\" sx={{ mb: 3 }}>{error}</Alert>}\r\n\r\n                        <Stack spacing={3}>\r\n                            <TextField\r\n                                label=\"Build Name / Title\"\r\n                                fullWidth\r\n                                value={adminResponse.buildName}\r\n                                onChange={e => setAdminResponse({ ...adminResponse, buildName: e.target.value })}\r\n                                placeholder=\"e.g., Ultimate 4K Gaming Beast\"\r\n                            />\r\n\r\n                            <Grid container spacing={2}>\r\n                                <Grid size={{ xs: 6 }}>\r\n                                    <TextField\r\n                                        label=\"Total Price\"\r\n                                        type=\"number\"\r\n                                        fullWidth\r\n                                        value={adminResponse.totalPrice}\r\n                                        onChange={e => setAdminResponse({ ...adminResponse, totalPrice: Number(e.target.value) })}\r\n                                        InputProps={{ startAdornment: <Typography sx={{ mr: 1 }}>{request.formData?.currency === 'EUR' ? 'Γé¼' : '$'}</Typography> }}\r\n                                    />\r\n                                </Grid>\r\n                                <Grid size={{ xs: 6 }}>\r\n                                    {/* Placeholder for future expansion */}\r\n                                </Grid>\r\n                            </Grid>\r\n\r\n                            <TextField\r\n                                label=\"Admin Notes & Recommendations\"\r\n                                multiline\r\n                                rows={4}\r\n                                fullWidth\r\n                                value={adminResponse.adminNotes}\r\n                                onChange={e => setAdminResponse({ ...adminResponse, adminNotes: e.target.value })}\r\n                                placeholder=\"Explain why you chose these parts...\"\r\n                            />\r\n\r\n                            <TextField\r\n                                label=\"YouTube Walkthrough/Guide URL\"\r\n                                fullWidth\r\n                                value={adminResponse.youtubeLink}\r\n                                onChange={e => setAdminResponse({ ...adminResponse, youtubeLink: e.target.value })}\r\n                                placeholder=\"https://youtube.com/...\"\r\n                            />\r\n\r\n                            <Box>\r\n                                <Typography variant=\"subtitle2\" gutterBottom>Components (JSON)</Typography>\r\n                                <Typography variant=\"caption\" color=\"text.secondary\" gutterBottom display=\"block\">\r\n                                    {'Paste the JSON array of components here. Use the format `[{\"type\": \"CPU\", \"name\": \"...\", \"price\": ... }]`'}\r\n                                </Typography>\r\n                                <TextField\r\n                                    multiline\r\n                                    rows={10}\r\n                                    fullWidth\r\n                                    value={componentsJson}\r\n                                    onChange={e => setComponentsJson(e.target.value)}\r\n                                    sx={{ fontFamily: 'monospace' }}\r\n                                />\r\n                            </Box>\r\n\r\n                            <Button\r\n                                variant=\"contained\"\r\n                                size=\"large\"\r\n                                startIcon={saving ? <CircularProgress size={20} color=\"inherit\" /> : <SaveIcon />}\r\n                                disabled={saving}\r\n                                onClick={handleSaveResponse}\r\n                                sx={{\r\n                                    mt: 2,\r\n                                    background: 'linear-gradient(45deg, #10B981 30%, #3B82F6 90%)'\r\n                                }}\r\n                            >\r\n                                {saving ? 'Saving...' : 'Save Build Plan'}\r\n                            </Button>\r\n                        </Stack>\r\n                    </Paper>\r\n                </Grid>\r\n            </Grid>\r\n        </Container>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\pc-requests\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'where' is defined but never used.","line":27,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":55}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n    Container,\r\n    Paper,\r\n    Typography,\r\n    Box,\r\n    Button,\r\n    Chip,\r\n    Tab,\r\n    Tabs,\r\n    Card,\r\n    CardContent,\r\n    CardActions,\r\n    Grid,\r\n    CircularProgress,\r\n    Alert,\r\n} from '@mui/material';\r\nimport VisibilityIcon from '@mui/icons-material/Visibility';\r\nimport PendingIcon from '@mui/icons-material/Pending';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport BuildIcon from '@mui/icons-material/Build';\r\nimport AccessTimeIcon from '@mui/icons-material/AccessTime';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { collection, onSnapshot, query, orderBy, where } from 'firebase/firestore';\r\nimport { db } from '@/lib/firebase';\r\nimport { PCBuildRequest, PCBuildRequestStatus } from '@/types/pcBuilder';\r\n\r\nexport default function AdminPCRequestsPage() {\r\n    const router = useRouter();\r\n    const { user } = useAuth();\r\n    const [loading, setLoading] = useState(true);\r\n    const [requests, setRequests] = useState<PCBuildRequest[]>([]);\r\n    const [tabValue, setTabValue] = useState<number>(0);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (!user) return; // Wait for auth\r\n\r\n        const q = query(collection(db, 'pc_build_requests'), orderBy('updatedAt', 'desc'));\r\n\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            const items: PCBuildRequest[] = [];\r\n            snapshot.forEach((doc) => {\r\n                items.push(doc.data() as PCBuildRequest);\r\n            });\r\n            setRequests(items);\r\n            setLoading(false);\r\n        }, (err) => {\r\n            console.error(\"Error fetching PC requests:\", err);\r\n            setError(\"Failed to load requests.\");\r\n            setLoading(false);\r\n        });\r\n\r\n        return () => unsubscribe();\r\n    }, [user]);\r\n\r\n    const getFilteredRequests = () => {\r\n        // 0: All\r\n        // 1: Action Required (submitted)\r\n        // 2: In Progress (reviewing)\r\n        // 3: Completed\r\n        // 4: Pending User (paid_pending_form, pending_payment)\r\n\r\n        switch (tabValue) {\r\n            case 0: return requests;\r\n            case 1: return requests.filter(r => r.status === 'submitted');\r\n            case 2: return requests.filter(r => r.status === 'reviewing');\r\n            case 3: return requests.filter(r => r.status === 'completed');\r\n            case 4: return requests.filter(r => ['paid_pending_form', 'pending_payment'].includes(r.status));\r\n            default: return requests;\r\n        }\r\n    };\r\n\r\n    const getStatusChip = (status: PCBuildRequestStatus) => {\r\n        switch (status) {\r\n            case 'completed':\r\n                return <Chip icon={<CheckCircleIcon />} label=\"Completed\" color=\"success\" size=\"small\" />;\r\n            case 'reviewing':\r\n                return <Chip icon={<BuildIcon />} label=\"Reviewing\" color=\"info\" size=\"small\" />;\r\n            case 'submitted':\r\n                return <Chip icon={<VisibilityIcon />} label=\"New Request\" color=\"warning\" size=\"small\" />;\r\n            case 'paid_pending_form':\r\n                return <Chip icon={<AccessTimeIcon />} label=\"Waiting for Form\" color=\"default\" size=\"small\" />;\r\n            case 'pending_payment':\r\n                return <Chip icon={<PendingIcon />} label=\"Payment Pending\" color=\"default\" variant=\"outlined\" size=\"small\" />;\r\n            default:\r\n                return <Chip label={status} size=\"small\" />;\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <Container maxWidth=\"lg\" sx={{ mt: 5, textAlign: 'center' }}>\r\n                <CircularProgress />\r\n            </Container>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Container maxWidth=\"lg\" sx={{ mt: 5, mb: 10 }}>\r\n            <Typography variant=\"h4\" fontWeight=\"bold\" gutterBottom>\r\n                PC Build Requests\r\n            </Typography>\r\n\r\n            {error && (\r\n                <Alert severity=\"error\" sx={{ mb: 3 }} onClose={() => setError(null)}>\r\n                    {error}\r\n                </Alert>\r\n            )}\r\n\r\n            <Paper sx={{ mb: 3 }}>\r\n                <Tabs\r\n                    value={tabValue}\r\n                    onChange={(e, val) => setTabValue(val)}\r\n                    variant=\"scrollable\"\r\n                    scrollButtons=\"auto\"\r\n                >\r\n                    <Tab label=\"All\" />\r\n                    <Tab label=\"New Requests\" />\r\n                    <Tab label=\"In Progress\" />\r\n                    <Tab label=\"Completed\" />\r\n                    <Tab label=\"Pending User\" />\r\n                </Tabs>\r\n            </Paper>\r\n\r\n            <Grid container spacing={3}>\r\n                {getFilteredRequests().map((req) => (\r\n                    <Grid size={{ xs: 12, md: 6, lg: 4 }} key={req.userId}>\r\n                        <Card sx={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\r\n                            <CardContent sx={{ flexGrow: 1 }}>\r\n                                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', mb: 2 }}>\r\n                                    <Typography variant=\"h6\" fontWeight=\"bold\" noWrap sx={{ maxWidth: '70%' }}>\r\n                                        {req.userEmail}\r\n                                    </Typography>\r\n                                    {getStatusChip(req.status)}\r\n                                </Box>\r\n\r\n                                {req.formData ? (\r\n                                    <>\r\n                                        <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>\r\n                                            <strong>Budget:</strong> {req.formData.currency} {req.formData.budget}\r\n                                        </Typography>\r\n                                        <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>\r\n                                            <strong>Usage:</strong> {req.formData.usage}\r\n                                        </Typography>\r\n                                        <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>\r\n                                            <strong>Country:</strong> {req.formData.country}\r\n                                        </Typography>\r\n                                    </>\r\n                                ) : (\r\n                                    <Typography variant=\"body2\" color=\"text.secondary\" fontStyle=\"italic\">\r\n                                        Form not submitted yet.\r\n                                    </Typography>\r\n                                )}\r\n\r\n                                <Typography variant=\"caption\" display=\"block\" sx={{ mt: 2, color: 'text.disabled' }}>\r\n                                    Updated: {req.updatedAt ? new Date(req.updatedAt).toLocaleDateString() : 'N/A'}\r\n                                </Typography>\r\n                            </CardContent>\r\n                            <CardActions sx={{ p: 2, pt: 0 }}>\r\n                                <Button\r\n                                    size=\"small\"\r\n                                    variant=\"contained\"\r\n                                    fullWidth\r\n                                    onClick={() => router.push(`/admin/pc-requests/${req.userId}`)}\r\n                                >\r\n                                    Manage Request\r\n                                </Button>\r\n                            </CardActions>\r\n                        </Card>\r\n                    </Grid>\r\n                ))}\r\n\r\n                {getFilteredRequests().length === 0 && (\r\n                    <Grid size={{ xs: 12 }}>\r\n                        <Box sx={{ py: 8, textAlign: 'center' }}>\r\n                            <Typography color=\"text.secondary\">No requests found in this category.</Typography>\r\n                        </Box>\r\n                    </Grid>\r\n                )}\r\n            </Grid>\r\n        </Container>\r\n    );\r\n}\r\n\r\n// Add these types if they are missing in your local file to make it compile,\r\n// though they should be imported from types/pcBuilder.ts\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\settings\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EventManagerConfig' is defined but never used.","line":27,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2192,2195],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2192,2195],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loadingModels' is assigned a value but never used.","line":97,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":25},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchSettings' and 'router'. Either include them or remove the dependency array.","line":130,"column":8,"nodeType":"ArrayExpression","endLine":130,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [userProfile, authLoading, fetchSettings, router]","fix":{"range":[4553,4579],"text":"[userProfile, authLoading, fetchSettings, router]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":402,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":402,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15602,15605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15602,15605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":420,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":420,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16506,16509],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16506,16509],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":501,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":501,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19777,19780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19777,19780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":508,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":508,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20128,20131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20128,20131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":525,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":525,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20839,20842],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20839,20842],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":640,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":640,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26001,26004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26001,26004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n    Box,\r\n    Typography,\r\n    CircularProgress,\r\n    Snackbar,\r\n    Alert,\r\n    Tabs,\r\n    Tab,\r\n    Paper\r\n} from '@mui/material';\r\nimport SettingsSuggestIcon from '@mui/icons-material/SettingsSuggest';\r\nimport SmartToyIcon from '@mui/icons-material/SmartToy';\r\nimport CloudQueueIcon from '@mui/icons-material/CloudQueue';\r\nimport { getSystemSettings, updateSystemSettings } from '@/services/systemService';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport axios from 'axios';\r\n\r\n// Import Sub-Components\r\nimport GeneralSettingsTab from '@/components/admin/settings/GeneralSettingsTab';\r\nimport AISettingsTab from '@/components/admin/settings/AISettingsTab';\r\nimport SystemSettingsTab from '@/components/admin/settings/SystemSettingsTab';\r\n\r\nimport { EventManagerConfig } from '@/types/system';\r\n\r\nexport default function AdminSettingsPage() {\r\n    const { user, userProfile, loading: authLoading } = useAuth();\r\n    const router = useRouter();\r\n    const searchParams = useSearchParams();\r\n\r\n    // Tab State (Default to 0 or URL param)\r\n    const initialTab = parseInt(searchParams.get('tab') || '0');\r\n    const [tabValue, setTabValue] = useState(initialTab);\r\n\r\n    const [loading, setLoading] = useState(true);\r\n    const [msg, setMsg] = useState({ type: 'success', text: '' });\r\n    const [showKeys, setShowKeys] = useState<Record<string, boolean>>({});\r\n\r\n    // General Settings\r\n    const [maintenanceMode, setMaintenanceMode] = useState(false);\r\n    const [betaMode, setBetaMode] = useState(false);\r\n    const [branding, setBranding] = useState({\r\n        faviconUrl: '',\r\n        appleTouchIconUrl: '',\r\n        androidIcon192Url: '',\r\n        androidIcon512Url: ''\r\n    });\r\n    const [savingBranding, setSavingBranding] = useState(false);\r\n\r\n    // Secure API Keys (stored in _system_secrets - backend only access)\r\n    const [secureKeys, setSecureKeys] = useState<Record<string, string>>({\r\n        groq: '',\r\n        gemini: '',\r\n        deepseek: '',\r\n        openai: ''\r\n    });\r\n    const [models, setModels] = useState<any>({});\r\n    const [savingSecure, setSavingSecure] = useState(false);\r\n\r\n    // --- FREE API KEYS ---\r\n    const [freeApiKeys, setFreeApiKeys] = useState({\r\n        gemini: '',\r\n        groq: '',\r\n        openai: '',\r\n        deepseek: '',\r\n        cerebras: '',\r\n        sambanova: '',\r\n        serpapi: ''\r\n    });\r\n    const [savingFreeKeys, setSavingFreeKeys] = useState(false);\r\n\r\n    // --- SEARXNG SETTINGS ---\r\n    const [searxngConfig, setSearxngConfig] = useState({\r\n        searxngUrl: ''\r\n    });\r\n    const [savingSearxng, setSavingSearxng] = useState(false);\r\n\r\n    // --- GITHUB MODELS (PC BUILDER) ---\r\n    const [githubModelsConfig, setGithubModelsConfig] = useState({\r\n        githubModelsToken: '',\r\n        githubModelsModel: 'gpt-4o'\r\n    });\r\n    const [savingGithubModels, setSavingGithubModels] = useState(false);\r\n\r\n    // --- OLLAMA SETTINGS ---\r\n    const [ollamaConfig, setOllamaConfig] = useState({\r\n        ollamaUrl: '',\r\n        ollamaFallbackUrl: '',\r\n        defaultOllamaModel: '',\r\n        ollamaModels: {} as Record<string, boolean>\r\n    });\r\n    const [savingOllama, setSavingOllama] = useState(false);\r\n    const [availableModels, setAvailableModels] = useState<string[]>([]);\r\n    const [loadingModels, setLoadingModels] = useState(false);\r\n\r\n    // --- DEEPSEEK SETTINGS ---\r\n    const [deepseekConfig, setDeepSeekConfig] = useState({\r\n        deepseekBaseUrl: 'https://api.deepseek.com'\r\n    });\r\n    const [savingDeepSeek, setSavingDeepSeek] = useState(false);\r\n\r\n    // --- OPENROUTER SETTINGS ---\r\n    const [openrouterConfig, setOpenRouterConfig] = useState({\r\n        openrouterApiKey: '',\r\n        openrouterModel: 'meta-llama/llama-3.1-8b-instruct:free'\r\n    });\r\n    const [savingOpenRouter, setSavingOpenRouter] = useState(false);\r\n\r\n    // --- BACKUP SETTINGS ---\r\n    const [runningBackup, setRunningBackup] = useState(false);\r\n\r\n    // --- PC CONSULTATION PRICE ---\r\n    const [pcConsultationPrice, setPcConsultationPrice] = useState(2000);\r\n    const [savingPcPrice, setSavingPcPrice] = useState(false);\r\n\r\n    // --- EVENT MANAGER SETTINGS ---\r\n    // Moved to /admin/events\r\n\r\n    useEffect(() => {\r\n        if (!authLoading) {\r\n            if (userProfile?.role !== 'admin') {\r\n                router.push('/');\r\n                return;\r\n            }\r\n            fetchSettings();\r\n        }\r\n    }, [userProfile, authLoading]);\r\n\r\n    // Update URL when tab changes\r\n    const handleTabChange = (event: React.SyntheticEvent, newValue: number) => {\r\n        setTabValue(newValue);\r\n        const params = new URLSearchParams(searchParams.toString());\r\n        params.set('tab', newValue.toString());\r\n        router.push(`?${params.toString()}`, { scroll: false });\r\n    };\r\n\r\n    const fetchSettings = async () => {\r\n        try {\r\n            const settings = await getSystemSettings();\r\n\r\n            // Load environment variable keys as fallback/current values\r\n            const envKeys = {\r\n                gemini: process.env.NEXT_PUBLIC_GEMINI_API_KEY || '',\r\n                groq: process.env.NEXT_PUBLIC_GROQ_API_KEY || '',\r\n                openai: process.env.NEXT_PUBLIC_OPENAI_API_KEY || '',\r\n                deepseek: process.env.NEXT_PUBLIC_DEEPSEEK_API_KEY || '',\r\n                cerebras: process.env.NEXT_PUBLIC_CEREBRAS_API_KEY || '',\r\n                sambanova: process.env.NEXT_PUBLIC_SAMBANOVA_API_KEY || '',\r\n                serpapi: process.env.NEXT_PUBLIC_SERPAPI_API_KEY || '',\r\n            };\r\n\r\n            setFreeApiKeys({\r\n                gemini: settings.apiKeys?.gemini || envKeys.gemini,\r\n                groq: settings.apiKeys?.groq || envKeys.groq,\r\n                openai: settings.apiKeys?.openai || envKeys.openai,\r\n                deepseek: settings.apiKeys?.deepseek || envKeys.deepseek,\r\n                cerebras: settings.apiKeys?.cerebras || envKeys.cerebras,\r\n                sambanova: settings.apiKeys?.sambanova || envKeys.sambanova,\r\n                serpapi: settings.apiKeys?.serpapi || envKeys.serpapi,\r\n            });\r\n\r\n            setSearxngConfig({\r\n                searxngUrl: settings.apiKeys?.searxngUrl || 'http://20.199.129.203:8080',\r\n            });\r\n\r\n            // Load GitHub Models config\r\n            setGithubModelsConfig({\r\n                githubModelsToken: settings.apiKeys?.githubModelsToken || '',\r\n                githubModelsModel: settings.apiKeys?.githubModelsModel || 'gpt-4o'\r\n            });\r\n\r\n            setModels(settings.apiKeys?.models || {});\r\n\r\n            setOllamaConfig({\r\n                ollamaUrl: settings.apiKeys?.ollamaUrl || 'http://20.199.129.203:11434',\r\n                ollamaFallbackUrl: settings.apiKeys?.ollamaFallbackUrl || '',\r\n                defaultOllamaModel: settings.apiKeys?.defaultOllamaModel || '',\r\n                ollamaModels: settings.apiKeys?.ollamaModels || {}\r\n            });\r\n\r\n            setDeepSeekConfig({\r\n                deepseekBaseUrl: settings.apiKeys?.deepseekBaseUrl || 'https://api.deepseek.com'\r\n            });\r\n\r\n            setOpenRouterConfig({\r\n                openrouterApiKey: settings.apiKeys?.openrouterApiKey || '',\r\n                openrouterModel: settings.apiKeys?.openrouterModel || 'meta-llama/llama-3.1-8b-instruct:free'\r\n            });\r\n\r\n            // Load Models list if Ollama URL exists\r\n            const currentOllamaUrl = settings.apiKeys?.ollamaUrl || 'http://20.199.129.203:11434';\r\n            if (currentOllamaUrl) {\r\n                fetchOllamaModels(currentOllamaUrl, false);\r\n            }\r\n\r\n            if (settings.branding) {\r\n                setBranding({\r\n                    faviconUrl: settings.branding.faviconUrl || '',\r\n                    appleTouchIconUrl: settings.branding.appleTouchIconUrl || '',\r\n                    androidIcon192Url: settings.branding.androidIcon192Url || '',\r\n                    androidIcon512Url: settings.branding.androidIcon512Url || ''\r\n                });\r\n            }\r\n\r\n            if (typeof settings.maintenanceMode !== 'undefined') {\r\n                setMaintenanceMode(settings.maintenanceMode);\r\n            }\r\n            if (typeof settings.betaAccess !== 'undefined') {\r\n                setBetaMode(settings.betaAccess);\r\n            }\r\n            if (typeof settings.pcConsultationPrice !== 'undefined') {\r\n                setPcConsultationPrice(settings.pcConsultationPrice);\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error(error);\r\n            setMsg({ type: 'error', text: 'Failed to load settings' });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const toggleShow = (key: string) => {\r\n        setShowKeys(prev => ({ ...prev, [key]: !prev[key] }));\r\n    };\r\n\r\n    // --- HANDLERS (Moved from inline to functions where possible, or kept here if simple) ---\r\n\r\n    const updateMaintenanceMode = async (val: boolean) => {\r\n        try {\r\n            await updateSystemSettings({ maintenanceMode: val });\r\n            setMsg({ type: 'success', text: `Maintenance mode ${val ? 'enabled' : 'disabled'}` });\r\n        } catch (e) {\r\n            console.error(e);\r\n            setMsg({ type: 'error', text: 'Failed to update maintenance mode' });\r\n            setMaintenanceMode(!val); // Revert\r\n        }\r\n    };\r\n\r\n    const updateBetaMode = async (val: boolean) => {\r\n        try {\r\n            await updateSystemSettings({ betaAccess: val });\r\n            setMsg({ type: 'success', text: `Beta features ${val ? 'enabled' : 'disabled'}` });\r\n        } catch (e) {\r\n            console.error(e);\r\n            setMsg({ type: 'error', text: 'Failed to update beta config' });\r\n            setBetaMode(!val); // Revert\r\n        }\r\n    };\r\n\r\n    const handleSaveFreeKeys = async () => {\r\n        setSavingFreeKeys(true);\r\n        try {\r\n            const currentSettings = await getSystemSettings();\r\n            const updatedApiKeys = {\r\n                ...currentSettings.apiKeys,\r\n                ...freeApiKeys\r\n            };\r\n            await updateSystemSettings({ apiKeys: updatedApiKeys });\r\n            setMsg({ type: 'success', text: 'Free API Keys updated!' });\r\n        } catch (error) {\r\n            console.error('Save Free Keys Error:', error);\r\n            setMsg({ type: 'error', text: 'Failed to save API keys' });\r\n        } finally {\r\n            setSavingFreeKeys(false);\r\n        }\r\n    };\r\n\r\n    const handleSaveSearxng = async () => {\r\n        setSavingSearxng(true);\r\n        try {\r\n            const currentSettings = await getSystemSettings();\r\n            const updatedApiKeys = {\r\n                ...currentSettings.apiKeys,\r\n                ...searxngConfig\r\n            };\r\n            await updateSystemSettings({ apiKeys: updatedApiKeys });\r\n            setMsg({ type: 'success', text: 'SearXNG Settings updated!' });\r\n        } catch (error) {\r\n            console.error('Save SearXNG Error:', error);\r\n            setMsg({ type: 'error', text: 'Failed to save SearXNG settings' });\r\n        } finally {\r\n            setSavingSearxng(false);\r\n        }\r\n    };\r\n\r\n    const handleSaveGithubModels = async () => {\r\n        setSavingGithubModels(true);\r\n        try {\r\n            const currentSettings = await getSystemSettings();\r\n            const updatedApiKeys = {\r\n                ...currentSettings.apiKeys,\r\n                ...githubModelsConfig\r\n            };\r\n            await updateSystemSettings({ apiKeys: updatedApiKeys });\r\n            setMsg({ type: 'success', text: 'GitHub Models config saved!' });\r\n        } catch (error) {\r\n            console.error('Save GitHub Models Error:', error);\r\n            setMsg({ type: 'error', text: 'Failed to save GitHub Models config' });\r\n        } finally {\r\n            setSavingGithubModels(false);\r\n        }\r\n    };\r\n\r\n    const handleSaveOllama = async () => {\r\n        setSavingOllama(true);\r\n        try {\r\n            const currentSettings = await getSystemSettings();\r\n            const updatedApiKeys = {\r\n                ...currentSettings.apiKeys,\r\n                ...ollamaConfig\r\n            };\r\n            if (!updatedApiKeys.ollamaModels) {\r\n                updatedApiKeys.ollamaModels = {};\r\n            }\r\n            await updateSystemSettings({ apiKeys: updatedApiKeys });\r\n            setMsg({ type: 'success', text: 'Ollama Settings updated!' });\r\n        } catch (error) {\r\n            console.error('Save Ollama Error:', error);\r\n            setMsg({ type: 'error', text: 'Failed to save Ollama settings' });\r\n        } finally {\r\n            setSavingOllama(false);\r\n        }\r\n    };\r\n\r\n    const handleSaveDeepSeek = async () => {\r\n        setSavingDeepSeek(true);\r\n        try {\r\n            const currentSettings = await getSystemSettings();\r\n            const updatedApiKeys = {\r\n                ...currentSettings.apiKeys,\r\n                ...deepseekConfig\r\n            };\r\n            await updateSystemSettings({ apiKeys: updatedApiKeys });\r\n            setMsg({ type: 'success', text: 'DeepSeek Settings updated!' });\r\n        } catch (error) {\r\n            console.error('Save DeepSeek Error:', error);\r\n            setMsg({ type: 'error', text: 'Failed to save DeepSeek settings' });\r\n        } finally {\r\n            setSavingDeepSeek(false);\r\n        }\r\n    };\r\n\r\n    const handleSaveOpenRouter = async () => {\r\n        setSavingOpenRouter(true);\r\n        try {\r\n            const currentSettings = await getSystemSettings();\r\n            const updatedApiKeys = {\r\n                ...currentSettings.apiKeys,\r\n                ...openrouterConfig\r\n            };\r\n            await updateSystemSettings({ apiKeys: updatedApiKeys });\r\n            setMsg({ type: 'success', text: 'OpenRouter Settings updated!' });\r\n        } catch (error) {\r\n            console.error('Save OpenRouter Error:', error);\r\n            setMsg({ type: 'error', text: 'Failed to save OpenRouter settings' });\r\n        } finally {\r\n            setSavingOpenRouter(false);\r\n        }\r\n    };\r\n\r\n    const handleSaveBranding = async () => {\r\n        setSavingBranding(true);\r\n        try {\r\n            await updateSystemSettings({ branding });\r\n            setMsg({ type: 'success', text: 'Branding updated!' });\r\n        } catch (error) {\r\n            console.error('Save Branding Error:', error);\r\n            setMsg({ type: 'error', text: 'Failed to save branding' });\r\n        } finally {\r\n            setSavingBranding(false);\r\n        }\r\n    };\r\n\r\n    const handleSavePcPrice = async () => {\r\n        setSavingPcPrice(true);\r\n        try {\r\n            await updateSystemSettings({ pcConsultationPrice });\r\n            setMsg({ type: 'success', text: 'PC Consultation Price updated!' });\r\n        } catch (error) {\r\n            console.error('Save Price Error:', error);\r\n            setMsg({ type: 'error', text: 'Failed to update price' });\r\n        } finally {\r\n            setSavingPcPrice(false);\r\n        }\r\n    };\r\n\r\n    const fetchOllamaModels = async (url: string, showMsg = true) => {\r\n        if (!url || !user) return;\r\n        setLoadingModels(true);\r\n        try {\r\n            console.log('[ADMIN] Fetching models via proxy for:', url);\r\n            const token = await user.getIdToken();\r\n            const response = await axios.get('/api/admin/ollama/models', {\r\n                params: { url: url },\r\n                headers: { Authorization: `Bearer ${token}` }\r\n            });\r\n\r\n            const models = response.data.models?.map((m: any) => m.name) || [];\r\n            if (models.length > 0) {\r\n                setAvailableModels(models);\r\n                setOllamaConfig(prev => {\r\n                    const currentModels = prev.ollamaModels || {};\r\n                    const newModels = { ...currentModels };\r\n                    models.forEach((m: string) => {\r\n                        if (newModels[m] === undefined) {\r\n                            newModels[m] = true;\r\n                        }\r\n                    });\r\n                    return { ...prev, ollamaModels: newModels };\r\n                });\r\n                if (showMsg) setMsg({ type: 'success', text: `Found ${models.length} AI models!` });\r\n            } else {\r\n                setAvailableModels([]);\r\n                if (showMsg) setMsg({ type: 'warning', text: 'Connected to server, but no models found installed.' });\r\n            }\r\n        } catch (error: any) {\r\n            console.error('[ADMIN] Failed to fetch models:', error);\r\n            const errorMsg = error.response?.data?.error || error.message || 'Unknown error';\r\n            const debugInfo = error.response?.data?.debug ? JSON.stringify(error.response.data.debug) : '';\r\n\r\n            if (showMsg) {\r\n                setMsg({\r\n                    type: 'error',\r\n                    text: `Connection Failed: ${errorMsg}. ${debugInfo ? '(Check console for debug details)' : ''}`\r\n                });\r\n            }\r\n            if (debugInfo) console.error('[ADMIN] Debug Info:', debugInfo);\r\n        } finally {\r\n            setLoadingModels(false);\r\n        }\r\n    };\r\n\r\n    const toggleModel = (modelName: string) => {\r\n        setOllamaConfig(prev => ({\r\n            ...prev,\r\n            ollamaModels: {\r\n                ...prev.ollamaModels,\r\n                [modelName]: !prev.ollamaModels?.[modelName]\r\n            }\r\n        }));\r\n    };\r\n\r\n\r\n\r\n    const handleTestAndSave = async (provider: string, apiKey: string, modelId: string) => {\r\n        if (!user) return;\r\n        // If key is masked (********) or empty, we might be only updating the model. \r\n        // But for safety, we usually require re-entry to test. \r\n        // Actually, if key is empty/masked, we can't test because client doesn't have the real key.\r\n        // So for \"Secure Config\", we only test if the user Provides a NEW key.\r\n        // If Key is empty (unchanged), we only save the model settings but we can't test the connection.\r\n\r\n        let shouldTest = true;\r\n        if (!apiKey || apiKey.includes('****')) {\r\n            shouldTest = false;\r\n            // We can't test without the key. Just save the model? \r\n            // Ideally we check if model changed.\r\n        }\r\n\r\n        setSavingSecure(true);\r\n        try {\r\n            const token = await user.getIdToken();\r\n\r\n            if (shouldTest) {\r\n                // 1. Verify Connection\r\n                setMsg({ type: 'info', text: `Testing connection to ${provider}...` });\r\n                await axios.post('/api/admin/ai-test', {\r\n                    provider,\r\n                    apiKey,\r\n                    modelId,\r\n                    baseUrl: provider === 'deepseek' ? deepseekConfig.deepseekBaseUrl : undefined\r\n                }, { headers: { Authorization: `Bearer ${token}` } });\r\n\r\n                // If we get here, test passed\r\n                setMsg({ type: 'success', text: 'Γ£à Connection Verified! Saving...' });\r\n\r\n                // 2. Save Key\r\n                await axios.post('/api/admin/keys', {\r\n                    action: 'save',\r\n                    provider,\r\n                    key: apiKey\r\n                }, { headers: { Authorization: `Bearer ${token}` } });\r\n            }\r\n\r\n            // 3. Save Model Config (Always save if we got here)\r\n            const currentSettings = await getSystemSettings();\r\n            const updatedApiKeys = {\r\n                ...currentSettings.apiKeys,\r\n                models: {\r\n                    ...models,\r\n                    [provider]: modelId\r\n                }\r\n            };\r\n            await updateSystemSettings({ apiKeys: updatedApiKeys });\r\n\r\n            // Update local state models\r\n            setModels((prev: any) => ({ ...prev, [provider]: modelId }));\r\n\r\n            setMsg({ type: 'success', text: `≡ƒÄë ${provider.charAt(0).toUpperCase() + provider.slice(1)} Config Saved & Verified!` });\r\n\r\n            // Clear the key field for security (it's masked on reload)\r\n            setSecureKeys(prev => ({ ...prev, [provider]: '' }));\r\n\r\n        } catch (error: any) {\r\n            console.error('Save Failed:', error);\r\n            const errMsg = error.response?.data?.error || error.message;\r\n            setMsg({ type: 'error', text: `Γ¥î Save Failed: ${errMsg}` });\r\n        } finally {\r\n            setSavingSecure(false);\r\n        }\r\n    };\r\n\r\n    const handleRunBackup = async () => {\r\n        setRunningBackup(true);\r\n        try {\r\n            const token = await user?.getIdToken();\r\n            const res = await axios.post('/api/admin/backup', {}, {\r\n                headers: { Authorization: `Bearer ${token}` }\r\n            });\r\n            setMsg({ type: 'success', text: `Backup completed! ${res.data.recordsBackedUp} records saved.` });\r\n        } catch (e: any) {\r\n            setMsg({ type: 'error', text: e.response?.data?.error || 'Backup failed' });\r\n        } finally {\r\n            setRunningBackup(false);\r\n        }\r\n    };\r\n\r\n\r\n\r\n\r\n    if (loading || authLoading) {\r\n        return (\r\n            <Box sx={{ display: 'flex', justifyContent: 'center', p: 5 }}>\r\n                <CircularProgress />\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Box sx={{ maxWidth: 1000, mx: 'auto', p: { xs: 1, sm: 2 } }}>\r\n            <Typography variant=\"h4\" fontWeight=\"bold\" sx={{ mb: 1, fontSize: { xs: '1.75rem', sm: '2.125rem' }, color: '#333' }}>\r\n                System Settings\r\n            </Typography>\r\n            <Typography color=\"text.secondary\" sx={{ mb: 4 }}>\r\n                Manage global configuration, AI services, and integrations.\r\n            </Typography>\r\n\r\n            <Paper sx={{ mb: 3 }}>\r\n                <Tabs\r\n                    value={tabValue}\r\n                    onChange={handleTabChange}\r\n                    indicatorColor=\"primary\"\r\n                    textColor=\"primary\"\r\n                    variant=\"fullWidth\"\r\n                    sx={{ borderBottom: 1, borderColor: 'divider' }}\r\n                >\r\n                    <Tab icon={<SettingsSuggestIcon />} iconPosition=\"start\" label=\"General\" />\r\n                    <Tab icon={<SmartToyIcon />} iconPosition=\"start\" label=\"AI & Models\" />\r\n                    <Tab icon={<CloudQueueIcon />} iconPosition=\"start\" label=\"Integrations\" />\r\n\r\n                </Tabs>\r\n            </Paper>\r\n\r\n            <Box sx={{ mt: 3 }}>\r\n                {tabValue === 0 && (\r\n                    <GeneralSettingsTab\r\n                        maintenanceMode={maintenanceMode}\r\n                        setMaintenanceMode={setMaintenanceMode}\r\n                        updateMaintenanceMode={updateMaintenanceMode}\r\n                        betaMode={betaMode}\r\n                        setBetaMode={setBetaMode}\r\n                        updateBetaMode={updateBetaMode}\r\n                        branding={branding}\r\n                        setBranding={setBranding}\r\n                        handleSaveBranding={handleSaveBranding}\r\n                        savingBranding={savingBranding}\r\n                    />\r\n                )}\r\n                {tabValue === 1 && (\r\n                    <AISettingsTab\r\n                        secureKeys={secureKeys}\r\n                        setSecureKeys={setSecureKeys}\r\n                        handleTestAndSave={handleTestAndSave}\r\n                        savingSecure={savingSecure}\r\n                        freeApiKeys={freeApiKeys}\r\n                        setFreeApiKeys={setFreeApiKeys}\r\n                        handleSaveFreeKeys={handleSaveFreeKeys}\r\n                        savingFreeKeys={savingFreeKeys}\r\n                        showKeys={showKeys}\r\n                        toggleShow={toggleShow}\r\n                        ollamaConfig={ollamaConfig}\r\n                        setOllamaConfig={setOllamaConfig}\r\n                        handleSaveOllama={handleSaveOllama}\r\n                        savingOllama={savingOllama}\r\n                        availableModels={availableModels}\r\n                        fetchOllamaModels={fetchOllamaModels}\r\n                        toggleModel={toggleModel}\r\n                        models={models}\r\n                        setModels={setModels}\r\n                        deepseekConfig={deepseekConfig}\r\n                        setDeepSeekConfig={setDeepSeekConfig}\r\n                        handleSaveDeepSeek={handleSaveDeepSeek}\r\n                        savingDeepSeek={savingDeepSeek}\r\n                        openrouterConfig={openrouterConfig}\r\n                        setOpenRouterConfig={setOpenRouterConfig}\r\n                        handleSaveOpenRouter={handleSaveOpenRouter}\r\n                        savingOpenRouter={savingOpenRouter}\r\n                    />\r\n                )}\r\n                {tabValue === 2 && (\r\n                    <SystemSettingsTab\r\n                        searxngConfig={searxngConfig}\r\n                        setSearxngConfig={setSearxngConfig}\r\n                        handleSaveSearxng={handleSaveSearxng}\r\n                        savingSearxng={savingSearxng}\r\n                        handleRunBackup={handleRunBackup}\r\n                        runningBackup={runningBackup}\r\n                        githubModelsConfig={githubModelsConfig}\r\n                        setGithubModelsConfig={setGithubModelsConfig}\r\n                        handleSaveGithubModels={handleSaveGithubModels}\r\n                        savingGithubModels={savingGithubModels}\r\n                        pcConsultationPrice={pcConsultationPrice}\r\n                        setPcConsultationPrice={setPcConsultationPrice}\r\n                        handleSavePcPrice={handleSavePcPrice}\r\n                        savingPcPrice={savingPcPrice}\r\n                    />\r\n                )}\r\n\r\n            </Box>\r\n\r\n            <Snackbar\r\n                open={!!msg.text}\r\n                autoHideDuration={6000}\r\n                onClose={() => setMsg({ type: '', text: '' })}\r\n            >\r\n                <Alert severity={msg.type as any} sx={{ width: '100%' }}>\r\n                    {msg.text}\r\n                </Alert>\r\n            </Snackbar>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\settings\\recovery\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CircularProgress' is defined but never used.","line":4,"column":60,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":76}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { Box, Typography, Paper, Button, TextField, Alert, CircularProgress, Divider } from '@mui/material';\r\nimport { generateAdminToken } from '@/services/adminService';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { QRCodeCanvas } from 'qrcode.react';\r\nimport ContentCopyIcon from '@mui/icons-material/ContentCopy';\r\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\r\nimport { useRouter } from 'next/navigation';\r\n\r\nexport default function AdminRecoverySettingsPage() {\r\n    const { userProfile } = useAuth();\r\n    const router = useRouter();\r\n    const [loading, setLoading] = useState(false);\r\n    const [generatedData, setGeneratedData] = useState<{ token: string; secret: string; otpAuthUrl: string } | null>(null);\r\n    const [email, setEmail] = useState('');\r\n\r\n    const handleGenerate = async () => {\r\n        if (!email) {\r\n            alert('Please enter an email for this token.');\r\n            return;\r\n        }\r\n        setLoading(true);\r\n        try {\r\n            const data = await generateAdminToken(email);\r\n            setGeneratedData(data);\r\n        } catch (error) {\r\n            console.error(error);\r\n            alert('Failed to generate token.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const copyToClipboard = (text: string) => {\r\n        navigator.clipboard.writeText(text);\r\n        alert('Copied to clipboard!');\r\n    };\r\n\r\n    if (userProfile?.role !== 'admin') return null;\r\n\r\n    return (\r\n        <Box sx={{ maxWidth: 800, mx: 'auto', p: 4 }}>\r\n            <Button startIcon={<ArrowBackIcon />} onClick={() => router.push('/admin/settings')} sx={{ mb: 2 }}>\r\n                Back to Settings\r\n            </Button>\r\n\r\n            <Typography variant=\"h4\" fontWeight=\"bold\" gutterBottom>\r\n                Admin 2FA Recovery Setup\r\n            </Typography>\r\n            <Typography variant=\"body1\" color=\"text.secondary\" paragraph>\r\n                Create emergency recovery tokens secured by 2FA (Google Authenticator).\r\n                Save the <strong>Token ID</strong> safely, and scan the <strong>QR Code</strong> with your phone.\r\n            </Typography>\r\n\r\n            <Paper sx={{ p: 4, mt: 4 }}>\r\n                {!generatedData ? (\r\n                    <Box>\r\n                        <TextField\r\n                            label=\"Admin Email for Recovery\"\r\n                            fullWidth\r\n                            value={email}\r\n                            onChange={(e) => setEmail(e.target.value)}\r\n                            placeholder=\"my.personal.email@example.com\"\r\n                            helperText=\"The email address allowed to use this token.\"\r\n                            sx={{ mb: 3 }}\r\n                        />\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            size=\"large\"\r\n                            onClick={handleGenerate}\r\n                            disabled={loading || !email}\r\n                        >\r\n                            {loading ? 'Generating...' : 'Generate New 2FA Token'}\r\n                        </Button>\r\n                    </Box>\r\n                ) : (\r\n                    <Box sx={{ textAlign: 'center' }}>\r\n                        <Alert severity=\"success\" sx={{ mb: 4 }}>\r\n                            <strong>Token Generated Successfully!</strong>\r\n                        </Alert>\r\n\r\n                        <Typography variant=\"h6\" gutterBottom>Step 1: Save this Token ID</Typography>\r\n                        <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 2, mb: 4 }}>\r\n                            <Typography variant=\"h3\" fontWeight=\"bold\" fontFamily=\"monospace\" sx={{ bgcolor: '#eee', p: 2, borderRadius: 2 }}>\r\n                                {generatedData.token}\r\n                            </Typography>\r\n                            <Button onClick={() => copyToClipboard(generatedData.token)} startIcon={<ContentCopyIcon />}>\r\n                                Copy\r\n                            </Button>\r\n                        </Box>\r\n\r\n                        <Divider sx={{ my: 4 }} />\r\n\r\n                        <Typography variant=\"h6\" gutterBottom>Step 2: Scan QR with Google Authenticator</Typography>\r\n                        <Box sx={{ border: '1px solid #ddd', p: 2, display: 'inline-block', borderRadius: 2, mb: 2, bgcolor: 'white' }}>\r\n                            <QRCodeCanvas value={generatedData.otpAuthUrl} size={256} />\r\n                        </Box>\r\n                        <Typography variant=\"body2\" color=\"text.secondary\">\r\n                            Or enter secret manually: {generatedData.secret}\r\n                        </Typography>\r\n\r\n                        <Divider sx={{ my: 4 }} />\r\n\r\n                        <Button variant=\"outlined\" onClick={() => setGeneratedData(null)}>\r\n                            Done (Clear Screen)\r\n                        </Button>\r\n\r\n                        <Alert severity=\"warning\" sx={{ mt: 2 }}>\r\n                            <strong>Warning:</strong> You must save the Token ID and scan the QR now. You cannot view them again later.\r\n                        </Alert>\r\n                    </Box>\r\n                )}\r\n            </Paper>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\support\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\themes\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IconButton' is defined but never used.","line":14,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tooltip' is defined but never used.","line":32,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PaletteIcon' is defined but never used.","line":38,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'defaultShape' is assigned a value but never used.","line":75,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":19},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":286,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[10619,10681],"text":"No custom themes created yet. Click &quot;Create Theme\" to add one."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[10619,10681],"text":"No custom themes created yet. Click &ldquo;Create Theme\" to add one."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[10619,10681],"text":"No custom themes created yet. Click &#34;Create Theme\" to add one."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[10619,10681],"text":"No custom themes created yet. Click &rdquo;Create Theme\" to add one."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":286,"column":93,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[10619,10681],"text":"No custom themes created yet. Click \"Create Theme&quot; to add one."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[10619,10681],"text":"No custom themes created yet. Click \"Create Theme&ldquo; to add one."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[10619,10681],"text":"No custom themes created yet. Click \"Create Theme&#34; to add one."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[10619,10681],"text":"No custom themes created yet. Click \"Create Theme&rdquo; to add one."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":528,"column":57,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[23719,23778],"text":"\r\n                        Are you sure you want to delete &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[23719,23778],"text":"\r\n                        Are you sure you want to delete &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[23719,23778],"text":"\r\n                        Are you sure you want to delete &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[23719,23778],"text":"\r\n                        Are you sure you want to delete &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":528,"column":79,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[23799,23886],"text":"&quot;? Users who selected this theme will be reverted to the default.\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[23799,23886],"text":"&ldquo;? Users who selected this theme will be reverted to the default.\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[23799,23886],"text":"&#34;? Users who selected this theme will be reverted to the default.\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[23799,23886],"text":"&rdquo;? Users who selected this theme will be reverted to the default.\r\n                    "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n    Container,\r\n    Typography,\r\n    Box,\r\n    Paper,\r\n    Grid,\r\n    Card,\r\n    CardContent,\r\n    CardActions,\r\n    Button,\r\n    IconButton,\r\n    Chip,\r\n    CircularProgress,\r\n    Dialog,\r\n    DialogTitle,\r\n    DialogContent,\r\n    DialogActions,\r\n    TextField,\r\n    Switch,\r\n    FormControlLabel,\r\n    Slider,\r\n    Alert,\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableContainer,\r\n    TableHead,\r\n    TableRow,\r\n    Tooltip,\r\n} from '@mui/material';\r\nimport AddIcon from '@mui/icons-material/Add';\r\nimport EditIcon from '@mui/icons-material/Edit';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport StarIcon from '@mui/icons-material/Star';\r\nimport PaletteIcon from '@mui/icons-material/Palette';\r\nimport BarChartIcon from '@mui/icons-material/BarChart';\r\nimport DarkModeIcon from '@mui/icons-material/DarkMode';\r\nimport LightModeIcon from '@mui/icons-material/LightMode';\r\nimport {\r\n    createGlobalTheme,\r\n    updateGlobalTheme,\r\n    deleteGlobalTheme,\r\n    getGlobalThemes,\r\n    getThemeAnalytics,\r\n    setDefaultTheme,\r\n} from '@/services/themeService';\r\nimport { GlobalTheme, ThemeAnalytics, ThemeColors, ThemeTypography, ThemeShape, ThemeMode } from '@/types/theme';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { themeList } from '@/lib/theme/themes';\r\n\r\n// Default colors for new theme\r\nconst defaultColors: ThemeColors = {\r\n    primary: { main: '#6366F1', light: '#818CF8', dark: '#4F46E5', contrastText: '#FFFFFF' },\r\n    secondary: { main: '#EC4899', light: '#F472B6', dark: '#DB2777', contrastText: '#FFFFFF' },\r\n    background: { default: '#F8FAFC', paper: '#FFFFFF' },\r\n    text: { primary: '#1E293B', secondary: '#64748B' },\r\n    error: { main: '#EF4444', light: '#F87171', dark: '#DC2626' },\r\n    warning: { main: '#F59E0B', light: '#FBBF24', dark: '#D97706' },\r\n    info: { main: '#3B82F6', light: '#60A5FA', dark: '#2563EB' },\r\n    success: { main: '#10B981', light: '#34D399', dark: '#059669' },\r\n};\r\n\r\nconst defaultTypography: ThemeTypography = {\r\n    fontFamily: \"'Inter', 'Roboto', sans-serif\",\r\n    fontSize: 14,\r\n    fontWeightLight: 300,\r\n    fontWeightRegular: 400,\r\n    fontWeightMedium: 500,\r\n    fontWeightBold: 700,\r\n};\r\n\r\nconst defaultShape: ThemeShape = { borderRadius: 12 };\r\n\r\nexport default function AdminThemesPage() {\r\n    const { user } = useAuth();\r\n    const [globalThemes, setGlobalThemes] = useState<GlobalTheme[]>([]);\r\n    const [analytics, setAnalytics] = useState<ThemeAnalytics[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n\r\n    // Editor state\r\n    const [editorOpen, setEditorOpen] = useState(false);\r\n    const [editingTheme, setEditingTheme] = useState<GlobalTheme | null>(null);\r\n    const [deleteConfirmOpen, setDeleteConfirmOpen] = useState(false);\r\n    const [themeToDelete, setThemeToDelete] = useState<GlobalTheme | null>(null);\r\n\r\n    // Form state\r\n    const [formName, setFormName] = useState('');\r\n    const [formMode, setFormMode] = useState<ThemeMode>('light');\r\n    const [formPrimary, setFormPrimary] = useState('#6366F1');\r\n    const [formSecondary, setFormSecondary] = useState('#EC4899');\r\n    const [formBackground, setFormBackground] = useState('#F8FAFC');\r\n    const [formBorderRadius, setFormBorderRadius] = useState(12);\r\n    const [formIsDefault, setFormIsDefault] = useState(false);\r\n    const [error, setError] = useState('');\r\n\r\n    // Load data\r\n    useEffect(() => {\r\n        loadData();\r\n    }, []);\r\n\r\n    const loadData = async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            const [themes, stats] = await Promise.all([\r\n                getGlobalThemes(),\r\n                getThemeAnalytics(),\r\n            ]);\r\n            setGlobalThemes(themes);\r\n            setAnalytics(stats);\r\n        } catch (err) {\r\n            console.error('Failed to load themes:', err);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const openCreateDialog = () => {\r\n        setEditingTheme(null);\r\n        setFormName('');\r\n        setFormMode('light');\r\n        setFormPrimary('#6366F1');\r\n        setFormSecondary('#EC4899');\r\n        setFormBackground('#F8FAFC');\r\n        setFormBorderRadius(12);\r\n        setFormIsDefault(false);\r\n        setError('');\r\n        setEditorOpen(true);\r\n    };\r\n\r\n    const openEditDialog = (theme: GlobalTheme) => {\r\n        setEditingTheme(theme);\r\n        setFormName(theme.name);\r\n        setFormMode(theme.mode);\r\n        setFormPrimary(theme.colors.primary.main);\r\n        setFormSecondary(theme.colors.secondary.main);\r\n        setFormBackground(theme.colors.background.default);\r\n        setFormBorderRadius(theme.shape.borderRadius);\r\n        setFormIsDefault(theme.isDefault);\r\n        setError('');\r\n        setEditorOpen(true);\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        if (!formName.trim()) {\r\n            setError('Theme name is required');\r\n            return;\r\n        }\r\n        if (!user) return;\r\n\r\n        setIsSaving(true);\r\n        try {\r\n            const themeData = {\r\n                name: formName,\r\n                mode: formMode,\r\n                colors: {\r\n                    ...defaultColors,\r\n                    primary: { ...defaultColors.primary, main: formPrimary },\r\n                    secondary: { ...defaultColors.secondary, main: formSecondary },\r\n                    background: {\r\n                        default: formBackground,\r\n                        paper: formMode === 'dark' ? '#1E293B' : '#FFFFFF',\r\n                    },\r\n                    text: {\r\n                        primary: formMode === 'dark' ? '#F1F5F9' : '#1E293B',\r\n                        secondary: formMode === 'dark' ? '#94A3B8' : '#64748B',\r\n                    },\r\n                },\r\n                typography: defaultTypography,\r\n                shape: { borderRadius: formBorderRadius },\r\n                isDefault: formIsDefault,\r\n            };\r\n\r\n            if (editingTheme) {\r\n                await updateGlobalTheme(editingTheme.id, themeData);\r\n            } else {\r\n                await createGlobalTheme(user.uid, themeData);\r\n            }\r\n\r\n            if (formIsDefault) {\r\n                // Set this as default (will unset others)\r\n                const themeId = editingTheme?.id || formName.toLowerCase().replace(/\\s+/g, '-') + '-' + Date.now();\r\n                await setDefaultTheme(themeId);\r\n            }\r\n\r\n            await loadData();\r\n            setEditorOpen(false);\r\n        } catch (err) {\r\n            console.error('Failed to save theme:', err);\r\n            setError('Failed to save theme. Please try again.');\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async () => {\r\n        if (!themeToDelete) return;\r\n\r\n        setIsSaving(true);\r\n        try {\r\n            await deleteGlobalTheme(themeToDelete.id);\r\n            await loadData();\r\n            setDeleteConfirmOpen(false);\r\n            setThemeToDelete(null);\r\n        } catch (err) {\r\n            console.error('Failed to delete theme:', err);\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const getAnalyticsForTheme = (themeId: string) => {\r\n        return analytics.find(a => a.themeId === themeId);\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <Container maxWidth=\"xl\" sx={{ py: 4, display: 'flex', justifyContent: 'center' }}>\r\n                <CircularProgress />\r\n            </Container>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Container maxWidth=\"xl\">\r\n            {/* Header */}\r\n            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 4 }}>\r\n                <Box>\r\n                    <Typography variant=\"h4\" fontWeight=\"bold\" gutterBottom>\r\n                        Theme Management\r\n                    </Typography>\r\n                    <Typography variant=\"body1\" color=\"text.secondary\">\r\n                        Create and manage themes available to all users\r\n                    </Typography>\r\n                </Box>\r\n                <Button\r\n                    variant=\"contained\"\r\n                    startIcon={<AddIcon />}\r\n                    onClick={openCreateDialog}\r\n                    sx={{ borderRadius: 2 }}\r\n                >\r\n                    Create Theme\r\n                </Button>\r\n            </Box>\r\n\r\n            {/* Built-in Themes (Read-only) */}\r\n            <Paper sx={{ p: 3, mb: 4, borderRadius: 3 }}>\r\n                <Typography variant=\"h6\" fontWeight=\"bold\" gutterBottom>\r\n                    Built-in Themes\r\n                </Typography>\r\n                <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 2 }}>\r\n                    These themes are included by default and cannot be modified.\r\n                </Typography>\r\n                <Grid container spacing={2}>\r\n                    {themeList.map((theme) => (\r\n                        <Grid size={{ xs: 6, sm: 4, md: 2.4 }} key={theme.id}>\r\n                            <Card variant=\"outlined\" sx={{ bgcolor: 'action.hover' }}>\r\n                                <CardContent sx={{ p: 2 }}>\r\n                                    <Box sx={{ display: 'flex', gap: 0.5, mb: 1 }}>\r\n                                        <Box sx={{ width: 20, height: 20, borderRadius: '50%', bgcolor: theme.colors.primary.main }} />\r\n                                        <Box sx={{ width: 20, height: 20, borderRadius: '50%', bgcolor: theme.colors.secondary.main }} />\r\n                                    </Box>\r\n                                    <Typography variant=\"body2\" fontWeight=\"medium\">{theme.name}</Typography>\r\n                                    <Chip\r\n                                        label=\"Built-in\"\r\n                                        size=\"small\"\r\n                                        variant=\"outlined\"\r\n                                        sx={{ mt: 1, height: 20, fontSize: 10 }}\r\n                                    />\r\n                                </CardContent>\r\n                            </Card>\r\n                        </Grid>\r\n                    ))}\r\n                </Grid>\r\n            </Paper>\r\n\r\n            {/* Custom Global Themes */}\r\n            <Paper sx={{ p: 3, mb: 4, borderRadius: 3 }}>\r\n                <Typography variant=\"h6\" fontWeight=\"bold\" gutterBottom>\r\n                    Custom Themes\r\n                </Typography>\r\n                {globalThemes.length === 0 ? (\r\n                    <Alert severity=\"info\">No custom themes created yet. Click \"Create Theme\" to add one.</Alert>\r\n                ) : (\r\n                    <Grid container spacing={2}>\r\n                        {globalThemes.map((theme) => (\r\n                            <Grid size={{ xs: 12, sm: 6, md: 4 }} key={theme.id}>\r\n                                <Card sx={{ position: 'relative' }}>\r\n                                    {theme.isDefault && (\r\n                                        <Chip\r\n                                            icon={<StarIcon />}\r\n                                            label=\"Default\"\r\n                                            size=\"small\"\r\n                                            color=\"warning\"\r\n                                            sx={{ position: 'absolute', top: 8, right: 8 }}\r\n                                        />\r\n                                    )}\r\n                                    <CardContent>\r\n                                        <Box sx={{ display: 'flex', gap: 1, mb: 2 }}>\r\n                                            <Box sx={{ width: 40, height: 40, borderRadius: 2, bgcolor: theme.colors.primary.main }} />\r\n                                            <Box sx={{ width: 40, height: 40, borderRadius: 2, bgcolor: theme.colors.secondary.main }} />\r\n                                            <Box sx={{ width: 40, height: 40, borderRadius: 2, bgcolor: theme.colors.background.default, border: '1px solid', borderColor: 'divider' }} />\r\n                                        </Box>\r\n                                        <Typography variant=\"subtitle1\" fontWeight=\"bold\">{theme.name}</Typography>\r\n                                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mt: 1 }}>\r\n                                            {theme.mode === 'dark' ? <DarkModeIcon fontSize=\"small\" /> : <LightModeIcon fontSize=\"small\" />}\r\n                                            <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                                {theme.mode === 'dark' ? 'Dark Mode' : 'Light Mode'}\r\n                                            </Typography>\r\n                                        </Box>\r\n                                        {getAnalyticsForTheme(theme.id) && (\r\n                                            <Typography variant=\"caption\" color=\"text.secondary\" sx={{ display: 'block', mt: 1 }}>\r\n                                                <BarChartIcon sx={{ fontSize: 12, mr: 0.5, verticalAlign: 'middle' }} />\r\n                                                {getAnalyticsForTheme(theme.id)?.usageCount || 0} users\r\n                                            </Typography>\r\n                                        )}\r\n                                    </CardContent>\r\n                                    <CardActions>\r\n                                        <Button size=\"small\" startIcon={<EditIcon />} onClick={() => openEditDialog(theme)}>\r\n                                            Edit\r\n                                        </Button>\r\n                                        <Button\r\n                                            size=\"small\"\r\n                                            color=\"error\"\r\n                                            startIcon={<DeleteIcon />}\r\n                                            onClick={() => {\r\n                                                setThemeToDelete(theme);\r\n                                                setDeleteConfirmOpen(true);\r\n                                            }}\r\n                                        >\r\n                                            Delete\r\n                                        </Button>\r\n                                    </CardActions>\r\n                                </Card>\r\n                            </Grid>\r\n                        ))}\r\n                    </Grid>\r\n                )}\r\n            </Paper>\r\n\r\n            {/* Analytics Summary */}\r\n            <Paper sx={{ p: 3, borderRadius: 3 }}>\r\n                <Typography variant=\"h6\" fontWeight=\"bold\" gutterBottom>\r\n                    Theme Usage Analytics\r\n                </Typography>\r\n                {analytics.length === 0 ? (\r\n                    <Alert severity=\"info\">No analytics data available yet.</Alert>\r\n                ) : (\r\n                    <TableContainer>\r\n                        <Table size=\"small\">\r\n                            <TableHead>\r\n                                <TableRow>\r\n                                    <TableCell>Theme</TableCell>\r\n                                    <TableCell align=\"right\">Usage Count</TableCell>\r\n                                    <TableCell align=\"right\">Last Used</TableCell>\r\n                                </TableRow>\r\n                            </TableHead>\r\n                            <TableBody>\r\n                                {analytics.map((stat) => (\r\n                                    <TableRow key={stat.themeId}>\r\n                                        <TableCell>{stat.themeName}</TableCell>\r\n                                        <TableCell align=\"right\">{stat.usageCount}</TableCell>\r\n                                        <TableCell align=\"right\">\r\n                                            {stat.lastUsed?.toLocaleDateString() || 'Never'}\r\n                                        </TableCell>\r\n                                    </TableRow>\r\n                                ))}\r\n                            </TableBody>\r\n                        </Table>\r\n                    </TableContainer>\r\n                )}\r\n            </Paper>\r\n\r\n            {/* Theme Editor Dialog */}\r\n            <Dialog open={editorOpen} onClose={() => setEditorOpen(false)} maxWidth=\"sm\" fullWidth>\r\n                <DialogTitle>\r\n                    {editingTheme ? 'Edit Theme' : 'Create New Theme'}\r\n                </DialogTitle>\r\n                <DialogContent>\r\n                    <Box sx={{ display: 'flex', flexDirection: 'column', gap: 3, pt: 1 }}>\r\n                        {error && <Alert severity=\"error\">{error}</Alert>}\r\n\r\n                        <TextField\r\n                            label=\"Theme Name\"\r\n                            value={formName}\r\n                            onChange={(e) => setFormName(e.target.value)}\r\n                            fullWidth\r\n                            required\r\n                        />\r\n\r\n                        <FormControlLabel\r\n                            control={\r\n                                <Switch\r\n                                    checked={formMode === 'dark'}\r\n                                    onChange={(e) => setFormMode(e.target.checked ? 'dark' : 'light')}\r\n                                />\r\n                            }\r\n                            label={`Mode: ${formMode === 'dark' ? 'Dark' : 'Light'}`}\r\n                        />\r\n\r\n                        <Box>\r\n                            <Typography variant=\"body2\" gutterBottom>Primary Color</Typography>\r\n                            <Box sx={{ display: 'flex', gap: 1, alignItems: 'center' }}>\r\n                                <TextField\r\n                                    type=\"color\"\r\n                                    value={formPrimary}\r\n                                    onChange={(e) => setFormPrimary(e.target.value)}\r\n                                    sx={{ width: 60 }}\r\n                                />\r\n                                <TextField\r\n                                    value={formPrimary}\r\n                                    onChange={(e) => setFormPrimary(e.target.value)}\r\n                                    size=\"small\"\r\n                                    fullWidth\r\n                                />\r\n                            </Box>\r\n                        </Box>\r\n\r\n                        <Box>\r\n                            <Typography variant=\"body2\" gutterBottom>Secondary Color</Typography>\r\n                            <Box sx={{ display: 'flex', gap: 1, alignItems: 'center' }}>\r\n                                <TextField\r\n                                    type=\"color\"\r\n                                    value={formSecondary}\r\n                                    onChange={(e) => setFormSecondary(e.target.value)}\r\n                                    sx={{ width: 60 }}\r\n                                />\r\n                                <TextField\r\n                                    value={formSecondary}\r\n                                    onChange={(e) => setFormSecondary(e.target.value)}\r\n                                    size=\"small\"\r\n                                    fullWidth\r\n                                />\r\n                            </Box>\r\n                        </Box>\r\n\r\n                        <Box>\r\n                            <Typography variant=\"body2\" gutterBottom>Background Color</Typography>\r\n                            <Box sx={{ display: 'flex', gap: 1, alignItems: 'center' }}>\r\n                                <TextField\r\n                                    type=\"color\"\r\n                                    value={formBackground}\r\n                                    onChange={(e) => setFormBackground(e.target.value)}\r\n                                    sx={{ width: 60 }}\r\n                                />\r\n                                <TextField\r\n                                    value={formBackground}\r\n                                    onChange={(e) => setFormBackground(e.target.value)}\r\n                                    size=\"small\"\r\n                                    fullWidth\r\n                                />\r\n                            </Box>\r\n                        </Box>\r\n\r\n                        <Box>\r\n                            <Typography variant=\"body2\" gutterBottom>Border Radius: {formBorderRadius}px</Typography>\r\n                            <Slider\r\n                                value={formBorderRadius}\r\n                                onChange={(_, value) => setFormBorderRadius(value as number)}\r\n                                min={0}\r\n                                max={24}\r\n                                step={2}\r\n                                marks\r\n                            />\r\n                        </Box>\r\n\r\n                        <FormControlLabel\r\n                            control={\r\n                                <Switch\r\n                                    checked={formIsDefault}\r\n                                    onChange={(e) => setFormIsDefault(e.target.checked)}\r\n                                />\r\n                            }\r\n                            label=\"Set as default theme for new users\"\r\n                        />\r\n\r\n                        {/* Live Preview */}\r\n                        <Paper\r\n                            sx={{\r\n                                p: 2,\r\n                                bgcolor: formBackground,\r\n                                borderRadius: `${formBorderRadius}px`,\r\n                            }}\r\n                        >\r\n                            <Typography variant=\"body2\" sx={{ mb: 1, color: formMode === 'dark' ? '#F1F5F9' : '#1E293B' }}>\r\n                                Preview\r\n                            </Typography>\r\n                            <Button\r\n                                variant=\"contained\"\r\n                                sx={{\r\n                                    bgcolor: formPrimary,\r\n                                    borderRadius: `${formBorderRadius}px`,\r\n                                    mr: 1,\r\n                                    '&:hover': { bgcolor: formPrimary, opacity: 0.9 },\r\n                                }}\r\n                            >\r\n                                Primary\r\n                            </Button>\r\n                            <Button\r\n                                variant=\"outlined\"\r\n                                sx={{\r\n                                    borderColor: formSecondary,\r\n                                    color: formSecondary,\r\n                                    borderRadius: `${formBorderRadius}px`,\r\n                                }}\r\n                            >\r\n                                Secondary\r\n                            </Button>\r\n                        </Paper>\r\n                    </Box>\r\n                </DialogContent>\r\n                <DialogActions sx={{ p: 2 }}>\r\n                    <Button onClick={() => setEditorOpen(false)}>Cancel</Button>\r\n                    <Button variant=\"contained\" onClick={handleSave} disabled={isSaving}>\r\n                        {isSaving ? 'Saving...' : editingTheme ? 'Update Theme' : 'Create Theme'}\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n\r\n            {/* Delete Confirmation Dialog */}\r\n            <Dialog open={deleteConfirmOpen} onClose={() => setDeleteConfirmOpen(false)}>\r\n                <DialogTitle>Delete Theme?</DialogTitle>\r\n                <DialogContent>\r\n                    <Typography>\r\n                        Are you sure you want to delete \"{themeToDelete?.name}\"? Users who selected this theme will be reverted to the default.\r\n                    </Typography>\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => setDeleteConfirmOpen(false)}>Cancel</Button>\r\n                    <Button color=\"error\" variant=\"contained\" onClick={handleDelete} disabled={isSaving}>\r\n                        {isSaving ? 'Deleting...' : 'Delete'}\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        </Container>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\tiers\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Paper' is defined but never used.","line":6,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":10},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1323,1326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1323,1326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2079,2082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2079,2082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userProfile' is assigned a value but never used.","line":226,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":226,"endColumn":36}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n    Box,\r\n    Paper,\r\n    Typography,\r\n    Grid,\r\n    TextField,\r\n    Button,\r\n    Card,\r\n    CardContent,\r\n    CardHeader,\r\n    Switch,\r\n    FormControlLabel,\r\n    InputAdornment,\r\n    Divider,\r\n    Alert,\r\n    CircularProgress,\r\n    Chip,\r\n    IconButton,\r\n    Collapse\r\n} from '@mui/material';\r\nimport SaveIcon from '@mui/icons-material/Save';\r\nimport RestoreIcon from '@mui/icons-material/Restore';\r\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\r\nimport ExpandLessIcon from '@mui/icons-material/ExpandLess';\r\nimport LoadingSpinner from '@/components/ui/LoadingSpinner';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { SystemTierConfig, TierDefinition } from '@/types/system';\r\nimport { updateSystemSettings } from '@/services/systemService';\r\nimport { UserTier, TIER_CONFIG } from '@/types/user';\r\n\r\n// Temporary type for local edits before saving\r\ntype EditableConfig = SystemTierConfig;\r\n\r\nconst TierEditor = ({ tierId, tierData, onChange, onReset }: {\r\n    tierId: UserTier,\r\n    tierData: TierDefinition,\r\n    onChange: (updated: TierDefinition) => void,\r\n    onReset: () => void\r\n}) => {\r\n    const [expanded, setExpanded] = useState(false);\r\n\r\n    const handleChange = (field: keyof TierDefinition, value: any) => {\r\n        onChange({ ...tierData, [field]: value });\r\n    };\r\n\r\n    const handlePricingChange = (field: 'monthly' | 'lifetime', value: string) => {\r\n        const num = parseFloat(value);\r\n        if (isNaN(num)) return;\r\n        onChange({\r\n            ...tierData,\r\n            pricing: { ...tierData.pricing, [field]: num }\r\n        });\r\n    };\r\n\r\n    const handleMetaPriceChange = (field: 'originalPriceMonthly' | 'originalPriceLifetime', value: string) => {\r\n        const num = parseFloat(value);\r\n        if (isNaN(num)) return;\r\n        onChange({\r\n            ...tierData,\r\n            metadata: { ...tierData.metadata, [field]: num }\r\n        });\r\n    };\r\n\r\n    const handleFeatureChange = (field: keyof typeof tierData.features, value: any) => {\r\n        onChange({\r\n            ...tierData,\r\n            features: { ...tierData.features, [field]: value }\r\n        });\r\n    };\r\n\r\n    const isFeatured = tierId === 'pro';\r\n\r\n    return (\r\n        <Card sx={{ mb: 3, borderRadius: 3, border: isFeatured ? '2px solid #6C63FF' : '1px solid #e0e0e0', overflow: 'visible' }}>\r\n            <CardHeader\r\n                title={\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\r\n                            <Typography variant=\"h6\" fontWeight=\"bold\">{tierData.name}</Typography>\r\n                            {isFeatured && <Chip label=\"Most Popular\" color=\"primary\" size=\"small\" />}\r\n                        </Box>\r\n                        <Box>\r\n                            <IconButton onClick={() => setExpanded(!expanded)}>\r\n                                {expanded ? <ExpandLessIcon /> : <ExpandMoreIcon />}\r\n                            </IconButton>\r\n                        </Box>\r\n                    </Box>\r\n                }\r\n                subheader={tierData.description}\r\n                sx={{\r\n                    bgcolor: isFeatured ? 'rgba(108, 99, 255, 0.05)' : 'transparent',\r\n                    borderBottom: expanded ? '1px solid #f0f0f0' : 'none'\r\n                }}\r\n            />\r\n            <Collapse in={expanded}>\r\n                <CardContent>\r\n                    <Grid container spacing={3}>\r\n                        {/* Basic Info */}\r\n                        <Grid size={{ xs: 12, md: 6 }}>\r\n                            <TextField\r\n                                fullWidth\r\n                                label=\"Display Name\"\r\n                                value={tierData.name}\r\n                                onChange={(e) => handleChange('name', e.target.value)}\r\n                                sx={{ mb: 2 }}\r\n                            />\r\n                            <TextField\r\n                                fullWidth\r\n                                label=\"Description\"\r\n                                value={tierData.description}\r\n                                onChange={(e) => handleChange('description', e.target.value)}\r\n                            />\r\n                        </Grid>\r\n\r\n                        {/* Pricing */}\r\n                        <Grid size={{ xs: 12, md: 6 }}>\r\n                            <Typography variant=\"subtitle2\" gutterBottom fontWeight=\"bold\">Pricing (USD)</Typography>\r\n                            <Box sx={{ display: 'flex', gap: 2, mb: 2 }}>\r\n                                <TextField\r\n                                    label=\"Monthly Price\"\r\n                                    type=\"number\"\r\n                                    value={tierData.pricing.monthly}\r\n                                    onChange={(e) => handlePricingChange('monthly', e.target.value)}\r\n                                    InputProps={{ startAdornment: <InputAdornment position=\"start\">$</InputAdornment> }}\r\n                                    fullWidth\r\n                                />\r\n                                <TextField\r\n                                    label=\"Lifetime Price\"\r\n                                    type=\"number\"\r\n                                    value={tierData.pricing.lifetime}\r\n                                    onChange={(e) => handlePricingChange('lifetime', e.target.value)}\r\n                                    InputProps={{ startAdornment: <InputAdornment position=\"start\">$</InputAdornment> }}\r\n                                    fullWidth\r\n                                />\r\n                            </Box>\r\n                            <Box sx={{ display: 'flex', gap: 2 }}>\r\n                                <TextField\r\n                                    label=\"Fake Original Lifetime (Strikethrough)\"\r\n                                    type=\"number\"\r\n                                    value={tierData.metadata.originalPriceLifetime || ''}\r\n                                    onChange={(e) => handleMetaPriceChange('originalPriceLifetime', e.target.value)}\r\n                                    InputProps={{ startAdornment: <InputAdornment position=\"start\">$</InputAdornment> }}\r\n                                    helperText=\"Leave empty to hide\"\r\n                                    fullWidth\r\n                                />\r\n                            </Box>\r\n                        </Grid>\r\n\r\n                        <Grid size={{ xs: 12 }}><Divider><Chip label=\"Feature Limits\" size=\"small\" /></Divider></Grid>\r\n\r\n                        {/* Limits */}\r\n                        <Grid size={{ xs: 12, sm: 4 }}>\r\n                            <TextField\r\n                                label=\"Daily Scans\"\r\n                                type=\"number\"\r\n                                value={tierData.features.dailyScanLimit}\r\n                                onChange={(e) => handleFeatureChange('dailyScanLimit', parseInt(e.target.value))}\r\n                                helperText=\"-1 for Unlimited\"\r\n                                fullWidth\r\n                            />\r\n                        </Grid>\r\n                        <Grid size={{ xs: 12, sm: 4 }}>\r\n                            <TextField\r\n                                label=\"Multi-Scan Limit\"\r\n                                type=\"number\"\r\n                                value={tierData.features.multiScanLimit}\r\n                                onChange={(e) => handleFeatureChange('multiScanLimit', parseInt(e.target.value))}\r\n                                fullWidth\r\n                            />\r\n                        </Grid>\r\n                        <Grid size={{ xs: 12, sm: 4 }}>\r\n                            <TextField\r\n                                label=\"History Limit\"\r\n                                type=\"number\"\r\n                                value={tierData.features.historyLimit}\r\n                                onChange={(e) => handleFeatureChange('historyLimit', parseInt(e.target.value))}\r\n                                helperText=\"-1 for Unlimited\"\r\n                                fullWidth\r\n                            />\r\n                        </Grid>\r\n\r\n                        <Grid size={{ xs: 12 }}><Divider><Chip label=\"Capability Flags\" size=\"small\" /></Divider></Grid>\r\n\r\n                        {/* Boolean Toggles */}\r\n                        <Grid size={{ xs: 12 }}>\r\n                            <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 3 }}>\r\n                                <FormControlLabel\r\n                                    control={<Switch checked={tierData.features.smartGrading} onChange={(e) => handleFeatureChange('smartGrading', e.target.checked)} />}\r\n                                    label=\"Smart Grading\"\r\n                                />\r\n                                <FormControlLabel\r\n                                    control={<Switch checked={tierData.features.aiTruthDetector} onChange={(e) => handleFeatureChange('aiTruthDetector', e.target.checked)} />}\r\n                                    label=\"AI Truth Detector\"\r\n                                />\r\n                                <FormControlLabel\r\n                                    control={<Switch checked={tierData.features.fastLane} onChange={(e) => handleFeatureChange('fastLane', e.target.checked)} />}\r\n                                    label=\"Fast Lane (Priority)\"\r\n                                />\r\n                                <FormControlLabel\r\n                                    control={<Switch checked={!tierData.features.adsEnabled} onChange={(e) => handleFeatureChange('adsEnabled', !e.target.checked)} color=\"success\" />}\r\n                                    label=\"Ad-Free Experience\"\r\n                                />\r\n                                <FormControlLabel\r\n                                    control={<Switch checked={tierData.features.whiteLabel} onChange={(e) => handleFeatureChange('whiteLabel', e.target.checked)} />}\r\n                                    label=\"White Label Reports\"\r\n                                />\r\n                            </Box>\r\n                        </Grid>\r\n\r\n                        <Grid size={{ xs: 12 }} sx={{ display: 'flex', justifyContent: 'flex-end', gap: 2 }}>\r\n                            <Button startIcon={<RestoreIcon />} onClick={onReset} color=\"warning\">\r\n                                Reset to Defaults\r\n                            </Button>\r\n                        </Grid>\r\n                    </Grid>\r\n                </CardContent>\r\n            </Collapse>\r\n        </Card>\r\n    );\r\n};\r\n\r\nexport default function AdminTiersPage() {\r\n    const { tierConfig, userProfile } = useAuth();\r\n    const [localConfig, setLocalConfig] = useState<EditableConfig | null>(null);\r\n    const [saving, setSaving] = useState(false);\r\n    const [status, setStatus] = useState<{ type: 'success' | 'error', msg: string } | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (tierConfig) {\r\n            setLocalConfig(tierConfig);\r\n        }\r\n    }, [tierConfig]);\r\n\r\n    const handleSave = async () => {\r\n        if (!localConfig) return;\r\n        setSaving(true);\r\n        setStatus(null);\r\n        try {\r\n            await updateSystemSettings({ tierConfig: localConfig });\r\n            setStatus({ type: 'success', msg: 'Tier configuration updated successfully!' });\r\n        } catch (error) {\r\n            console.error(error);\r\n            setStatus({ type: 'error', msg: 'Failed to save changes.' });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleTierUpdate = (tierId: UserTier, updatedDef: TierDefinition) => {\r\n        if (!localConfig) return;\r\n        setLocalConfig({\r\n            ...localConfig,\r\n            [tierId]: updatedDef\r\n        });\r\n    };\r\n\r\n    const handleResetTier = (tierId: UserTier) => {\r\n        if (!localConfig) return;\r\n        // Reset specific tier to code-hardcoded defaults from TIER_CONFIG\r\n        // We need to re-construct the default object structure locally\r\n        const base = TIER_CONFIG[tierId];\r\n        const defaultDef: TierDefinition = {\r\n            id: tierId,\r\n            name: tierId.charAt(0).toUpperCase() + tierId.slice(1),\r\n            description: 'Default Description',\r\n            pricing: { monthly: 0, lifetime: 0, currency: 'USD' },\r\n            features: base,\r\n            metadata: {}\r\n        };\r\n        // Simple manual override for consistent defaults if needed, \r\n        // but broadly this resets features. Pricing might default to 0.\r\n        // Ideally we should pull from the 'factory default' constant in systemService,\r\n        // but that's not exported. This is a \"Soft Reset\".\r\n        setLocalConfig({\r\n            ...localConfig,\r\n            [tierId]: defaultDef\r\n        });\r\n    };\r\n\r\n    if (!localConfig) return <LoadingSpinner />;\r\n\r\n    return (\r\n        <Box maxWidth=\"lg\">\r\n            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 4 }}>\r\n                <Box>\r\n                    <Typography variant=\"h4\" fontWeight=\"bold\" gutterBottom>Subscription Tiers</Typography>\r\n                    <Typography variant=\"body1\" color=\"text.secondary\">\r\n                        Manage pricing, features, and limits for all user levels.\r\n                    </Typography>\r\n                </Box>\r\n                <Button\r\n                    variant=\"contained\"\r\n                    size=\"large\"\r\n                    startIcon={saving ? <CircularProgress size={20} color=\"inherit\" /> : <SaveIcon />}\r\n                    onClick={handleSave}\r\n                    disabled={saving}\r\n                    sx={{ borderRadius: 3, px: 4 }}\r\n                >\r\n                    {saving ? 'Saving...' : 'Save Changes'}\r\n                </Button>\r\n            </Box>\r\n\r\n            {status && (\r\n                <Alert severity={status.type} sx={{ mb: 4, borderRadius: 2 }} onClose={() => setStatus(null)}>\r\n                    {status.msg}\r\n                </Alert>\r\n            )}\r\n\r\n            <TierEditor\r\n                tierId=\"free\"\r\n                tierData={localConfig.free}\r\n                onChange={(d) => handleTierUpdate('free', d)}\r\n                onReset={() => handleResetTier('free')}\r\n            />\r\n            <TierEditor\r\n                tierId=\"plus\"\r\n                tierData={localConfig.plus}\r\n                onChange={(d) => handleTierUpdate('plus', d)}\r\n                onReset={() => handleResetTier('plus')}\r\n            />\r\n            <TierEditor\r\n                tierId=\"pro\"\r\n                tierData={localConfig.pro}\r\n                onChange={(d) => handleTierUpdate('pro', d)}\r\n                onReset={() => handleResetTier('pro')}\r\n            />\r\n            <TierEditor\r\n                tierId=\"ultimate\"\r\n                tierData={localConfig.ultimate}\r\n                onChange={(d) => handleTierUpdate('ultimate', d)}\r\n                onReset={() => handleResetTier('ultimate')}\r\n            />\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\admin\\users\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7226,7229],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7226,7229],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7561,7564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7561,7564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":217,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8983,8986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8983,8986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport {\r\n    Box,\r\n    Typography,\r\n    Paper,\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableContainer,\r\n    TableHead,\r\n    TableRow,\r\n    Chip,\r\n    IconButton,\r\n    Button,\r\n    CircularProgress,\r\n    Dialog,\r\n    DialogTitle,\r\n    DialogContent,\r\n    DialogActions,\r\n    TextField,\r\n    MenuItem,\r\n    Alert,\r\n    Tabs,\r\n    Tab,\r\n    Badge\r\n} from '@mui/material';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport PersonIcon from '@mui/icons-material/Person';\r\nimport AdminPanelSettingsIcon from '@mui/icons-material/AdminPanelSettings';\r\nimport EditIcon from '@mui/icons-material/Edit';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport LockResetIcon from '@mui/icons-material/LockReset';\r\nimport axios from 'axios';\r\n\r\ninterface AdminUser {\r\n    uid: string;\r\n    email: string;\r\n    role: string;\r\n    tier: string;\r\n    status: 'Active' | 'Disabled';\r\n    lastSignIn?: string;\r\n    createdAt?: string;\r\n\r\n}\r\n\r\ninterface UserTableProps {\r\n    users: AdminUser[];\r\n    loading: boolean;\r\n    onEdit: (user: AdminUser) => void;\r\n    onPass: (user: AdminUser) => void;\r\n    onDelete: (user: AdminUser) => void;\r\n}\r\n\r\nconst UserTable = ({ users, loading, onEdit, onPass, onDelete }: UserTableProps) => (\r\n    <TableContainer component={Paper} sx={{ borderRadius: 2, boxShadow: 3, overflowX: 'auto' }}>\r\n        <Table sx={{ minWidth: { xs: 600, sm: 650 } }}>\r\n            <TableHead sx={{ bgcolor: '#fafafa' }}>\r\n                <TableRow>\r\n                    <TableCell sx={{ fontWeight: 'bold' }}>ID</TableCell>\r\n                    <TableCell sx={{ fontWeight: 'bold' }}>Email</TableCell>\r\n                    <TableCell sx={{ fontWeight: 'bold' }}>Role</TableCell>\r\n                    <TableCell sx={{ fontWeight: 'bold' }}>Tier</TableCell>\r\n                    <TableCell sx={{ fontWeight: 'bold' }}>Status</TableCell>\r\n                    <TableCell sx={{ fontWeight: 'bold' }}>Actions</TableCell>\r\n                </TableRow>\r\n            </TableHead>\r\n            <TableBody>\r\n                {loading ? (\r\n                    <TableRow>\r\n                        <TableCell colSpan={6} align=\"center\" sx={{ py: 5 }}>\r\n                            <CircularProgress />\r\n                        </TableCell>\r\n                    </TableRow>\r\n                ) : users.length === 0 ? (\r\n                    <TableRow>\r\n                        <TableCell colSpan={6} align=\"center\" sx={{ py: 5 }}>\r\n                            <Typography color=\"text.secondary\">No users found.</Typography>\r\n                        </TableCell>\r\n                    </TableRow>\r\n                ) : (\r\n                    users.map((user, index) => (\r\n                        <TableRow key={user.uid} hover>\r\n                            <TableCell sx={{ color: '#666', fontSize: '0.85rem' }}>{index + 1}</TableCell>\r\n                            <TableCell sx={{ fontWeight: 500 }}>{user.email}</TableCell>\r\n                            <TableCell>\r\n                                <Chip\r\n                                    label={user.role}\r\n                                    size=\"small\"\r\n                                    color={user.role === 'admin' ? 'primary' : 'default'}\r\n                                    variant={user.role === 'admin' ? 'filled' : 'outlined'}\r\n                                />\r\n                            </TableCell>\r\n                            <TableCell>\r\n                                {user.role === 'admin' ? (\r\n                                    <Chip\r\n                                        label=\"ΓÇö\"\r\n                                        size=\"small\"\r\n                                        variant=\"outlined\"\r\n                                        sx={{ color: '#999', borderColor: '#eee' }}\r\n                                    />\r\n                                ) : (\r\n                                    <Chip\r\n                                        label={user.tier ? user.tier.toUpperCase() : 'FREE'}\r\n                                        size=\"small\"\r\n                                        sx={{\r\n                                            bgcolor: user.tier === 'pro' || user.tier === 'ultimate' ? 'gold' : '#e0e0e0',\r\n                                            fontWeight: 'bold',\r\n                                            color: user.tier === 'pro' || user.tier === 'ultimate' ? 'black' : 'inherit'\r\n                                        }}\r\n                                    />\r\n                                )}\r\n                            </TableCell>\r\n                            <TableCell>\r\n                                <Chip\r\n                                    label={user.status}\r\n                                    size=\"small\"\r\n                                    color={user.status === 'Active' ? 'success' : 'error'}\r\n                                    sx={{ borderRadius: 1 }}\r\n                                />\r\n                            </TableCell>\r\n                            <TableCell>\r\n                                <IconButton size=\"small\" color=\"primary\" onClick={() => onEdit(user)} title=\"Edit User\">\r\n                                    <EditIcon fontSize=\"small\" />\r\n                                </IconButton>\r\n                                <IconButton size=\"small\" color=\"secondary\" onClick={() => onPass(user)} title=\"Reset Password\">\r\n                                    <LockResetIcon fontSize=\"small\" />\r\n                                </IconButton>\r\n                                <IconButton size=\"small\" color=\"error\" onClick={() => onDelete(user)} title=\"Delete User\">\r\n                                    <DeleteIcon fontSize=\"small\" />\r\n                                </IconButton>\r\n                            </TableCell>\r\n                        </TableRow>\r\n                    ))\r\n                )}\r\n            </TableBody>\r\n        </Table>\r\n    </TableContainer>\r\n);\r\n\r\n\r\nexport default function UserManagementPage() {\r\n    const [users, setUsers] = useState<AdminUser[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState('');\r\n    const { user: currentUser } = useAuth();\r\n\r\n\r\n    // Dialog States\r\n    const [editOpen, setEditOpen] = useState(false);\r\n    const [passOpen, setPassOpen] = useState(false);\r\n    const [deleteOpen, setDeleteOpen] = useState(false);\r\n    const [selectedUser, setSelectedUser] = useState<AdminUser | null>(null);\r\n\r\n    // Form data\r\n    const [role, setRole] = useState('user');\r\n    const [tier, setTier] = useState('free');\r\n    const [newPassword, setNewPassword] = useState('');\r\n    const [actionLoading, setActionLoading] = useState(false);\r\n    const [actionMsg, setActionMsg] = useState('');\r\n    const [tabValue, setTabValue] = useState(0);\r\n\r\n    // Filtered lists\r\n    const admins = users.filter(u => u.role === 'admin');\r\n    const regularUsers = users.filter(u => u.role !== 'admin');\r\n\r\n\r\n    const fetchUsers = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const res = await axios.get('/api/admin/users');\r\n            setUsers(res.data.users);\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            setError('Failed to fetch users. Ensure you have admin privileges and server key is set.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchUsers();\r\n    }, []);\r\n\r\n    const handleAction = async (action: string, data: any = {}) => {\r\n        if (!selectedUser) return;\r\n        setActionLoading(true);\r\n        setActionMsg('');\r\n        try {\r\n            const res = await axios.post('/api/admin/action', {\r\n                action,\r\n                userId: selectedUser.uid,\r\n                data\r\n            });\r\n\r\n            if (res.data.success) {\r\n                // Refresh list or update local state\r\n                if (action === 'deleteUser') {\r\n                    setUsers(users.filter(u => u.uid !== selectedUser.uid));\r\n                    setDeleteOpen(false);\r\n                } else if (action === 'updateRole') {\r\n                    setUsers(users.map(u => u.uid === selectedUser.uid ? { ...u, role: data.role } : u));\r\n                } else if (action === 'updateTier') {\r\n                    setUsers(users.map(u => u.uid === selectedUser.uid ? { ...u, tier: data.tier } : u));\r\n                } else if (action === 'setPassword') {\r\n                    setActionMsg('Password updated successfully!');\r\n                    setTimeout(() => setPassOpen(false), 1500);\r\n                } else if (action === 'resetPasswordEmail') {\r\n                    setActionMsg(`Reset Link Generated: ${res.data.link}`);\r\n                }\r\n\r\n                if (['updateRole', 'updateTier'].includes(action)) {\r\n                    setActionMsg('Updated successfully');\r\n                }\r\n            }\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            setActionMsg(`Error: ${err.response?.data?.error || err.message}`);\r\n        } finally {\r\n            setActionLoading(false);\r\n        }\r\n    };\r\n\r\n    // Wrapper to save both Role and Tier\r\n    const handleSaveUser = async () => {\r\n        // Validation: Prevent self-demotion if last admin\r\n        if (selectedUser?.uid === currentUser?.uid) {\r\n            if (role !== 'admin' && admins.length <= 1) {\r\n                setActionMsg('Error: You cannot remove your admin status because you are the only admin.');\r\n                return;\r\n            }\r\n        }\r\n\r\n        // We'll call them sequentially for simplicity \r\n        await handleAction('updateRole', { role });\r\n        await handleAction('updateTier', { tier });\r\n        // Close dialog after short delay to show success\r\n        setTimeout(() => setEditOpen(false), 800);\r\n    }\r\n\r\n\r\n    const openEdit = (user: AdminUser) => {\r\n        setSelectedUser(user);\r\n        setRole(user.role);\r\n        setTier(user.tier || 'free');\r\n        setEditOpen(true);\r\n        setActionMsg('');\r\n    };\r\n\r\n    const openPass = (user: AdminUser) => {\r\n        setSelectedUser(user);\r\n        setNewPassword('');\r\n        setPassOpen(true);\r\n        setActionMsg('');\r\n    };\r\n\r\n    const openDelete = (user: AdminUser) => {\r\n        setSelectedUser(user);\r\n        setDeleteOpen(true);\r\n        setActionMsg('');\r\n    };\r\n\r\n    return (\r\n        <Box>\r\n            <Typography variant=\"h4\" fontWeight=\"bold\" sx={{ mb: 4, color: '#333' }}>\r\n                User Management\r\n            </Typography>\r\n\r\n            {error && <Alert severity=\"error\" sx={{ mb: 2 }}>{error}</Alert>}\r\n\r\n            <Paper sx={{ mb: 3, borderRadius: 2 }}>\r\n                <Tabs\r\n                    value={tabValue}\r\n                    onChange={(_, val) => setTabValue(val)}\r\n                    indicatorColor=\"primary\"\r\n                    textColor=\"primary\"\r\n                    sx={{ borderBottom: 1, borderColor: 'divider', px: 2 }}\r\n                >\r\n                    <Tab\r\n                        icon={<PersonIcon fontSize=\"small\" />}\r\n                        iconPosition=\"start\"\r\n                        label={\r\n                            <Badge badgeContent={regularUsers.length} color=\"secondary\" sx={{ ml: 1 }}>\r\n                                <Box sx={{ mr: 2 }}>Users</Box>\r\n                            </Badge>\r\n                        }\r\n                    />\r\n                    <Tab\r\n                        icon={<AdminPanelSettingsIcon fontSize=\"small\" />}\r\n                        iconPosition=\"start\"\r\n                        label={\r\n                            <Badge badgeContent={admins.length} color=\"primary\" sx={{ ml: 1 }}>\r\n                                <Box sx={{ mr: 2 }}>Admins</Box>\r\n                            </Badge>\r\n                        }\r\n                    />\r\n                </Tabs>\r\n            </Paper>\r\n\r\n            {tabValue === 0 && (\r\n                <UserTable\r\n                    users={regularUsers}\r\n                    loading={loading}\r\n                    onEdit={openEdit}\r\n                    onPass={openPass}\r\n                    onDelete={openDelete}\r\n                />\r\n            )}\r\n\r\n            {tabValue === 1 && (\r\n                <UserTable\r\n                    users={admins}\r\n                    loading={loading}\r\n                    onEdit={openEdit}\r\n                    onPass={openPass}\r\n                    onDelete={openDelete}\r\n                />\r\n            )}\r\n\r\n\r\n            {/* Edit User Dialog */}\r\n            <Dialog open={editOpen} onClose={() => setEditOpen(false)}>\r\n                <DialogTitle>Edit User Details</DialogTitle>\r\n                <DialogContent sx={{ minWidth: 300, pt: 2 }}>\r\n                    <Typography variant=\"body2\" sx={{ mb: 2 }}>User: {selectedUser?.email}</Typography>\r\n\r\n                    <TextField\r\n                        select\r\n                        label=\"Role\"\r\n                        fullWidth\r\n                        value={role}\r\n                        onChange={(e) => setRole(e.target.value)}\r\n                        variant=\"outlined\"\r\n                        sx={{ mt: 1, mb: 2 }}\r\n                    >\r\n                        <MenuItem value=\"user\">User</MenuItem>\r\n                        <MenuItem value=\"admin\">Admin</MenuItem>\r\n                    </TextField>\r\n\r\n                    <TextField\r\n                        select\r\n                        label=\"Subscription Tier\"\r\n                        fullWidth\r\n                        value={tier}\r\n                        onChange={(e) => setTier(e.target.value)}\r\n                        variant=\"outlined\"\r\n                    >\r\n                        <MenuItem value=\"free\">Free</MenuItem>\r\n                        <MenuItem value=\"plus\">Plus</MenuItem>\r\n                        <MenuItem value=\"pro\">Pro</MenuItem>\r\n                        <MenuItem value=\"ultimate\">Ultimate</MenuItem>\r\n                    </TextField>\r\n\r\n                    {actionMsg && <Alert severity={actionMsg.includes('Error') ? 'error' : 'success'} sx={{ mt: 2 }}>{actionMsg}</Alert>}\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => setEditOpen(false)}>Cancel</Button>\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        onClick={handleSaveUser}\r\n                        disabled={actionLoading}\r\n                    >\r\n                        {actionLoading ? 'Saving...' : 'Save Changes'}\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n\r\n            {/* Password Dialog */}\r\n            <Dialog open={passOpen} onClose={() => setPassOpen(false)}>\r\n                <DialogTitle>Reset Password</DialogTitle>\r\n                <DialogContent sx={{ minWidth: 350, pt: 2 }}>\r\n                    <Typography variant=\"body2\" sx={{ mb: 2 }}>User: {selectedUser?.email}</Typography>\r\n\r\n                    <Typography variant=\"subtitle2\" sx={{ mt: 2, mb: 1, fontWeight: 'bold' }}>Option 1: Direct Change</Typography>\r\n                    <TextField\r\n                        label=\"New Password\"\r\n                        type=\"text\" // Visible so admin can read it to user\r\n                        fullWidth\r\n                        value={newPassword}\r\n                        onChange={(e) => setNewPassword(e.target.value)}\r\n                        placeholder=\"Enter new password\"\r\n                    />\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        fullWidth\r\n                        sx={{ mt: 1 }}\r\n                        onClick={() => handleAction('setPassword', { newPassword })}\r\n                        disabled={!newPassword || actionLoading}\r\n                    >\r\n                        Set Password Directly\r\n                    </Button>\r\n\r\n                    <Typography variant=\"subtitle2\" sx={{ mt: 3, mb: 1, fontWeight: 'bold' }}>Option 2: Email Reset</Typography>\r\n                    <Button\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                        onClick={() => handleAction('resetPasswordEmail')}\r\n                        disabled={actionLoading}\r\n                    >\r\n                        Generate Reset Link\r\n                    </Button>\r\n\r\n                    {actionMsg && <Alert severity={actionMsg.includes('Error') ? 'error' : 'success'} sx={{ mt: 2, wordBreak: 'break-all' }}>{actionMsg}</Alert>}\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => setPassOpen(false)}>Close</Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n\r\n            {/* Delete Dialog */}\r\n            <Dialog open={deleteOpen} onClose={() => setDeleteOpen(false)}>\r\n                <DialogTitle sx={{ color: '#d32f2f' }}>Delete User?</DialogTitle>\r\n                <DialogContent>\r\n                    <Typography>Are you sure you want to delete <b>{selectedUser?.email}</b>?</Typography>\r\n                    <Typography variant=\"caption\" color=\"error\">This action cannot be undone.</Typography>\r\n\r\n                    {selectedUser?.uid === currentUser?.uid && admins.length <= 1 && (\r\n                        <Alert severity=\"error\" sx={{ mt: 2 }}>\r\n                            Warning: You are the ONLY admin. Deleting your account will lock everyone out of the admin panel. Action Blocked.\r\n                        </Alert>\r\n                    )}\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => setDeleteOpen(false)}>Cancel</Button>\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        color=\"error\"\r\n                        onClick={() => handleAction('deleteUser')}\r\n                        disabled={actionLoading || (selectedUser?.uid === currentUser?.uid && admins.length <= 1)}\r\n                    >\r\n                        {actionLoading ? 'Deleting...' : 'Delete Permanently'}\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(admin)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\(user)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1842,1845],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1842,1845],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'results' is never reassigned. Use 'const' instead.","line":55,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":55,"endColumn":20,"fix":{"range":[2394,2829],"text":"const results = rawResults.filter((product: EnhancedProductData) => {\r\n            const normalizedName = product.identity.name.trim().toLowerCase();\r\n            const brandKey = (product.identity.brand || '').toLowerCase().split(',')[0].trim();\r\n            const uniqueKey = `${brandKey}|${normalizedName}`;\r\n\r\n            if (seen.has(uniqueKey)) return false;\r\n            seen.add(uniqueKey);\r\n            return true;\r\n        });"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":127,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5311,5314],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5311,5314],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":163,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":163,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":315,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":315,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12462,12465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12462,12465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":473,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":473,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19302,19305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19302,19305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport axios from 'axios';\r\nimport { fetchFromFooDB } from '@/services/external/foodbService';\r\n\r\nconst OFF_API_URL = 'https://world.openfoodfacts.org/api/v0/product';\r\n\r\nimport { EnhancedProductData, mapOpenFoodFactsToEnhanced } from '@/services/productMapper';\r\n\r\nconst apiClient = axios.create({\r\n    headers: {\r\n        'User-Agent': 'TruthLens - Web - 0.1.0'\r\n    }\r\n});\r\n\r\nexport type { EnhancedProductData }; // Re-export type if needed by consumers who import from here, though updating consumers is better. \r\n\r\n// ... (rest of the file content) - wait, replace_file_content replaces the chunk. \r\n// I need to replace lines 8-142 with the import.\r\n\r\n\r\nimport { searchFDA } from '@/services/external/fdaService';\r\nimport { generateProductInfoAI } from '@/services/searchAiService';\r\nimport { findProductImages, searchWithSearXNG } from '@/services/searxngService';\r\n\r\nexport const searchProductsAction = async (query: string): Promise<EnhancedProductData[]> => {\r\n    try {\r\n        console.log(`[Global Search] Initiating multi-source search for: ${query}`);\r\n\r\n        // 1. Parallel Execution: OpenFoodFacts + FDA\r\n        const [offResponse, fdaResults] = await Promise.allSettled([\r\n            apiClient.get(`https://world.openfoodfacts.org/cgi/search.pl?search_terms=${query}&search_simple=1&action=process&json=1&page_size=20&fields=_id,code,product_name,brands,generic_name,image_small_url,image_front_small_url,image_url,nutrition_grades,ecoscore_grade,nova_group`, { timeout: 8000 }),\r\n            searchFDA(query)\r\n        ]);\r\n\r\n        let rawResults: EnhancedProductData[] = [];\r\n\r\n        // 2. Process OpenFoodFacts Results\r\n        if (offResponse.status === 'fulfilled' && offResponse.value.data.products) {\r\n            const offProducts = offResponse.value.data.products\r\n                .map((p: any) => mapOpenFoodFactsToEnhanced(p))\r\n                .filter((p: EnhancedProductData) => p.identity.name !== 'Unknown Product');\r\n            rawResults = [...rawResults, ...offProducts];\r\n        } else {\r\n            console.warn('[Global Search] OpenFoodFacts request failed or timed out.');\r\n        }\r\n\r\n        // 3. Process FDA Results\r\n        if (fdaResults.status === 'fulfilled') {\r\n            rawResults = [...rawResults, ...fdaResults.value];\r\n        }\r\n\r\n        // 4. Deduplication\r\n        const seen = new Set<string>();\r\n        let results = rawResults.filter((product: EnhancedProductData) => {\r\n            const normalizedName = product.identity.name.trim().toLowerCase();\r\n            const brandKey = (product.identity.brand || '').toLowerCase().split(',')[0].trim();\r\n            const uniqueKey = `${brandKey}|${normalizedName}`;\r\n\r\n            if (seen.has(uniqueKey)) return false;\r\n            seen.add(uniqueKey);\r\n            return true;\r\n        });\r\n\r\n        // 5. Augment Missing Images via SearXNG\r\n        const finalResults = await Promise.all(results.map(async (p) => {\r\n            // If image is placeholder or missing, try to find one\r\n            if ((!p.media.front_image || p.media.front_image.includes('placeholder')) && p.identity.name) {\r\n                const images = await findProductImages(`${p.identity.name} ${p.identity.brand || ''}`, 1);\r\n                if (images.length > 0) {\r\n                    console.log(`[Global Search] Augmented missing image for ${p.identity.name}`);\r\n                    return {\r\n                        ...p,\r\n                        media: {\r\n                            ...p.media,\r\n                            front_image: images[0],\r\n                            thumbnail: images[0]\r\n                        }\r\n                    };\r\n                }\r\n            }\r\n            return p;\r\n        }));\r\n\r\n        if (finalResults.length > 0) {\r\n            return finalResults;\r\n        }\r\n\r\n        // 6. DB Failed? Fallback to Advanced Web Synthesis\r\n        // This handles \"Fanta\" if not in DB, or random questions\r\n        console.log('[Global Search] No DB results. Triggering Web-Augmented AI Fallback...');\r\n\r\n        // Search for Web Info + Images in parallel\r\n        const [webResults, imageResults] = await Promise.all([\r\n            searchWithSearXNG(query, 'general'),\r\n            findProductImages(query, 1)\r\n        ]);\r\n\r\n        const topWeb = webResults[0];\r\n        // Only use web image if imageResults failed AND web image is high quality (not a logo)\r\n        let topImage = imageResults[0];\r\n\r\n        if (!topImage && topWeb?.img_src) {\r\n            const url = topWeb.img_src.toLowerCase();\r\n            const isSuspicious = url.includes('logo') || url.includes('icon') || url.includes('assets') || url.includes('favicon') || url.includes('svg');\r\n            if (!isSuspicious) {\r\n                topImage = topWeb.img_src;\r\n            } else {\r\n                console.log('[Global Search] Filtered out suspicious fallback image:', url);\r\n            }\r\n        }\r\n\r\n        const webContext = {\r\n            title: topWeb?.title,\r\n            snippet: topWeb?.content,\r\n            image: topImage,\r\n            sourceUrl: topWeb?.url\r\n        };\r\n\r\n        const aiResult = await generateProductInfoAI(query, webContext);\r\n        if (aiResult) {\r\n            return [aiResult];\r\n        }\r\n\r\n        return [];\r\n\r\n    } catch (error: any) {\r\n        console.error(\"[Global Search] Aggregation Error:\", error.message);\r\n        // Crisis Fallback to AI if everything explodes\r\n        const aiResult = await generateProductInfoAI(query);\r\n        return aiResult ? [aiResult] : [];\r\n    }\r\n};\r\n\r\nexport const getAIProductAction = async (query: string): Promise<EnhancedProductData | null> => {\r\n    // Perform Web Search to get context for re-generation\r\n    try {\r\n        const [webResults, imageResults] = await Promise.all([\r\n            searchWithSearXNG(query, 'general'),\r\n            findProductImages(query, 1) // Now highly optimized\r\n        ]);\r\n\r\n        const topWeb = webResults[0];\r\n        // Only use web image if imageResults failed AND web image is high quality (not a logo)\r\n        let topImage = imageResults[0];\r\n\r\n        if (!topImage && topWeb?.img_src) {\r\n            const url = topWeb.img_src.toLowerCase();\r\n            const isSuspicious = url.includes('logo') || url.includes('icon') || url.includes('assets') || url.includes('favicon');\r\n            if (!isSuspicious) {\r\n                topImage = topWeb.img_src;\r\n            }\r\n        }\r\n\r\n        const webContext = {\r\n            title: topWeb?.title,\r\n            snippet: topWeb?.content,\r\n            image: topImage,\r\n            sourceUrl: topWeb?.url\r\n        };\r\n\r\n        return generateProductInfoAI(query, webContext);\r\n    } catch (e) {\r\n        return generateProductInfoAI(query);\r\n    }\r\n};\r\n\r\nexport const getProductAction = async (barcode: string): Promise<EnhancedProductData | null> => {\r\n    try {\r\n        // 1. Try FooDB First\r\n        const foodbResult = await fetchFromFooDB(barcode);\r\n        if (foodbResult) {\r\n            console.log(`[ProductAction] Found in FooDB: ${foodbResult.name}`);\r\n            // Map FooDB ProductData to EnhancedProductData\r\n            return {\r\n                id: foodbResult.id,\r\n                identity: {\r\n                    name: foodbResult.name,\r\n                    brand: foodbResult.brand,\r\n                    barcode: barcode,\r\n                    category: 'Unknown',\r\n                    description: foodbResult.description\r\n                },\r\n                media: {\r\n                    front_image: foodbResult.image,\r\n                    thumbnail: foodbResult.image,\r\n                },\r\n                grades: {\r\n                    nutri_score: '?', // FooDB doesn't typically have NutriScore\r\n                    eco_score: '?',\r\n                    processing_score: '?'\r\n                },\r\n                nutrition: {}, // FooDB structure is complex, leaving empty for generic view\r\n                sensory_profile: { flavors: [] },\r\n                ingredients: []\r\n            };\r\n        }\r\n\r\n        // 2. Fallback to OpenFoodFacts\r\n        const response = await apiClient.get(`${OFF_API_URL}/${barcode}.json`);\r\n\r\n        if (response.data.status === 1) {\r\n            return mapOpenFoodFactsToEnhanced(response.data.product);\r\n        }\r\n\r\n        // 3. Fallback to SearXNG (Azure VM)\r\n        console.log(`[ProductAction] Fallback: Searching SearXNG for ${barcode}...`);\r\n        const { searchWithSearXNG } = await import('@/services/searxngService'); // Dynamic import to avoid circular dep if any\r\n        const query = `${barcode} product details`;\r\n        const searchResults = await searchWithSearXNG(query, 'general');\r\n\r\n        if (searchResults && searchResults.length > 0) {\r\n            const topResult = searchResults[0];\r\n\r\n            // Extract Name/Brand logic (Simplified vs API route for now, or match it)\r\n            let name = topResult.title;\r\n            let brand = 'Unknown Brand';\r\n\r\n            if (name.includes(' - ')) {\r\n                const parts = name.split(' - ');\r\n                brand = parts[0];\r\n                name = parts.slice(1).join(' - ');\r\n            } else {\r\n                // Heuristic: Assume first word is brand if no separator found, or use \"Generic\"\r\n                const parts = name.split(' ');\r\n                if (parts.length > 1) {\r\n                    brand = parts[0]; // e.g. \"Samsung Galaxy S21\" -> Brand: Samsung\r\n                }\r\n            }\r\n\r\n            const enhancedData: EnhancedProductData = {\r\n                id: barcode,\r\n                identity: {\r\n                    name: name,\r\n                    brand: brand,\r\n                    barcode: barcode,\r\n                    category: 'Scanned Product',\r\n                    description: topResult.content || 'Details found via web search.'\r\n                },\r\n                media: {\r\n                    front_image: topResult.img_src || topResult.thumbnail || '',\r\n                    thumbnail: topResult.thumbnail || topResult.img_src || '',\r\n                },\r\n                grades: {\r\n                    nutri_score: '?', // Calculate in component or service if needed\r\n                    eco_score: '?',\r\n                    processing_score: '?'\r\n                },\r\n                nutrition: { nutriments_raw: {} },\r\n                sensory_profile: { flavors: [] },\r\n                ingredients: []\r\n            };\r\n            return enhancedData;\r\n        }\r\n\r\n        return null;\r\n\r\n    } catch (error) {\r\n        console.error(\"Error fetching product data:\", error);\r\n        return null;\r\n    }\r\n};\r\n\r\n// --- RECAPTCHA & REGISTRATION ---\r\nimport { adminAuth, adminDb } from '@/lib/firebaseAdmin';\r\n\r\nconst RECAPTCHA_SECRET_KEY = '6LeYMiYsAAAAAKBrlgVd2DgpCa1NO285uPI8Jvib'; // v2 Secret Key\r\n\r\ninterface RegisterResponse {\r\n    success: boolean;\r\n    token?: string; // Custom Firebase Token\r\n    error?: string;\r\n}\r\n\r\nexport async function registerUser(formData: FormData, token: string): Promise<RegisterResponse> {\r\n    const email = formData.get('email') as string;\r\n    const password = formData.get('password') as string;\r\n\r\n    if (!email || !password || !token) {\r\n        return { success: false, error: 'Missing required fields.' };\r\n    }\r\n\r\n    try {\r\n        // 1. Verify reCAPTCHA\r\n        const verificationUrl = `https://www.google.com/recaptcha/api/siteverify?secret=${RECAPTCHA_SECRET_KEY}&response=${token}`;\r\n        const recaptchaRes = await axios.post(verificationUrl);\r\n\r\n        const { success } = recaptchaRes.data;\r\n\r\n        console.log('reCAPTCHA Verification:', { success, email });\r\n\r\n        if (!success) {\r\n            console.warn('Blocked suspicious signup request:', email);\r\n            return { success: false, error: 'Security check failed. Please try again.' };\r\n        }\r\n\r\n        // 2. Create User in Firebase Admin\r\n        if (!adminAuth) {\r\n            console.error('Firebase Admin SDK not initialized.');\r\n            return { success: false, error: 'Internal server error.' };\r\n        }\r\n\r\n        const userRecord = await adminAuth.createUser({\r\n            email,\r\n            password,\r\n            emailVerified: false,\r\n            disabled: false,\r\n        });\r\n\r\n        // 3. Create Custom Token for immediate login\r\n        const customToken = await adminAuth.createCustomToken(userRecord.uid);\r\n\r\n        return { success: true, token: customToken };\r\n\r\n    } catch (error: any) {\r\n        console.error('Registration Error:', error);\r\n        // Map Firebase errors to user-friendly messages\r\n        if (error.code === 'auth/email-already-exists') {\r\n            return { success: false, error: 'Email is already in use.' };\r\n        }\r\n        if (error.code === 'auth/invalid-password') {\r\n            return { success: false, error: 'Password is too weak.' };\r\n        }\r\n        return { success: false, error: error.message || 'Failed to create account.' };\r\n    }\r\n}\r\n\r\n// --- AI SUGGESTIONS ---\r\n\r\nconst FALLBACK_SUGGESTIONS = [\r\n    // Food & Nutrition\r\n    \"What are healthy snacks for energy?\",\r\n    \"Is oatmeal good for weight loss?\",\r\n    \"How much water should I drink daily?\",\r\n    \"Does spinach have more iron than steak?\",\r\n    \"What's a good post-workout meal?\",\r\n\r\n    // Tech & PC Building\r\n    \"Best budget GPU for 1080p gaming?\",\r\n    \"How much RAM do I really need?\",\r\n    \"Is the RTX 4060 worth it?\",\r\n    \"How to check my PC specs?\",\r\n    \"Difference between SSD and NVMe?\",\r\n\r\n    // General Help\r\n    \"How do I reset my password?\",\r\n    \"How does the barcode scanner work?\",\r\n    \"Who created this AI?\",\r\n    \"Can you explain the Eco-Score?\",\r\n    \"What features are in Pro mode?\"\r\n];\r\n\r\nfunction getRandomSuggestions(count: number = 3): string[] {\r\n    const shuffled = [...FALLBACK_SUGGESTIONS].sort(() => 0.5 - Math.random());\r\n    return shuffled.slice(0, count);\r\n}\r\n\r\nexport async function generateChatSuggestions(): Promise<string[]> {\r\n    try {\r\n        console.log('[AI Action] Generating chat suggestions...');\r\n        let groqKey = process.env.GROQ_API_KEY || process.env.NEXT_PUBLIC_GROQ_API_KEY;\r\n\r\n        // 1. Try to fetch secure key from Admin Storage (if available)\r\n        if (adminDb) {\r\n            try {\r\n                const secretDoc = await adminDb.collection('_system_secrets').doc('ai_config').get();\r\n                if (secretDoc.exists) {\r\n                    const data = secretDoc.data();\r\n                    if (data?.groq) {\r\n                        groqKey = data.groq;\r\n                        console.log('[AI Action] Using Secure Admin Key for Groq');\r\n                    }\r\n                }\r\n            } catch (err) {\r\n                console.warn('[AI Action] Failed to fetch admin secrets:', err);\r\n            }\r\n        }\r\n\r\n        if (groqKey) {\r\n            try {\r\n                // 2. Try Groq API\r\n                const response = await axios.post(\r\n                    'https://api.groq.com/openai/v1/chat/completions',\r\n                    {\r\n                        model: 'llama3-8b-8192',\r\n                        messages: [\r\n                            {\r\n                                role: 'system',\r\n                                content: 'You are an AI Expert for Food, Nutrition, Tech & PC Building. Generate 3 short, engaging, diverse questions a user might ask you. ONE about nutrition, ONE about tech/PC building, and ONE generic. Return ONLY a JSON array of strings. Example: [\"Healthy snack ideas?\", \"Best GPU for 1080p?\", \"How to reset password?\"]'\r\n                            },\r\n                            {\r\n                                role: 'user',\r\n                                content: 'Generate 3 suggestions.'\r\n                            }\r\n                        ],\r\n                        temperature: 0.7,\r\n                        max_tokens: 100\r\n                    },\r\n                    {\r\n                        headers: {\r\n                            'Authorization': `Bearer ${groqKey}`,\r\n                            'Content-Type': 'application/json'\r\n                        }\r\n                    }\r\n                );\r\n\r\n                const content = response.data.choices[0]?.message?.content;\r\n                if (content) {\r\n                    const cleanContent = content.replace(/```json\\n?|\\n?```/g, '').trim();\r\n                    const parsed = JSON.parse(cleanContent);\r\n                    if (Array.isArray(parsed) && parsed.length > 0) {\r\n                        return parsed.slice(0, 3);\r\n                    }\r\n                }\r\n            } catch (err) {\r\n                console.warn('[AI Action] Groq failed, trying fallback...', err);\r\n            }\r\n        }\r\n\r\n        // 3. Try GitHub Models Fallback\r\n        // Fetch key again if needed or use env\r\n        const ghToken = process.env.GITHUB_MODELS_TOKEN; // Or fetch from adminDb logic if we stored it there\r\n\r\n        // Check admin secrets for GitHub Token if not in env\r\n        let secureGhToken = ghToken;\r\n        if (!secureGhToken && adminDb) {\r\n            const secretDoc = await adminDb.collection('_system_secrets').doc('ai_config').get();\r\n            if (secretDoc.exists) {\r\n                secureGhToken = secretDoc.data()?.githubModelsToken;\r\n            }\r\n        }\r\n\r\n        if (secureGhToken) {\r\n            console.log('[AI Action] Trying GitHub Models Fallback...');\r\n            try {\r\n                const response = await fetch('https://models.github.ai/inference/chat/completions', {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Authorization': `Bearer ${secureGhToken}`,\r\n                        'Content-Type': 'application/json',\r\n                        'Accept': 'application/vnd.github+json',\r\n                        'X-GitHub-Api-Version': '2022-11-28',\r\n                    },\r\n                    body: JSON.stringify({\r\n                        model: 'openai/gpt-4o', // or another reliable model available\r\n                        messages: [\r\n                            { role: 'system', content: 'Generate 3 short, diverse questions a user might ask an AI assistant (Food, Tech, General). Return ONLY a JSON array of strings.' },\r\n                            { role: 'user', content: 'Generate suggestions.' }\r\n                        ],\r\n                        max_tokens: 100\r\n                    })\r\n                });\r\n\r\n                if (response.ok) {\r\n                    const data = await response.json();\r\n                    const content = data.choices?.[0]?.message?.content;\r\n                    if (content) {\r\n                        const cleanContent = content.replace(/```json\\n?|\\n?```/g, '').trim();\r\n                        const parsed = JSON.parse(cleanContent);\r\n                        if (Array.isArray(parsed) && parsed.length > 0) {\r\n                            return parsed.slice(0, 3);\r\n                        }\r\n                    }\r\n                }\r\n            } catch (ghErr) {\r\n                console.warn('[AI Action] GitHub Models fallback failed:', ghErr);\r\n            }\r\n        }\r\n\r\n        console.warn('[AI Action] All AI providers failed. Using randomized static fallback.');\r\n        return getRandomSuggestions();\r\n\r\n    } catch (error: any) {\r\n        console.error('[AI Action] Error generating suggestions:', error.message);\r\n        return getRandomSuggestions();\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\actions\\adminRecovery.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3351,3354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3351,3354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport { adminDb } from '@/lib/firebase-admin';\r\nimport { FieldValue } from 'firebase-admin/firestore';\r\nimport * as OTPAuth from 'otpauth';\r\n\r\nexport async function recoverAdminAccount(token: string, totpCode: string, userEmail: string, userId: string): Promise<{ success: boolean; message: string }> {\r\n    if (!adminDb) {\r\n        console.error('Firebase Admin not initialized');\r\n        return { success: false, message: 'Server configuration error. Contact support.' };\r\n    }\r\n\r\n    try {\r\n        console.log(`[AdminRecovery] Attempting recovery for ${userEmail} with token ${token}`);\r\n\r\n        // 1. Get Token Doc (Bypass client rules)\r\n        const tokenRef = adminDb.collection('admin_setup_tokens').doc(token);\r\n        const tokenSnap = await tokenRef.get();\r\n\r\n        if (!tokenSnap.exists) {\r\n            return { success: false, message: 'Invalid token.' };\r\n        }\r\n\r\n        const data = tokenSnap.data();\r\n        if (!data) return { success: false, message: 'Token data corrupted.' };\r\n\r\n        // 2. Validate Token Status\r\n        if (data.status !== 'pending') {\r\n            return { success: false, message: `Token is ${data.status}.` };\r\n        }\r\n\r\n        // Email check\r\n        if (data.email && data.email.toLowerCase() !== userEmail.toLowerCase()) {\r\n            return { success: false, message: 'This token is not for this email address.' };\r\n        }\r\n\r\n        // Expiry check\r\n        const now = new Date();\r\n        const expiresAt = data.expiresAt?.toDate ? data.expiresAt.toDate() : new Date(data.expiresAt);\r\n        if (now > expiresAt) {\r\n            await tokenRef.update({ status: 'expired' });\r\n            return { success: false, message: 'Token has expired.' };\r\n        }\r\n\r\n        // 3. ≡ƒöÉ Validate TOTP Code\r\n        if (data.secret) {\r\n            // Strict 2FA Mode\r\n            if (!totpCode) {\r\n                return { success: false, message: '2FA Code required for this token.' };\r\n            }\r\n\r\n            const totp = new OTPAuth.TOTP({\r\n                issuer: 'TruthLens',\r\n                label: 'Admin Recovery',\r\n                algorithm: 'SHA1',\r\n                digits: 6,\r\n                period: 30,\r\n                secret: OTPAuth.Secret.fromBase32(data.secret)\r\n            });\r\n\r\n            const delta = totp.validate({ token: totpCode, window: 1 });\r\n\r\n            if (delta === null) {\r\n                console.warn(`[AdminRecovery] Invalid TOTP code for token ${token}`);\r\n                return { success: false, message: 'Invalid 2FA Code.' };\r\n            }\r\n        } else {\r\n            // Emergency / Legacy Mode (No Secret in DB)\r\n            console.warn(`[AdminRecovery] allowing recovery without 2FA for token ${token} (Emergency Mode)`);\r\n        }\r\n\r\n        // 4. Perform Promotion\r\n        await tokenRef.update({\r\n            status: 'used',\r\n            usedBy: userEmail,\r\n            usedAt: FieldValue.serverTimestamp()\r\n        });\r\n\r\n        await adminDb.collection('users').doc(userId).update({\r\n            role: 'admin',\r\n            adminTokenUsed: token,\r\n            updatedAt: FieldValue.serverTimestamp()\r\n        });\r\n\r\n        console.log(`[AdminRecovery] Success. Promoted ${userEmail} to admin.`);\r\n        return { success: true, message: 'Successfully recovered admin access.' };\r\n\r\n    } catch (error: any) {\r\n        console.error('[AdminRecovery] Error:', error);\r\n        return { success: false, message: error.message || 'Recovery failed.' };\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\actions\\aiActions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1097,1100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1097,1100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport { adminDb } from '@/lib/firebase-admin';\r\nimport { GoogleGenerativeAI } from \"@google/generative-ai\";\r\nimport Groq from \"groq-sdk\";\r\nimport axios from 'axios';\r\n\r\n// --- SECRET MANAGEMENT ---\r\n\r\nasync function getSystemKey(provider: string): Promise<string | undefined> {\r\n    try {\r\n        if (!adminDb) return undefined;\r\n        const doc = await adminDb.collection('_system_secrets').doc('api_keys').get();\r\n        return doc.data()?.[provider];\r\n    } catch (e) {\r\n        console.error('Failed to fetch system key', e);\r\n        return undefined;\r\n    }\r\n}\r\n\r\n// --- AI PROVIDERS ---\r\n\r\nexport async function serverCallGemini(prompt: string): Promise<string> {\r\n    const key = (await getSystemKey('gemini')) || process.env.GEMINI_API_KEY;\r\n    if (!key) throw new Error(\"Gemini Key configuration missing\");\r\n\r\n    const genAI = new GoogleGenerativeAI(key);\r\n    const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\r\n\r\n    try {\r\n        const result = await model.generateContent(prompt);\r\n        return result.response.text();\r\n    } catch (e: any) {\r\n        if (e.message?.includes('404')) {\r\n            const fallback = genAI.getGenerativeModel({ model: \"gemini-1.5-flash-latest\" });\r\n            const res = await fallback.generateContent(prompt);\r\n            return res.response.text();\r\n        }\r\n        throw e;\r\n    }\r\n}\r\n\r\nexport async function serverCallGroq(prompt: string): Promise<string> {\r\n    const key = (await getSystemKey('groq')) || process.env.GROQ_API_KEY;\r\n    if (!key) throw new Error(\"Groq Key configuration missing\");\r\n\r\n    const groq = new Groq({ apiKey: key });\r\n    const completion = await groq.chat.completions.create({\r\n        messages: [{ role: \"user\", content: prompt }],\r\n        model: \"llama-3.3-70b-versatile\",\r\n        temperature: 0.5,\r\n    });\r\n    return completion.choices[0]?.message?.content || \"\";\r\n}\r\n\r\nexport async function serverCallOpenAICompatible(prompt: string, provider: 'deepseek' | 'cerebras' | 'sambanova'): Promise<string> {\r\n    const key = await getSystemKey(provider) || process.env[`${provider.toUpperCase()}_API_KEY`];\r\n    if (!key) throw new Error(`${provider} Key configuration missing`);\r\n\r\n    const config = {\r\n        deepseek: { url: \"https://api.deepseek.com/v1\", model: \"deepseek-chat\" },\r\n        cerebras: { url: \"https://api.cerebras.ai/v1\", model: \"llama3.1-70b\" },\r\n        sambanova: { url: \"https://api.sambanova.ai/v1\", model: \"Meta-Llama-3.1-70B-Instruct\" }\r\n    };\r\n\r\n    const { url, model } = config[provider];\r\n\r\n    const response = await axios.post(\r\n        `${url}/chat/completions`,\r\n        {\r\n            model: model,\r\n            messages: [{ role: \"user\", content: prompt }],\r\n            temperature: 0.5,\r\n        },\r\n        { headers: { 'Authorization': `Bearer ${key}`, 'Content-Type': 'application/json' } }\r\n    );\r\n    return response.data.choices[0]?.message?.content || \"\";\r\n}\r\n\r\n// --- SWARM LOGIC (Server Side) ---\r\n\r\nexport async function serverSwarmResponse(prompt: string, providers: string[] = ['groq', 'gemini']): Promise<string> {\r\n    console.log(`≡ƒÉ¥ [Server Swarm] Racing ${providers.join(', ')}...`);\r\n\r\n    const promises: Promise<string>[] = [];\r\n\r\n    if (providers.includes('groq')) promises.push(serverCallGroq(prompt));\r\n    if (providers.includes('gemini')) promises.push(serverCallGemini(prompt));\r\n    if (providers.includes('deepseek')) promises.push(serverCallOpenAICompatible(prompt, 'deepseek'));\r\n    if (providers.includes('cerebras')) promises.push(serverCallOpenAICompatible(prompt, 'cerebras'));\r\n    if (providers.includes('sambanova')) promises.push(serverCallOpenAICompatible(prompt, 'sambanova'));\r\n\r\n    try {\r\n        const winner = await Promise.any(promises);\r\n        return winner;\r\n    } catch (error) {\r\n        console.error(\"Γÿá∩╕Å [Server Swarm] All providers failed:\", error);\r\n        throw new Error(\"All AI providers failed on server.\");\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\actions\\stripe.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[306,309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[306,309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'productName' is never reassigned. Use 'const' instead.","line":40,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":40,"endColumn":24,"fix":{"range":[1100,1178],"text":"const productName = `TruthLens ${tier.charAt(0).toUpperCase() + tier.slice(1)}`;"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3031,3034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3031,3034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":155,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5192,5195],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5192,5195],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":171,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5795,5798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5795,5798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":205,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7115,7118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7115,7118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":254,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9292,9295],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9292,9295],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport { adminAuth, adminDb } from '@/lib/firebaseAdmin';\r\n\r\nimport Stripe from 'stripe';\r\n\r\nif (!process.env.STRIPE_SECRET_KEY) {\r\n    console.error('STRIPE_SECRET_KEY is missing');\r\n}\r\n\r\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, {\r\n    apiVersion: '2024-11-20.acacia' as any, // Suppress version mismatch\r\n});\r\n\r\nconst APP_URL = process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';\r\n\r\ninterface CreateCheckoutSessionParams {\r\n    userId: string;\r\n    userEmail: string;\r\n    tier: 'plus' | 'pro' | 'ultimate';\r\n    billingCycle: 'monthly' | 'lifetime';\r\n}\r\n\r\nexport async function createCheckoutSession({\r\n    userId,\r\n    userEmail,\r\n    tier,\r\n    billingCycle,\r\n}: CreateCheckoutSessionParams) {\r\n    try {\r\n        if (!userId || !userEmail) {\r\n            throw new Error('Missing user information');\r\n        }\r\n\r\n        // Define Product/Price Data dynamically\r\n        // Ideally, these are defined in Stripe Dashboard and we use Price IDs.\r\n        // For dynamic/ad-hoc generation ensuring strict pricing:\r\n\r\n        let priceAmount = 0;\r\n        let productName = `TruthLens ${tier.charAt(0).toUpperCase() + tier.slice(1)}`;\r\n\r\n        // Pricing Map (Matches systemService.ts defaults)\r\n        const prices = {\r\n            plus: { monthly: 399, lifetime: 1999 }, // In cents\r\n            pro: { monthly: 799, lifetime: 4999 },\r\n            ultimate: { monthly: 1499, lifetime: 7999 }\r\n        };\r\n\r\n        if (prices[tier]) {\r\n            priceAmount = prices[tier][billingCycle];\r\n        } else {\r\n            throw new Error('Invalid tier');\r\n        }\r\n\r\n        // Construct line item\r\n        const lineItem: Stripe.Checkout.SessionCreateParams.LineItem = {\r\n            quantity: 1,\r\n            price_data: {\r\n                currency: 'usd',\r\n                product_data: {\r\n                    name: productName,\r\n                    description: `${billingCycle === 'monthly' ? 'Monthly Subscription' : 'Lifetime Access'} - ${productName}`,\r\n                    metadata: {\r\n                        tier,\r\n                        billingCycle\r\n                    }\r\n                },\r\n                unit_amount: priceAmount,\r\n            },\r\n        };\r\n\r\n        if (billingCycle === 'monthly') {\r\n            lineItem.price_data!.recurring = {\r\n                interval: 'month',\r\n            };\r\n        }\r\n\r\n        const session = await stripe.checkout.sessions.create({\r\n            payment_method_types: ['card'],\r\n            line_items: [lineItem],\r\n            mode: billingCycle === 'monthly' ? 'subscription' : 'payment',\r\n            success_url: `${APP_URL}/payment/success?session_id={CHECKOUT_SESSION_ID}`,\r\n            cancel_url: `${APP_URL}/upgrade`,\r\n            customer_email: userEmail,\r\n            metadata: {\r\n                userId,\r\n                tier,\r\n                billingCycle,\r\n                type: 'paid'\r\n            },\r\n        });\r\n\r\n        return { sessionId: session.id, url: session.url };\r\n    } catch (error: any) {\r\n        console.error('Stripe Checkout Error:', error);\r\n        throw new Error(error.message || 'Failed to initiate checkout');\r\n    }\r\n}\r\n\r\nexport async function verifyStripeSession(sessionId: string) {\r\n    try {\r\n        const session = await stripe.checkout.sessions.retrieve(sessionId);\r\n\r\n        if (session.payment_status === 'paid') {\r\n            return {\r\n                success: true,\r\n                metadata: session.metadata\r\n            };\r\n        }\r\n\r\n        return { success: false };\r\n    } catch (error) {\r\n        console.error('Verify Session Error:', error);\r\n        return { success: false };\r\n    }\r\n}\r\n\r\nexport async function finalizeUpgradeAction(userId: string, tier: 'plus' | 'pro' | 'ultimate', billingCycle: 'monthly' | 'lifetime') {\r\n    try {\r\n        if (!process.env.FIREBASE_SERVICE_ACCOUNT_KEY || !adminDb || !adminAuth) {\r\n            console.error('FIREBASE_SERVICE_ACCOUNT_KEY missing for upgrade');\r\n            return { success: false, error: 'Internal config error' };\r\n        }\r\n\r\n        console.log(`[STRIPE] Finalizing upgrade for ${userId} to ${tier} (${billingCycle})`);\r\n\r\n        // 1. Update User Subscription in Firestore (Using Admin SDK -> bypasses rules)\r\n        await adminDb.collection('users').doc(userId).set({\r\n            subscription: {\r\n                tier,\r\n                startDate: new Date(), // Now\r\n                endDate: billingCycle === 'monthly'\r\n                    ? new Date(Date.now() + 30 * 24 * 60 * 60 * 1000) // +30 days\r\n                    : null, // Lifetime\r\n                autoRenew: billingCycle === 'monthly',\r\n            }\r\n        }, { merge: true });\r\n\r\n        // 2. Record Transaction\r\n        await adminDb.collection('paymentRequests').add({\r\n            userId,\r\n            tier,\r\n            billingCycle,\r\n            type: 'paid',\r\n            status: 'completed',\r\n            provider: 'stripe',\r\n            createdAt: new Date(),\r\n            updatedAt: new Date()\r\n        });\r\n\r\n        // 3. Set Custom Claim\r\n        await adminAuth.setCustomUserClaims(userId, { tier });\r\n\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('Finalize Upgrade Error:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\n// --- PC Build Consultation Actions ---\r\n\r\nexport async function createConsultationCheckout(userId: string, userEmail: string) {\r\n    try {\r\n        if (!userId || !userEmail) throw new Error('Missing user info');\r\n\r\n        if (!adminDb) throw new Error('Db not init');\r\n\r\n        // 1. Fetch Dynamic Price from System Settings\r\n        const settingsSnap = await adminDb.collection('system').doc('settings').get();\r\n        const settings = settingsSnap.data() as any; // Cast as needed or import type if shared\r\n\r\n        // Default to 20.00 USD (2000 cents) if not set\r\n        const priceAmount = settings?.pcConsultationPrice || 2000;\r\n\r\n        const lineItem: Stripe.Checkout.SessionCreateParams.LineItem = {\r\n            quantity: 1,\r\n            price_data: {\r\n                currency: 'usd',\r\n                product_data: {\r\n                    name: 'PC Build Expert Consultation',\r\n                    description: 'Custom PC configuration by TruthLens experts',\r\n                    metadata: {\r\n                        type: 'pc_consultation'\r\n                    }\r\n                },\r\n                unit_amount: priceAmount,\r\n            },\r\n        };\r\n\r\n        const session = await stripe.checkout.sessions.create({\r\n            payment_method_types: ['card'],\r\n            line_items: [lineItem],\r\n            mode: 'payment',\r\n            success_url: `${APP_URL}/pc-builder?payment=success&session_id={CHECKOUT_SESSION_ID}`,\r\n            cancel_url: `${APP_URL}/pc-builder?payment=cancelled`, // Return to builder\r\n            customer_email: userEmail,\r\n            metadata: {\r\n                userId,\r\n                type: 'pc_consultation'\r\n            },\r\n        });\r\n\r\n        return { sessionId: session.id, url: session.url };\r\n    } catch (error: any) {\r\n        console.error('Consultation Checkout Error:', error);\r\n        throw new Error(error.message || 'Failed to initiate checkout');\r\n    }\r\n}\r\n\r\nexport async function verifyPaymentAndCreateRequest(sessionId: string) {\r\n    try {\r\n        const session = await stripe.checkout.sessions.retrieve(sessionId);\r\n\r\n        if (session.payment_status === 'paid' && session.metadata?.type === 'pc_consultation') {\r\n            const userId = session.metadata.userId;\r\n            const amount = session.amount_total || 2000;\r\n\r\n            if (!userId) throw new Error('No User ID in session metadata');\r\n\r\n            if (!adminDb) throw new Error('Db not init');\r\n\r\n            console.log(`[STRIPE] Creating PC Build Request for ${userId}`);\r\n\r\n            // Create initial request document\r\n            // Check if exists first? We can just set/merge.\r\n            // Status: 'paid_pending_form'\r\n            const requestRef = adminDb.collection('pc_build_requests').doc(userId);\r\n\r\n            // We use set with merge: true to avoid overwriting if they somehow paid twice or to be safe,\r\n            // but effectively this resets the status to allow them to fill the form.\r\n            await requestRef.set({\r\n                userId,\r\n                userEmail: session.customer_details?.email || session.customer_email || '',\r\n                status: 'paid_pending_form',\r\n                paymentId: session.payment_intent as string,\r\n                amount: amount,\r\n                updatedAt: new Date(),\r\n                // Only set createdAt if new\r\n            }, { merge: true });\r\n\r\n            // If createdAt doesn't exist, set it (using update or specialized set logic, \r\n            // but Firestore 'merge' doesn't selectively ignore fields if doc missing.\r\n            // Simpler: Just read and see.\r\n            const doc = await requestRef.get();\r\n            if (!doc.data()?.createdAt) {\r\n                await requestRef.set({ createdAt: new Date() }, { merge: true });\r\n            }\r\n\r\n            return { success: true };\r\n        }\r\n\r\n        return { success: false, error: 'Payment not successful or invalid type' };\r\n    } catch (error: any) {\r\n        console.error('Verify Consultation Error:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\ai-chat\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isFree' is assigned a value but never used.","line":33,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isPlus' is assigned a value but never used.","line":33,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":61},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":152,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5634,5637],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5634,5637],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":355,"column":42,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[14918,15010],"text":"\r\n                                    Hi! I&apos;m TruthLens AI\r\n                                "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[14918,15010],"text":"\r\n                                    Hi! I&lsquo;m TruthLens AI\r\n                                "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[14918,15010],"text":"\r\n                                    Hi! I&#39;m TruthLens AI\r\n                                "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[14918,15010],"text":"\r\n                                    Hi! I&rsquo;m TruthLens AI\r\n                                "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n    Box,\r\n    Container,\r\n    Typography,\r\n    Paper,\r\n    TextField,\r\n    IconButton,\r\n    Avatar,\r\n    Button,\r\n    CircularProgress,\r\n    Collapse\r\n} from '@mui/material';\r\nimport SendIcon from '@mui/icons-material/Send';\r\nimport SmartToyIcon from '@mui/icons-material/SmartToy';\r\nimport PersonIcon from '@mui/icons-material/Person';\r\nimport SettingsIcon from '@mui/icons-material/Settings';\r\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { sendAIChatMessage, getUserApiKeys, requiresOwnKey } from '@/services/aiChatService';\r\nimport { AIChatMessage, AIChatError, AIProvider, AILanguage, AI_PROVIDERS } from '@/types/aiChat';\r\nimport ApiKeyManager from '@/components/settings/ApiKeyManager';\r\nimport AIChatSettings from '@/components/settings/AIChatSettings';\r\nimport ChatErrorCard from '@/components/chat/ChatErrorCard';\r\nimport { generateChatSuggestions } from '@/app/actions';\r\n\r\nexport default function AIChatPage() {\r\n    const router = useRouter();\r\n    const { user, tier, loading: authLoading, isFree, isPlus, features } = useAuth();\r\n\r\n    const [messages, setMessages] = useState<AIChatMessage[]>([]);\r\n    const [input, setInput] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState<AIChatError | null>(null);\r\n    const [provider, setProvider] = useState<AIProvider>('ollama'); // Default safe initial state\r\n    const [language, setLanguage] = useState<AILanguage>('en');\r\n    const [showSettings, setShowSettings] = useState(false);\r\n    const [hasApiKey, setHasApiKey] = useState<boolean | null>(null);\r\n    const [suggestions, setSuggestions] = useState<string[]>([]);\r\n\r\n    const messagesEndRef = useRef<HTMLDivElement>(null);\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n    // Redirect if not logged in\r\n    useEffect(() => {\r\n        if (!authLoading && !user) {\r\n            router.push('/login');\r\n        }\r\n    }, [user, authLoading, router]);\r\n\r\n    // Check if user has API key and load preferences\r\n    useEffect(() => {\r\n        const loadPreferences = async () => {\r\n            if (user) {\r\n                const keys = await getUserApiKeys(user.uid);\r\n                const savedProvider = keys.preferredProvider;\r\n                const savedLanguage = keys.preferredLanguage || 'en';\r\n\r\n                setLanguage(savedLanguage);\r\n\r\n                // Set Provider Logic\r\n                if (savedProvider) {\r\n                    setProvider(savedProvider);\r\n                } else {\r\n                    // Smart Defaults\r\n                    if (requiresOwnKey(tier)) {\r\n                        // Free/Plus -> Default to Azure AI (Ollama) as it's free\r\n                        setProvider('ollama');\r\n                    } else {\r\n                        // Pro/Ultimate -> Default to Groq (Fastest)\r\n                        setProvider('groq');\r\n                    }\r\n                }\r\n\r\n                // Check API Key\r\n                // For Pro/Ultimate (not requiresOwnKey), they always have access via platform keys\r\n                // For Free/Plus (requiresOwnKey), check if they have key for CURRENT provider\r\n                if (requiresOwnKey(tier)) {\r\n                    // Azure AI (Ollama) is free for everyone\r\n                    if ((savedProvider || 'ollama') === 'ollama') {\r\n                        setHasApiKey(true);\r\n                    } else {\r\n                        // Check specific key\r\n                        const currentProvider = savedProvider || 'ollama';\r\n                        setHasApiKey(!!keys[currentProvider]);\r\n                    }\r\n                } else {\r\n                    setHasApiKey(true);\r\n                }\r\n            }\r\n        };\r\n        loadPreferences();\r\n    }, [user, tier]);\r\n\r\n    // Load AI-generated suggestions\r\n    useEffect(() => {\r\n        const loadSuggestions = async () => {\r\n            const aiSuggestions = await generateChatSuggestions();\r\n            setSuggestions(aiSuggestions);\r\n        };\r\n        loadSuggestions();\r\n    }, []);\r\n\r\n    // Scroll to bottom on new messages\r\n    useEffect(() => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n    }, [messages]);\r\n\r\n    const handleSend = async () => {\r\n        if (!input.trim() || loading || !user) return;\r\n\r\n        const userMessage: AIChatMessage = {\r\n            id: Date.now().toString(),\r\n            role: 'user',\r\n            content: input.trim(),\r\n            timestamp: new Date()\r\n        };\r\n\r\n        setMessages(prev => [...prev, userMessage]);\r\n        setInput('');\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            // Build conversation history\r\n            const history = messages.map(m => ({\r\n                role: m.role,\r\n                content: m.content\r\n            }));\r\n\r\n            const response = await sendAIChatMessage(\r\n                user.uid,\r\n                tier,\r\n                userMessage.content,\r\n                provider,\r\n                history,\r\n                language\r\n            );\r\n\r\n            const assistantMessage: AIChatMessage = {\r\n                id: (Date.now() + 1).toString(),\r\n                role: 'assistant',\r\n                content: response,\r\n                timestamp: new Date()\r\n            };\r\n\r\n            setMessages(prev => [...prev, assistantMessage]);\r\n        } catch (err: any) {\r\n            console.error('Chat error:', err);\r\n            setError(err as AIChatError);\r\n        } finally {\r\n            setLoading(false);\r\n            inputRef.current?.focus();\r\n        }\r\n    };\r\n\r\n    const handleKeyPress = (e: React.KeyboardEvent) => {\r\n        if (e.key === 'Enter' && !e.shiftKey) {\r\n            e.preventDefault();\r\n            handleSend();\r\n        }\r\n    };\r\n\r\n    const handleKeysUpdated = async () => {\r\n        if (user) {\r\n            const keys = await getUserApiKeys(user.uid);\r\n            // Re-check key status for current provider\r\n            if (provider === 'ollama' || !requiresOwnKey(tier)) {\r\n                setHasApiKey(true);\r\n            } else {\r\n                setHasApiKey(!!keys[provider]);\r\n            }\r\n            // Do NOT automatically close settings - user might want to add multiple keys\r\n            // setShowSettings(false); \r\n            setError(null);\r\n        }\r\n    };\r\n\r\n    if (authLoading || !user) {\r\n        return (\r\n            <Box className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-black\">\r\n                <CircularProgress />\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    // Feature gate - AI Chat access check\r\n    if (!features.aiChat) {\r\n        return (\r\n            <Box className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-black\">\r\n                <Container maxWidth=\"sm\">\r\n                    <Paper sx={{ p: 5, borderRadius: 4, textAlign: 'center' }}>\r\n                        <SmartToyIcon sx={{ fontSize: 60, color: 'warning.main', mb: 2 }} />\r\n                        <Typography variant=\"h5\" fontWeight=\"bold\" gutterBottom>Premium Feature</Typography>\r\n                        <Typography color=\"text.secondary\" paragraph>\r\n                            AI Chat is available for Plus, Pro, and Ultimate members.\r\n                        </Typography>\r\n                        <Button variant=\"contained\" color=\"warning\" href=\"/upgrade\">\r\n                            Upgrade Now\r\n                        </Button>\r\n                    </Paper>\r\n                </Container>\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    // Show settings panel if user needs to add API key\r\n    const needsKeySetup = requiresOwnKey(tier) && !hasApiKey;\r\n\r\n    return (\r\n        <Box\r\n            sx={{\r\n                minHeight: '100vh',\r\n                bgcolor: 'background.default',\r\n                display: 'flex',\r\n                flexDirection: 'column'\r\n            }}\r\n        >\r\n            {/* Header */}\r\n            <Paper\r\n                elevation={0}\r\n                sx={{\r\n                    py: 2,\r\n                    px: 2,\r\n                    borderBottom: '1px solid',\r\n                    borderColor: 'divider',\r\n                    position: 'sticky',\r\n                    top: 0,\r\n                    zIndex: 10,\r\n                    backdropFilter: 'blur(10px)',\r\n                    bgcolor: 'rgba(var(--background-paper-rgb), 0.9)'\r\n                }}\r\n            >\r\n                <Container maxWidth=\"md\" disableGutters>\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\r\n                            <IconButton onClick={() => router.back()}>\r\n                                <ArrowBackIcon />\r\n                            </IconButton>\r\n                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                                <Avatar\r\n                                    sx={{\r\n                                        width: 40,\r\n                                        height: 40,\r\n                                        background: 'linear-gradient(135deg, #9333EA 0%, #6366F1 100%)'\r\n                                    }}\r\n                                >\r\n                                    <SmartToyIcon />\r\n                                </Avatar>\r\n                                <Box>\r\n                                    <Typography variant=\"subtitle1\" fontWeight=\"bold\">\r\n                                        TruthLens AI\r\n                                    </Typography>\r\n                                    <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                        {AI_PROVIDERS[provider].icon} Using {AI_PROVIDERS[provider].name}\r\n                                    </Typography>\r\n                                </Box>\r\n                            </Box>\r\n                        </Box>\r\n\r\n                        <IconButton\r\n                            onClick={() => setShowSettings(!showSettings)}\r\n                            sx={{\r\n                                bgcolor: showSettings ? 'primary.main' : 'action.hover',\r\n                                color: showSettings ? 'white' : 'inherit',\r\n                                '&:hover': {\r\n                                    bgcolor: showSettings ? 'primary.dark' : 'action.selected'\r\n                                }\r\n                            }}\r\n                        >\r\n                            <SettingsIcon />\r\n                        </IconButton>\r\n                    </Box>\r\n                </Container>\r\n            </Paper>\r\n\r\n            {/* Settings Panel */}\r\n            <Collapse in={showSettings || needsKeySetup}>\r\n                <Box sx={{ bgcolor: 'background.paper', borderBottom: '1px solid', borderColor: 'divider' }}>\r\n                    <Container maxWidth=\"md\" sx={{ py: 3 }}>\r\n                        {/* Free/Plus: Needs Key Management AND Model Selection */}\r\n                        {requiresOwnKey(tier) ? (\r\n                            <ApiKeyManager\r\n                                onKeysSaved={handleKeysUpdated}\r\n                                onKeysDeleted={handleKeysUpdated}\r\n                                onSettingsChanged={() => {\r\n                                    if (user) {\r\n                                        getUserApiKeys(user.uid).then(keys => {\r\n                                            if (keys.preferredProvider) setProvider(keys.preferredProvider);\r\n                                            if (keys.preferredLanguage) setLanguage(keys.preferredLanguage);\r\n                                        });\r\n                                    }\r\n                                }}\r\n                            />\r\n                        ) : (\r\n                            /* Pro/Ultimate: Just Model/Language Selection */\r\n                            <AIChatSettings onSettingsChanged={() => {\r\n                                // Reload preferences when settings change\r\n                                if (user) {\r\n                                    getUserApiKeys(user.uid).then(keys => {\r\n                                        setProvider(keys.preferredProvider || 'groq');\r\n                                        setLanguage(keys.preferredLanguage || 'en');\r\n                                    });\r\n                                }\r\n                            }} />\r\n                        )}\r\n                    </Container>\r\n                </Box>\r\n            </Collapse>\r\n\r\n            {/* Messages Container */}\r\n            <Box sx={{ flex: 1, overflow: 'auto', py: 2 }}>\r\n                <Container maxWidth=\"md\">\r\n                    {/* Welcome Message */}\r\n                    {messages.length === 0 && !needsKeySetup && (\r\n                        <Box\r\n                            component={motion.div}\r\n                            initial={{ opacity: 0, y: 20 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            sx={{\r\n                                py: 8,\r\n                                display: 'flex',\r\n                                justifyContent: 'center'\r\n                            }}\r\n                        >\r\n                            <Paper\r\n                                elevation={0}\r\n                                sx={{\r\n                                    p: 4,\r\n                                    maxWidth: 600,\r\n                                    borderRadius: 4,\r\n                                    textAlign: 'center',\r\n                                    border: '1px solid',\r\n                                    borderColor: 'divider',\r\n                                    bgcolor: 'background.paper'\r\n                                }}\r\n                            >\r\n                                <Avatar\r\n                                    sx={{\r\n                                        width: 80,\r\n                                        height: 80,\r\n                                        mx: 'auto',\r\n                                        mb: 3,\r\n                                        background: 'linear-gradient(135deg, #9333EA 0%, #6366F1 100%)',\r\n                                        boxShadow: '0 8px 32px rgba(99, 102, 241, 0.25)'\r\n                                    }}\r\n                                >\r\n                                    <SmartToyIcon sx={{ fontSize: 40 }} />\r\n                                </Avatar>\r\n                                <Typography variant=\"h5\" fontWeight=\"bold\" gutterBottom>\r\n                                    Hi! I'm TruthLens AI\r\n                                </Typography>\r\n                                <Typography variant=\"body1\" color=\"text.secondary\" sx={{ mb: 4 }}>\r\n                                    Your AI Expert for <b>Food, Nutrition, Tech & PC Building</b>.\r\n                                    <br />\r\n                                    How can I help you today?\r\n                                </Typography>\r\n\r\n                                {/* Quick Suggestions */}\r\n                                <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1, justifyContent: 'center' }}>\r\n                                    {suggestions.map((suggestion) => (\r\n                                        <Button\r\n                                            key={suggestion}\r\n                                            variant=\"outlined\"\r\n                                            size=\"small\"\r\n                                            onClick={() => {\r\n                                                setInput(suggestion);\r\n                                                inputRef.current?.focus();\r\n                                            }}\r\n                                            sx={{\r\n                                                borderRadius: 3,\r\n                                                textTransform: 'none',\r\n                                                borderColor: 'divider',\r\n                                                color: 'text.primary',\r\n                                                '&:hover': {\r\n                                                    borderColor: 'primary.main',\r\n                                                    bgcolor: 'rgba(108, 99, 255, 0.05)'\r\n                                                }\r\n                                            }}\r\n                                        >\r\n                                            {suggestion}\r\n                                        </Button>\r\n                                    ))}\r\n                                </Box>\r\n                            </Paper>\r\n                        </Box>\r\n                    )}\r\n\r\n                    {/* Chat Messages */}\r\n                    <AnimatePresence>\r\n                        {messages.map((message, index) => (\r\n                            <Box\r\n                                component={motion.div}\r\n                                key={message.id}\r\n                                initial={{ opacity: 0, y: 20, scale: 0.95 }}\r\n                                animate={{ opacity: 1, y: 0, scale: 1 }}\r\n                                transition={{ duration: 0.3, delay: index * 0.05 }}\r\n                                sx={{\r\n                                    display: 'flex',\r\n                                    gap: 2,\r\n                                    mb: 2,\r\n                                    flexDirection: message.role === 'user' ? 'row-reverse' : 'row'\r\n                                }}\r\n                            >\r\n                                <Avatar\r\n                                    sx={{\r\n                                        width: 36,\r\n                                        height: 36,\r\n                                        bgcolor: message.role === 'user' ? 'primary.main' : 'transparent',\r\n                                        background: message.role === 'assistant'\r\n                                            ? 'linear-gradient(135deg, #9333EA 0%, #6366F1 100%)'\r\n                                            : undefined\r\n                                    }}\r\n                                >\r\n                                    {message.role === 'user' ? <PersonIcon /> : <SmartToyIcon />}\r\n                                </Avatar>\r\n\r\n                                <Paper\r\n                                    elevation={0}\r\n                                    sx={{\r\n                                        p: 2,\r\n                                        maxWidth: '75%',\r\n                                        borderRadius: 3,\r\n                                        bgcolor: message.role === 'user'\r\n                                            ? 'primary.main'\r\n                                            : 'background.paper',\r\n                                        color: message.role === 'user' ? 'white' : 'text.primary',\r\n                                        border: message.role === 'assistant' ? '1px solid' : 'none',\r\n                                        borderColor: 'divider'\r\n                                    }}\r\n                                >\r\n                                    <Typography\r\n                                        variant=\"body1\"\r\n                                        sx={{\r\n                                            whiteSpace: 'pre-wrap',\r\n                                            wordBreak: 'break-word'\r\n                                        }}\r\n                                    >\r\n                                        {message.content}\r\n                                    </Typography>\r\n                                </Paper>\r\n                            </Box>\r\n                        ))}\r\n                    </AnimatePresence>\r\n\r\n                    {/* Loading Indicator */}\r\n                    {loading && (\r\n                        <Box\r\n                            component={motion.div}\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            sx={{ display: 'flex', gap: 2, mb: 2 }}\r\n                        >\r\n                            <Avatar\r\n                                sx={{\r\n                                    width: 36,\r\n                                    height: 36,\r\n                                    background: 'linear-gradient(135deg, #9333EA 0%, #6366F1 100%)'\r\n                                }}\r\n                            >\r\n                                <SmartToyIcon />\r\n                            </Avatar>\r\n                            <Paper\r\n                                elevation={0}\r\n                                sx={{\r\n                                    p: 2,\r\n                                    borderRadius: 3,\r\n                                    bgcolor: 'background.paper',\r\n                                    border: '1px solid',\r\n                                    borderColor: 'divider'\r\n                                }}\r\n                            >\r\n                                <Box sx={{ display: 'flex', gap: 0.5 }}>\r\n                                    {[0, 1, 2].map((i) => (\r\n                                        <Box\r\n                                            key={i}\r\n                                            component={motion.div}\r\n                                            animate={{\r\n                                                y: [0, -6, 0]\r\n                                            }}\r\n                                            transition={{\r\n                                                duration: 0.6,\r\n                                                repeat: Infinity,\r\n                                                delay: i * 0.15\r\n                                            }}\r\n                                            sx={{\r\n                                                width: 8,\r\n                                                height: 8,\r\n                                                borderRadius: '50%',\r\n                                                bgcolor: 'text.secondary'\r\n                                            }}\r\n                                        />\r\n                                    ))}\r\n                                </Box>\r\n                            </Paper>\r\n                        </Box>\r\n                    )}\r\n\r\n                    {/* Error Message */}\r\n                    <AnimatePresence>\r\n                        {error && (\r\n                            <ChatErrorCard\r\n                                error={error}\r\n                                onOpenSettings={() => setShowSettings(true)}\r\n                                onRetry={() => {\r\n                                    setError(null);\r\n                                    // Retry last message if exists\r\n                                    if (messages.length > 0) {\r\n                                        const lastUserMessage = [...messages].reverse().find(m => m.role === 'user');\r\n                                        if (lastUserMessage) {\r\n                                            setInput(lastUserMessage.content);\r\n                                        }\r\n                                    }\r\n                                }}\r\n                                onDismiss={() => setError(null)}\r\n                            />\r\n                        )}\r\n                    </AnimatePresence>\r\n\r\n                    <div ref={messagesEndRef} />\r\n                </Container>\r\n            </Box>\r\n\r\n            {/* Input Area */}\r\n            <Paper\r\n                elevation={0}\r\n                sx={{\r\n                    p: 2,\r\n                    borderTop: '1px solid',\r\n                    borderColor: 'divider',\r\n                    position: 'sticky',\r\n                    bottom: 0,\r\n                    bgcolor: 'background.paper'\r\n                }}\r\n            >\r\n                <Container maxWidth=\"md\" disableGutters>\r\n                    <Box sx={{ display: 'flex', gap: 1, alignItems: 'flex-end' }}>\r\n                        <TextField\r\n                            fullWidth\r\n                            multiline\r\n                            maxRows={4}\r\n                            placeholder={needsKeySetup ? 'Add your API key above to start chatting...' : 'Ask about Food, Tech, or anything...'}\r\n                            value={input}\r\n                            onChange={(e) => setInput(e.target.value)}\r\n                            onKeyDown={handleKeyPress}\r\n                            disabled={loading || needsKeySetup}\r\n                            inputRef={inputRef}\r\n                            sx={{\r\n                                '& .MuiOutlinedInput-root': {\r\n                                    borderRadius: 3,\r\n                                    bgcolor: 'background.default'\r\n                                }\r\n                            }}\r\n                        />\r\n                        <IconButton\r\n                            color=\"primary\"\r\n                            onClick={handleSend}\r\n                            disabled={!input.trim() || loading || needsKeySetup}\r\n                            sx={{\r\n                                width: 48,\r\n                                height: 48,\r\n                                bgcolor: 'primary.main',\r\n                                color: 'white',\r\n                                '&:hover': {\r\n                                    bgcolor: 'primary.dark'\r\n                                },\r\n                                '&:disabled': {\r\n                                    bgcolor: 'action.disabledBackground',\r\n                                    color: 'action.disabled'\r\n                                }\r\n                            }}\r\n                        >\r\n                            {loading ? <CircularProgress size={24} color=\"inherit\" /> : <SendIcon />}\r\n                        </IconButton>\r\n                    </Box>\r\n                </Container>\r\n            </Paper>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\access\\submit\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":20,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5073,5076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5073,5076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { adminDb, adminAuth } from '@/lib/firebase-admin';\r\nimport { FieldValue, Timestamp } from 'firebase-admin/firestore';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        // 1. Verify User Auth\r\n        const authHeader = req.headers.get('Authorization');\r\n        if (!authHeader?.startsWith('Bearer ')) {\r\n            return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 });\r\n        }\r\n\r\n        const idToken = authHeader.split('Bearer ')[1];\r\n        let uid;\r\n        try {\r\n            const decodedToken = await adminAuth!.verifyIdToken(idToken);\r\n            uid = decodedToken.uid;\r\n        } catch (e) {\r\n            return NextResponse.json({ success: false, error: 'Invalid Token' }, { status: 401 });\r\n        }\r\n\r\n        const data = await req.json();\r\n\r\n        if (!adminDb) {\r\n            return NextResponse.json({ success: false, error: 'Server configuration error' }, { status: 500 });\r\n        }\r\n\r\n        // 2. Transact: Re-Validate Code -> Create Request -> Update Code Usage -> Update User (if auto-approved)\r\n        const result = await adminDb.runTransaction(async (t) => {\r\n            // A. Check Code\r\n            const codesRef = adminDb!.collection('accessCodes');\r\n            const codeSnapshot = await t.get(codesRef.where('code', '==', data.code.toUpperCase()).where('active', '==', true).limit(1));\r\n\r\n            if (codeSnapshot.empty) {\r\n                throw new Error('Invalid or inactive access code');\r\n            }\r\n\r\n            const codeDoc = codeSnapshot.docs[0];\r\n            const codeData = codeDoc.data();\r\n\r\n            if (codeData.expiresAt && codeData.expiresAt.toDate() < new Date()) {\r\n                throw new Error('Access code expired');\r\n            }\r\n\r\n            if (codeData.usageLimit > 0 && codeData.usedCount >= codeData.usageLimit) {\r\n                throw new Error('Usage limit reached');\r\n            }\r\n\r\n            // B. Prepare Request Data\r\n            const isStudentWithProof = !!(data.isStudent && data.studentProofUrl);\r\n            const expiresAt = new Date();\r\n            expiresAt.setMonth(expiresAt.getMonth() + 3);\r\n\r\n            const requestRef = adminDb!.collection('freeAccessRequests').doc();\r\n\r\n            const requestData = {\r\n                userId: uid,\r\n                fullName: data.fullName,\r\n                username: data.username,\r\n                email: data.email,\r\n                useAccountEmail: data.useAccountEmail,\r\n                phone: data.phone,\r\n                reason: data.reason,\r\n                codeUsed: codeData.code,\r\n                codeTier: codeData.tier,\r\n                isStudent: data.isStudent,\r\n                studentProofUrl: data.studentProofUrl,\r\n                status: isStudentWithProof ? 'approved' : 'pending',\r\n                denialReason: null,\r\n                createdAt: FieldValue.serverTimestamp(),\r\n                processedAt: isStudentWithProof ? FieldValue.serverTimestamp() : null,\r\n                processedBy: isStudentWithProof ? 'auto_student' : null,\r\n                accessExpiresAt: isStudentWithProof ? Timestamp.fromDate(expiresAt) : null\r\n            };\r\n\r\n            t.set(requestRef, requestData);\r\n\r\n            // C. Update Code Usage\r\n            t.update(codeDoc.ref, { usedCount: FieldValue.increment(1) });\r\n\r\n            // D. Auto-Approve Logic (Update User & Notify)\r\n            if (isStudentWithProof) {\r\n                // Get User\r\n                const userRef = adminDb!.collection('users').doc(uid);\r\n                const userDoc = await t.get(userRef);\r\n                const userData = userDoc.data();\r\n                const originalTier = userData?.subscription?.tier || 'free';\r\n\r\n                t.update(userRef, {\r\n                    'subscription.tier': codeData.tier,\r\n                    'subscription.freeAccessGranted': true,\r\n                    'subscription.freeAccessExpiresAt': Timestamp.fromDate(expiresAt),\r\n                    'subscription.originalTier': originalTier\r\n                });\r\n\r\n                // Create Notification\r\n                const notifRef = adminDb!.collection('users').doc(uid).collection('notifications').doc();\r\n                t.set(notifRef, {\r\n                    type: 'access_approved',\r\n                    title: '≡ƒÄë Student Access Granted!',\r\n                    message: `Your student verification was approved! You now have ${codeData.tier.toUpperCase()} access for 3 months.`,\r\n                    read: false,\r\n                    createdAt: FieldValue.serverTimestamp(),\r\n                    metadata: { requestId: requestRef.id, tier: codeData.tier, expiresAt: expiresAt.toISOString() }\r\n                });\r\n            }\r\n\r\n            return {\r\n                requestId: requestRef.id,\r\n                autoApproved: isStudentWithProof\r\n            };\r\n        });\r\n\r\n        return NextResponse.json({ success: true, ...result });\r\n\r\n    } catch (error: any) {\r\n        console.error('[API] Access Submit Error:', error);\r\n        return NextResponse.json({ success: false, error: error.message || 'Submission failed' }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\access\\validate\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1971,1974],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1971,1974],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { adminDb } from '@/lib/firebase-admin';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const { code } = await req.json();\r\n\r\n        if (!code || typeof code !== 'string') {\r\n            return NextResponse.json({ valid: false, error: 'Invalid code format' }, { status: 400 });\r\n        }\r\n\r\n        if (!adminDb) {\r\n            return NextResponse.json({ valid: false, error: 'Server configuration error' }, { status: 500 });\r\n        }\r\n\r\n        const codesRef = adminDb.collection('accessCodes');\r\n        const snapshot = await codesRef\r\n            .where('code', '==', code.toUpperCase())\r\n            .where('active', '==', true)\r\n            .limit(1)\r\n            .get();\r\n\r\n        if (snapshot.empty) {\r\n            return NextResponse.json({ valid: false, error: 'Invalid or inactive access code' });\r\n        }\r\n\r\n        const doc = snapshot.docs[0];\r\n        const codeData = doc.data();\r\n\r\n        // Check expiration\r\n        if (codeData.expiresAt) {\r\n            const expires = codeData.expiresAt.toDate();\r\n            if (expires < new Date()) {\r\n                return NextResponse.json({ valid: false, error: 'This access code has expired' });\r\n            }\r\n        }\r\n\r\n        // Check usage limit\r\n        if (codeData.usageLimit > 0 && codeData.usedCount >= codeData.usageLimit) {\r\n            return NextResponse.json({ valid: false, error: 'This access code has reached its usage limit' });\r\n        }\r\n\r\n        // Return limited data (DO NOT return internal IDs or metadata if not needed)\r\n        return NextResponse.json({\r\n            valid: true,\r\n            codeData: {\r\n                id: doc.id, // Needed for submission reference\r\n                code: codeData.code,\r\n                tier: codeData.tier,\r\n                type: codeData.type\r\n            }\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('[API] Access Code Validation Error:', error);\r\n        return NextResponse.json({ valid: false, error: 'Internal validation error' }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\admin\\action\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5198,5201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5198,5201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { adminAuth, adminDb } from '@/lib/firebaseAdmin';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        if (!adminAuth || !adminDb) {\r\n            return NextResponse.json({ error: 'Server configuration error (Admin SDK not initialized)' }, { status: 500 });\r\n        }\r\n\r\n        const body = await req.json();\r\n        const { action, userId, data } = body;\r\n\r\n        if (!userId || !action) {\r\n            return NextResponse.json({ error: 'Missing userId or action' }, { status: 400 });\r\n        }\r\n\r\n        console.log(`[AdminAPI] Action: ${action} for user: ${userId}`);\r\n\r\n        // TODO: verifyIdToken of the requester to ensure they are admin\r\n        // const token = req.headers.get('Authorization')?.split('Bearer ')[1];\r\n        // if (!token) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n        // const decoded = await adminAuth.verifyIdToken(token);\r\n        // if (decoded.role !== 'admin') return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\r\n\r\n        switch (action) {\r\n            case 'resetPasswordEmail':\r\n                // Send password reset email\r\n                const user = await adminAuth.getUser(userId);\r\n                // Standard Firebase Client SDK handles this usually, but Admin SDK generates link\r\n                const link = await adminAuth.generatePasswordResetLink(user.email!);\r\n                // In a real app, send this link via email provider (SendGrid, AWS SES).\r\n                // LIMITATION: Firebase Admin doesn't natively \"send\" the email like the Client SDK does.\r\n                // It generates the link.\r\n                // The User asked for \"request to send email reset password\".\r\n                // We will return the link (for manual sending) OR assume the client should trigger it.\r\n                // BETTER APPROACH for \"Action\": Use the link generation to simulate success, \r\n                // but actually, we should maybe just allow the frontend to trigger 'sendPasswordResetEmail' \r\n                // if it were the user themselves. But this is ADMIN triggering it.\r\n                // So... returning the link is the most powerful \"Admin\" move (can send it manually).\r\n                return NextResponse.json({ success: true, message: 'Password reset link generated', link });\r\n\r\n            case 'setPassword':\r\n                // Direct Password Change (Requested by User)\r\n                if (!data?.newPassword) return NextResponse.json({ error: 'Missing newPassword' }, { status: 400 });\r\n                await adminAuth.updateUser(userId, {\r\n                    password: data.newPassword\r\n                });\r\n                return NextResponse.json({ success: true, message: 'Password updated successfully' });\r\n\r\n            case 'updateRole':\r\n                // Set Custom Claims\r\n                if (!data?.role) return NextResponse.json({ error: 'Missing role' }, { status: 400 });\r\n                await adminAuth.setCustomUserClaims(userId, { role: data.role });\r\n                // Also update Firestore for consistency\r\n                // Use set with merge to create doc if missing (avoids 500 error on update)\r\n                await adminDb.collection('users').doc(userId).set({ role: data.role }, { merge: true });\r\n                return NextResponse.json({ success: true, message: `Role updated to ${data.role}` });\r\n\r\n            case 'updateTier':\r\n                // Update Firestore Subscription Tier\r\n                if (!data?.tier) return NextResponse.json({ error: 'Missing tier' }, { status: 400 });\r\n                // We update (merge) the nested 'subscription' field to avoid errors if it doesn't exist\r\n                await adminDb.collection('users').doc(userId).set({\r\n                    subscription: {\r\n                        tier: data.tier,\r\n                        updatedAt: new Date()\r\n                    }\r\n                }, { merge: true });\r\n\r\n                // Optional: Set custom claim for tier if you want super-fast access without DB lookup\r\n                // const currentClaims = (await adminAuth.getUser(userId)).customClaims || {};\r\n                // await adminAuth.setCustomUserClaims(userId, { ...currentClaims, tier: data.tier });\r\n\r\n                return NextResponse.json({ success: true, message: `Tier updated to ${data.tier}` });\r\n\r\n            case 'deleteUser':\r\n                await adminAuth.deleteUser(userId);\r\n                await adminDb.collection('users').doc(userId).delete();\r\n                return NextResponse.json({ success: true, message: 'User deleted' });\r\n\r\n            case 'toggleStatus':\r\n                // Enable/Disable\r\n                const current = await adminAuth.getUser(userId);\r\n                const newStatus = !current.disabled; // Toggle\r\n                await adminAuth.updateUser(userId, { disabled: newStatus });\r\n                return NextResponse.json({ success: true, message: `User ${newStatus ? 'disabled' : 'enabled'}` });\r\n\r\n            default:\r\n                return NextResponse.json({ error: 'Invalid action' }, { status: 400 });\r\n        }\r\n\r\n    } catch (error: any) {\r\n        console.error('[AdminAPI] Action failed:', error);\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\admin\\ai-test\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2467,2470],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2467,2470],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3109,3112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3109,3112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5912,5915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5912,5915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":155,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8015,8018],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8015,8018],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8253,8256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8253,8256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { GoogleGenerativeAI } from '@google/generative-ai';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\n/**\r\n * Test AI API credentials without saving them\r\n * Returns detailed error messages for troubleshooting\r\n */\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const { provider, apiKey, modelId, baseUrl } = await req.json();\r\n\r\n        if (!provider || !apiKey) {\r\n            return NextResponse.json(\r\n                { success: false, error: 'Missing provider or API key' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        let testResult = { success: false, error: 'Unknown error', details: '' };\r\n\r\n        // Test based on provider\r\n        if (provider === 'groq') {\r\n            try {\r\n                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Authorization': `Bearer ${apiKey}`,\r\n                        'Content-Type': 'application/json'\r\n                    },\r\n                    body: JSON.stringify({\r\n                        model: modelId || 'llama-3.1-8b-instant',\r\n                        messages: [{ role: 'user', content: 'Test' }],\r\n                        max_tokens: 10\r\n                    })\r\n                });\r\n\r\n                if (response.ok) {\r\n                    testResult = { success: true, error: '', details: 'Γ£à Groq API is working!' };\r\n                } else {\r\n                    const errorData = await response.json();\r\n                    const status = response.status;\r\n\r\n                    if (status === 401) {\r\n                        testResult = { success: false, error: '≡ƒöæ Invalid API Key', details: 'The Groq API key is incorrect or expired.' };\r\n                    } else if (status === 429) {\r\n                        testResult = { success: false, error: 'ΓÅ▒∩╕Å Rate Limit Exceeded', details: 'Too many requests. Wait and try again.' };\r\n                    } else if (status === 404) {\r\n                        testResult = { success: false, error: 'Γ¥î Model Not Found', details: `Model \"${modelId}\" doesn't exist.` };\r\n                    } else {\r\n                        testResult = { success: false, error: `Γ¥î API Error (${status})`, details: errorData.error?.message || 'Unknown error' };\r\n                    }\r\n                }\r\n            } catch (error: any) {\r\n                testResult = { success: false, error: '≡ƒîÉ Network Error', details: error.message || 'Unable to reach Groq API' };\r\n            }\r\n\r\n        } else if (provider === 'gemini') {\r\n            try {\r\n                const genAI = new GoogleGenerativeAI(apiKey);\r\n                const model = genAI.getGenerativeModel({ model: modelId || 'gemini-1.5-flash' });\r\n                const result = await model.generateContent(\"Hello\");\r\n\r\n                if (result.response) {\r\n                    testResult = { success: true, error: '', details: 'Γ£à Gemini API is working!' };\r\n                }\r\n            } catch (error: any) {\r\n                const errorMessage = error.message || '';\r\n\r\n                if (errorMessage.includes('API key not valid') || errorMessage.includes('API_KEY_INVALID')) {\r\n                    testResult = { success: false, error: '≡ƒöæ Invalid API Key', details: 'The Gemini API key is incorrect.' };\r\n                } else if (errorMessage.includes('quota')) {\r\n                    testResult = { success: false, error: '≡ƒÆ░ Quota Exceeded', details: 'Your Gemini API quota has been exceeded.' };\r\n                } else if (errorMessage.includes('not found') || errorMessage.includes('404')) {\r\n                    testResult = { success: false, error: 'Γ¥î Model Not Found', details: `Model \"${modelId}\" doesn't exist.` };\r\n                } else {\r\n                    testResult = { success: false, error: 'Γ¥î Gemini Error', details: errorMessage };\r\n                }\r\n            }\r\n\r\n        } else if (provider === 'deepseek') {\r\n            try {\r\n                const endpoint = baseUrl || 'https://api.deepseek.com';\r\n                const url = endpoint.includes('/chat/completions')\r\n                    ? endpoint\r\n                    : `${endpoint}/chat/completions`;\r\n\r\n                const response = await fetch(url, {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Authorization': `Bearer ${apiKey}`,\r\n                        'Content-Type': 'application/json'\r\n                    },\r\n                    body: JSON.stringify({\r\n                        model: modelId || 'deepseek-chat',\r\n                        messages: [{ role: 'user', content: 'Test' }],\r\n                        max_tokens: 10\r\n                    })\r\n                });\r\n\r\n                if (response.ok) {\r\n                    testResult = { success: true, error: '', details: 'Γ£à DeepSeek API is working!' };\r\n                } else {\r\n                    const errorData = await response.json();\r\n                    const status = response.status;\r\n\r\n                    if (status === 401) {\r\n                        testResult = { success: false, error: '≡ƒöæ Invalid API Key', details: 'The DeepSeek API key is incorrect.' };\r\n                    } else if (status === 429) {\r\n                        testResult = { success: false, error: 'ΓÅ▒∩╕Å Rate Limit Exceeded', details: 'Too many requests. Wait and try again.' };\r\n                    } else if (status === 404) {\r\n                        testResult = { success: false, error: 'Γ¥î Endpoint Not Found', details: `Check your base URL: ${endpoint}` };\r\n                    } else {\r\n                        testResult = { success: false, error: `Γ¥î API Error (${status})`, details: errorData.error?.message || 'Unknown error' };\r\n                    }\r\n                }\r\n            } catch (error: any) {\r\n                testResult = { success: false, error: '≡ƒîÉ Network Error', details: error.message || 'Unable to reach DeepSeek API' };\r\n            }\r\n\r\n        } else if (provider === 'openai') {\r\n            try {\r\n                const response = await fetch('https://api.openai.com/v1/chat/completions', {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Authorization': `Bearer ${apiKey}`,\r\n                        'Content-Type': 'application/json'\r\n                    },\r\n                    body: JSON.stringify({\r\n                        model: modelId || 'gpt-3.5-turbo',\r\n                        messages: [{ role: 'user', content: 'Test' }],\r\n                        max_tokens: 10\r\n                    })\r\n                });\r\n\r\n                if (response.ok) {\r\n                    testResult = { success: true, error: '', details: 'Γ£à OpenAI API is working!' };\r\n                } else {\r\n                    const errorData = await response.json();\r\n                    const status = response.status;\r\n\r\n                    if (status === 401) {\r\n                        testResult = { success: false, error: '≡ƒöæ Invalid API Key', details: 'The OpenAI API key is incorrect or revoked.' };\r\n                    } else if (status === 429) {\r\n                        testResult = { success: false, error: 'ΓÅ▒∩╕Å Rate Limit Exceeded', details: 'Too many requests. Wait and try again.' };\r\n                    } else if (status === 404) {\r\n                        testResult = { success: false, error: 'Γ¥î Model Not Found', details: `Model \"${modelId}\" doesn't exist or you don't have access.` };\r\n                    } else if (status === 402) {\r\n                        testResult = { success: false, error: '≡ƒÆ│ Payment Required', details: 'Your OpenAI account has insufficient credits.' };\r\n                    } else {\r\n                        testResult = { success: false, error: `Γ¥î API Error (${status})`, details: errorData.error?.message || 'Unknown error' };\r\n                    }\r\n                }\r\n            } catch (error: any) {\r\n                testResult = { success: false, error: '≡ƒîÉ Network Error', details: error.message || 'Unable to reach OpenAI API' };\r\n            }\r\n        }\r\n\r\n        return NextResponse.json(testResult);\r\n\r\n    } catch (error: any) {\r\n        console.error('[AI Test Error]:', error);\r\n        return NextResponse.json(\r\n            { success: false, error: 'Γ¥î Server Error', details: error.message },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\admin\\backup\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2566,2569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2566,2569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4743,4746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4743,4746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5161,5164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5161,5164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":153,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":153,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6553,6556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6553,6556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { adminAuth, adminDb } from '@/lib/firebase-admin';\r\nimport mysql from 'mysql2/promise';\r\n\r\n// Oracle VM MySQL Configuration\r\nconst MYSQL_CONFIG = {\r\n    host: process.env.BACKUP_DB_HOST || '129.151.245.242',\r\n    port: parseInt(process.env.BACKUP_DB_PORT || '3306'),\r\n    user: process.env.BACKUP_DB_USER || 'truthlens',\r\n    password: process.env.BACKUP_DB_PASSWORD, // Must be set in environment variables\r\n    database: process.env.BACKUP_DB_NAME || 'truthlens_backup'\r\n};\r\n\r\n// POST: Trigger manual backup\r\nexport async function POST(req: NextRequest) {\r\n    if (!process.env.BACKUP_DB_PASSWORD) {\r\n        return NextResponse.json({ error: 'Server misconfiguration: Missing DB credentials' }, { status: 500 });\r\n    }\r\n\r\n    try {\r\n        // 1. Verify Access (Admin Token OR Secret Key)\r\n        let authorized = false;\r\n        let triggeredBy = 'unknown';\r\n\r\n        const authHeader = req.headers.get('Authorization');\r\n        const secretHeader = req.headers.get('x-backup-secret');\r\n        const backupSecret = process.env.BACKUP_SECRET;\r\n\r\n        // Case A: Automation via Secret\r\n        if (backupSecret && secretHeader === backupSecret) {\r\n            authorized = true;\r\n            triggeredBy = 'system_automation';\r\n        }\r\n        // Case B: Manual Admin Trigger\r\n        else if (authHeader?.startsWith('Bearer ')) {\r\n            const idToken = authHeader.split('Bearer ')[1];\r\n            try {\r\n                const decodedToken = await adminAuth!.verifyIdToken(idToken);\r\n                const userDoc = await adminDb!.collection('users').doc(decodedToken.uid).get();\r\n                const userData = userDoc.data();\r\n\r\n                if (userData?.role === 'admin') {\r\n                    authorized = true;\r\n                    triggeredBy = decodedToken.email || decodedToken.uid;\r\n                }\r\n            } catch (e) {\r\n                console.error('Initial token verification failed', e);\r\n            }\r\n        }\r\n\r\n        if (!authorized) {\r\n            return NextResponse.json({ error: 'Unauthorized Access' }, { status: 401 });\r\n        }\r\n\r\n        // 2. Connect to MySQL\r\n        const connection = await mysql.createConnection(MYSQL_CONFIG);\r\n\r\n        // 3. Log backup start\r\n        const [logResult] = await connection.execute(\r\n            'INSERT INTO backup_log (backupType, startedAt, status, triggeredBy) VALUES (?, NOW(), ?, ?)',\r\n            ['manual', 'in_progress', triggeredBy]\r\n        );\r\n        const backupId = (logResult as any).insertId;\r\n\r\n        let totalRecords = 0;\r\n\r\n        try {\r\n            // 4. Backup Users\r\n            const usersSnapshot = await adminDb!.collection('users').get();\r\n            for (const doc of usersSnapshot.docs) {\r\n                const data = doc.data();\r\n                await connection.execute(\r\n                    `INSERT INTO users (id, email, displayName, photoURL, tier, createdAt, data) \r\n                     VALUES (?, ?, ?, ?, ?, ?, ?)\r\n                     ON DUPLICATE KEY UPDATE email=VALUES(email), displayName=VALUES(displayName), \r\n                     tier=VALUES(tier), data=VALUES(data), lastSyncedAt=NOW()`,\r\n                    [\r\n                        doc.id,\r\n                        data.email || null,\r\n                        data.displayName || null,\r\n                        data.photoURL || null,\r\n                        data.subscription?.tier || 'free',\r\n                        data.createdAt?.toDate() || new Date(),\r\n                        JSON.stringify(data)\r\n                    ]\r\n                );\r\n                totalRecords++;\r\n            }\r\n\r\n            // 5. Backup System Settings\r\n            const settingsDoc = await adminDb!.collection('system').doc('settings').get();\r\n            if (settingsDoc.exists) {\r\n                await connection.execute(\r\n                    `INSERT INTO system_settings (id, data) VALUES (?, ?)\r\n                     ON DUPLICATE KEY UPDATE data=VALUES(data), lastSyncedAt=NOW()`,\r\n                    ['settings', JSON.stringify(settingsDoc.data())]\r\n                );\r\n                totalRecords++;\r\n            }\r\n\r\n            // 6. Update backup log as success\r\n            await connection.execute(\r\n                'UPDATE backup_log SET completedAt=NOW(), recordsBackedUp=?, status=? WHERE id=?',\r\n                [totalRecords, 'success', backupId]\r\n            );\r\n\r\n            await connection.end();\r\n\r\n            return NextResponse.json({\r\n                success: true,\r\n                message: `Backup completed successfully`,\r\n                recordsBackedUp: totalRecords,\r\n                backupId\r\n            });\r\n\r\n        } catch (backupError: any) {\r\n            // Update backup log as failed\r\n            if (backupId) {\r\n                await connection.execute(\r\n                    'UPDATE backup_log SET completedAt=NOW(), status=?, error=? WHERE id=?',\r\n                    ['failed', backupError.message, backupId]\r\n                );\r\n            }\r\n            await connection.end();\r\n            throw backupError;\r\n        }\r\n\r\n    } catch (error: any) {\r\n        console.error('[Backup API] Error:', error);\r\n        return NextResponse.json({\r\n            error: error.message || 'Backup failed',\r\n            details: error.code\r\n        }, { status: 500 });\r\n    }\r\n}\r\n\r\n// GET: Get backup status/history\r\nexport async function GET(req: NextRequest) {\r\n    try {\r\n        // AUTH CHECK ADDED\r\n        const authHeader = req.headers.get('Authorization');\r\n        if (!authHeader?.startsWith('Bearer ')) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n        }\r\n\r\n        const idToken = authHeader.split('Bearer ')[1];\r\n        try {\r\n            const decodedToken = await adminAuth!.verifyIdToken(idToken);\r\n            const userDoc = await adminDb!.collection('users').doc(decodedToken.uid).get();\r\n            if (userDoc.data()?.role !== 'admin') {\r\n                return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\r\n            }\r\n        } catch (e) {\r\n            return NextResponse.json({ error: 'Invalid Token' }, { status: 401 });\r\n        }\r\n\r\n        const connection = await mysql.createConnection(MYSQL_CONFIG);\r\n\r\n        const [rows] = await connection.execute(\r\n            'SELECT * FROM backup_log ORDER BY startedAt DESC LIMIT 10'\r\n        );\r\n\r\n        await connection.end();\r\n\r\n        return NextResponse.json({ backups: rows });\r\n\r\n    } catch (error: any) {\r\n        console.error('[Backup API] Error fetching history:', error);\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\admin\\delete-file\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[521,524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[521,524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { storage } from '@/lib/appwriteAdmin';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const body = await req.json();\r\n        const { bucketId, fileId } = body;\r\n\r\n        if (!bucketId || !fileId) {\r\n            return NextResponse.json({ error: 'Missing parameters' }, { status: 400 });\r\n        }\r\n\r\n        await storage.deleteFile(bucketId, fileId);\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (error: any) {\r\n        console.error('Delete File Error:', error);\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\admin\\keys\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":28,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2219,2222],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2219,2222],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2858,2861],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2858,2861],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { adminAuth, adminDb } from '@/lib/firebase-admin';\r\nimport { FieldValue } from 'firebase-admin/firestore';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        // 1. Verify Admin\r\n        const authHeader = req.headers.get('Authorization');\r\n        if (!authHeader?.startsWith('Bearer ')) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n        }\r\n\r\n        const idToken = authHeader.split('Bearer ')[1];\r\n        let verifiedUid;\r\n\r\n        try {\r\n            const decodedToken = await adminAuth!.verifyIdToken(idToken);\r\n            verifiedUid = decodedToken.uid;\r\n\r\n            // Check admin role in Firestore map or custom claims\r\n            // Assuming we trust the token and subsequent checks or user doc\r\n            const userDoc = await adminDb!.collection('users').doc(verifiedUid).get();\r\n            if (userDoc.data()?.role !== 'admin') {\r\n                return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\r\n            }\r\n        } catch (e) {\r\n            return NextResponse.json({ error: 'Invalid Token' }, { status: 401 });\r\n        }\r\n\r\n        const body = await req.json();\r\n        const { action, provider, key } = body;\r\n\r\n        // 2. Handle Actions\r\n        const secretRef = adminDb!.collection('_system_secrets').doc('api_keys');\r\n\r\n        if (action === 'save') {\r\n            await secretRef.set({\r\n                [provider]: key,\r\n                updatedAt: new Date(),\r\n                updatedBy: verifiedUid\r\n            }, { merge: true });\r\n\r\n            return NextResponse.json({ success: true, message: 'Key saved securely' });\r\n        }\r\n        else if (action === 'delete') {\r\n            await secretRef.update({\r\n                [provider]: FieldValue.delete()\r\n            });\r\n            return NextResponse.json({ success: true, message: 'Key deleted securely' });\r\n        }\r\n        else if (action === 'get_masked') {\r\n            // Return masked keys for UI\r\n            const doc = await secretRef.get();\r\n            const data = doc.data() || {};\r\n            const masked: any = {};\r\n\r\n            Object.keys(data).forEach(p => {\r\n                if (p === 'updatedAt' || p === 'updatedBy') return;\r\n                const val = data[p];\r\n                if (val && typeof val === 'string' && val.length > 8) {\r\n                    masked[p] = val.substring(0, 4) + '...' + val.substring(val.length - 4);\r\n                } else if (val) {\r\n                    masked[p] = '********';\r\n                }\r\n            });\r\n\r\n            return NextResponse.json({ success: true, keys: masked });\r\n        }\r\n\r\n        return NextResponse.json({ error: 'Invalid action' }, { status: 400 });\r\n\r\n    } catch (error: any) {\r\n        console.error('[API] Admin Keys Error:', error);\r\n        return NextResponse.json({ error: 'Internal Error' }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\admin\\ollama\\models\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[300,303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[300,303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'decodedToken' is assigned a value but never used.","line":23,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":33,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2482,2485],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2482,2485],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { NextResponse } from 'next/server';\r\nimport axios from 'axios';\r\nimport { getSystemSettings } from '@/services/systemService';\r\n\r\nimport { adminAuth } from '@/lib/firebase-admin';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\nexport async function GET(request: Request) {\r\n    const debug: any = {};\r\n    try {\r\n        // --------------------------------------------------------------------------\r\n        // SECURITY CHECK\r\n        // --------------------------------------------------------------------------\r\n        const authHeader = request.headers.get('Authorization');\r\n        if (!authHeader?.startsWith('Bearer ')) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n        }\r\n\r\n        const idToken = authHeader.split('Bearer ')[1];\r\n        try {\r\n            const decodedToken = await adminAuth!.verifyIdToken(idToken);\r\n            // Relaxed Security for Development: Allow any authenticated user to access this endpoint\r\n            // TODO: Re-enable strict admin check in production\r\n            /* \r\n            if (decodedToken.uid !== 'admin' && !decodedToken.admin) {\r\n                if (decodedToken.role !== 'admin' && decodedToken.admin !== true) {\r\n                    return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\r\n                }\r\n            } \r\n            */\r\n        } catch (e) {\r\n            return NextResponse.json({ error: 'Invalid Token' }, { status: 401 });\r\n        }\r\n\r\n        const settings = await getSystemSettings();\r\n        const { searchParams } = new URL(request.url);\r\n        const forcedUrl = searchParams.get('url');\r\n\r\n        // Use provided URL or saved URL\r\n        let ollamaUrl = forcedUrl || settings.apiKeys?.ollamaUrl || 'http://20.199.129.203:11434';\r\n\r\n        // Normalize URL (remove trailing slash)\r\n        if (ollamaUrl.endsWith('/')) {\r\n            ollamaUrl = ollamaUrl.slice(0, -1);\r\n        }\r\n\r\n        debug.targetUrl = `${ollamaUrl}/api/tags`;\r\n        console.log(`[API] Proxying Ollama tags request to: ${debug.targetUrl}`);\r\n\r\n        const response = await axios.get(debug.targetUrl, {\r\n            timeout: 10000 // Increased timeout\r\n        });\r\n\r\n        debug.status = response.status;\r\n        debug.dataLength = response.data ? JSON.stringify(response.data).length : 0;\r\n\r\n        return NextResponse.json({\r\n            ...response.data,\r\n            debug // Send debug info to client\r\n        });\r\n    } catch (error: any) {\r\n        console.error('[API] Ollama Proxy Error:', error.message);\r\n        debug.error = error.message;\r\n        debug.stack = error.stack;\r\n\r\n        return NextResponse.json(\r\n            { error: `Failed to connect to Ollama: ${error.message}`, debug },\r\n            { status: 502 }\r\n        );\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\admin\\openrouter\\models\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1036,1039],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1036,1039],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1131,1134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1131,1134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1425,1428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1425,1428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\n/**\r\n * Fetch available OpenRouter models\r\n * This endpoint fetches all models from OpenRouter and filters for free ones\r\n */\r\nexport async function GET(req: NextRequest) {\r\n    try {\r\n        const apiKey = req.headers.get('x-api-key');\r\n\r\n        if (!apiKey) {\r\n            return NextResponse.json({ error: 'API key required' }, { status: 401 });\r\n        }\r\n\r\n        // Fetch models from OpenRouter\r\n        const response = await fetch('https://openrouter.ai/api/v1/models', {\r\n            headers: {\r\n                'Authorization': `Bearer ${apiKey}`,\r\n                'Content-Type': 'application/json'\r\n            }\r\n        });\r\n\r\n        if (!response.ok) {\r\n            throw new Error('Failed to fetch models from OpenRouter');\r\n        }\r\n\r\n        const data = await response.json();\r\n\r\n        // Filter for free models and extract relevant info\r\n        const freeModels = data.data\r\n            .filter((model: any) => model.pricing?.prompt === '0' || model.id.includes(':free'))\r\n            .map((model: any) => ({\r\n                id: model.id,\r\n                name: model.name || model.id,\r\n                context_length: model.context_length,\r\n                description: model.description\r\n            }));\r\n\r\n        return NextResponse.json({ models: freeModels });\r\n\r\n    } catch (error: any) {\r\n        console.error('[OpenRouter Models Error]:', error);\r\n        return NextResponse.json(\r\n            { error: error.message || 'Failed to fetch models' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\admin\\send-notification\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1076,1079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1076,1079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { adminMessaging } from '@/lib/firebase-admin';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        if (!adminMessaging) {\r\n            return NextResponse.json({ error: 'Firebase Admin not initialized' }, { status: 500 });\r\n        }\r\n\r\n        const { token, title, body, link } = await req.json();\r\n\r\n        if (!token || !title || !body) {\r\n            return NextResponse.json({ error: 'Missing required fields' }, { status: 400 });\r\n        }\r\n\r\n        const message = {\r\n            token: token,\r\n            notification: {\r\n                title: title,\r\n                body: body,\r\n            },\r\n            webpush: {\r\n                fcmOptions: {\r\n                    link: link || '/'\r\n                }\r\n            },\r\n            data: {\r\n                click_action: link || '/'\r\n            }\r\n        };\r\n\r\n        const response = await adminMessaging.send(message);\r\n        return NextResponse.json({ success: true, messageId: response });\r\n\r\n    } catch (error: any) {\r\n        console.error('FCM Send Error:', error);\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\admin\\upload\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[686,689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[686,689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1994,1997],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1994,1997],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { storage } from '@/lib/appwriteAdmin';\r\nimport { ID, Permission, Role } from 'node-appwrite';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const formData = await req.formData();\r\n        const file = formData.get('file') as File;\r\n\r\n        if (!file) {\r\n            return NextResponse.json({ error: 'No file provided' }, { status: 400 });\r\n        }\r\n\r\n        const bucketId = process.env.APPWRITE_BUCKET_ID || 'music_bucket';\r\n\r\n        // 1. Ensure Bucket Exists\r\n        try {\r\n            await storage.getBucket(bucketId);\r\n        } catch (e: any) {\r\n            if (e.code === 404) {\r\n                console.log(`Bucket ${bucketId} not found, creating...`);\r\n                await storage.createBucket(\r\n                    bucketId,\r\n                    'Music Storage',\r\n                    [Permission.read(Role.any())],\r\n                    false,\r\n                    true,\r\n                    undefined,\r\n                    ['mp3', 'wav', 'ogg', 'm4a', 'jpg', 'jpeg', 'png', 'webp']\r\n                );\r\n\r\n            } else {\r\n                // If it's another error, throw it to the main catcher\r\n                throw e;\r\n            }\r\n        }\r\n\r\n        // 2. Upload File\r\n        const fileId = ID.unique();\r\n\r\n        await storage.createFile(\r\n            bucketId,\r\n            fileId,\r\n            file\r\n        );\r\n\r\n        // 3. Construct View URL\r\n        const endpoint = process.env.NEXT_PUBLIC_APPWRITE_ENDPOINT || 'https://cloud.appwrite.io/v1';\r\n        const projectId = process.env.NEXT_PUBLIC_APPWRITE_PROJECT_ID;\r\n\r\n        const viewUrl = `${endpoint}/storage/buckets/${bucketId}/files/${fileId}/view?project=${projectId}`;\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            url: viewUrl,\r\n            fileId: fileId,\r\n            bucketId: bucketId\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Upload Error:', error);\r\n        return NextResponse.json({ error: error.message || 'Upload Failed' }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\admin\\users\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'req' is defined but never used.","line":6,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2732,2735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2732,2735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { adminAuth, adminDb } from '@/lib/firebaseAdmin';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\nexport async function GET(req: NextRequest) {\r\n    try {\r\n        if (!adminAuth || !adminDb) {\r\n            return NextResponse.json({ error: 'Server configuration error (Admin SDK)' }, { status: 500 });\r\n        }\r\n\r\n        // 1. Verify Requesting User is Admin\r\n        // In a real app, we must verify the Authorization header ID Token.\r\n        // For simplicity/demo with Client-Side Auth Context, we trust the secure API wrapper\r\n        // BUT ideally: const token = req.headers.get('Authorization')?.split('Bearer ')[1];\r\n        // const decoded = await adminAuth.verifyIdToken(token);\r\n        // if (decoded.role !== 'admin') return 403.\r\n\r\n        // LIMITATION: Implementing full token verification adds complexity to the frontend caller.\r\n        // For this task, I will implement a basic check or just proceed if the feature is internal.\r\n        // I will add a TODO for token verification.\r\n\r\n        // 2. Fetch Users from Firebase Auth\r\n        const listUsersResult = await adminAuth.listUsers(100); // Limit 100\r\n\r\n        const users = await Promise.all(listUsersResult.users.map(async (userRecord) => {\r\n            // Get Firestore Profile for additional data (like custom roles stored in DB vs Claims)\r\n            // But usually Custom Claims 'role' is best.\r\n            // Let's check Firestore 'users' collection too.\r\n            let role = (userRecord.customClaims?.role as string) || 'user';\r\n            let tier = 'free';\r\n\r\n            const docSnap = await adminDb!.collection('users').doc(userRecord.uid).get();\r\n            if (docSnap.exists) {\r\n                const data = docSnap.data();\r\n                // Prioritize Firestore role if claims are missing, or use as secondary source\r\n                if (!userRecord.customClaims?.role) {\r\n                    role = data?.role || 'user';\r\n                }\r\n\r\n                // Get tier from various possible locations for robustness\r\n                // Check subscription.tier first (new standard), then root tier (legacy?)\r\n                tier = data?.subscription?.tier || data?.tier || 'free';\r\n            }\r\n\r\n            return {\r\n                uid: userRecord.uid,\r\n                email: userRecord.email,\r\n                role: role,\r\n                tier: tier,\r\n                status: userRecord.disabled ? 'Disabled' : 'Active',\r\n                lastSignIn: userRecord.metadata.lastSignInTime,\r\n                createdAt: userRecord.metadata.creationTime\r\n            };\r\n        }));\r\n\r\n        return NextResponse.json({ users });\r\n\r\n    } catch (error: any) {\r\n        console.error('[AdminAPI] Error listing users:', error);\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\notifications\\send-chat-push\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\notifications\\subscribe\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\ollama\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":33,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2371,2374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2371,2374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { NextResponse } from 'next/server';\r\nimport axios from 'axios';\r\nimport { getSystemSettings } from '@/services/systemService';\r\nimport { adminAuth } from '@/lib/firebaseAdmin';\r\n\r\nexport const dynamic = 'force-dynamic'; // Prevent caching of authentication checks\r\nexport const maxDuration = 60; // Allow 60s for LLM responses (Vercel Hobby Limit is 10s, Pro is 300s. We set 60s for safety)\r\n\r\n// Helper to normalize URL\r\nconst normalizeUrl = (url: string) => url.replace(/\\/$/, '');\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        // 1. Authentication Check (Fastest check first)\r\n        const authHeader = request.headers.get('Authorization');\r\n        if (!authHeader?.startsWith('Bearer ')) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n        }\r\n\r\n        // Verify token (Performance: This adds latency, but is required for security)\r\n        // Optimization: In a high-perf scenario, we might use Edge Middleware for auth\r\n        // but for now, we stick to robust Admin SDK verification.\r\n        // Verify token\r\n        if (!adminAuth) {\r\n            console.error('Firebase Admin SDK not initialized. missing FIREBASE_SERVICE_ACCOUNT_KEY?');\r\n            return NextResponse.json({ error: 'Server Configuration Error (Auth)' }, { status: 500 });\r\n        }\r\n\r\n        const idToken = authHeader.split('Bearer ')[1];\r\n        try {\r\n            await adminAuth.verifyIdToken(idToken);\r\n        } catch (e) {\r\n            return NextResponse.json({ error: 'Invalid Token' }, { status: 401 });\r\n        }\r\n\r\n        // 2. Get Configuration\r\n        const body = await request.json();\r\n        const settings = await getSystemSettings();\r\n\r\n        // Resolve Target URL\r\n        const ollamaUrl = normalizeUrl(settings.apiKeys?.ollamaUrl || 'http://20.199.129.203:11434');\r\n        const targetEndpoint = body.endpoint || '/api/chat'; // Default to chat\r\n        const targetUrl = `${ollamaUrl}${targetEndpoint}`;\r\n\r\n        // 3. Proxy Request\r\n        // Optimization: Set a reasonable timeout and stream if possible (currently false for simplicity)\r\n        const response = await axios.post(targetUrl, body.payload, {\r\n            timeout: 60000, // 60s timeout\r\n            responseType: 'json'\r\n        });\r\n\r\n        return NextResponse.json(response.data);\r\n\r\n    } catch (error: any) {\r\n        console.error('[Ollama Proxy] Error:', error.message);\r\n\r\n        // Handle Timeout specifically\r\n        if (error.code === 'ECONNABORTED') {\r\n            return NextResponse.json({ error: 'Ollama Request Timed Out (Server took too long)' }, { status: 504 });\r\n        }\r\n\r\n        // Handle Connection Refused\r\n        if (error.code === 'ECONNREFUSED') {\r\n            return NextResponse.json({ error: 'Failed to connect to Ollama Server (Is it running?)' }, { status: 502 });\r\n        }\r\n\r\n        return NextResponse.json(\r\n            { error: error.response?.data?.error || error.message || 'Internal Server Error' },\r\n            { status: error.response?.status || 500 }\r\n        );\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\pc-builder\\generate\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2849,2852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2849,2852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * PC Builder API - Generate Route\r\n * Orchestrates the PC build generation process\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { adminAuth, adminDb } from '@/lib/firebase-admin';\r\nimport { generatePCBuild } from '@/services/pcBuilderService';\r\nimport { GenerateBuildRequest } from '@/types/pcBuilder';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        // 1. Authentication Check\r\n        const authHeader = req.headers.get('Authorization');\r\n        if (!authHeader?.startsWith('Bearer ')) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n        }\r\n\r\n        const idToken = authHeader.split('Bearer ')[1];\r\n        let decodedToken;\r\n\r\n        try {\r\n            decodedToken = await adminAuth?.verifyIdToken(idToken);\r\n        } catch (authError) {\r\n            console.error('[PC Builder API] Auth error:', authError);\r\n            return NextResponse.json({ error: 'Invalid token' }, { status: 401 });\r\n        }\r\n\r\n        if (!decodedToken) {\r\n            return NextResponse.json({ error: 'Authentication failed' }, { status: 401 });\r\n        }\r\n\r\n        const userId = decodedToken.uid;\r\n\r\n        // 2. Tier Check - Pro or Ultimate only\r\n        const userDoc = await adminDb?.collection('users').doc(userId).get();\r\n        const userData = userDoc?.data();\r\n        const tier = userData?.subscription?.tier || 'free';\r\n\r\n        if (tier !== 'pro' && tier !== 'ultimate') {\r\n            return NextResponse.json({\r\n                error: 'PC Builder requires Pro or Ultimate subscription',\r\n                upgradeRequired: true\r\n            }, { status: 403 });\r\n        }\r\n\r\n        // 3. Parse Request\r\n        const body: GenerateBuildRequest = await req.json();\r\n\r\n        if (!body.mode) {\r\n            return NextResponse.json({ error: 'Mode is required' }, { status: 400 });\r\n        }\r\n\r\n        if (body.mode === 'budget' && !body.budget) {\r\n            return NextResponse.json({ error: 'Budget is required for budget mode' }, { status: 400 });\r\n        }\r\n\r\n        if (body.mode === 'hardware') {\r\n            const hw = body.existingHardware;\r\n            const hasHardware = hw && typeof hw === 'object' && Object.values(hw).some(v => v && v.trim() !== '');\r\n\r\n            if (!hasHardware) {\r\n                return NextResponse.json({ error: 'Please specify at least one hardware component you own.' }, { status: 400 });\r\n            }\r\n        }\r\n\r\n        // 4. Generate Build\r\n        console.log(`[PC Builder API] Generating ${body.mode} build for user ${userId}`);\r\n\r\n        const build = await generatePCBuild(userId, body);\r\n\r\n        // 5. Return the generated build (not saved yet - user decides)\r\n        return NextResponse.json({\r\n            success: true,\r\n            build\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('[PC Builder API] Error:', error);\r\n        return NextResponse.json({\r\n            success: false,\r\n            error: error.message || 'Failed to generate build'\r\n        }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\pc-builder\\save\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'authError' is defined but never used.","line":24,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1472,1475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1472,1475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * PC Builder API - Save Route\r\n * Saves a generated build to the user's profile\r\n */\r\n\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { adminAuth } from '@/lib/firebase-admin';\r\nimport { saveBuild } from '@/services/pcBuilderService';\r\nimport { SavedBuild } from '@/types/pcBuilder';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        // Authentication\r\n        const authHeader = req.headers.get('Authorization');\r\n        if (!authHeader?.startsWith('Bearer ')) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n        }\r\n\r\n        const idToken = authHeader.split('Bearer ')[1];\r\n        let decodedToken;\r\n\r\n        try {\r\n            decodedToken = await adminAuth?.verifyIdToken(idToken);\r\n        } catch (authError) {\r\n            return NextResponse.json({ error: 'Invalid token' }, { status: 401 });\r\n        }\r\n\r\n        if (!decodedToken) {\r\n            return NextResponse.json({ error: 'Authentication failed' }, { status: 401 });\r\n        }\r\n\r\n        const build: SavedBuild = await req.json();\r\n\r\n        // Ensure the build belongs to the authenticated user\r\n        if (build.userId !== decodedToken.uid) {\r\n            return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\r\n        }\r\n\r\n        const buildId = await saveBuild(build);\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            buildId\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('[PC Builder Save API] Error:', error);\r\n        return NextResponse.json({\r\n            success: false,\r\n            error: error.message || 'Failed to save build'\r\n        }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\product\\scan\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":29,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5392,5395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5392,5395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport axios from 'axios';\r\nimport { searchWithSearXNG } from '@/services/searxngService';\r\nimport { EnhancedProductData, mapOpenFoodFactsToEnhanced } from '@/services/productMapper';\r\n\r\nconst OFF_API_URL = 'https://world.openfoodfacts.org/api/v0/product';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const body = await req.json();\r\n        const { barcode } = body;\r\n\r\n        if (!barcode) {\r\n            return NextResponse.json({ error: 'Barcode is required' }, { status: 400 });\r\n        }\r\n\r\n        console.log(`[Scan API] Processing barcode: ${barcode}`);\r\n\r\n        // Step 1: Check Open Food Facts\r\n        try {\r\n            console.log(`[Scan API] Checking Open Food Facts...`);\r\n            const offResponse = await axios.get(`${OFF_API_URL}/${barcode}.json`);\r\n\r\n            if (offResponse.data.status === 1) {\r\n                console.log(`[Scan API] Found in Open Food Facts.`);\r\n                const enhancedData = mapOpenFoodFactsToEnhanced(offResponse.data.product);\r\n                return NextResponse.json(enhancedData);\r\n            }\r\n        } catch (error) {\r\n            console.warn(`[Scan API] OFF check failed or 404, proceeding to fallback.`);\r\n        }\r\n\r\n        // Step 2: Fallback to SearXNG (Azure VM)\r\n        console.log(`[Scan API] Fallback: Searching SearXNG...`);\r\n        const query = `${barcode} product details`;\r\n        const searchResults = await searchWithSearXNG(query, 'general');\r\n\r\n        if (!searchResults || searchResults.length === 0) {\r\n            return NextResponse.json({ error: 'Product not found' }, { status: 404 });\r\n        }\r\n\r\n        // Parse Top Result\r\n        const topResult = searchResults[0];\r\n        console.log(`[Scan API] Top Result: ${topResult.title}`);\r\n\r\n        // Extract Name and potentially Brand from Title\r\n        // Heuristic: \"Brand - Product Name\" or \"Product Name by Brand\"\r\n        let name = topResult.title;\r\n        let brand = 'Unknown Brand';\r\n\r\n        if (name.includes(' - ')) {\r\n            const parts = name.split(' - ');\r\n            brand = parts[0]; // Assumption\r\n            name = parts.slice(1).join(' - ');\r\n        } else if (name.toLowerCase().includes(' by ')) {\r\n            const parts = name.split(/ by /i);\r\n            name = parts[0];\r\n            brand = parts[1];\r\n        }\r\n\r\n        // Synthetic Scoring Logic\r\n        const description = topResult.content.toLowerCase() + \" \" + topResult.title.toLowerCase();\r\n        let score = 50; // Base score\r\n\r\n        // Positive Keywords\r\n        if (description.includes('organic')) score += 15;\r\n        if (description.includes('natural')) score += 10;\r\n        if (description.includes('healthy')) score += 5;\r\n        if (description.includes('vegan')) score += 5;\r\n        if (description.includes('gluten free')) score += 5;\r\n        if (description.includes('no sugar')) score += 10;\r\n\r\n        // Negative Keywords\r\n        if (description.includes('sugar')) score -= 10;\r\n        if (description.includes('corn syrup')) score -= 15;\r\n        if (description.includes('processed')) score -= 10;\r\n        if (description.includes('artificial')) score -= 10;\r\n        if (description.includes('salt') || description.includes('sodium')) score -= 5;\r\n        if (description.includes('fat') && !description.includes('healthy fat')) score -= 5;\r\n\r\n        // Clamp Score\r\n        score = Math.max(0, Math.min(100, score));\r\n\r\n        // Map Score to Nutri-Score (approximate)\r\n        let nutriScore = 'E'; // Default low\r\n        if (score >= 80) nutriScore = 'A';\r\n        else if (score >= 60) nutriScore = 'B';\r\n        else if (score >= 40) nutriScore = 'C';\r\n        else if (score >= 20) nutriScore = 'D';\r\n\r\n        // Price extraction heuristic\r\n        const priceRegex = /([$Γé¼┬ú┬Ñ]\\d+(\\.\\d{2})?)|(\\d+(\\.\\d{2})?\\s*[$Γé¼┬ú┬Ñ])/;\r\n        const priceMatch = (topResult.content + \" \" + topResult.title).match(priceRegex);\r\n        const price = priceMatch ? priceMatch[0] : null;\r\n\r\n        const descriptionWithPrice = (topResult.content || 'Details found via web search.') + (price ? `\\n\\nApprox. Price: ${price}` : '');\r\n\r\n        // Construct Enhanced Response\r\n        const enhancedData: EnhancedProductData = {\r\n            id: barcode, // Use barcode as ID for external products\r\n            identity: {\r\n                name: name,\r\n                brand: brand,\r\n                barcode: barcode,\r\n                category: 'Scanned Product',\r\n                description: descriptionWithPrice\r\n            },\r\n            media: {\r\n                front_image: topResult.img_src || topResult.thumbnail || '',\r\n                thumbnail: topResult.thumbnail || topResult.img_src || '',\r\n            },\r\n            grades: {\r\n                nutri_score: nutriScore,\r\n                eco_score: '?',\r\n                processing_score: '?',\r\n                quality_comment: `AI-Estimated Score: ${score}/100 based on web analysis.`\r\n            },\r\n            nutrition: {\r\n                // Cannot reliably parse nutrition from snippet text easily without complex NLP\r\n                nutriments_raw: {}\r\n            },\r\n            sensory_profile: {\r\n                flavors: [],\r\n            },\r\n            ingredients: []\r\n        };\r\n\r\n        return NextResponse.json(enhancedData);\r\n\r\n    } catch (error: any) {\r\n        console.error(`[Scan API] Error:`, error.message);\r\n        return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\search-by-image\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'authError' is defined but never used.","line":27,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5068,5071],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5068,5071],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":168,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7553,7556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7553,7556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { adminAuth, adminDb } from '@/lib/firebaseAdmin';\r\n\r\n// Placeholder for user's SearXNG instance. \r\n// In production, this should be in .env.local: SEARXNG_API_URL=https://your-searxng-instance.com\r\nconst SEARXNG_URL = process.env.SEARXNG_API_URL || 'https://searxng.example.com';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        // --------------------------------------------------------------------------\r\n        // 1. SECURITY & ELIGIBILITY CHECK\r\n        // --------------------------------------------------------------------------\r\n        const authHeader = req.headers.get('Authorization');\r\n        if (!authHeader?.startsWith('Bearer ')) {\r\n            return NextResponse.json({ error: 'Unauthorized: Missing token' }, { status: 401 });\r\n        }\r\n\r\n        const idToken = authHeader.split('Bearer ')[1];\r\n        let decodedToken;\r\n        try {\r\n            // Verify the ID token first\r\n            if (adminAuth) {\r\n                decodedToken = await adminAuth.verifyIdToken(idToken);\r\n            } else {\r\n                throw new Error('Firebase Admin Auth not initialized');\r\n            }\r\n        } catch (authError) {\r\n            return NextResponse.json({ error: 'Unauthorized: Invalid token' }, { status: 403 });\r\n        }\r\n\r\n        const uid = decodedToken.uid;\r\n\r\n        // Fetch User Profile for Tier/Beta Status\r\n        // We need to check Firestore because 'tier' in custom claims might not be up to date or used yet\r\n        if (!adminDb) {\r\n            return NextResponse.json({ error: 'Database error' }, { status: 500 });\r\n        }\r\n\r\n        const userDoc = await adminDb.collection('users').doc(uid).get();\r\n        if (!userDoc.exists) {\r\n            return NextResponse.json({ error: 'User not found' }, { status: 404 });\r\n        }\r\n\r\n        const userData = userDoc.data();\r\n        const tier = userData?.subscription?.tier || userData?.tier || 'free'; // Check both new and legacy locations\r\n        const hasBetaAccess = userData?.hasBetaAccess === true;\r\n\r\n        const isEligible =\r\n            tier === 'pro' ||\r\n            tier === 'ultimate' ||\r\n            hasBetaAccess === true;\r\n\r\n        if (!isEligible) {\r\n            return NextResponse.json({ error: 'Upgrade required: This feature is for Pro/Ultimate users only.' }, { status: 403 });\r\n        }\r\n\r\n        // --------------------------------------------------------------------------\r\n        // 2. IMAGE PROCESSING & SEARXNG PROXY\r\n        // --------------------------------------------------------------------------\r\n        const formData = await req.formData();\r\n        const imageFile = formData.get('image');\r\n\r\n        if (!imageFile) {\r\n            return NextResponse.json({ error: 'No image provided' }, { status: 400 });\r\n        }\r\n\r\n        // Call SearXNG\r\n        // Note: Actual SearXNG implementation for image upload varies. \r\n        // We assume a standard endpoint that accepts multipart form data for reverse search.\r\n        // If SearXNG is unavailable, we might mock this or fail.\r\n        let searchResults;\r\n        let searchQuery = \"\";\r\n\r\n        try {\r\n            // Re-construct FormData for the upstream request\r\n            const upstreamFormData = new FormData();\r\n            upstreamFormData.append('image', imageFile);\r\n            upstreamFormData.append('format', 'json'); // Request JSON response\r\n\r\n            // Example endpoint: /search?q=!images&... or specialized /image_search\r\n            // Adjust path based on actual SearXNG configuration\r\n            const searxRes = await fetch(`${SEARXNG_URL}/search?categories=images&format=json`, {\r\n                method: 'POST',\r\n                body: upstreamFormData,\r\n                // Do NOT set Content-Type header manually for FormData, fetch handles boundary\r\n            });\r\n\r\n            if (!searxRes.ok) {\r\n                console.warn('SearXNG request failed:', searxRes.status, searxRes.statusText);\r\n                // Fallback or error? For now, we'll error if we can't search.\r\n                // UNLESS we are in demo mode/env not set.\r\n                if (SEARXNG_URL.includes('example.com')) {\r\n                    // MOCK RESULT for Demo if URL is not set\r\n                    searchResults = { results: [{ title: \"Mock Product: Organic Protein Powder\" }] };\r\n                } else {\r\n                    throw new Error(`SearXNG Error: ${searxRes.statusText}`);\r\n                }\r\n            } else {\r\n                searchResults = await searxRes.json();\r\n            }\r\n\r\n            // Extract best query from results\r\n            // Assume results[0].title is the best match\r\n            if (searchResults.results && searchResults.results.length > 0) {\r\n                searchQuery = searchResults.results[0].title || \"Unknown Product\";\r\n                // Clean up query (remove file extensions, etc if generic)\r\n            } else {\r\n                searchQuery = \"Unknown Item\";\r\n            }\r\n\r\n        } catch (searchError: any) {\r\n            console.error('Visual Search Error:', searchError);\r\n            return NextResponse.json({ error: 'Visual search service unavailable' }, { status: 502 });\r\n        }\r\n\r\n        // --------------------------------------------------------------------------\r\n        // 3. INTERNAL PRODUCT LOOKUP\r\n        // --------------------------------------------------------------------------\r\n        // Try to find a matching product in OUR database using the extracted query\r\n        // Simple case-insensitive prefix match or similar\r\n        let matchedProductId = null;\r\n\r\n        if (searchQuery) {\r\n            // normalize\r\n            const normalizedQuery = searchQuery.toLowerCase().split(' ').slice(0, 3).join(' '); // Take first 3 words for better fuzzy match chance\r\n\r\n            // This is a basic simulation. Real world would use Algolia/Elastic or more complex query\r\n            const productsSnapshot = await adminDb.collection('products')\r\n                .where('keywords', 'array-contains', normalizedQuery)\r\n                .limit(1)\r\n                .get();\r\n\r\n            // If strict keyword match fails, maybe try a direct name query?\r\n            // Firestore doesn't support 'contains' natively easily without full text search engines.\r\n            // We'll skip complex logic here and just return the query if no direct match.\r\n\r\n            if (!productsSnapshot.empty) {\r\n                matchedProductId = productsSnapshot.docs[0].id;\r\n            }\r\n        }\r\n\r\n        // --------------------------------------------------------------------------\r\n        // 4. LOG HISTORY (FIREBASE)\r\n        // --------------------------------------------------------------------------\r\n        try {\r\n            await adminDb.collection('search_history').add({\r\n                userId: uid,\r\n                timestamp: new Date(),\r\n                searchType: 'Visual_Search',\r\n                searchQuery: searchQuery,\r\n                productId: matchedProductId,\r\n                metadata: {\r\n                    source: 'quick_action_camera'\r\n                }\r\n            });\r\n        } catch (histError) {\r\n            console.error('Failed to save history:', histError);\r\n            // Non-blocking error\r\n        }\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            query: searchQuery,\r\n            productId: matchedProductId,\r\n            data: searchResults // Debug info?\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Search API Error:', error);\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\api\\v1\\event_config\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\cancel-membership\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2148,2151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2148,2151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":93,"column":23,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3766,3859],"text":"\r\n                    We&apos;re sorry to see you go! If you cancel, you will lose access to your "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3766,3859],"text":"\r\n                    We&lsquo;re sorry to see you go! If you cancel, you will lose access to your "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3766,3859],"text":"\r\n                    We&#39;re sorry to see you go! If you cancel, you will lose access to your "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3766,3859],"text":"\r\n                    We&rsquo;re sorry to see you go! If you cancel, you will lose access to your "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { Container, Typography, TextField, Button, Alert, Paper, Box, CircularProgress } from '@mui/material';\r\nimport WarningIcon from '@mui/icons-material/Warning';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { createCancellationRequest } from '@/services/subscriptionService';\r\nimport { useRouter } from 'next/navigation';\r\n\r\nexport default function CancelMembershipPage() {\r\n    const { user, tier } = useAuth();\r\n    const router = useRouter();\r\n    const [reason, setReason] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const [success, setSuccess] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // If user is not logged in or is on free tier, handle gracefully\r\n    if (!user) {\r\n        return (\r\n            <Container sx={{ mt: 10, textAlign: 'center' }}>\r\n                <CircularProgress />\r\n            </Container>\r\n        );\r\n    }\r\n\r\n    if (tier === 'free') {\r\n        return (\r\n            <Container maxWidth=\"md\" sx={{ mt: 10 }}>\r\n                <Paper sx={{ p: 4, textAlign: 'center' }}>\r\n                    <Typography variant=\"h5\" gutterBottom>No Active Subscription</Typography>\r\n                    <Typography color=\"text.secondary\" paragraph>\r\n                        You are currently on the Free tier, so there is no membership to cancel.\r\n                    </Typography>\r\n                    <Button variant=\"contained\" onClick={() => router.push('/profile')}>\r\n                        Back to Profile\r\n                    </Button>\r\n                </Paper>\r\n            </Container>\r\n        );\r\n    }\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        if (!reason.trim()) {\r\n            setError('Please provide a reason for cancellation.');\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            await createCancellationRequest(user.uid, user.email || 'No Email', reason);\r\n            setSuccess(true);\r\n        } catch (err: any) {\r\n            setError('Failed to submit cancellation request. Please try again later.');\r\n            console.error(err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (success) {\r\n        return (\r\n            <Container maxWidth=\"md\" sx={{ mt: 10 }}>\r\n                <Paper sx={{ p: 4, textAlign: 'center', borderRadius: 4 }}>\r\n                    <Box sx={{ color: 'success.main', mb: 2 }}>\r\n                        <CheckIcon />\r\n                    </Box>\r\n                    <Typography variant=\"h5\" gutterBottom fontWeight=\"bold\">Request Received</Typography>\r\n                    <Typography color=\"text.secondary\" paragraph>\r\n                        Your cancellation request has been submitted to our support team. We will process it shortly and notify you via email.\r\n                    </Typography>\r\n                    <Button variant=\"outlined\" onClick={() => router.push('/profile')}>\r\n                        Return to Profile\r\n                    </Button>\r\n                </Paper>\r\n            </Container>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Container maxWidth=\"sm\" sx={{ mt: 5, mb: 10 }}>\r\n            <Paper component=\"form\" onSubmit={handleSubmit} sx={{ p: 4, borderRadius: 4 }}>\r\n                <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, mb: 3, color: 'warning.main' }}>\r\n                    <WarningIcon fontSize=\"large\" />\r\n                    <Typography variant=\"h5\" fontWeight=\"bold\" color=\"text.primary\">Cancel Membership</Typography>\r\n                </Box>\r\n\r\n                <Typography variant=\"body1\" paragraph>\r\n                    We're sorry to see you go! If you cancel, you will lose access to your <strong>{tier?.toUpperCase()}</strong> tier benefits at the end of your billing cycle.\r\n                </Typography>\r\n\r\n                <Alert severity=\"info\" sx={{ mb: 3 }}>\r\n                    Please let us know why you are cancelling so we can improve TruthLens.\r\n                </Alert>\r\n\r\n                {error && <Alert severity=\"error\" sx={{ mb: 3 }}>{error}</Alert>}\r\n\r\n                <TextField\r\n                    fullWidth\r\n                    label=\"Reason for cancellation\"\r\n                    multiline\r\n                    rows={4}\r\n                    value={reason}\r\n                    onChange={(e) => setReason(e.target.value)}\r\n                    placeholder=\"I'm cancelling because...\"\r\n                    required\r\n                    sx={{ mb: 4 }}\r\n                />\r\n\r\n                <Box sx={{ display: 'flex', gap: 2, justifyContent: 'flex-end' }}>\r\n                    <Button\r\n                        variant=\"text\"\r\n                        onClick={() => router.back()}\r\n                        disabled={loading}\r\n                    >\r\n                        Keep Membership\r\n                    </Button>\r\n                    <Button\r\n                        type=\"submit\"\r\n                        variant=\"contained\"\r\n                        color=\"error\"\r\n                        disabled={loading}\r\n                    >\r\n                        {loading ? 'Submitting...' : 'Confirm Cancellation'}\r\n                    </Button>\r\n                </Box>\r\n            </Paper>\r\n        </Container>\r\n    );\r\n}\r\n\r\nfunction CheckIcon() {\r\n    return (\r\n        <svg width=\"60\" height=\"60\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <path d=\"M12 22C17.5 22 22 17.5 22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22Z\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n            <path d=\"M7.75 12L10.58 14.83L16.25 9.17\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n        </svg>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\compare\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Grid' is defined but never used.","line":4,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getAttributeWinner' is assigned a value but never used.","line":25,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'attribute' is defined but never used.","line":25,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'products' is defined but never used.","line":25,"column":87,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":95},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'type' is defined but never used.","line":25,"column":112,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":116},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2124,2127],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2124,2127],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport { Box, Container, Typography, Grid, Paper, Chip, Button, IconButton } from '@mui/material';\r\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useCompare } from '@/context/CompareContext';\r\nimport { ProductData } from '@/services/productService';\r\n\r\nexport default function ComparePage() {\r\n    const router = useRouter();\r\n    const { selectedProducts, removeFromCompare } = useCompare();\r\n\r\n    // Redirect if local state is empty (user refreshed or navigated directly)\r\n    React.useEffect(() => {\r\n        if (selectedProducts.length === 0) {\r\n            router.replace('/search');\r\n        }\r\n    }, [selectedProducts, router]);\r\n\r\n    if (selectedProducts.length === 0) {\r\n        return null;\r\n    }\r\n\r\n    const getAttributeWinner = (attribute: keyof ProductData['nutriments'] | 'grade', products: ProductData[], type: 'high' | 'low') => {\r\n        // Basic logic to find best value. \r\n        // For Nutrition Grade, 'a' > 'b' > 'c'...\r\n        // For sugar, lower is better.\r\n        // For protein, higher is better.\r\n        // This is a simplified implementation.\r\n        return null; // TODO: Implement advanced winner logic\r\n    };\r\n\r\n    const attributes = [\r\n        { label: 'Nutrition Grade', key: 'nutrition_grades', format: (v: string) => v?.toUpperCase() || '?' },\r\n        { label: 'Brand', key: 'brand', format: (v: string) => v },\r\n        { label: 'Energy (kcal)', key: 'energy-kcal_100g', path: 'nutriments', unit: 'kcal' },\r\n        { label: 'Fat', key: 'fat_100g', path: 'nutriments', unit: 'g' },\r\n        { label: 'Saturated Fat', key: 'saturated-fat_100g', path: 'nutriments', unit: 'g' },\r\n        { label: 'Sugars', key: 'sugars_100g', path: 'nutriments', unit: 'g' },\r\n        { label: 'Salt', key: 'salt_100g', path: 'nutriments', unit: 'g' },\r\n        { label: 'Proteins', key: 'proteins_100g', path: 'nutriments', unit: 'g' },\r\n        { label: 'Fiber', key: 'fiber_100g', path: 'nutriments', unit: 'g' },\r\n    ];\r\n\r\n    const getValue = (product: ProductData, attr: any) => {\r\n        if (attr.key === 'nutrition_grades') return product.nutrition_grades;\r\n        if (attr.key === 'brand') return product.brand;\r\n        if (attr.path === 'nutriments' && product.nutriments) {\r\n            return product.nutriments[attr.key] ? `${Math.round(product.nutriments[attr.key])}${attr.unit}` : '-';\r\n        }\r\n        return '-';\r\n    };\r\n\r\n    return (\r\n        <Box sx={{ minHeight: '100vh', py: 4, bgcolor: 'background.default' }}>\r\n            <Container maxWidth=\"xl\">\r\n                <Button\r\n                    startIcon={<ArrowBackIcon />}\r\n                    onClick={() => router.back()}\r\n                    sx={{ mb: 4 }}\r\n                >\r\n                    Back to Search\r\n                </Button>\r\n\r\n                <Typography variant=\"h4\" fontWeight=\"bold\" gutterBottom>\r\n                    Product Comparison\r\n                </Typography>\r\n                <Typography variant=\"body1\" color=\"text.secondary\" sx={{ mb: 6 }}>\r\n                    Comparing {selectedProducts.length} items side-by-side\r\n                </Typography>\r\n\r\n                <Box sx={{ overflowX: 'auto', pb: 2 }}>\r\n                    <Box sx={{ minWidth: 600, display: 'grid', gridTemplateColumns: `200px repeat(${selectedProducts.length}, 1fr)`, gap: 2 }}>\r\n\r\n                        {/* Header Row (Product Info) */}\r\n                        <Box sx={{ p: 2 }} /> {/* Empty corner cell */}\r\n                        {selectedProducts.map((product) => (\r\n                            <Paper key={product.id} sx={{ p: 3, textAlign: 'center', position: 'relative' }}>\r\n                                <IconButton\r\n                                    size=\"small\"\r\n                                    color=\"error\"\r\n                                    onClick={() => removeFromCompare(product.id)}\r\n                                    sx={{ position: 'absolute', top: 8, right: 8 }}\r\n                                >\r\n                                    <Box sx={{ fontSize: 20 }}>├ù</Box>\r\n                                </IconButton>\r\n                                <Box\r\n                                    component=\"img\"\r\n                                    src={product.image}\r\n                                    alt={product.name}\r\n                                    sx={{ width: 120, height: 120, objectFit: 'contain', mb: 2, borderRadius: 2 }}\r\n                                />\r\n                                <Typography variant=\"h6\" fontWeight=\"bold\" sx={{ fontSize: '1rem', mb: 1 }}>\r\n                                    {product.name}\r\n                                </Typography>\r\n                                <Chip\r\n                                    label={`Grade ${product.nutrition_grades?.toUpperCase()}`}\r\n                                    color={\r\n                                        product.nutrition_grades === 'a' || product.nutrition_grades === 'b' ? 'success' :\r\n                                            product.nutrition_grades === 'c' ? 'warning' : 'error'\r\n                                    }\r\n                                    size=\"small\"\r\n                                />\r\n                            </Paper>\r\n                        ))}\r\n\r\n                        {/* Attribute Rows */}\r\n                        {attributes.map((attr) => (\r\n                            <React.Fragment key={attr.label}>\r\n                                <Box sx={{ p: 2, display: 'flex', alignItems: 'center', fontWeight: 'bold', color: 'text.secondary', borderBottom: '1px solid rgba(255,255,255,0.05)' }}>\r\n                                    {attr.label}\r\n                                </Box>\r\n                                {selectedProducts.map((product) => (\r\n                                    <Box key={`${product.id}-${attr.label}`} sx={{ p: 2, textAlign: 'center', borderBottom: '1px solid rgba(255,255,255,0.05)', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                                        <Typography variant=\"body1\">\r\n                                            {getValue(product, attr)}\r\n                                        </Typography>\r\n                                    </Box>\r\n                                ))}\r\n                            </React.Fragment>\r\n                        ))}\r\n\r\n                    </Box>\r\n                </Box>\r\n\r\n            </Container>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\favorites\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":4,"column":65,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":71},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'loadFavorites', 'loading', and 'router'. Either include them or remove the dependency array.","line":28,"column":8,"nodeType":"ArrayExpression","endLine":28,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadFavorites, loading, router, user]","fix":{"range":[1217,1223],"text":"[loadFavorites, loading, router, user]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":49,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Container, Typography, IconButton, Paper, Box, Avatar, Button } from '@mui/material';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { getFavorites, removeFromFavorites, FavoriteItem } from '@/services/favoriteService';\r\nimport PageTransition from '@/components/animation/PageTransition';\r\nimport StaggerList, { StaggerItem } from '@/components/animation/StaggerList';\r\nimport LoadingSpinner from '@/components/ui/LoadingSpinner';\r\nimport EmptyState from '@/components/ui/EmptyState';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\r\nimport FavoriteIcon from '@mui/icons-material/Favorite';\r\n\r\nexport default function FavoritesPage() {\r\n    const { user } = useAuth();\r\n    const router = useRouter();\r\n    const [favorites, setFavorites] = useState<FavoriteItem[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (user) {\r\n            loadFavorites();\r\n        } else if (!loading) { // If auth loaded and no user\r\n            router.push('/login');\r\n        }\r\n    }, [user]);\r\n\r\n    const loadFavorites = async () => {\r\n        if (!user) return;\r\n        setLoading(true);\r\n        try {\r\n            const data = await getFavorites(user.uid);\r\n            setFavorites(data);\r\n        } catch (error) {\r\n            console.error('Failed to load favorites', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleRemove = async (e: React.MouseEvent, id: string) => {\r\n        e.stopPropagation();\r\n        if (!user) return;\r\n        try {\r\n            await removeFromFavorites(user.uid, id);\r\n            setFavorites(prev => prev.filter(item => item.id !== id));\r\n        } catch (error) {\r\n            // console.error(error);\r\n        }\r\n    };\r\n\r\n    if (loading) return <LoadingSpinner fullScreen />;\r\n\r\n    return (\r\n        <PageTransition>\r\n            <Container maxWidth=\"md\" sx={{ mt: 4, mb: 10 }}>\r\n                <Box sx={{ display: 'flex', alignItems: 'center', mb: 4, gap: 2 }}>\r\n                    <IconButton onClick={() => router.back()}>\r\n                        <ArrowBackIcon />\r\n                    </IconButton>\r\n                    <Typography variant=\"h4\" fontWeight=\"bold\">My Favorites</Typography>\r\n                </Box>\r\n\r\n                {favorites.length > 0 ? (\r\n                    <StaggerList>\r\n                        {favorites.map((item) => (\r\n                            <StaggerItem key={item.id}>\r\n                                <Paper\r\n                                    elevation={0}\r\n                                    sx={{\r\n                                        p: 2,\r\n                                        mb: 2,\r\n                                        display: 'flex',\r\n                                        alignItems: 'center',\r\n                                        gap: 2,\r\n                                        borderRadius: 3,\r\n                                        border: '1px solid',\r\n                                        borderColor: 'divider',\r\n                                        cursor: 'pointer',\r\n                                        transition: 'all 0.2s',\r\n                                        '&:hover': {\r\n                                            borderColor: 'primary.main',\r\n                                            transform: 'translateY(-2px)',\r\n                                            boxShadow: 4\r\n                                        }\r\n                                    }}\r\n                                    onClick={() => router.push(`/product/${item.id}`)}\r\n                                >\r\n                                    <Avatar\r\n                                        src={item.image}\r\n                                        variant=\"rounded\"\r\n                                        sx={{ width: 60, height: 60, bgcolor: 'action.hover' }}\r\n                                    >\r\n                                        {item.name.charAt(0)}\r\n                                    </Avatar>\r\n\r\n                                    <Box sx={{ flex: 1 }}>\r\n                                        <Typography variant=\"subtitle1\" fontWeight=\"bold\">\r\n                                            {item.name}\r\n                                        </Typography>\r\n                                        <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                            {item.brand}\r\n                                        </Typography>\r\n                                    </Box>\r\n\r\n                                    <IconButton\r\n                                        color=\"error\"\r\n                                        onClick={(e) => handleRemove(e, item.id)}\r\n                                    >\r\n                                        <DeleteIcon />\r\n                                    </IconButton>\r\n                                </Paper>\r\n                            </StaggerItem>\r\n                        ))}\r\n                    </StaggerList>\r\n                ) : (\r\n                    <EmptyState\r\n                        icon={<FavoriteIcon sx={{ fontSize: 60, color: 'text.disabled' }} />}\r\n                        title=\"No favorites yet\"\r\n                        description=\"Save products you love to easily find them later.\"\r\n                        actionLabel=\"Scan Products\"\r\n                        onAction={() => router.push('/scan')}\r\n                        secondaryActionLabel=\"Search Manually\"\r\n                        onSecondaryAction={() => router.push('/')}\r\n                    />\r\n                )}\r\n            </Container>\r\n        </PageTransition>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\global-search\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\global-search\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'InputAdornment' is defined but never used.","line":4,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":70},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useTheme' is defined but never used.","line":4,"column":98,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":106},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'addToHistory' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":22},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 'hasSearched'. Either include it or remove the dependency array.","line":41,"column":8,"nodeType":"ArrayExpression","endLine":41,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [hasSearched, searchParams]","fix":{"range":[2017,2031],"text":"[hasSearched, searchParams]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { Box, Container, Typography, Paper, TextField, InputAdornment, Avatar, Chip, IconButton, useTheme } from '@mui/material';\r\nimport SearchIcon from '@mui/icons-material/Search';\r\nimport CloseIcon from '@mui/icons-material/Close';\r\nimport PublicIcon from '@mui/icons-material/Public';\r\nimport ArrowForwardIosIcon from '@mui/icons-material/ArrowForwardIos';\r\nimport LockIcon from '@mui/icons-material/Lock';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { searchProductsAction, EnhancedProductData } from '@/app/actions';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { addToHistory } from '@/services/historyService';\r\nimport UpgradePrompt from '@/components/subscription/UpgradePrompt';\r\nimport PageTransition from '@/components/animation/PageTransition';\r\nimport StaggerList from '@/components/animation/StaggerList';\r\nimport AnimatedButton from '@/components/ui/AnimatedButton';\r\nimport LoadingSpinner from '@/components/ui/LoadingSpinner';\r\nimport SearchingAnimation from '@/components/ui/SearchingAnimation';\r\nimport EmptyState from '@/components/ui/EmptyState';\r\nimport { motion } from 'framer-motion';\r\n\r\nexport default function GlobalSearchPage() {\r\n    const [query, setQuery] = useState('');\r\n    const [results, setResults] = useState<EnhancedProductData[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [hasSearched, setHasSearched] = useState(false);\r\n    const router = useRouter();\r\n    const searchParams = useSearchParams();\r\n    const { features, tier, loading: authLoading } = useAuth(); // Use tier-based feature flag\r\n    const { t } = useTranslation();\r\n\r\n    // Auto-search from URL\r\n    React.useEffect(() => {\r\n        const urlQuery = searchParams.get('search') || searchParams.get('q');\r\n        if (urlQuery && !hasSearched) {\r\n            setQuery(urlQuery);\r\n            performSearch(urlQuery);\r\n        }\r\n    }, [searchParams]);\r\n\r\n    const performSearch = async (searchQuery: string) => {\r\n        if (!searchQuery.trim()) return;\r\n        setLoading(true);\r\n        setHasSearched(true);\r\n        try {\r\n            const data = await searchProductsAction(searchQuery);\r\n            setResults(data);\r\n        } catch (error) {\r\n            console.error(\"Search failed\", error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // Show loading state while auth is initializing\r\n    if (authLoading) {\r\n        return (\r\n            <Box sx={{ minHeight: '80vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                <LoadingSpinner />\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    const handleSearch = async (e?: React.FormEvent) => {\r\n        if (e) e.preventDefault();\r\n        performSearch(query);\r\n    };\r\n\r\n    const handleClear = () => {\r\n        setQuery('');\r\n        setResults([]);\r\n        setHasSearched(false);\r\n        // Optional: clear URL param?\r\n        router.replace('/global-search');\r\n    };\r\n\r\n    // Debug logging\r\n    console.log('[Global Search] Access check:', {\r\n        tier,\r\n        'features.globalSearch': features?.globalSearch,\r\n        'full features': features\r\n    });\r\n\r\n    // ≡ƒÜ½ Restricted Access View - Use tier feature flag\r\n    if (!features?.globalSearch) {\r\n        return (\r\n            <PageTransition>\r\n                <Box sx={{\r\n                    minHeight: '80vh',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    background: 'radial-gradient(circle at center, rgba(108,99,255,0.05) 0%, transparent 70%)'\r\n                }}>\r\n                    <Container maxWidth=\"sm\">\r\n                        <Box sx={{ textAlign: 'center', mb: 6 }}>\r\n                            <Avatar sx={{\r\n                                width: 80, height: 80,\r\n                                bgcolor: 'rgba(255,255,255,0.05)',\r\n                                color: '#6C63FF',\r\n                                margin: '0 auto',\r\n                                mb: 2,\r\n                                border: '1px solid rgba(108,99,255,0.3)'\r\n                            }}>\r\n                                <LockIcon sx={{ fontSize: 40 }} />\r\n                            </Avatar>\r\n                            <Typography variant=\"h4\" fontWeight=\"bold\" gutterBottom>\r\n                                {t('global_search_title')}\r\n                            </Typography>\r\n                            <Typography variant=\"body1\" color=\"text.secondary\">\r\n                                {t('global_search_restricted_desc')}\r\n                            </Typography>\r\n                        </Box>\r\n                        <UpgradePrompt feature={t('global_search_feature_name')} variant=\"full\" />\r\n                    </Container>\r\n                </Box>\r\n            </PageTransition>\r\n        );\r\n    }\r\n\r\n    // Γ£à Premium View (Ultimate Users)\r\n    return (\r\n        <PageTransition>\r\n            <Box sx={{\r\n                minHeight: '100vh',\r\n                bgcolor: '#050505',\r\n                color: 'white',\r\n                pt: 8,\r\n                pb: 12,\r\n                position: 'relative',\r\n                overflow: 'hidden'\r\n            }}>\r\n                {/* Background Decoration */}\r\n                <Box sx={{\r\n                    position: 'absolute',\r\n                    top: '-20%',\r\n                    right: '-20%',\r\n                    width: '600px',\r\n                    height: '600px',\r\n                    background: 'radial-gradient(circle, rgba(108,99,255,0.08) 0%, transparent 70%)',\r\n                    borderRadius: '50%',\r\n                    filter: 'blur(80px)',\r\n                    zIndex: 0\r\n                }} />\r\n\r\n                <Container maxWidth=\"md\" sx={{ position: 'relative', zIndex: 1 }}>\r\n                    <Box sx={{ textAlign: 'center', mb: 6 }}>\r\n                        <motion.div\r\n                            initial={{ scale: 0.8, opacity: 0 }}\r\n                            animate={{ scale: 1, opacity: 1 }}\r\n                            transition={{ duration: 0.5 }}\r\n                        >\r\n                            <Box sx={{ display: 'inline-flex', p: 1.5, borderRadius: '50%', bgcolor: 'rgba(108,99,255,0.1)', mb: 2 }}>\r\n                                <PublicIcon sx={{ fontSize: 40, color: '#6C63FF' }} />\r\n                            </Box>\r\n                        </motion.div>\r\n                        <Typography variant=\"h3\" fontWeight=\"900\" sx={{\r\n                            mb: 1,\r\n                            background: 'linear-gradient(135deg, #fff 0%, #aaa 100%)',\r\n                            WebkitBackgroundClip: 'text',\r\n                            WebkitTextFillColor: 'transparent',\r\n                        }}>\r\n                            {t('global_search_title')}\r\n                        </Typography>\r\n                        <Typography variant=\"body1\" sx={{ color: 'rgba(255,255,255,0.5)' }}>\r\n                            {t('global_search_subtitle')}\r\n                        </Typography>\r\n                    </Box>\r\n\r\n                    <Paper\r\n                        component=\"form\"\r\n                        onSubmit={handleSearch}\r\n                        elevation={0}\r\n                        sx={{\r\n                            p: '8px 16px',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            mb: 6,\r\n                            borderRadius: '24px',\r\n                            bgcolor: 'rgba(255,255,255,0.05)',\r\n                            border: '1px solid rgba(255,255,255,0.1)',\r\n                            backdropFilter: 'blur(10px)',\r\n                            transition: 'all 0.3s',\r\n                            '&:hover, &:focus-within': {\r\n                                bgcolor: 'rgba(255,255,255,0.08)',\r\n                                borderColor: 'rgba(108, 99, 255, 0.5)',\r\n                                boxShadow: '0 0 30px rgba(108, 99, 255, 0.15)'\r\n                            }\r\n                        }}\r\n                    >\r\n                        <SearchIcon sx={{ color: 'rgba(255,255,255,0.5)', mr: 2 }} />\r\n                        <TextField\r\n                            fullWidth\r\n                            placeholder={t('global_search_placeholder')}\r\n                            value={query}\r\n                            onChange={(e) => setQuery(e.target.value)}\r\n                            variant=\"standard\"\r\n                            InputProps={{\r\n                                disableUnderline: true,\r\n                                style: { fontSize: '1.2rem', color: 'white' }\r\n                            }}\r\n                            sx={{\r\n                                '& input::placeholder': {\r\n                                    color: 'rgba(255,255,255,0.3)',\r\n                                    fontStyle: 'italic'\r\n                                }\r\n                            }}\r\n                        />\r\n                        {query && (\r\n                            <IconButton onClick={handleClear} size=\"small\" sx={{ color: 'rgba(255,255,255,0.5)' }}>\r\n                                <CloseIcon fontSize=\"small\" />\r\n                            </IconButton>\r\n                        )}\r\n                        <AnimatedButton\r\n                            type=\"submit\"\r\n                            variant=\"contained\"\r\n                            disabled={loading || !query.trim()}\r\n                            sx={{\r\n                                ml: 2,\r\n                                borderRadius: '16px',\r\n                                px: 4,\r\n                                py: 1,\r\n                                background: 'linear-gradient(135deg, #6C63FF 0%, #5a52d5 100%)',\r\n                                boxShadow: '0 4px 12px rgba(108, 99, 255, 0.3)'\r\n                            }}\r\n                        >\r\n                            {t('search_button')}\r\n                        </AnimatedButton>\r\n                    </Paper>\r\n\r\n                    {loading ? (\r\n                        <Box sx={{ display: 'flex', justifyContent: 'center', py: 8 }}>\r\n                            <SearchingAnimation />\r\n                        </Box>\r\n                    ) : (\r\n                        <StaggerList>\r\n                            {results.map((product) => (\r\n                                <Paper\r\n                                    key={product.id}\r\n                                    onClick={() => router.push(`/product/${product.id}?source=global-search&q=${encodeURIComponent(query)}`)}\r\n                                    sx={{\r\n                                        mb: 2,\r\n                                        p: 2,\r\n                                        borderRadius: 4,\r\n                                        bgcolor: 'rgba(255,255,255,0.03)',\r\n                                        border: '1px solid rgba(255,255,255,0.05)',\r\n                                        display: 'flex',\r\n                                        alignItems: 'center',\r\n                                        cursor: 'pointer',\r\n                                        transition: 'all 0.2s',\r\n                                        '&:hover': {\r\n                                            transform: 'translateY(-2px)',\r\n                                            bgcolor: 'rgba(255,255,255,0.06)',\r\n                                            borderColor: 'rgba(255,255,255,0.1)'\r\n                                        }\r\n                                    }}\r\n                                >\r\n                                    <Avatar\r\n                                        variant=\"rounded\"\r\n                                        src={product.media.thumbnail}\r\n                                        sx={{\r\n                                            width: 70,\r\n                                            height: 70,\r\n                                            mr: 2.5,\r\n                                            bgcolor: 'rgba(255,255,255,0.05)',\r\n                                            borderRadius: 3\r\n                                        }}\r\n                                    >\r\n                                        {product.identity.name.charAt(0)}\r\n                                    </Avatar>\r\n\r\n                                    <Box sx={{ flex: 1, minWidth: 0 }}>\r\n                                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5, mb: 0.5 }}>\r\n                                            <Typography variant=\"h6\" fontWeight=\"bold\" noWrap sx={{ color: 'white', maxWidth: '70%' }}>\r\n                                                {product.identity.name}\r\n                                            </Typography>\r\n                                            <Chip\r\n                                                label={product.grades.nutri_score?.toUpperCase() || '?'}\r\n                                                size=\"small\"\r\n                                                sx={{\r\n                                                    fontWeight: '900',\r\n                                                    borderRadius: 1.5,\r\n                                                    height: 24,\r\n                                                    bgcolor: ['A', 'B'].includes(product.grades.nutri_score) ? '#00C853' :\r\n                                                        product.grades.nutri_score === 'C' ? '#FFD600' : '#FF3D00',\r\n                                                    color: 'black'\r\n                                                }}\r\n                                            />\r\n                                        </Box>\r\n                                        <Typography variant=\"body2\" sx={{ color: 'rgba(255,255,255,0.6)', mb: 0.5 }}>\r\n                                            <Box component=\"span\" fontWeight=\"500\" sx={{ color: 'rgba(255,255,255,0.9)' }}>\r\n                                                {product.identity.brand || 'Unknown Brand'}\r\n                                            </Box>\r\n                                            {\" ΓÇó \"}{product.identity.category?.split(',')[0]}\r\n                                        </Typography>\r\n                                    </Box>\r\n\r\n                                    <IconButton size=\"small\" sx={{ bgcolor: 'rgba(255,255,255,0.05)', color: 'white' }}>\r\n                                        <ArrowForwardIosIcon fontSize=\"small\" />\r\n                                    </IconButton>\r\n                                </Paper>\r\n                            ))}\r\n                        </StaggerList>\r\n                    )}\r\n\r\n                    {hasSearched && results.length === 0 && !loading && (\r\n                        <EmptyState\r\n                            title={t('global_search_no_results', { query })}\r\n                            description={t('global_search_no_results_desc')}\r\n                            actionLabel={t('clear_search')}\r\n                            onAction={handleClear}\r\n                        />\r\n                    )}\r\n                </Container>\r\n            </Box>\r\n        </PageTransition>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\history\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\history\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'List' is defined but never used.","line":4,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CircularProgress' is defined but never used.","line":4,"column":128,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":144},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":4,"column":146,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":152},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isPro' is assigned a value but never used.","line":30,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadHistory'. Either include it or remove the dependency array.","line":38,"column":8,"nodeType":"ArrayExpression","endLine":38,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [user, tier, loadHistory]","fix":{"range":[1906,1918],"text":"[user, tier, loadHistory]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":65,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":82,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":82,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":102,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":102,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Box, Container, Typography, Paper, List, ListItem, ListItemText, ListItemAvatar, Avatar, IconButton, Tab, Tabs, Chip, CircularProgress, Button, Alert } from '@mui/material';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport QrCodeScannerIcon from '@mui/icons-material/QrCodeScanner';\r\nimport SearchIcon from '@mui/icons-material/Search';\r\nimport DownloadIcon from '@mui/icons-material/Download';\r\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { getUserHistoryWithLimit, deleteHistoryItem, HistoryItem, exportHistoryToCSV, exportHistoryToPDF } from '@/services/historyService';\r\nimport UgradePrompt from '@/components/subscription/UpgradePrompt';\r\nimport AdBanner from '@/components/ads/AdBanner';\r\nimport PageTransition from '@/components/animation/PageTransition';\r\nimport StaggerList, { StaggerItem } from '@/components/animation/StaggerList';\r\nimport AnimatedButton from '@/components/ui/AnimatedButton';\r\nimport LoadingSpinner from '@/components/ui/LoadingSpinner';\r\nimport EmptyState from '@/components/ui/EmptyState';\r\nimport HistoryIcon from '@mui/icons-material/History';\r\n\r\nexport default function HistoryPage() {\r\n    const [tabValue, setTabValue] = useState(0);\r\n    const [history, setHistory] = useState<HistoryItem[]>([]);\r\n    const [hasMore, setHasMore] = useState(false);\r\n    const [limit, setLimit] = useState<number | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [exporting, setExporting] = useState(false);\r\n    const router = useRouter();\r\n    const { user, isPro, isFree, tier, features } = useAuth();\r\n\r\n    useEffect(() => {\r\n        if (user) {\r\n            loadHistory();\r\n        } else {\r\n            setLoading(false);\r\n        }\r\n    }, [user, tier]);\r\n\r\n    const loadHistory = async () => {\r\n        if (!user) return;\r\n        setLoading(true);\r\n        try {\r\n            const data = await getUserHistoryWithLimit(user.uid, tier);\r\n            setHistory(data.items);\r\n            setHasMore(data.hasMore);\r\n            setLimit(data.limit);\r\n        } catch (error) {\r\n            console.error('[HISTORY] Γ¥î Failed to load:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleTabChange = (event: React.SyntheticEvent, newValue: number) => {\r\n        setTabValue(newValue);\r\n    };\r\n\r\n    const handleDelete = async (e: React.MouseEvent, id: string) => {\r\n        e.stopPropagation();\r\n        if (!confirm('Are you sure you want to delete this item?')) return;\r\n        try {\r\n            await deleteHistoryItem(id);\r\n            setHistory(prev => prev.filter(item => item.id !== id));\r\n        } catch (err) {\r\n            alert('Failed to delete item');\r\n        }\r\n    };\r\n\r\n    const handleExportCSV = async () => {\r\n        if (!user || !features.exportFormats.includes('csv')) return;\r\n        setExporting(true);\r\n        try {\r\n            const csv = await exportHistoryToCSV(user.uid);\r\n            const blob = new Blob([csv], { type: 'text/csv' });\r\n            const url = window.URL.createObjectURL(blob);\r\n            const a = document.createElement('a');\r\n            a.href = url;\r\n            a.download = `truthlens-history-${new Date().toISOString().split('T')[0]}.csv`;\r\n            a.click();\r\n            window.URL.revokeObjectURL(url);\r\n        } catch (error) {\r\n            alert('Failed to export CSV');\r\n        } finally {\r\n            setExporting(false);\r\n        }\r\n    };\r\n\r\n    const handleExportPDF = async () => {\r\n        if (!user || !features.exportFormats.includes('pdf')) return;\r\n        setExporting(true);\r\n        try {\r\n            const html = await exportHistoryToPDF(user.uid);\r\n            const blob = new Blob([html], { type: 'text/html' });\r\n            const url = window.URL.createObjectURL(blob);\r\n            const a = document.createElement('a');\r\n            a.href = url;\r\n            a.download = `truthlens-history-${new Date().toISOString().split('T')[0]}.html`;\r\n            a.click();\r\n            window.URL.revokeObjectURL(url);\r\n            alert('PDF export downloaded as HTML. Open it in your browser and print to PDF.');\r\n        } catch (error) {\r\n            alert('Failed to export PDF');\r\n        } finally {\r\n            setExporting(false);\r\n        }\r\n    };\r\n\r\n    const filteredHistory = history.filter(item => {\r\n        if (tabValue === 0) return true;\r\n        if (tabValue === 1) return item.type === 'search'; // Tab 1 is now \"Searches\"\r\n        if (tabValue === 2) return item.type === 'scan';   // Tab 2 is now \"Scans\"\r\n        return true;\r\n    });\r\n\r\n    if (loading) return <LoadingSpinner fullScreen />;\r\n\r\n    return (\r\n        <PageTransition>\r\n            <Container maxWidth=\"md\" sx={{ mt: 5, mb: isFree ? 15 : 10 }}>\r\n                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\r\n                        <IconButton onClick={() => router.back()}>\r\n                            <ArrowBackIcon />\r\n                        </IconButton>\r\n                        <Typography variant=\"h4\" fontWeight=\"bold\">History</Typography>\r\n                    </Box>\r\n\r\n                    {features.exportFormats.length > 0 && (\r\n                        <Box sx={{ display: 'flex', gap: 1 }}>\r\n                            {features.exportFormats.includes('csv') && (\r\n                                <AnimatedButton\r\n                                    variant=\"outlined\"\r\n                                    size=\"small\"\r\n                                    startIcon={<DownloadIcon />}\r\n                                    onClick={handleExportCSV}\r\n                                    disabled={exporting || history.length === 0}\r\n                                >\r\n                                    CSV\r\n                                </AnimatedButton>\r\n                            )}\r\n                            {features.exportFormats.includes('pdf') && (\r\n                                <AnimatedButton\r\n                                    variant=\"outlined\"\r\n                                    size=\"small\"\r\n                                    startIcon={<DownloadIcon />}\r\n                                    onClick={handleExportPDF}\r\n                                    disabled={exporting || history.length === 0}\r\n                                >\r\n                                    PDF\r\n                                </AnimatedButton>\r\n                            )}\r\n                        </Box>\r\n                    )}\r\n                </Box>\r\n\r\n                {isFree && limit && (\r\n                    <Alert severity=\"info\" sx={{ mb: 2, borderRadius: 2 }}>\r\n                        <Typography variant=\"body2\">\r\n                            Free users can view the last <strong>{limit} scans</strong>.\r\n                            {hasMore && ' You have more history items. '}\r\n                            <strong\r\n                                style={{ cursor: 'pointer', textDecoration: 'underline' }}\r\n                                onClick={() => router.push('/upgrade')}\r\n                            >\r\n                                Upgrade to Pro for unlimited history.\r\n                            </strong>\r\n                        </Typography>\r\n                    </Alert>\r\n                )}\r\n\r\n                <Paper sx={{ mb: 3, borderRadius: 2, overflow: 'hidden' }}>\r\n                    <Tabs value={tabValue} onChange={handleTabChange} indicatorColor=\"secondary\" textColor=\"inherit\" variant=\"fullWidth\">\r\n                        <Tab label=\"All Activity\" />\r\n                        <Tab label=\"Searches\" />\r\n                        <Tab label=\"Scans\" />\r\n                    </Tabs>\r\n                </Paper>\r\n\r\n                {filteredHistory.length > 0 ? (\r\n                    <StaggerList staggerDelay={0.05}>\r\n                        {filteredHistory.map((item) => (\r\n                            <StaggerItem key={item.id}>\r\n                                <Paper\r\n                                    sx={{\r\n                                        mb: 2,\r\n                                        overflow: 'hidden',\r\n                                        borderRadius: 3,\r\n                                        transition: 'transform 0.2s',\r\n                                        '&:hover': { transform: 'translateY(-2px)', boxShadow: 3 }\r\n                                    }}\r\n                                >\r\n                                    <ListItem\r\n                                        secondaryAction={\r\n                                            <IconButton edge=\"end\" aria-label=\"delete\" onClick={(e) => handleDelete(e, item.id!)}>\r\n                                                <DeleteIcon color=\"error\" />\r\n                                            </IconButton>\r\n                                        }\r\n                                        disablePadding\r\n                                        sx={{ p: 2, cursor: 'pointer' }}\r\n                                        onClick={() => router.push(`/product/${item.productId || item.id}`)}\r\n                                    >\r\n                                        <ListItemAvatar>\r\n                                            <Avatar sx={{ bgcolor: item.type === 'scan' ? 'primary.main' : 'secondary.main' }}>\r\n                                                {item.type === 'scan' ? <QrCodeScannerIcon /> : <SearchIcon />}\r\n                                            </Avatar>\r\n                                        </ListItemAvatar>\r\n                                        <ListItemText\r\n                                            primary={\r\n                                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\r\n                                                    <Typography variant=\"subtitle1\" fontWeight=\"bold\">{item.title}</Typography>\r\n                                                    {item.grade && (\r\n                                                        <Chip\r\n                                                            label={`Grade ${item.grade}`}\r\n                                                            size=\"small\"\r\n                                                            color={['A', 'B'].includes(item.grade) ? 'success' : item.grade === 'C' ? 'warning' : 'error'}\r\n                                                            variant=\"outlined\"\r\n                                                        />\r\n                                                    )}\r\n                                                </Box>\r\n                                            }\r\n                                            secondary={item.createdAt ? new Date(item.createdAt).toLocaleDateString() : 'Just now'}\r\n                                        />\r\n                                    </ListItem>\r\n                                </Paper>\r\n                            </StaggerItem>\r\n                        ))}\r\n                    </StaggerList>\r\n                ) : (\r\n                    <EmptyState\r\n                        icon={<HistoryIcon sx={{ fontSize: 60, color: 'text.secondary' }} />}\r\n                        title=\"No history yet\"\r\n                        description=\"Your scanned products and searches will appear here.\"\r\n                        actionLabel=\"Start Scanning\"\r\n                        onAction={() => router.push('/scan')}\r\n                    />\r\n                )}\r\n\r\n                {isFree && hasMore && (\r\n                    <Box sx={{ mt: 3 }}>\r\n                        <UgradePrompt feature=\"Unlimited History & Export\" variant=\"full\" />\r\n                    </Box>\r\n                )}\r\n            </Container>\r\n\r\n            {isFree && features.adsEnabled && <AdBanner position=\"bottom\" />}\r\n        </PageTransition>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\install-guide\\page.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":74,"column":37,"nodeType":"JSXOpeningElement","endLine":78,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { ArrowLeft, Share, PlusSquare } from 'lucide-react';\r\nimport { motion } from 'framer-motion';\r\n\r\nexport default function InstallGuidePage() {\r\n    const router = useRouter();\r\n\r\n    const steps = [\r\n        {\r\n            title: \"Tap the Share Button\",\r\n            description: \"Look for the share icon in your browser toolbar (bottom on iPhone, top on iPad).\",\r\n            image: \"/images/install-guide/ios-share-step.png\",\r\n            icon: <Share className=\"w-6 h-6 text-blue-400\" />\r\n        },\r\n        {\r\n            title: \"Select 'Add to Home Screen'\",\r\n            description: \"Scroll down the list until you see 'Add to Home Screen' and tap it.\",\r\n            image: \"/images/install-guide/ios-add-home-step.png\",\r\n            icon: <PlusSquare className=\"w-6 h-6 text-green-400\" />\r\n        },\r\n        {\r\n            title: \"Confirm Install\",\r\n            description: \"Tap 'Add' in the top right corner. The app will appear on your home screen.\",\r\n            image: \"/icons/icon-192x192.png\", // Using icon as generic confirmation or if I had a confirm image\r\n            icon: null\r\n        }\r\n    ];\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-black text-white p-6 pb-24 overflow-y-auto\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-4 mb-8 sticky top-0 bg-black/80 backdrop-blur-xl py-4 z-50 border-b border-white/10\">\r\n                <button\r\n                    onClick={() => router.back()}\r\n                    className=\"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors\"\r\n                >\r\n                    <ArrowLeft className=\"w-6 h-6\" />\r\n                </button>\r\n                <h1 className=\"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500\">\r\n                    Install TruthLens\r\n                </h1>\r\n            </div>\r\n\r\n            {/* Intro */}\r\n            <div className=\"text-center mb-10\">\r\n                <p className=\"text-gray-400 text-lg\">\r\n                    Follow these simple steps to install the app on your iPhone or iPad.\r\n                </p>\r\n            </div>\r\n\r\n            {/* Steps */}\r\n            <div className=\"space-y-12 max-w-md mx-auto\">\r\n                {steps.map((step, index) => (\r\n                    <motion.div\r\n                        key={index}\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: index * 0.2 }}\r\n                        className=\"relative\"\r\n                    >\r\n                        {/* Step Number */}\r\n                        <div className=\"absolute -left-4 -top-4 w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center font-bold text-sm shadow-lg z-10\">\r\n                            {index + 1}\r\n                        </div>\r\n\r\n                        {/* Card */}\r\n                        <div className=\"bg-white/5 border border-white/10 rounded-3xl overflow-hidden shadow-2xl\">\r\n                            {/* Image Container */}\r\n                            <div className=\"aspect-[4/3] bg-black/50 relative flex items-center justify-center p-4\">\r\n                                {step.image ? (\r\n                                    <img\r\n                                        src={step.image}\r\n                                        alt={step.title}\r\n                                        className=\"rounded-xl shadow-lg max-h-full object-contain border border-white/5\"\r\n                                    />\r\n                                ) : (\r\n                                    <div className=\"w-20 h-20 bg-white/10 rounded-xl\" />\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Content */}\r\n                            <div className=\"p-6\">\r\n                                <h3 className=\"text-xl font-bold mb-2 flex items-center gap-3\">\r\n                                    {step.icon && <span className=\"p-1.5 bg-white/10 rounded-lg\">{step.icon}</span>}\r\n                                    {step.title}\r\n                                </h3>\r\n                                <p className=\"text-gray-400 leading-relaxed\">\r\n                                    {step.description}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </motion.div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Footer / Done */}\r\n            <div className=\"mt-12 text-center pb-8\">\r\n                <div className=\"inline-block p-4 rounded-2xl bg-gradient-to-r from-blue-500/20 to-purple-500/20 border border-blue-500/30\">\r\n                    <p className=\"text-blue-200 font-medium\">\r\n                        Looking forward to seeing you in the app!\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\login\\page.tsx","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":35,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":35,"endColumn":26,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[1591,1604],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1785,1788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1785,1788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":74,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":74,"endColumn":26,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[2978,2991],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3172,3175],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3172,3175],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":105,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":105,"endColumn":21}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Box, Button, TextField, Typography, Alert, Grid, Paper } from '@mui/material';\r\nimport GoogleIcon from '@mui/icons-material/Google';\r\nimport LockOutlinedIcon from '@mui/icons-material/LockOutlined';\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/navigation';\r\nimport { signInWithPopup, signInWithEmailAndPassword, sendEmailVerification } from 'firebase/auth';\r\nimport { auth, googleProvider } from '@/lib/firebase';\r\nimport AnimatedButton from '@/components/ui/AnimatedButton';\r\nimport LoadingSpinner from '@/components/ui/LoadingSpinner';\r\nimport ScrollReveal from '@/components/animation/ScrollReveal';\r\nimport QrCodeScannerIcon from '@mui/icons-material/QrCodeScanner';\r\n\r\nexport default function LoginPage() {\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n    const [verificationSent, setVerificationSent] = useState(false);\r\n    const [unverifiedEmail, setUnverifiedEmail] = useState('');\r\n    const router = useRouter();\r\n    const { t } = useTranslation();\r\n\r\n    const handleGoogleLogin = async () => {\r\n        setLoading(true);\r\n        setError('');\r\n        try {\r\n            const result = await signInWithPopup(auth, googleProvider);\r\n            const user = result.user;\r\n\r\n            const { getUserProfile } = await import('@/services/subscriptionService');\r\n            const profile = await getUserProfile(user.uid, user.email || '', user.displayName, user.photoURL);\r\n\r\n            // @ts-ignore\r\n            if (profile.role === 'admin') {\r\n                router.push('/admin');\r\n            } else {\r\n                router.push('/');\r\n            }\r\n        } catch (err: any) {\r\n            console.error('Google login error:', err);\r\n            setError(err.message || t('auth_login_failed_google'));\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleEmailLogin = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n        setError('');\r\n        setVerificationSent(false);\r\n\r\n        const data = new FormData(e.target as HTMLFormElement);\r\n        const email = data.get('email') as string;\r\n        const password = data.get('password') as string;\r\n\r\n        try {\r\n            const userCredential = await signInWithEmailAndPassword(auth, email, password);\r\n            const user = userCredential.user;\r\n\r\n            if (!user.emailVerified) {\r\n                setUnverifiedEmail(email);\r\n                setError(t('auth_verify_email_first'));\r\n                await auth.signOut();\r\n                setLoading(false);\r\n                return;\r\n            }\r\n\r\n            const { getUserProfile } = await import('@/services/subscriptionService');\r\n            const profile = await getUserProfile(user.uid, user.email || '', user.displayName, user.photoURL);\r\n\r\n            // @ts-ignore\r\n            if (profile.role === 'admin') {\r\n                router.push('/admin');\r\n            } else {\r\n                router.push('/');\r\n            }\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            if (err.code === 'auth/invalid-credential' || err.code === 'auth/wrong-password') {\r\n                setError(t('auth_invalid_credentials'));\r\n            } else if (err.code === 'auth/user-not-found') {\r\n                setError(t('auth_no_account'));\r\n            } else {\r\n                setError(err.message || t('auth_login_failed'));\r\n            }\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleResendVerification = async () => {\r\n        if (!unverifiedEmail) return;\r\n        setLoading(true);\r\n        try {\r\n            const data = new FormData(document.querySelector('form') as HTMLFormElement);\r\n            const password = data.get('password') as string;\r\n            const userCredential = await signInWithEmailAndPassword(auth, unverifiedEmail, password);\r\n            await sendEmailVerification(userCredential.user);\r\n            await auth.signOut();\r\n            setVerificationSent(true);\r\n            setError('');\r\n        } catch (err) {\r\n            setError(t('auth_resend_error'));\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (loading && !error) {\r\n        return <LoadingSpinner fullScreen message={t('auth_logging_in')} />;\r\n    }\r\n\r\n    return (\r\n        <Grid container sx={{ minHeight: '100vh' }}>\r\n            {/* Left Side - Branding */}\r\n            <Grid\r\n                size={{ xs: 12, md: 6 }}\r\n                sx={{\r\n                    display: { xs: 'none', md: 'flex' },\r\n                    flexDirection: 'column',\r\n                    justifyContent: 'center',\r\n                    alignItems: 'center',\r\n                    background: 'linear-gradient(135deg, #6C63FF 0%, #00F0FF 100%)',\r\n                    color: 'white',\r\n                    p: 6,\r\n                }}\r\n            >\r\n                <ScrollReveal>\r\n                    <QrCodeScannerIcon sx={{ fontSize: 80, mb: 3 }} />\r\n                    <Typography variant=\"h3\" fontWeight=\"bold\" gutterBottom>\r\n                        {t('auth_login_welcome_title')}\r\n                    </Typography>\r\n                    <Typography variant=\"h6\" sx={{ opacity: 0.9, maxWidth: 400, textAlign: 'center' }}>\r\n                        {t('auth_login_welcome_desc')}\r\n                    </Typography>\r\n                </ScrollReveal>\r\n            </Grid>\r\n\r\n            {/* Right Side - Login Form */}\r\n            <Grid\r\n                size={{ xs: 12, md: 6 }}\r\n                sx={{\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    justifyContent: 'center',\r\n                    p: { xs: 3, md: 8 },\r\n                }}\r\n            >\r\n                <Paper\r\n                    elevation={0}\r\n                    sx={{\r\n                        maxWidth: 450,\r\n                        mx: 'auto',\r\n                        width: '100%',\r\n                        p: { xs: 3, md: 4 },\r\n                        bgcolor: 'transparent',\r\n                    }}\r\n                >\r\n                    <ScrollReveal>\r\n                        <Box sx={{ textAlign: 'center', mb: 4 }}>\r\n                            <LockOutlinedIcon sx={{ fontSize: 48, color: 'primary.main', mb: 2 }} />\r\n                            <Typography variant=\"h4\" fontWeight=\"bold\" gutterBottom>\r\n                                {t('auth_sign_in_title')}\r\n                            </Typography>\r\n                            <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                {t('auth_sign_in_subtitle')}\r\n                            </Typography>\r\n                        </Box>\r\n\r\n                        {error && (\r\n                            <Alert\r\n                                severity=\"error\"\r\n                                sx={{ mb: 3 }}\r\n                                action={\r\n                                    unverifiedEmail && !verificationSent ? (\r\n                                        <Button color=\"inherit\" size=\"small\" onClick={handleResendVerification}>\r\n                                            Resend\r\n                                        </Button>\r\n                                    ) : null\r\n                                }\r\n                            >\r\n                                {error}\r\n                            </Alert>\r\n                        )}\r\n\r\n                        {verificationSent && (\r\n                            <Alert severity=\"success\" sx={{ mb: 3 }}>\r\n                                {t('auth_verification_sent')}\r\n                            </Alert>\r\n                        )}\r\n\r\n                        <AnimatedButton\r\n                            fullWidth\r\n                            size=\"large\"\r\n                            variant=\"outlined\"\r\n                            startIcon={<GoogleIcon />}\r\n                            onClick={handleGoogleLogin}\r\n                            disabled={loading}\r\n                            sx={{\r\n                                py: 1.5,\r\n                                mb: 3,\r\n                                borderColor: 'rgba(108,99,255,0.3)',\r\n                                '&:hover': {\r\n                                    borderColor: 'primary.main',\r\n                                },\r\n                            }}\r\n                        >\r\n                            {t('auth_continue_google')}\r\n                        </AnimatedButton>\r\n\r\n                        <Box sx={{ display: 'flex', alignItems: 'center', mb: 3 }}>\r\n                            <Box sx={{ flex: 1, height: 1, bgcolor: 'divider' }} />\r\n                            <Typography variant=\"body2\" sx={{ px: 2, color: 'text.secondary' }}>\r\n                                {t('auth_or')}\r\n                            </Typography>\r\n                            <Box sx={{ flex: 1, height: 1, bgcolor: 'divider' }} />\r\n                        </Box>\r\n\r\n                        <Box component=\"form\" onSubmit={handleEmailLogin} sx={{ display: 'flex', flexDirection: 'column', gap: 2.5 }}>\r\n                            <TextField\r\n                                name=\"email\"\r\n                                label={t('auth_email')}\r\n                                type=\"email\"\r\n                                required\r\n                                fullWidth\r\n                                disabled={loading}\r\n                                autoComplete=\"email\"\r\n                            />\r\n                            <TextField\r\n                                name=\"password\"\r\n                                label={t('auth_password')}\r\n                                type=\"password\"\r\n                                required\r\n                                fullWidth\r\n                                disabled={loading}\r\n                                autoComplete=\"current-password\"\r\n                            />\r\n\r\n                            <Box sx={{ textAlign: 'right', mt: -1 }}>\r\n                                <Link href=\"/reset-password\" style={{ fontSize: '0.875rem', color: '#6C63FF', textDecoration: 'none' }}>\r\n                                    {t('auth_forgot_password')}\r\n                                </Link>\r\n                            </Box>\r\n\r\n                            <AnimatedButton\r\n                                type=\"submit\"\r\n                                fullWidth\r\n                                size=\"large\"\r\n                                variant=\"contained\"\r\n                                disabled={loading}\r\n                                sx={{\r\n                                    py: 1.5,\r\n                                    mt: 1,\r\n                                    background: 'linear-gradient(45deg, #6C63FF 30%, #00F0FF 90%)',\r\n                                }}\r\n                            >\r\n                                {loading ? t('auth_logging_in') : t('auth_sign_in_button')}\r\n                            </AnimatedButton>\r\n                        </Box>\r\n\r\n                        <Box sx={{ mt: 4, textAlign: 'center' }}>\r\n                            <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                {t('auth_no_account_question')}{' '}\r\n                                <Link href=\"/signup\" style={{ color: '#6C63FF', fontWeight: 600, textDecoration: 'none' }}>\r\n                                    {t('auth_sign_up_link')}\r\n                                </Link>\r\n                            </Typography>\r\n                        </Box>\r\n                    </ScrollReveal>\r\n                </Paper>\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\maintenance\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Paper' is defined but never used.","line":4,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BuildIcon' is defined but never used.","line":6,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport { Box, Container, Typography, Button, Paper } from '@mui/material';\r\nimport { motion } from 'framer-motion';\r\nimport BuildIcon from '@mui/icons-material/Build'; // Or a more creative icon if available\r\nimport EngineeringIcon from '@mui/icons-material/Engineering';\r\nimport Link from 'next/link';\r\n\r\nexport default function MaintenancePage() {\r\n    return (\r\n        <Box\r\n            sx={{\r\n                minHeight: '100vh',\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                justifyContent: 'center',\r\n                alignItems: 'center',\r\n                bgcolor: '#050505',\r\n                color: 'white',\r\n                position: 'relative',\r\n                overflow: 'hidden',\r\n            }}\r\n        >\r\n            {/* Background Animation */}\r\n            <Box\r\n                component={motion.div}\r\n                animate={{\r\n                    rotate: 360,\r\n                }}\r\n                transition={{\r\n                    duration: 50,\r\n                    repeat: Infinity,\r\n                    ease: \"linear\"\r\n                }}\r\n                sx={{\r\n                    position: 'absolute',\r\n                    width: '80vw',\r\n                    height: '80vw',\r\n                    maxWidth: 800,\r\n                    maxHeight: 800,\r\n                    borderRadius: '40%',\r\n                    background: 'linear-gradient(135deg, rgba(108, 99, 255, 0.1) 0%, rgba(0, 240, 255, 0.1) 100%)',\r\n                    filter: 'blur(60px)',\r\n                    zIndex: 0,\r\n                }}\r\n            />\r\n\r\n            <Container maxWidth=\"sm\" sx={{ position: 'relative', zIndex: 1, textAlign: 'center' }}>\r\n                <Box\r\n                    component={motion.div}\r\n                    initial={{ scale: 0.8, opacity: 0 }}\r\n                    animate={{ scale: 1, opacity: 1 }}\r\n                    transition={{ duration: 0.8, ease: \"easeOut\" }}\r\n                >\r\n                    <Box\r\n                        sx={{\r\n                            display: 'inline-flex',\r\n                            p: 3,\r\n                            borderRadius: '30%',\r\n                            bgcolor: 'rgba(255,255,255,0.05)',\r\n                            mb: 4,\r\n                            border: '1px solid rgba(255,255,255,0.1)',\r\n                            boxShadow: '0 0 40px rgba(108, 99, 255, 0.3)'\r\n                        }}\r\n                    >\r\n                        <EngineeringIcon sx={{ fontSize: 60, color: '#6C63FF' }} />\r\n                    </Box>\r\n                </Box>\r\n\r\n                <Typography\r\n                    component={motion.h1}\r\n                    initial={{ y: 20, opacity: 0 }}\r\n                    animate={{ y: 0, opacity: 1 }}\r\n                    transition={{ delay: 0.2 }}\r\n                    variant=\"h2\"\r\n                    fontWeight=\"bold\"\r\n                    gutterBottom\r\n                    sx={{\r\n                        background: 'linear-gradient(45deg, #fff, #aaa)',\r\n                        backgroundClip: 'text',\r\n                        color: 'transparent',\r\n                    }}\r\n                >\r\n                    Under Maintenance\r\n                </Typography>\r\n\r\n                <Typography\r\n                    component={motion.p}\r\n                    initial={{ y: 20, opacity: 0 }}\r\n                    animate={{ y: 0, opacity: 1 }}\r\n                    transition={{ delay: 0.4 }}\r\n                    variant=\"h6\"\r\n                    color=\"text.secondary\"\r\n                    sx={{ mb: 6, lineHeight: 1.6 }}\r\n                >\r\n                    We are currently upgrading our systems to bring you a better experience.\r\n                    <br />\r\n                    TruthLens will be back shortly.\r\n                </Typography>\r\n\r\n                <Box\r\n                    component={motion.div}\r\n                    initial={{ y: 20, opacity: 0 }}\r\n                    animate={{ y: 0, opacity: 1 }}\r\n                    transition={{ delay: 0.6 }}\r\n                >\r\n                    <Link href=\"/login\" passHref style={{ textDecoration: 'none' }}>\r\n                        <Button\r\n                            variant=\"outlined\"\r\n                            sx={{\r\n                                color: 'rgba(255,255,255,0.5)',\r\n                                borderColor: 'rgba(255,255,255,0.2)',\r\n                                textTransform: 'none',\r\n                                '&:hover': {\r\n                                    borderColor: 'white',\r\n                                    color: 'white',\r\n                                    bgcolor: 'transparent'\r\n                                }\r\n                            }}\r\n                        >\r\n                            Admin Login\r\n                        </Button>\r\n                    </Link>\r\n                </Box>\r\n            </Container>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\manifest.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\meal-planner\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Chip' is defined but never used.","line":4,"column":77,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":81},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadPlan` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\meal-planner\\page.tsx:22:13\n  20 |     useEffect(() => {\n  21 |         if (user && hasAccess) {\n> 22 |             loadPlan();\n     |             ^^^^^^^^ `loadPlan` accessed before it is declared\n  23 |         } else {\n  24 |             setLoading(false);\n  25 |         }\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\meal-planner\\page.tsx:28:5\n  26 |     }, [user, hasAccess]);\n  27 |\n> 28 |     const loadPlan = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 29 |         setLoading(true);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^\n> 30 |         if (user) {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^\n> 31 |             const existing = await getLatestMealPlan(user.uid);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^\n> 32 |             if (existing) {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^\n> 33 |                 setPlan(existing);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^\n> 34 |             }\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^\n> 35 |         }\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^\n> 36 |         setLoading(false);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^\n> 37 |     };\n     | ^^^^^^^ `loadPlan` is declared here\n  38 |\n  39 |     const generateNewPlan = async () => {\n  40 |         if (!user) return;","line":22,"column":13,"nodeType":null,"endLine":22,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPlan'. Either include it or remove the dependency array.","line":26,"column":8,"nodeType":"ArrayExpression","endLine":26,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [user, hasAccess, loadPlan]","fix":{"range":[990,1007],"text":"[user, hasAccess, loadPlan]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport { Container, Typography, Box, Paper, Grid, Button, CircularProgress, Chip, Divider } from '@mui/material';\r\nimport RestaurantMenuIcon from '@mui/icons-material/RestaurantMenu';\r\nimport AutoAwesomeIcon from '@mui/icons-material/AutoAwesome';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { createWeeklyMealPlan, getLatestMealPlan } from '@/services/mealPlannerService';\r\nimport { MealPlanDay } from '@/services/aiService';\r\n\r\nexport default function MealPlannerPage() {\r\n    const { user, features } = useAuth();\r\n    const [plan, setPlan] = useState<MealPlanDay[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [generating, setGenerating] = useState(false);\r\n\r\n    // Access check\r\n    const hasAccess = features.mealPlanning;\r\n\r\n    useEffect(() => {\r\n        if (user && hasAccess) {\r\n            loadPlan();\r\n        } else {\r\n            setLoading(false);\r\n        }\r\n    }, [user, hasAccess]);\r\n\r\n    const loadPlan = async () => {\r\n        setLoading(true);\r\n        if (user) {\r\n            const existing = await getLatestMealPlan(user.uid);\r\n            if (existing) {\r\n                setPlan(existing);\r\n            }\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    const generateNewPlan = async () => {\r\n        if (!user) return;\r\n        setGenerating(true);\r\n        try {\r\n            const newPlan = await createWeeklyMealPlan(user.uid);\r\n            setPlan(newPlan);\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n        setGenerating(false);\r\n    };\r\n\r\n    if (!user) return <Container sx={{ mt: 10 }}>Please log in.</Container>;\r\n\r\n    // Premium feature gate\r\n    if (!hasAccess) {\r\n        return (\r\n            <Container maxWidth=\"sm\" sx={{ mt: 10, textAlign: 'center' }}>\r\n                <Paper sx={{ p: 5, borderRadius: 4 }}>\r\n                    <RestaurantMenuIcon sx={{ fontSize: 60, color: 'warning.main', mb: 2 }} />\r\n                    <Typography variant=\"h5\" fontWeight=\"bold\" gutterBottom>Premium Feature</Typography>\r\n                    <Typography color=\"text.secondary\" paragraph>\r\n                        AI Meal Planning is available for Pro and Ultimate members.\r\n                    </Typography>\r\n                    <Button variant=\"contained\" color=\"warning\" href=\"/upgrade\">\r\n                        Upgrade Now\r\n                    </Button>\r\n                </Paper>\r\n            </Container>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Container maxWidth=\"lg\" sx={{ mt: 5, mb: 10 }}>\r\n            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 4 }}>\r\n                <Box>\r\n                    <Typography variant=\"h4\" fontWeight=\"bold\" sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                        <RestaurantMenuIcon fontSize=\"large\" color=\"primary\" />\r\n                        AI Meal Planner\r\n                    </Typography>\r\n                    <Typography variant=\"body1\" color=\"text.secondary\">\r\n                        Personalized recipes based on your scan history.\r\n                    </Typography>\r\n                </Box>\r\n                <Button\r\n                    variant=\"contained\"\r\n                    startIcon={generating ? <CircularProgress size={20} color=\"inherit\" /> : <AutoAwesomeIcon />}\r\n                    onClick={generateNewPlan}\r\n                    disabled={generating}\r\n                >\r\n                    {generating ? 'Chef AI is Cooking...' : 'Generate New Plan'}\r\n                </Button>\r\n            </Box>\r\n\r\n            {loading ? (\r\n                <Box sx={{ display: 'flex', justifyContent: 'center', py: 10 }}>\r\n                    <CircularProgress />\r\n                </Box>\r\n            ) : plan.length === 0 ? (\r\n                <Paper sx={{ p: 5, textAlign: 'center', borderRadius: 4 }}>\r\n                    <Typography variant=\"h6\" gutterBottom>No meal plans yet.</Typography>\r\n                    <Typography color=\"text.secondary\" paragraph>\r\n                        Our AI needs to see what foods you like! Scan some items and then generate a plan.\r\n                    </Typography>\r\n                    <Button variant=\"outlined\" onClick={generateNewPlan}>Create My First Plan</Button>\r\n                </Paper>\r\n            ) : (\r\n                <Grid container spacing={3}>\r\n                    {plan.map((day, index) => (\r\n                        <Grid size={{ xs: 12, md: 4 }} key={index}>\r\n                            <Paper sx={{ p: 3, borderRadius: 3, height: '100%', position: 'relative', overflow: 'hidden' }}>\r\n                                <Box sx={{ position: 'absolute', top: 0, left: 0, width: '100%', height: 6, bgcolor: 'primary.main' }} />\r\n                                <Typography variant=\"h6\" fontWeight=\"bold\" gutterBottom>{day.day}</Typography>\r\n                                <Divider sx={{ mb: 2 }} />\r\n\r\n                                <Box sx={{ mb: 2 }}>\r\n                                    <Typography variant=\"caption\" color=\"text.secondary\" fontWeight=\"bold\">BREAKFAST</Typography>\r\n                                    <Typography variant=\"body2\">{day.meals.breakfast}</Typography>\r\n                                </Box>\r\n                                <Box sx={{ mb: 2 }}>\r\n                                    <Typography variant=\"caption\" color=\"text.secondary\" fontWeight=\"bold\">LUNCH</Typography>\r\n                                    <Typography variant=\"body2\">{day.meals.lunch}</Typography>\r\n                                </Box>\r\n                                <Box sx={{ mb: 2 }}>\r\n                                    <Typography variant=\"caption\" color=\"text.secondary\" fontWeight=\"bold\">DINNER</Typography>\r\n                                    <Typography variant=\"body2\">{day.meals.dinner}</Typography>\r\n                                </Box>\r\n\r\n                                <Box sx={{ mt: 2, p: 1.5, bgcolor: 'background.default', borderRadius: 2 }}>\r\n                                    <Typography variant=\"caption\" fontStyle=\"italic\" color=\"text.secondary\">\r\n                                        ≡ƒÆí {day.nutritionalSummary}\r\n                                    </Typography>\r\n                                </Box>\r\n                            </Paper>\r\n                        </Grid>\r\n                    ))}\r\n                </Grid>\r\n            )}\r\n        </Container>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\not-found.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":38,"column":64,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[1339,1527],"text":"\r\n                    The page you are looking for does not exist or has been moved.\r\n                    If you were looking for the search page, it&apos;s now Global Search!\r\n                "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[1339,1527],"text":"\r\n                    The page you are looking for does not exist or has been moved.\r\n                    If you were looking for the search page, it&lsquo;s now Global Search!\r\n                "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[1339,1527],"text":"\r\n                    The page you are looking for does not exist or has been moved.\r\n                    If you were looking for the search page, it&#39;s now Global Search!\r\n                "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[1339,1527],"text":"\r\n                    The page you are looking for does not exist or has been moved.\r\n                    If you were looking for the search page, it&rsquo;s now Global Search!\r\n                "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport { Box, Container, Typography, Button } from '@mui/material';\r\nimport { useRouter } from 'next/navigation';\r\nimport HomeIcon from '@mui/icons-material/Home';\r\nimport SearchIcon from '@mui/icons-material/Search';\r\n\r\nexport default function NotFound() {\r\n    const router = useRouter();\r\n\r\n    return (\r\n        <Box sx={{\r\n            minHeight: '100vh',\r\n            bgcolor: '#050505',\r\n            color: 'white',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            textAlign: 'center',\r\n            p: 3\r\n        }}>\r\n            <Container maxWidth=\"sm\">\r\n                <Typography variant=\"h1\" fontWeight=\"900\" sx={{\r\n                    fontSize: { xs: '6rem', md: '10rem' },\r\n                    background: 'linear-gradient(135deg, #6C63FF, #00F0FF)',\r\n                    WebkitBackgroundClip: 'text',\r\n                    WebkitTextFillColor: 'transparent',\r\n                    lineHeight: 1\r\n                }}>\r\n                    404\r\n                </Typography>\r\n                <Typography variant=\"h4\" fontWeight=\"bold\" sx={{ mb: 2 }}>\r\n                    Lost in the matrix?\r\n                </Typography>\r\n                <Typography variant=\"body1\" color=\"text.secondary\" paragraph sx={{ mb: 4 }}>\r\n                    The page you are looking for does not exist or has been moved.\r\n                    If you were looking for the search page, it's now Global Search!\r\n                </Typography>\r\n\r\n                <Box sx={{ display: 'flex', gap: 2, justifyContent: 'center', flexWrap: 'wrap' }}>\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        startIcon={<HomeIcon />}\r\n                        onClick={() => router.push('/')}\r\n                        sx={{\r\n                            bgcolor: '#6C63FF',\r\n                            '&:hover': { bgcolor: '#5a52d5' },\r\n                            borderRadius: 4,\r\n                            px: 3\r\n                        }}\r\n                    >\r\n                        Go Home\r\n                    </Button>\r\n                    <Button\r\n                        variant=\"outlined\"\r\n                        startIcon={<SearchIcon />}\r\n                        onClick={() => router.push('/global-search')}\r\n                        sx={{\r\n                            borderRadius: 4,\r\n                            borderColor: 'rgba(255,255,255,0.2)',\r\n                            color: 'white',\r\n                            px: 3,\r\n                            '&:hover': { borderColor: '#6C63FF', bgcolor: 'rgba(108, 99, 255, 0.1)' }\r\n                        }}\r\n                    >\r\n                        Global Search\r\n                    </Button>\r\n                </Box>\r\n            </Container>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircleIcon' is defined but never used.","line":22,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":23},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\page.tsx:44:9\n  42 |       const hasSeenWelcome = localStorage.getItem('truthlens_welcome_seen');\n  43 |       if (!hasSeenWelcome) {\n> 44 |         setShowWelcome(true);\n     |         ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  45 |       }\n  46 |     }\n  47 |   }, [loading, user]);","line":44,"column":9,"nodeType":null,"endLine":44,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * TruthLens Application\n * Developed by Youssef Boubli\n */\n'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Box, Container, Typography, Grid, Button, Card, CardContent, Chip, useTheme, useMediaQuery, IconButton } from '@mui/material';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '@/context/AuthContext';\nimport LoadingSpinner from '@/components/ui/LoadingSpinner';\nimport ScrollReveal from '@/components/animation/ScrollReveal';\nimport AnimatedButton from '@/components/ui/AnimatedButton';\n// Icons\nimport ArrowForwardIcon from '@mui/icons-material/ArrowForward';\nimport QrCodeScannerIcon from '@mui/icons-material/QrCodeScanner';\nimport VerifiedIcon from '@mui/icons-material/Verified';\nimport SpeedIcon from '@mui/icons-material/Speed';\nimport SmartToyIcon from '@mui/icons-material/SmartToy';\nimport HealthAndSafetyIcon from '@mui/icons-material/HealthAndSafety';\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\nimport StarIcon from '@mui/icons-material/Star';\nimport MenuIcon from '@mui/icons-material/Menu';\nimport CloseIcon from '@mui/icons-material/Close';\n// User Home Component\nimport UserHome from '@/components/user/UserHome';\nimport WelcomeModal from '@/components/ui/WelcomeModal';\n\nexport default function LandingPage() {\n  const router = useRouter();\n  const { t } = useTranslation();\n  const { user, userProfile, loading } = useAuth(); // Added userProfile\n  const theme = useTheme();\n  const isMobile = useMediaQuery(theme.breakpoints.down('md'));\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const [showWelcome, setShowWelcome] = useState(false);\n\n  // Check if user has seen welcome screen before\n  useEffect(() => {\n    if (!loading && !user) {\n      const hasSeenWelcome = localStorage.getItem('truthlens_welcome_seen');\n      if (!hasSeenWelcome) {\n        setShowWelcome(true);\n      }\n    }\n  }, [loading, user]);\n\n  // Admin Redirect: Admins should not see the user app (search, etc.)\n  useEffect(() => {\n    if (!loading && user && userProfile?.role === 'admin') {\n      router.replace('/admin');\n    }\n  }, [loading, user, userProfile, router]);\n\n  const handleCloseWelcome = () => {\n    setShowWelcome(false);\n    localStorage.setItem('truthlens_welcome_seen', 'true');\n  };\n\n  console.log('≡ƒöì DEBUG:', { loading, user: user ? 'logged in' : 'not logged in' });\n\n  if (loading) {\n    console.log('ΓÅ│ Still loading...');\n    return <LoadingSpinner fullScreen message=\"Loading TruthLens...\" />;\n  }\n\n  // If user is logged in...\n  if (user) {\n    // If Admin, show loading/spinner while redirect effect kicks in (or return null)\n    // Prevents flashing UserHome\n    if (userProfile?.role === 'admin') {\n      return <LoadingSpinner fullScreen message=\"Redirecting to Admin Dashboard...\" />;\n    }\n\n    console.log('Γ£à User logged in - rendering UserHome');\n    return <UserHome />;\n  }\n\n  console.log('≡ƒæñ No user - rendering Landing Page');\n\n\n  return (\n    <>\n      {/* Welcome Modal for first-time visitors */}\n      <WelcomeModal open={showWelcome} onClose={handleCloseWelcome} />\n\n      <Box sx={{ bgcolor: 'background.default', minHeight: '100vh', color: 'text.primary', overflowX: 'hidden' }}>\n\n        {/* Navigation */}\n        <Box sx={{\n          py: 2,\n          px: 3,\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'space-between',\n          position: 'fixed',\n          top: 0,\n          left: 0,\n          right: 0,\n          zIndex: 1000,\n          backdropFilter: 'blur(10px)',\n          bgcolor: 'rgba(10, 10, 10, 0.8)',\n          borderBottom: '1px solid rgba(255,255,255,0.05)'\n        }}>\n          <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n            <Box sx={{ width: 32, height: 32, bgcolor: 'primary.main', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\n              <QrCodeScannerIcon sx={{ fontSize: 20, color: 'white' }} />\n            </Box>\n            <Typography variant=\"h6\" fontWeight=\"bold\" sx={{ background: 'linear-gradient(45deg, #fff, #aaa)', backgroundClip: 'text', color: 'transparent' }}>\n              {t('brand_name')}\n            </Typography>\n          </Box>\n\n          {!isMobile ? (\n            <Box sx={{ display: 'flex', gap: 4, alignItems: 'center' }}>\n              <Button color=\"inherit\" onClick={() => document.getElementById('features')?.scrollIntoView({ behavior: 'smooth' })}>{t('nav_features')}</Button>\n              <Button color=\"inherit\" onClick={() => document.getElementById('pricing')?.scrollIntoView({ behavior: 'smooth' })}>{t('nav_pricing')}</Button>\n              <Button variant=\"outlined\" color=\"primary\" onClick={() => router.push('/login')}>{t('nav_login')}</Button>\n              <Button variant=\"contained\" color=\"primary\" onClick={() => router.push('/signup')}>{t('nav_get_started')}</Button>\n            </Box>\n          ) : (\n            <IconButton onClick={() => setMobileMenuOpen(!mobileMenuOpen)} color=\"inherit\">\n              {mobileMenuOpen ? <CloseIcon /> : <MenuIcon />}\n            </IconButton>\n          )}\n        </Box>\n\n        {/* Mobile Menu Overlay */}\n        {isMobile && mobileMenuOpen && (\n          <Box sx={{\n            position: 'fixed',\n            top: 64,\n            left: 0,\n            right: 0,\n            bottom: 0,\n            bgcolor: 'background.default',\n            zIndex: 999,\n            p: 4,\n            display: 'flex',\n            flexDirection: 'column',\n            gap: 2\n          }}>\n            <Button size=\"large\" color=\"inherit\" onClick={() => { setMobileMenuOpen(false); document.getElementById('features')?.scrollIntoView({ behavior: 'smooth' }); }}>Features</Button>\n            <Button size=\"large\" color=\"inherit\" onClick={() => { setMobileMenuOpen(false); document.getElementById('pricing')?.scrollIntoView({ behavior: 'smooth' }); }}>Pricing</Button>\n            <Button size=\"large\" variant=\"outlined\" onClick={() => router.push('/login')}>Login</Button>\n            <Button size=\"large\" variant=\"contained\" onClick={() => router.push('/signup')}>Get Started</Button>\n          </Box>\n        )}\n\n        {/* Hero Section */}\n        <Box sx={{\n          pt: { xs: 15, md: 20 },\n          pb: { xs: 10, md: 15 },\n          position: 'relative',\n          overflow: 'hidden'\n        }}>\n          {/* Background Elements */}\n          <Box sx={{\n            position: 'absolute',\n            top: '20%',\n            left: '50%',\n            transform: 'translate(-50%, -50%)',\n            width: '60vw',\n            height: '60vw',\n            bgcolor: 'primary.main',\n            opacity: 0.1,\n            filter: 'blur(100px)',\n            borderRadius: '50%',\n            zIndex: 0\n          }} />\n\n          <Container maxWidth=\"lg\" sx={{ position: 'relative', zIndex: 1 }}>\n            <Grid container spacing={6} alignItems=\"center\">\n              <Grid size={{ xs: 12, md: 6 }}>\n                <ScrollReveal>\n                  <Chip\n                    label={t('landing_new_feature')}\n                    color=\"primary\"\n                    sx={{ mb: 3, bgcolor: 'rgba(108, 99, 255, 0.1)', color: 'primary.light', border: '1px solid rgba(108, 99, 255, 0.2)' }}\n                  />\n                  <Typography\n                    variant=\"h1\"\n                    sx={{\n                      fontSize: { xs: '3rem', md: '4.5rem' },\n                      fontWeight: 900,\n                      lineHeight: 1.1,\n                      mb: 3,\n                      background: 'linear-gradient(135deg, #FFFFFF 0%, #AAAAAA 100%)',\n                      WebkitBackgroundClip: 'text',\n                      WebkitTextFillColor: 'transparent',\n                    }}\n                  >\n                    {t('landing_hero_title_1')} <br />\n                    <span style={{ color: '#6C63FF', WebkitTextFillColor: '#6C63FF' }}>{t('landing_hero_title_2')}</span>\n                  </Typography>\n                  <Typography variant=\"h5\" color=\"text.secondary\" paragraph sx={{ mb: 4, maxWidth: 500, lineHeight: 1.6 }}>\n                    {t('landing_hero_subtitle')}\n                  </Typography>\n\n                  <Box sx={{ display: 'flex', gap: 2, flexDirection: { xs: 'column', sm: 'row' } }}>\n                    <AnimatedButton\n                      variant=\"contained\"\n                      size=\"large\"\n                      endIcon={<ArrowForwardIcon />}\n                      onClick={() => router.push('/signup')}\n                      sx={{\n                        px: 4, py: 2, fontSize: '1.1rem',\n                        background: 'linear-gradient(90deg, #6C63FF 0%, #5a52d5 100%)',\n                        boxShadow: '0 0 30px rgba(108,99,255,0.4)'\n                      }}\n                    >\n                      {t('landing_cta_primary')}\n                    </AnimatedButton>\n                    <AnimatedButton\n                      variant=\"outlined\"\n                      size=\"large\"\n                      onClick={() => document.getElementById('demo')?.scrollIntoView({ behavior: 'smooth' })}\n                      sx={{ px: 4, py: 2, fontSize: '1.1rem', borderColor: 'rgba(255,255,255,0.2)', color: 'text.primary' }}\n                    >\n                      {t('landing_cta_secondary')}\n                    </AnimatedButton>\n                  </Box>\n                </ScrollReveal>\n              </Grid>\n              <Grid size={{ xs: 12, md: 6 }}>\n                <ScrollReveal delay={0.2}>\n                  <Box sx={{\n                    position: 'relative',\n                    '&::before': {\n                      content: '\"\"',\n                      position: 'absolute',\n                      inset: -20,\n                      background: 'conic-gradient(from 0deg, #6C63FF, transparent, #00F0FF, transparent, #6C63FF)',\n                      borderRadius: '30px',\n                      animation: 'spin 10s linear infinite',\n                      opacity: 0.3\n                    }\n                  }}>\n                    <Box sx={{\n                      bgcolor: '#111',\n                      borderRadius: '24px',\n                      border: '1px solid rgba(255,255,255,0.1)',\n                      p: 3,\n                      position: 'relative',\n                      boxShadow: '0 20px 50px rgba(0,0,0,0.5)'\n                    }}>\n                      {/* Mock UI for Scan Result */}\n                      <Box sx={{ display: 'flex', alignItems: 'center', mb: 3 }}>\n                        <Box sx={{ width: 60, height: 60, bgcolor: '#333', borderRadius: 2, mr: 2 }} />\n                        <Box>\n                          <Typography variant=\"h6\">Organic Granola</Typography>\n                          <Chip label=\"Grade A\" color=\"success\" size=\"small\" />\n                        </Box>\n                      </Box>\n                      <Box sx={{ mb: 2 }}>\n                        <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>Analysis</Typography>\n                        <Box sx={{ p: 2, bgcolor: 'rgba(76, 175, 80, 0.1)', borderRadius: 2, border: '1px solid rgba(76, 175, 80, 0.2)' }}>\n                          <Typography variant=\"body2\" color=\"success.light\">Γ£à Low Sugar ΓÇó High Fiber ΓÇó No Preservatives</Typography>\n                        </Box>\n                      </Box>\n                      <Box>\n                        <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>Health Impact</Typography>\n                        <Typography variant=\"caption\" color=\"text.secondary\">Excellent choice for maintaining stable blood sugar levels.</Typography>\n                      </Box>\n                    </Box>\n                  </Box>\n                </ScrollReveal>\n              </Grid>\n            </Grid>\n          </Container>\n        </Box>\n\n        {/* Features Grid */}\n        <Box id=\"features\" sx={{ py: 15, bgcolor: '#050505' }}>\n          <Container maxWidth=\"lg\">\n            <Typography variant=\"h2\" textAlign=\"center\" fontWeight=\"bold\" sx={{ mb: 8 }}>\n              {t('landing_features_title_1')} <span style={{ color: '#6C63FF' }}>{t('landing_features_title_2')}</span>\n            </Typography>\n            <Grid container spacing={4}>\n              {[\n                { icon: <QrCodeScannerIcon fontSize=\"large\" />, title: 'Instant Scan', desc: 'Point your camera and get results in under 2 seconds.' },\n                { icon: <SmartToyIcon fontSize=\"large\" />, title: 'AI Analysis', desc: 'Deep dive into ingredients with advanced Gemini AI models.' },\n                { icon: <VerifiedIcon fontSize=\"large\" />, title: 'Truth Grading', desc: 'Simple A-F grading system based on nutritional value.' },\n                { icon: <HealthAndSafetyIcon fontSize=\"large\" />, title: 'Allergen Alerts', desc: 'Customizable alerts for your specific dietary needs.' },\n                { icon: <SpeedIcon fontSize=\"large\" />, title: 'Performance', desc: 'Optimized for speed and low data usage.' },\n                { icon: <StarIcon fontSize=\"large\" />, title: 'Favorites', desc: 'Save products and build your healthy shopping list.' }\n              ].map((feature, i) => (\n                <Grid size={{ xs: 12, sm: 6, md: 4 }} key={i}>\n                  <ScrollReveal delay={i * 0.1}>\n                    <Card sx={{\n                      height: '100%',\n                      bgcolor: 'rgba(255,255,255,0.03)',\n                      border: '1px solid rgba(255,255,255,0.05)',\n                      transition: 'all 0.3s',\n                      '&:hover': {\n                        transform: 'translateY(-5px)',\n                        bgcolor: 'rgba(255,255,255,0.05)',\n                        borderColor: 'primary.main'\n                      }\n                    }}>\n                      <CardContent sx={{ p: 4 }}>\n                        <Box sx={{ color: 'primary.main', mb: 2 }}>{feature.icon}</Box>\n                        <Typography variant=\"h5\" gutterBottom fontWeight=\"bold\">{feature.title}</Typography>\n                        <Typography variant=\"body2\" color=\"text.secondary\">{feature.desc}</Typography>\n                      </CardContent>\n                    </Card>\n                  </ScrollReveal>\n                </Grid>\n              ))}\n            </Grid>\n          </Container>\n        </Box>\n\n        {/* CTA Section */}\n        <Box sx={{ py: 15, textAlign: 'center', position: 'relative', overflow: 'hidden' }}>\n          <Box sx={{\n            position: 'absolute',\n            bottom: 0,\n            left: 0,\n            right: 0,\n            height: '100%',\n            background: 'radial-gradient(circle at center, rgba(108,99,255,0.1) 0%, transparent 70%)',\n            pointerEvents: 'none'\n          }} />\n          <Container maxWidth=\"md\">\n            <ScrollReveal>\n              <Typography variant=\"h2\" fontWeight=\"bold\" gutterBottom>\n                {t('landing_footer_cta_title')}\n              </Typography>\n              <Typography variant=\"h5\" color=\"text.secondary\" sx={{ mb: 5 }}>\n                {t('landing_footer_cta_subtitle')}\n              </Typography>\n              <Button\n                variant=\"contained\"\n                size=\"large\"\n                onClick={() => router.push('/signup')}\n                sx={{\n                  px: 8,\n                  py: 2.5,\n                  fontSize: '1.2rem',\n                  borderRadius: '50px',\n                  background: 'white',\n                  color: 'black',\n                  '&:hover': { background: '#f0f0f0' }\n                }}\n              >\n                {t('landing_footer_cta_button')}\n              </Button>\n            </ScrollReveal>\n          </Container>\n        </Box>\n\n        {/* Footer */}\n        <Box sx={{ py: 4, textAlign: 'center', borderTop: '1px solid rgba(255,255,255,0.05)', bgcolor: '#050505' }}>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            ┬⌐ {new Date().getFullYear()} TruthLens. All rights reserved.\n          </Typography>\n        </Box>\n\n      </Box>\n\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\payment\\success\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getAuth' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createPaymentRequest' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userEmail' is assigned a value but never used.","line":33,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":66}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useSearchParams, useRouter } from 'next/navigation';\r\nimport { Box, Typography, Paper, CircularProgress } from '@mui/material';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport ErrorIcon from '@mui/icons-material/Error';\r\nimport { verifyStripeSession } from '@/app/actions/stripe';\r\nimport { getAuth } from 'firebase/auth'; // Handle client auth\r\nimport { createPaymentRequest } from '@/services/paymentService';\r\n\r\nfunction PaymentSuccessContent() {\r\n    const searchParams = useSearchParams();\r\n    const router = useRouter();\r\n    const sessionId = searchParams.get('session_id');\r\n    const [status, setStatus] = useState<'loading' | 'success' | 'error'>('loading');\r\n    const [message, setMessage] = useState('Verifying payment...');\r\n\r\n    useEffect(() => {\r\n        if (!sessionId) {\r\n            setStatus('error');\r\n            setMessage('Invalid session.');\r\n            return;\r\n        }\r\n\r\n        const verify = async () => {\r\n            try {\r\n                // 1. Verify with Stripe via Server Action\r\n                const result = await verifyStripeSession(sessionId);\r\n\r\n                if (result.success && result.metadata) {\r\n                    // 2. Metadata contains user info\r\n                    const { userId, tier, billingCycle, userEmail } = result.metadata;\r\n\r\n                    // Calling a new Server Action to finalize\r\n                    const upgradeResult = await finalizeUpgradeAction(\r\n                        userId,\r\n                        tier as 'plus' | 'pro' | 'ultimate',\r\n                        billingCycle as 'monthly' | 'lifetime'\r\n                    );\r\n\r\n                    if (upgradeResult.success) {\r\n                        setStatus('success');\r\n                    } else {\r\n                        throw new Error('Upgrade failed');\r\n                    }\r\n                } else {\r\n                    throw new Error('Payment verification failed.');\r\n                }\r\n            } catch (error) {\r\n                console.error(error);\r\n                setStatus('error');\r\n                setMessage('Verification failed. Please contact support if you were charged.');\r\n            }\r\n        };\r\n\r\n        verify();\r\n    }, [sessionId]);\r\n\r\n    if (status === 'loading') {\r\n        return (\r\n            <Box sx={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                <CircularProgress />\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    if (status === 'error') {\r\n        return (\r\n            <Box sx={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', p: 3 }}>\r\n                <Paper sx={{ p: 6, textAlign: 'center', maxWidth: 500 }}>\r\n                    <ErrorIcon sx={{ fontSize: 60, color: 'error.main', mb: 2 }} />\r\n                    <Typography variant=\"h5\" gutterBottom>Something went wrong</Typography>\r\n                    <Typography color=\"text.secondary\">{message}</Typography>\r\n                    <Typography\r\n                        variant=\"button\"\r\n                        sx={{ mt: 3, display: 'block', cursor: 'pointer', color: 'primary.main' }}\r\n                        onClick={() => router.push('/')}\r\n                    >\r\n                        Return Home\r\n                    </Typography>\r\n                </Paper>\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Box sx={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', p: 3 }}>\r\n            <Paper sx={{ p: 6, textAlign: 'center', maxWidth: 500 }}>\r\n                <CheckCircleIcon sx={{ fontSize: 80, color: 'success.main', mb: 3 }} />\r\n                <Typography variant=\"h4\" fontWeight=\"bold\" gutterBottom>Payment Successful!</Typography>\r\n                <Typography variant=\"body1\" color=\"text.secondary\" paragraph>\r\n                    Thank you for your purchase. Your account has been upgraded.\r\n                </Typography>\r\n                <Typography\r\n                    variant=\"button\"\r\n                    sx={{ mt: 2, display: 'block', cursor: 'pointer', color: 'primary.main', fontWeight: 'bold' }}\r\n                    onClick={() => router.push('/profile')}\r\n                >\r\n                    Go to Profile\r\n                </Typography>\r\n            </Paper>\r\n        </Box>\r\n    );\r\n}\r\n\r\nexport default function PaymentSuccessPage() {\r\n    return (\r\n        <React.Suspense fallback={\r\n            <Box sx={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                <CircularProgress />\r\n            </Box>\r\n        }>\r\n            <PaymentSuccessContent />\r\n        </React.Suspense>\r\n    );\r\n}\r\n\r\n// Inline Server Action helper for this file (or move to actions/stripe.ts)\r\n// Since this file is client, we can't define server action here directly unless mixed.\r\n// Better to export it from actions/stripe.ts.\r\nimport { finalizeUpgradeAction } from '@/app/actions/stripe';\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\pc-builder\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PCComponent' is defined but never used.","line":50,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":222,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8710,8713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8710,8713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":252,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":252,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9650,9653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9650,9653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * PC Builder Page\r\n * Main entry point for the PC Geek Builder feature\r\n */\r\n\r\n'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n    Box,\r\n    Container,\r\n    Typography,\r\n    Paper,\r\n    Slider,\r\n    TextField,\r\n    Button,\r\n    ToggleButton,\r\n    ToggleButtonGroup,\r\n    IconButton,\r\n    Chip,\r\n    LinearProgress,\r\n    Alert,\r\n    Snackbar,\r\n    Tooltip,\r\n    Divider,\r\n    Tabs,\r\n    Tab,\r\n    CircularProgress\r\n} from '@mui/material';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { auth, db } from '@/lib/firebase';\r\nimport { doc, onSnapshot } from 'firebase/firestore';\r\n\r\n// Icons\r\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\r\nimport AttachMoneyIcon from '@mui/icons-material/AttachMoney';\r\nimport MemoryIcon from '@mui/icons-material/Memory';\r\nimport RocketLaunchIcon from '@mui/icons-material/RocketLaunch';\r\nimport SaveIcon from '@mui/icons-material/Save';\r\nimport SpeedIcon from '@mui/icons-material/Speed';\r\nimport BoltIcon from '@mui/icons-material/Bolt';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport OpenInNewIcon from '@mui/icons-material/OpenInNew';\r\nimport EngineeringIcon from '@mui/icons-material/Engineering';\r\nimport AutoAwesomeIcon from '@mui/icons-material/AutoAwesome';\r\n\r\nimport BuildGeneratingView, { BuildStage } from '@/components/pc-builder/BuildGeneratingView';\r\nimport { SavedBuild, PCComponent, PCBuildRequest, HardwareInput } from '@/types/pcBuilder';\r\nimport ConsultationIntro from '@/components/pc-builder/consultation/ConsultationIntro';\r\nimport ConsultationForm from '@/components/pc-builder/consultation/ConsultationForm';\r\nimport ConsultationStatus from '@/components/pc-builder/consultation/ConsultationStatus';\r\nimport { verifyPaymentAndCreateRequest } from '@/app/actions/stripe';\r\n\r\n// Component display config\r\nconst componentConfig: Record<string, { label: string; color: string }> = {\r\n    cpu: { label: 'CPU', color: '#6C63FF' },\r\n    gpu: { label: 'GPU', color: '#00F0FF' },\r\n    ram: { label: 'RAM', color: '#10B981' },\r\n    motherboard: { label: 'Motherboard', color: '#F59E0B' },\r\n    psu: { label: 'PSU', color: '#EF4444' },\r\n    case: { label: 'Case', color: '#8B5CF6' },\r\n    storage: { label: 'Storage', color: '#EC4899' },\r\n    cooler: { label: 'Cooler', color: '#3B82F6' },\r\n};\r\n\r\nimport { Suspense } from 'react';\r\nimport LocationSelector from '@/components/profile/LocationSelector';\r\n\r\nfunction PCBuilderContent() {\r\n    const router = useRouter();\r\n    const searchParams = useSearchParams();\r\n    const { user, userProfile, features, loading: authLoading, tier } = useAuth();\r\n    const [activeTab, setActiveTab] = useState(0);\r\n\r\n    // Consultation State\r\n    const [consultationRequest, setConsultationRequest] = useState<PCBuildRequest | null>(null);\r\n    const [verifyingPayment, setVerifyingPayment] = useState(false);\r\n    const [paymentVerified, setPaymentVerified] = useState(false);\r\n\r\n    // AI Builder State\r\n    const [mode, setMode] = useState<'budget' | 'hardware'>('budget');\r\n    const [budget, setBudget] = useState<number>(1500);\r\n    const [hardwareInput, setHardwareInput] = useState<HardwareInput>({});\r\n    const [isGenerating, setIsGenerating] = useState(false);\r\n    const [stage, setStage] = useState<BuildStage>('drafting');\r\n    const [build, setBuild] = useState<SavedBuild | null>(null);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [saveSuccess, setSaveSuccess] = useState(false);\r\n\r\n    // Access check - use tier fallback\r\n    const hasAccess = features?.pcBuilder || tier === 'pro' || tier === 'ultimate';\r\n\r\n    // 1. Listen for Consultation Request Status\r\n    useEffect(() => {\r\n        if (!user) return;\r\n        const unsub = onSnapshot(doc(db, 'pc_build_requests', user.uid), (docSnap) => {\r\n            if (docSnap.exists()) {\r\n                setConsultationRequest(docSnap.data() as PCBuildRequest);\r\n            } else {\r\n                setConsultationRequest(null);\r\n            }\r\n        });\r\n        return () => unsub();\r\n    }, [user]);\r\n\r\n    // 2. Handle Payment Return\r\n    useEffect(() => {\r\n        const paymentStatus = searchParams.get('payment');\r\n        const sessionId = searchParams.get('session_id');\r\n\r\n        if (paymentStatus === 'success' && sessionId && !paymentVerified) {\r\n            setVerifyingPayment(true);\r\n            verifyPaymentAndCreateRequest(sessionId)\r\n                .then((res) => {\r\n                    if (res.success) {\r\n                        setPaymentVerified(true);\r\n                        setActiveTab(1); // Switch to Consultation tab\r\n                        // Clear URL params\r\n                        router.replace('/pc-builder');\r\n                    } else {\r\n                        setError('Payment verification failed.');\r\n                    }\r\n                })\r\n                .finally(() => setVerifyingPayment(false));\r\n        }\r\n    }, [searchParams, paymentVerified, router]);\r\n\r\n    if (authLoading) {\r\n        return (\r\n            <Box sx={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                <Typography color=\"text.secondary\">Loading...</Typography>\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    if (!user) {\r\n        router.push('/login');\r\n        return null;\r\n    }\r\n\r\n    if (!hasAccess) {\r\n        return (\r\n            <Box sx={{ minHeight: '100vh', bgcolor: 'background.default', pt: 4 }}>\r\n                <Container maxWidth=\"sm\">\r\n                    <Paper\r\n                        elevation={0}\r\n                        sx={{\r\n                            p: 4,\r\n                            textAlign: 'center',\r\n                            borderRadius: 4,\r\n                            border: '1px solid',\r\n                            borderColor: 'divider',\r\n                            background: 'linear-gradient(135deg, rgba(108, 99, 255, 0.05) 0%, rgba(0, 240, 255, 0.05) 100%)'\r\n                        }}\r\n                    >\r\n                        <MemoryIcon sx={{ fontSize: 60, color: '#6C63FF', mb: 2 }} />\r\n                        <Typography variant=\"h5\" fontWeight=\"bold\" gutterBottom>\r\n                            PC Geek Builder\r\n                        </Typography>\r\n                        <Typography color=\"text.secondary\" sx={{ mb: 3 }}>\r\n                            Build optimized PCs with AI-powered compatibility analysis and real-time pricing.\r\n                        </Typography>\r\n                        <Chip label=\"Pro / Ultimate Only\" color=\"warning\" sx={{ mb: 3 }} />\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            onClick={() => router.push('/upgrade')}\r\n                            sx={{\r\n                                background: 'linear-gradient(45deg, #6C63FF 30%, #00F0FF 90%)',\r\n                                px: 4\r\n                            }}\r\n                        >\r\n                            Upgrade Now\r\n                        </Button>\r\n                    </Paper>\r\n                </Container>\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    const handleGenerate = async () => {\r\n        setError(null);\r\n        setIsGenerating(true);\r\n        setStage('drafting');\r\n        setBuild(null);\r\n\r\n        try {\r\n            const token = await auth.currentUser?.getIdToken();\r\n            if (!token) throw new Error('Not authenticated');\r\n\r\n            // Simulate stage progression for UX\r\n            const stageTimer = setTimeout(() => setStage('pricing'), 3000);\r\n            const stageTimer2 = setTimeout(() => setStage('optimizing'), 7000);\r\n\r\n            const response = await fetch('/api/pc-builder/generate', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`\r\n                },\r\n                body: JSON.stringify({\r\n                    mode,\r\n                    budget: mode === 'budget' ? budget : undefined,\r\n                    existingHardware: mode === 'hardware' ? hardwareInput : undefined\r\n                })\r\n            });\r\n\r\n            clearTimeout(stageTimer);\r\n            clearTimeout(stageTimer2);\r\n\r\n            const data = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(data.error || 'Failed to generate build');\r\n            }\r\n\r\n            setStage('complete');\r\n            setBuild(data.build);\r\n\r\n        } catch (err: any) {\r\n            setError(err.message || 'An error occurred');\r\n        } finally {\r\n            setIsGenerating(false);\r\n        }\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        if (!build) return;\r\n\r\n        setIsSaving(true);\r\n        try {\r\n            const token = await auth.currentUser?.getIdToken();\r\n            if (!token) throw new Error('Not authenticated');\r\n\r\n            const response = await fetch('/api/pc-builder/save', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`\r\n                },\r\n                body: JSON.stringify(build)\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const data = await response.json();\r\n                throw new Error(data.error || 'Failed to save');\r\n            }\r\n\r\n            setSaveSuccess(true);\r\n        } catch (err: any) {\r\n            setError(err.message);\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n\r\n\r\n    const formatPrice = (price?: number) => {\r\n        if (!price) return 'N/A';\r\n        const currencyCode = userProfile?.preferences?.currency || 'USD';\r\n        const symbol = currencyCode === 'EUR' ? 'Γé¼' : '$';\r\n        return `${symbol}${price.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;\r\n    };\r\n\r\n    const renderConsultationTab = () => {\r\n        if (verifyingPayment) {\r\n            return (\r\n                <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', py: 10 }}>\r\n                    <CircularProgress sx={{ mb: 2 }} />\r\n                    <Typography>Verifying Payment...</Typography>\r\n                </Box>\r\n            );\r\n        }\r\n\r\n        // Logic flow:\r\n        // 1. No request OR status 'pending_payment' (if logic allows retrying) -> Show Intro\r\n        // 2. Status 'paid_pending_form' -> Show Form\r\n        // 3. Status 'submitted' or 'completed' -> Show Status\r\n\r\n        const status = consultationRequest?.status;\r\n\r\n        if (!consultationRequest || status === 'pending_payment') {\r\n            return <ConsultationIntro />;\r\n        }\r\n\r\n        if (status === 'paid_pending_form') {\r\n            return <ConsultationForm onSuccess={() => { }} />; // Firestore listener will auto-update UI to 'submitted'\r\n        }\r\n\r\n        return <ConsultationStatus request={consultationRequest} />;\r\n    };\r\n\r\n    return (\r\n        <Box sx={{ minHeight: '100vh', bgcolor: 'background.default', pb: 10 }}>\r\n            {/* Header */}\r\n            <Box\r\n                component={motion.div}\r\n                initial={{ opacity: 0, y: -20 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                sx={{\r\n                    pt: 2,\r\n                    pb: 3,\r\n                    px: 2,\r\n                    background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)',\r\n                    borderRadius: '0 0 24px 24px',\r\n                    mb: 3\r\n                }}\r\n            >\r\n                <Container maxWidth=\"md\">\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\r\n                        <IconButton onClick={() => router.back()} sx={{ color: 'white' }}>\r\n                            <ArrowBackIcon />\r\n                        </IconButton>\r\n                        <Box>\r\n                            <Typography variant=\"h5\" fontWeight=\"bold\" sx={{ color: 'white' }}>\r\n                                PC Geek Builder\r\n                            </Typography>\r\n                            <Typography variant=\"body2\" sx={{ color: 'rgba(255,255,255,0.6)' }}>\r\n                                Expert tools for your perfect rig\r\n                            </Typography>\r\n                        </Box>\r\n                    </Box>\r\n                </Container>\r\n            </Box>\r\n\r\n            <Container maxWidth=\"md\">\r\n                {/* Tabs */}\r\n                <Paper sx={{ mb: 4, borderRadius: 2 }}>\r\n                    <Tabs\r\n                        value={activeTab}\r\n                        onChange={(_, v) => setActiveTab(v)}\r\n                        variant=\"fullWidth\"\r\n                        indicatorColor=\"primary\"\r\n                        textColor=\"primary\"\r\n                    >\r\n                        <Tab icon={<AutoAwesomeIcon />} label=\"AI Auto-Build\" iconPosition=\"start\" />\r\n                        <Tab icon={<EngineeringIcon />} label=\"Request PC Build\" iconPosition=\"start\" />\r\n                    </Tabs>\r\n                </Paper>\r\n\r\n                <AnimatePresence mode=\"wait\">\r\n                    {/* Tab 0: AI Auto-Build */}\r\n                    {activeTab === 0 && (\r\n                        <motion.div\r\n                            key=\"ai-build\"\r\n                            initial={{ opacity: 0, x: -20 }}\r\n                            animate={{ opacity: 1, x: 0 }}\r\n                            exit={{ opacity: 0, x: -20 }}\r\n                            transition={{ duration: 0.2 }}\r\n                        >\r\n                            {/* Generating State */}\r\n                            {isGenerating && (\r\n                                <BuildGeneratingView stage={stage} />\r\n                            )}\r\n\r\n                            {/* Results View */}\r\n                            {build && !isGenerating && (\r\n                                <Box>\r\n                                    {/* Metrics Cards */}\r\n                                    <Box sx={{ display: 'flex', gap: 2, mb: 3, flexWrap: 'wrap' }}>\r\n                                        {/* Bottleneck Gauge */}\r\n                                        <Paper\r\n                                            elevation={0}\r\n                                            sx={{\r\n                                                flex: 1,\r\n                                                minWidth: 150,\r\n                                                p: 2,\r\n                                                borderRadius: 3,\r\n                                                border: '1px solid',\r\n                                                borderColor: 'divider',\r\n                                                textAlign: 'center'\r\n                                            }}\r\n                                        >\r\n                                            <SpeedIcon sx={{ fontSize: 32, color: build.metrics.bottleneckScore < 15 ? '#10B981' : build.metrics.bottleneckScore < 30 ? '#F59E0B' : '#EF4444' }} />\r\n                                            <Typography variant=\"h4\" fontWeight=\"bold\">\r\n                                                {build.metrics.bottleneckScore}%\r\n                                            </Typography>\r\n                                            <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                                Bottleneck Score\r\n                                            </Typography>\r\n                                            <LinearProgress\r\n                                                variant=\"determinate\"\r\n                                                value={100 - build.metrics.bottleneckScore}\r\n                                                sx={{\r\n                                                    mt: 1,\r\n                                                    height: 6,\r\n                                                    borderRadius: 3,\r\n                                                    bgcolor: 'rgba(0,0,0,0.1)',\r\n                                                    '& .MuiLinearProgress-bar': {\r\n                                                        bgcolor: build.metrics.bottleneckScore < 15 ? '#10B981' : build.metrics.bottleneckScore < 30 ? '#F59E0B' : '#EF4444'\r\n                                                    }\r\n                                                }}\r\n                                            />\r\n                                        </Paper>\r\n\r\n                                        {/* Power Usage */}\r\n                                        <Paper\r\n                                            elevation={0}\r\n                                            sx={{\r\n                                                flex: 1,\r\n                                                minWidth: 150,\r\n                                                p: 2,\r\n                                                borderRadius: 3,\r\n                                                border: '1px solid',\r\n                                                borderColor: 'divider',\r\n                                                textAlign: 'center'\r\n                                            }}\r\n                                        >\r\n                                            <BoltIcon sx={{ fontSize: 32, color: '#F59E0B' }} />\r\n                                            <Typography variant=\"h4\" fontWeight=\"bold\">\r\n                                                {build.metrics.estimatedWattage}W\r\n                                            </Typography>\r\n                                            <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                                Estimated Power\r\n                                            </Typography>\r\n                                        </Paper>\r\n\r\n                                        {/* Total Price */}\r\n                                        <Paper\r\n                                            elevation={0}\r\n                                            sx={{\r\n                                                flex: 1,\r\n                                                minWidth: 150,\r\n                                                p: 2,\r\n                                                borderRadius: 3,\r\n                                                border: '1px solid',\r\n                                                borderColor: 'divider',\r\n                                                textAlign: 'center',\r\n                                                background: 'linear-gradient(135deg, rgba(108, 99, 255, 0.1) 0%, rgba(0, 240, 255, 0.1) 100%)'\r\n                                            }}\r\n                                        >\r\n                                            <AttachMoneyIcon sx={{ fontSize: 32, color: '#6C63FF' }} />\r\n                                            <Typography variant=\"h4\" fontWeight=\"bold\">\r\n                                                {formatPrice(build.totalPrice)}\r\n                                            </Typography>\r\n                                            <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                                Total Price\r\n                                            </Typography>\r\n                                        </Paper>\r\n                                    </Box>\r\n\r\n                                    {/* Components List */}\r\n                                    <Paper\r\n                                        elevation={0}\r\n                                        sx={{\r\n                                            p: 2,\r\n                                            borderRadius: 3,\r\n                                            border: '1px solid',\r\n                                            borderColor: 'divider',\r\n                                            mb: 3\r\n                                        }}\r\n                                    >\r\n                                        <Typography variant=\"h6\" fontWeight=\"bold\" gutterBottom>\r\n                                            Components\r\n                                        </Typography>\r\n                                        <Divider sx={{ mb: 2 }} />\r\n\r\n                                        {Object.entries(build.components).map(([key, component]) => {\r\n                                            if (!component) return null;\r\n                                            const config = componentConfig[key];\r\n\r\n                                            return (\r\n                                                <Box\r\n                                                    key={key}\r\n                                                    component={motion.div}\r\n                                                    initial={{ opacity: 0, x: -20 }}\r\n                                                    animate={{ opacity: 1, x: 0 }}\r\n                                                    sx={{\r\n                                                        display: 'flex',\r\n                                                        alignItems: 'center',\r\n                                                        justifyContent: 'space-between',\r\n                                                        py: 1.5,\r\n                                                        borderBottom: '1px solid',\r\n                                                        borderColor: 'divider',\r\n                                                        '&:last-child': { borderBottom: 'none' }\r\n                                                    }}\r\n                                                >\r\n                                                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\r\n                                                        <Chip\r\n                                                            label={config?.label || key}\r\n                                                            size=\"small\"\r\n                                                            sx={{\r\n                                                                bgcolor: `${config?.color}20`,\r\n                                                                color: config?.color,\r\n                                                                fontWeight: 600,\r\n                                                                minWidth: 90\r\n                                                            }}\r\n                                                        />\r\n                                                        <Box>\r\n                                                            <Typography variant=\"body1\" fontWeight=\"500\">\r\n                                                                {component.brand} {component.name}\r\n                                                            </Typography>\r\n                                                            {component.priceUrl && (\r\n                                                                <Typography\r\n                                                                    variant=\"caption\"\r\n                                                                    color=\"text.secondary\"\r\n                                                                    sx={{ display: 'flex', alignItems: 'center', gap: 0.5 }}\r\n                                                                >\r\n                                                                    via {component.priceSource}\r\n                                                                    <Tooltip title=\"View source\">\r\n                                                                        <IconButton\r\n                                                                            size=\"small\"\r\n                                                                            href={component.priceUrl}\r\n                                                                            target=\"_blank\"\r\n                                                                            sx={{ p: 0 }}\r\n                                                                        >\r\n                                                                            <OpenInNewIcon sx={{ fontSize: 14 }} />\r\n                                                                        </IconButton>\r\n                                                                    </Tooltip>\r\n                                                                </Typography>\r\n                                                            )}\r\n                                                        </Box>\r\n                                                    </Box>\r\n                                                    <Typography\r\n                                                        variant=\"body1\"\r\n                                                        fontWeight=\"bold\"\r\n                                                        sx={{ color: component.price ? 'text.primary' : 'text.disabled' }}\r\n                                                    >\r\n                                                        {formatPrice(component.price)}\r\n                                                    </Typography>\r\n                                                </Box>\r\n                                            );\r\n                                        })}\r\n                                    </Paper>\r\n\r\n                                    {/* Actions */}\r\n                                    <Box sx={{ display: 'flex', gap: 2, flexWrap: 'wrap' }}>\r\n                                        <Button\r\n                                            variant=\"contained\"\r\n                                            startIcon={saveSuccess ? <CheckCircleIcon /> : <SaveIcon />}\r\n                                            onClick={handleSave}\r\n                                            disabled={isSaving || saveSuccess}\r\n                                            sx={{\r\n                                                flex: 1,\r\n                                                py: 1.5,\r\n                                                background: saveSuccess\r\n                                                    ? 'linear-gradient(45deg, #10B981 30%, #059669 90%)'\r\n                                                    : 'linear-gradient(45deg, #6C63FF 30%, #00F0FF 90%)'\r\n                                            }}\r\n                                        >\r\n                                            {saveSuccess ? 'Saved!' : isSaving ? 'Saving...' : 'Save to Profile'}\r\n                                        </Button>\r\n                                        <Button\r\n                                            variant=\"outlined\"\r\n                                            onClick={() => { setBuild(null); setStage('drafting'); }}\r\n                                            sx={{ flex: 1, py: 1.5 }}\r\n                                        >\r\n                                            New Build\r\n                                        </Button>\r\n                                    </Box>\r\n                                </Box>\r\n                            )}\r\n\r\n                            {/* Input Form */}\r\n                            {!build && !isGenerating && (\r\n                                <motion.div\r\n                                    key=\"form\"\r\n                                    initial={{ opacity: 0, y: 20 }}\r\n                                    animate={{ opacity: 1, y: 0 }}\r\n                                    exit={{ opacity: 0 }}\r\n                                >\r\n                                    {/* Location Selector */}\r\n                                    <LocationSelector />\r\n\r\n                                    {/* Mode Toggle */}\r\n                                    <Paper\r\n                                        elevation={0}\r\n                                        sx={{\r\n                                            p: 3,\r\n                                            borderRadius: 3,\r\n                                            border: '1px solid',\r\n                                            borderColor: 'divider',\r\n                                            mb: 3\r\n                                        }}\r\n                                    >\r\n                                        <Typography variant=\"subtitle2\" color=\"text.secondary\" gutterBottom>\r\n                                            Build Mode\r\n                                        </Typography>\r\n                                        <ToggleButtonGroup\r\n                                            value={mode}\r\n                                            exclusive\r\n                                            onChange={(_, v) => v && setMode(v)}\r\n                                            fullWidth\r\n                                            sx={{ mb: 3 }}\r\n                                        >\r\n                                            <ToggleButton value=\"budget\" sx={{ py: 1.5 }}>\r\n                                                <AttachMoneyIcon sx={{ mr: 1 }} />\r\n                                                Budget\r\n                                            </ToggleButton>\r\n                                            <ToggleButton value=\"hardware\" sx={{ py: 1.5 }}>\r\n                                                <MemoryIcon sx={{ mr: 1 }} />\r\n                                                Hardware\r\n                                            </ToggleButton>\r\n                                        </ToggleButtonGroup>\r\n\r\n                                        {/* Budget Mode */}\r\n                                        {mode === 'budget' && (\r\n                                            <Box>\r\n                                                <Typography variant=\"h4\" fontWeight=\"bold\" textAlign=\"center\" sx={{ mb: 2 }}>\r\n                                                    {formatPrice(budget)}\r\n                                                </Typography>\r\n                                                <Slider\r\n                                                    value={budget}\r\n                                                    onChange={(_, v) => setBudget(v as number)}\r\n                                                    min={500}\r\n                                                    max={10000}\r\n                                                    step={100}\r\n                                                    marks={[\r\n                                                        { value: 500, label: formatPrice(500) },\r\n                                                        { value: 2500, label: formatPrice(2500) },\r\n                                                        { value: 5000, label: formatPrice(5000) },\r\n                                                        { value: 10000, label: formatPrice(10000) }\r\n                                                    ]}\r\n                                                    sx={{\r\n                                                        '& .MuiSlider-track': {\r\n                                                            background: 'linear-gradient(90deg, #6C63FF 0%, #00F0FF 100%)'\r\n                                                        }\r\n                                                    }}\r\n                                                />\r\n                                            </Box>\r\n                                        )}\r\n\r\n                                        {/* Hardware Mode */}\r\n                                        {mode === 'hardware' && (\r\n                                            <Box>\r\n                                                <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 2 }}>\r\n                                                    Enter the components you already own. The AI will build around them.\r\n                                                </Typography>\r\n                                                <Box sx={{ display: 'grid', gridTemplateColumns: { xs: '1fr', sm: '1fr 1fr' }, gap: 2 }}>\r\n                                                    {[\r\n                                                        { key: 'cpu', label: 'CPU (Processor)', icon: '≡ƒºá' },\r\n                                                        { key: 'gpu', label: 'GPU (Graphics Card)', icon: '≡ƒÄ«' },\r\n                                                        { key: 'ram', label: 'RAM (Memory)', icon: '≡ƒÆ╛' },\r\n                                                        { key: 'motherboard', label: 'Motherboard', icon: '≡ƒöî' },\r\n                                                        { key: 'psu', label: 'PSU (Power Supply)', icon: 'ΓÜí' },\r\n                                                        { key: 'case', label: 'Case (Chassis)', icon: '≡ƒôª' },\r\n                                                        { key: 'storage', label: 'Storage (SSD/HDD)', icon: '≡ƒÆ┐' },\r\n                                                        { key: 'cooler', label: 'CPU Cooler', icon: 'Γ¥ä∩╕Å' }\r\n                                                    ].map((field) => (\r\n                                                        <TextField\r\n                                                            key={field.key}\r\n                                                            fullWidth\r\n                                                            label={field.label}\r\n                                                            placeholder={field.key === 'cpu' ? 'e.g., Ryzen 7 5800X' : field.key === 'gpu' ? 'e.g., RTX 3070' : 'Optional'}\r\n                                                            value={hardwareInput[field.key as keyof typeof hardwareInput] || ''}\r\n                                                            onChange={(e) => setHardwareInput(prev => ({ ...prev, [field.key]: e.target.value }))}\r\n                                                            InputProps={{\r\n                                                                startAdornment: <Box component=\"span\" sx={{ mr: 1, filter: 'grayscale(100%)', opacity: 0.7 }}>{field.icon}</Box>\r\n                                                            }}\r\n                                                            sx={{\r\n                                                                '& .MuiOutlinedInput-root': {\r\n                                                                    borderRadius: 2\r\n                                                                }\r\n                                                            }}\r\n                                                        />\r\n                                                    ))}\r\n                                                </Box>\r\n                                            </Box>\r\n                                        )}\r\n                                    </Paper>\r\n\r\n                                    {/* Generate Button */}\r\n                                    <Button\r\n                                        fullWidth\r\n                                        variant=\"contained\"\r\n                                        size=\"large\"\r\n                                        startIcon={<RocketLaunchIcon />}\r\n                                        onClick={handleGenerate}\r\n                                        disabled={mode === 'hardware' && !Object.values(hardwareInput).some(v => v?.trim())}\r\n                                        sx={{\r\n                                            py: 2,\r\n                                            fontSize: '1.1rem',\r\n                                            fontWeight: 'bold',\r\n                                            background: 'linear-gradient(45deg, #6C63FF 30%, #00F0FF 90%)',\r\n                                            borderRadius: 3,\r\n                                            '&:hover': {\r\n                                                background: 'linear-gradient(45deg, #5a52d5 30%, #00d4e0 90%)'\r\n                                            }\r\n                                        }}\r\n                                    >\r\n                                        Generate Build\r\n                                    </Button>\r\n\r\n                                    {error && (\r\n                                        <Alert severity=\"error\" sx={{ mt: 2 }}>\r\n                                            {error}\r\n                                        </Alert>\r\n                                    )}\r\n                                </motion.div>\r\n                            )}\r\n                        </motion.div>\r\n                    )}\r\n\r\n                    {/* Tab 1: Expert Consultation */}\r\n                    {activeTab === 1 && (\r\n                        <motion.div\r\n                            key=\"consultation\"\r\n                            initial={{ opacity: 0, x: 20 }}\r\n                            animate={{ opacity: 1, x: 0 }}\r\n                            exit={{ opacity: 0, x: 20 }}\r\n                            transition={{ duration: 0.2 }}\r\n                        >\r\n                            {renderConsultationTab()}\r\n                        </motion.div>\r\n                    )}\r\n                </AnimatePresence>\r\n            </Container>\r\n\r\n            {/* Success Snackbar */}\r\n            <Snackbar\r\n                open={saveSuccess}\r\n                autoHideDuration={3000}\r\n                onClose={() => setSaveSuccess(false)}\r\n                message=\"Build saved to your profile!\"\r\n            />\r\n        </Box>\r\n    );\r\n}\r\n\r\nexport default function PCBuilderPage() {\r\n    return (\r\n        <Suspense fallback={\r\n            <Box sx={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                <CircularProgress />\r\n            </Box>\r\n        }>\r\n            <PCBuilderContent />\r\n        </Suspense>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\product\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LinearProgress' is defined but never used.","line":4,"column":65,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":79},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tooltip' is defined but never used.","line":4,"column":81,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":88},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AutoAwesomeIcon' is defined but never used.","line":8,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getProductEcoScore' is defined but never used.","line":18,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'aiAnalysis' is assigned a value but never used.","line":44,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ecoScoreData' is assigned a value but never used.","line":46,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setEcoScoreData' is assigned a value but never used.","line":46,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ecoAnalyzing' is assigned a value but never used.","line":52,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setEcoAnalyzing' is assigned a value but never used.","line":52,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":41},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadProduct'. Either include it or remove the dependency array.","line":107,"column":8,"nodeType":"ArrayExpression","endLine":107,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [id, loadProduct]","fix":{"range":[5029,5033],"text":"[id, loadProduct]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":135,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6166,6169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6166,6169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":160,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7453,7456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7453,7456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":178,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8023,8026],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8023,8026],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":223,"column":17,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":223,"endColumn":30,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[10126,10139],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":234,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":234,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[10555,10568],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":262,"column":34,"nodeType":"Block","messageId":"tsIgnoreInsteadOfExpectError","endLine":262,"endColumn":50,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[11935,11951],"text":"/* @ts-expect-error */"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":263,"column":33,"nodeType":"JSXOpeningElement","endLine":267,"endColumn":35},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":305,"column":46,"nodeType":"Block","messageId":"tsIgnoreInsteadOfExpectError","endLine":305,"endColumn":62,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[14573,14589],"text":"/* @ts-expect-error */"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":307,"column":46,"nodeType":"Block","messageId":"tsIgnoreInsteadOfExpectError","endLine":307,"endColumn":62,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[14804,14820],"text":"/* @ts-expect-error */"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":416,"column":50,"nodeType":"Block","messageId":"tsIgnoreInsteadOfExpectError","endLine":416,"endColumn":66,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[24012,24028],"text":"/* @ts-expect-error */"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":418,"column":50,"nodeType":"Block","messageId":"tsIgnoreInsteadOfExpectError","endLine":418,"endColumn":66,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[24385,24401],"text":"/* @ts-expect-error */"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":420,"column":50,"nodeType":"Block","messageId":"tsIgnoreInsteadOfExpectError","endLine":420,"endColumn":66,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[24755,24771],"text":"/* @ts-expect-error */"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":422,"column":50,"nodeType":"Block","messageId":"tsIgnoreInsteadOfExpectError","endLine":422,"endColumn":66,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[25117,25133],"text":"/* @ts-expect-error */"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":428,"column":42,"nodeType":"Block","messageId":"tsIgnoreInsteadOfExpectError","endLine":428,"endColumn":58,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[25629,25645],"text":"/* @ts-expect-error */"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":437,"column":50,"nodeType":"Block","messageId":"tsIgnoreInsteadOfExpectError","endLine":437,"endColumn":66,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[26576,26592],"text":"/* @ts-expect-error */"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":440,"column":46,"nodeType":"Block","messageId":"tsIgnoreInsteadOfExpectError","endLine":440,"endColumn":62,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[26897,26913],"text":"/* @ts-expect-error */"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":455,"column":54,"nodeType":"Block","messageId":"tsIgnoreInsteadOfExpectError","endLine":455,"endColumn":70,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[28210,28226],"text":"/* @ts-expect-error */"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":483,"column":42,"nodeType":"Block","messageId":"tsIgnoreInsteadOfExpectError","endLine":483,"endColumn":58,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[30393,30409],"text":"/* @ts-expect-error */"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":501,"column":26,"nodeType":"Block","messageId":"tsIgnoreInsteadOfExpectError","endLine":501,"endColumn":42,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[31615,31631],"text":"/* @ts-expect-error */"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":18,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { Box, Container, Typography, Paper, Grid, Button, Chip, LinearProgress, Tooltip, Dialog, DialogTitle, DialogContent, Alert } from '@mui/material';\r\nimport FavoriteIcon from '@mui/icons-material/Favorite';\r\nimport FavoriteBorderIcon from '@mui/icons-material/FavoriteBorder';\r\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\r\nimport AutoAwesomeIcon from '@mui/icons-material/AutoAwesome';\r\nimport PublicIcon from '@mui/icons-material/Public';\r\nimport ViewInArIcon from '@mui/icons-material/ViewInAr';\r\nimport RestaurantMenuIcon from '@mui/icons-material/RestaurantMenu';\r\nimport ComputerIcon from '@mui/icons-material/Computer';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport CancelIcon from '@mui/icons-material/Cancel';\r\nimport { useParams, useRouter, useSearchParams } from 'next/navigation';\r\nimport { getProductAction, EnhancedProductData } from '@/app/actions';\r\nimport { analyzeProductByTier, AIAnalysis, analyzeIngredientsForHarmfulCompounds, AITruthDetectorResult, SustainabilityAnalysis, ARProductDetails, getARProductDetails, repairProductMetadata } from '@/services/aiService';\r\nimport { getProductEcoScore } from '@/services/sustainabilityService';\r\nimport { calculateSmartGrade, getGenericGrade, SmartGradeResult } from '@/services/gradingService';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { addToHistory } from '@/services/historyService';\r\nimport { addToFavorites, removeFromFavorites, checkIsFavorite } from '@/services/favoriteService';\r\nimport AITruthDetector from '@/components/product/AITruthDetector';\r\nimport UpgradePrompt from '@/components/subscription/UpgradePrompt';\r\nimport AdBanner from '@/components/ads/AdBanner';\r\nimport PageTransition from '@/components/animation/PageTransition';\r\nimport ScrollReveal from '@/components/animation/ScrollReveal';\r\nimport StaggerList from '@/components/animation/StaggerList';\r\nimport AnimatedButton from '@/components/ui/AnimatedButton';\r\nimport LoadingSpinner from '@/components/ui/LoadingSpinner';\r\nimport GradeDisplay from '@/components/features/GradeDisplay';\r\nimport ARProductVisualizer from '@/components/features/ARProductVisualizer';\r\nimport ProAnalysisView from '@/components/features/ProAnalysisView';\r\nimport TechScoreDisplay from '@/components/features/TechScoreDisplay';\r\n\r\nexport default function ProductDetailPage() {\r\n    const params = useParams();\r\n    const router = useRouter();\r\n    const { id } = params;\r\n\r\n    // UI States\r\n    const [loading, setLoading] = useState(true);\r\n    const [product, setProduct] = useState<EnhancedProductData | null>(null);\r\n    const [aiAnalysis, setAiAnalysis] = useState<AIAnalysis | null>(null);\r\n    const [truthDetectorResult, setTruthDetectorResult] = useState<AITruthDetectorResult | null>(null);\r\n    const [ecoScoreData, setEcoScoreData] = useState<SustainabilityAnalysis | null>(null);\r\n    const [arData, setArData] = useState<ARProductDetails | null>(null);\r\n    const [smartGrade, setSmartGrade] = useState<SmartGradeResult | null>(null);\r\n\r\n    // Analysis Loading States\r\n    const [analyzing, setAnalyzing] = useState(false);\r\n    const [ecoAnalyzing, setEcoAnalyzing] = useState(false);\r\n    const [arAnalyzing, setArAnalyzing] = useState(false);\r\n\r\n    // Interaction States\r\n    const [isFavorite, setIsFavorite] = useState(false);\r\n    const [favLoading, setFavLoading] = useState(false);\r\n    const [showAR, setShowAR] = useState(false);\r\n\r\n    // History Persistence State\r\n    const historySavedRef = useRef(false);\r\n\r\n    const { user, isPro, isFree, tier, features, dietaryPreferences } = useAuth();\r\n    const searchParams = useSearchParams();\r\n    const source = searchParams.get('source');\r\n\r\n    // Check Favorites Status\r\n    useEffect(() => {\r\n        if (user && id) {\r\n            checkIsFavorite(user.uid, String(id)).then(setIsFavorite);\r\n        }\r\n    }, [user, id]);\r\n\r\n    const handleToggleFavorite = async () => {\r\n        if (!user) {\r\n            router.push('/login');\r\n            return;\r\n        }\r\n        if (!product) return;\r\n\r\n        setFavLoading(true);\r\n        try {\r\n            if (isFavorite) {\r\n                await removeFromFavorites(user.uid, String(id));\r\n                setIsFavorite(false);\r\n            } else {\r\n                await addToFavorites(user.uid, {\r\n                    id: String(id),\r\n                    product_name: product.identity.name,\r\n                    image_front_small_url: product.media.thumbnail || product.media.front_image,\r\n                    brands: product.identity.brand,\r\n                });\r\n                setIsFavorite(true);\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to toggle favorite', error);\r\n        } finally {\r\n            setFavLoading(false);\r\n        }\r\n    };\r\n\r\n    // 1. Load Product Data (Independent of Auth)\r\n    useEffect(() => {\r\n        if (id) {\r\n            loadProduct(id as string);\r\n        }\r\n    }, [id]);\r\n\r\n    // 2. Save History (Dependent on Auth AND Product)\r\n    useEffect(() => {\r\n        if (user && product && !historySavedRef.current) {\r\n            const saveToHistory = async () => {\r\n                historySavedRef.current = true; // Prevent double saves\r\n                try {\r\n                    const type = (source === 'scan') ? 'scan' : 'search';\r\n                    console.log(`[History] Saving view type: ${type} for product: ${product.identity.name}`);\r\n\r\n                    await addToHistory(user.uid, {\r\n                        type: type as 'scan' | 'search',\r\n                        title: product.identity.name,\r\n                        grade: product.grades.nutri_score,\r\n                        productId: product.id\r\n                    });\r\n                } catch (e) {\r\n                    console.error(\"History Save Error:\", e);\r\n                    historySavedRef.current = false;\r\n                }\r\n            };\r\n            saveToHistory();\r\n        }\r\n    }, [user, product, source]);\r\n\r\n    const loadProduct = async (barcode: string) => {\r\n        setLoading(true);\r\n        let data: any = null;\r\n\r\n        // Check if this is an AI-generated ephemeral product\r\n        const isAiProduct = barcode.startsWith('ai_');\r\n        const query = searchParams.get('q');\r\n\r\n        if (isAiProduct && source === 'global-search' && query) {\r\n            console.log(`[ProductPage] Hydrating AI Product from query: ${query}`);\r\n            // Import dynamically or use the imported action\r\n            const { getAIProductAction } = await import('@/app/actions');\r\n            data = await getAIProductAction(query);\r\n        } else {\r\n            // Standard Barcode Fetch\r\n            data = await getProductAction(barcode);\r\n        }\r\n\r\n        if (data) {\r\n            setProduct(data);\r\n\r\n            // --- AI Auto-Repair Logic ---\r\n            if ((data.identity.brand === 'Unknown Brand' || data.identity.name === 'Unknown Product') && data.media.front_image && !isAiProduct) {\r\n                console.log(\"≡ƒöì [AI Repair] Detected unknown metadata. Attempting vision repair...\");\r\n                repairProductMetadata(data.media.front_image, data.identity.name).then(repaired => {\r\n                    if (repaired && repaired.brand && repaired.name) {\r\n                        console.log(\"Γ£à [AI Repair] Success:\", repaired);\r\n                        setProduct((prev: any) => prev ? ({\r\n                            ...prev,\r\n                            identity: {\r\n                                ...prev.identity,\r\n                                brand: repaired.brand,\r\n                                name: repaired.name\r\n                            }\r\n                        }) : null);\r\n                    }\r\n                });\r\n            }\r\n            // -----------------------------\r\n\r\n            performAiAnalysis(data);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    const performAiAnalysis = async (productData: any) => {\r\n        setAnalyzing(true);\r\n        try {\r\n            const analysis = await analyzeProductByTier(tier, productData.identity.name, productData.ingredients, productData.nutrition.nutriments_raw || {});\r\n            setAiAnalysis(analysis);\r\n\r\n            if (isPro && features.aiTruthDetector) {\r\n                // Feature Gate: Only run on consummables\r\n                const cat = (productData.identity.category || '').toLowerCase();\r\n                const isConsumable = ['food', 'medicine', 'beverage', 'snack', 'drink', 'supplement', 'drug'].some(c => cat.includes(c));\r\n\r\n                if (isConsumable && productData.ingredients && productData.ingredients.length > 0) {\r\n                    const truthResult = await analyzeIngredientsForHarmfulCompounds(productData.ingredients);\r\n                    setTruthDetectorResult(truthResult);\r\n                } else {\r\n                    setTruthDetectorResult(null);\r\n                }\r\n            }\r\n\r\n            // Smart Grade might need refactoring or we adapter it\r\n            // Passing flattened structure or adapting inside service. \r\n            // For now, let's skip strict Smart Grade calculation if it relies on old ProductData shape strictly,\r\n            // OR construct a compat object:\r\n            const compatProduct = {\r\n                ...productData,\r\n                name: productData.identity.name,\r\n                brand: productData.identity.brand,\r\n                nutrition_grades: productData.grades.nutri_score,\r\n                nutriments: productData.nutrition.nutriments_raw\r\n            };\r\n\r\n            if (isPro && features.smartGrading) {\r\n                setSmartGrade(calculateSmartGrade(compatProduct, dietaryPreferences));\r\n            } else {\r\n                setSmartGrade(getGenericGrade(compatProduct));\r\n            }\r\n        } catch (error) { console.error(error); }\r\n        setAnalyzing(false);\r\n    };\r\n\r\n    const handleARClick = async () => {\r\n        setShowAR(true);\r\n        if (!arData && product) {\r\n            setArAnalyzing(true);\r\n            try {\r\n                // @ts-ignore\r\n                const data = await getARProductDetails(product.identity.name, product.identity.category || 'Food');\r\n                setArData(data);\r\n            } catch (e) { console.error(\"AR Error\", e); }\r\n            setArAnalyzing(false);\r\n        }\r\n    };\r\n\r\n    if (loading) return <LoadingSpinner fullScreen />;\r\n    if (!product) return <Container sx={{ mt: 10 }}>Product not found.</Container>;\r\n\r\n    // @ts-ignore\r\n    const currentGrade = smartGrade?.grade || product.grades.nutri_score || '?';\r\n\r\n    return (\r\n        <PageTransition>\r\n            <Container maxWidth=\"lg\" sx={{ mt: 4, mb: 10 }}>\r\n                <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 2 }}>\r\n                    <AnimatedButton startIcon={<ArrowBackIcon />} onClick={() => router.back()} variant=\"text\" color=\"inherit\">\r\n                        Back\r\n                    </AnimatedButton>\r\n                    {/* AR Button */}\r\n                    {isPro && (\r\n                        <Button\r\n                            variant=\"outlined\"\r\n                            color=\"secondary\"\r\n                            startIcon={<ViewInArIcon />}\r\n                            onClick={handleARClick}\r\n                            sx={{ borderRadius: 3 }}\r\n                        >\r\n                            View in Space\r\n                        </Button>\r\n                    )}\r\n                </Box>\r\n\r\n                <Grid container spacing={4}>\r\n                    <Grid size={{ xs: 12, md: 5 }}>\r\n                        <ScrollReveal>\r\n                            <Paper elevation={4} sx={{ p: 2, borderRadius: 4, bgcolor: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', minHeight: 300, overflow: 'hidden' }}>\r\n                                {/* @ts-ignore */}\r\n                                <img\r\n                                    src={product.media.front_image || 'https://via.placeholder.com/400'}\r\n                                    alt={product.identity.name}\r\n                                    style={{ width: 'auto', height: 'auto', maxWidth: '100%', maxHeight: '450px', objectFit: 'contain' }}\r\n                                />\r\n                            </Paper>\r\n                        </ScrollReveal>\r\n                        <Box sx={{ mt: 3 }}>\r\n                            <AnimatedButton\r\n                                fullWidth\r\n                                variant=\"contained\"\r\n                                size=\"large\"\r\n                                startIcon={isFavorite ? <FavoriteIcon /> : <FavoriteBorderIcon />}\r\n                                onClick={handleToggleFavorite}\r\n                                color={isFavorite ? 'error' : 'primary'}\r\n                                disabled={favLoading}\r\n                                sx={{\r\n                                    py: 1.5,\r\n                                    fontWeight: 'bold',\r\n                                    borderRadius: 3,\r\n                                    boxShadow: isFavorite ? '0 8px 16px rgba(244, 67, 54, 0.3)' : '0 8px 16px rgba(108, 99, 255, 0.3)',\r\n                                    background: isFavorite ? undefined : 'linear-gradient(45deg, #6C63FF 30%, #5a52d5 90%)'\r\n                                }}\r\n                            >\r\n                                {isFavorite ? 'Saved to Favorites' : 'Add to Favorites'}\r\n                            </AnimatedButton>\r\n                        </Box>\r\n                    </Grid>\r\n\r\n                    <Grid size={{ xs: 12, md: 7 }}>\r\n                        <StaggerList staggerDelay={0.1}>\r\n                            {/* DYNAMIC HEADER & SCORE */}\r\n                            {(() => {\r\n                                const lowerCat = (product.identity.category || '').toLowerCase();\r\n                                const isTech = ['tech', 'electronic', 'hardware', 'laptop', 'gpu', 'phone', 'monitor', 'tv', 'watch', 'tablet', 'camera'].some(c => lowerCat.includes(c));\r\n\r\n                                // Tech Scoring Logic\r\n                                const techScore = product.analysis?.score || 0;\r\n\r\n                                return (\r\n                                    <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', mb: 3 }}>\r\n                                        <Box>\r\n                                            {/* @ts-ignore */}\r\n                                            <Typography variant=\"overline\" color=\"text.secondary\">{product.identity.brand} ΓÇó {product.identity.category}</Typography>\r\n                                            {/* @ts-ignore */}\r\n                                            <Typography variant=\"h3\" fontWeight=\"bold\" sx={{ lineHeight: 1.2 }}>{product.identity.name}</Typography>\r\n                                        </Box>\r\n                                        {/* Conditional Score Display */}\r\n                                        {isTech ? (\r\n                                            <TechScoreDisplay score={techScore} />\r\n                                        ) : (\r\n                                            <GradeDisplay grade={currentGrade} size=\"medium\" showDescription={false} />\r\n                                        )}\r\n                                    </Box>\r\n                                );\r\n                            })()}\r\n\r\n                            {/* DYNAMIC CONTENT SWITCHING BASED ON CATEGORY */}\r\n                            {(() => {\r\n                                const lowerCat = (product.identity.category || '').toLowerCase();\r\n                                const isTech = ['tech', 'electronic', 'hardware', 'laptop', 'gpu', 'phone', 'monitor', 'tv', 'watch', 'tablet', 'camera'].some(c => lowerCat.includes(c));\r\n\r\n                                if (isTech) {\r\n                                    // --- TECH VIEW ---\r\n                                    return (\r\n                                        <>\r\n                                            {/* Smart Grade Details */}\r\n                                            {smartGrade?.isPersonalized && (smartGrade.warnings.length > 0 || smartGrade.reasons.length > 0) && (\r\n                                                <Box sx={{ mb: 3 }}>\r\n                                                    {smartGrade.warnings.map((w, i) => (\r\n                                                        <Alert key={`warn-${i}`} severity=\"warning\" sx={{ mb: 1, borderRadius: 2 }}>{w}</Alert>\r\n                                                    ))}\r\n                                                    {smartGrade.reasons.map((r, i) => (\r\n                                                        <Alert key={`reason-${i}`} severity=\"success\" sx={{ mb: 1, borderRadius: 2 }}>{r}</Alert>\r\n                                                    ))}\r\n                                                </Box>\r\n                                            )}\r\n\r\n                                            {/* Tech Specs Card */}\r\n                                            {product.specs && Object.keys(product.specs).length > 0 && (\r\n                                                <Paper variant=\"outlined\" sx={{ p: 3, mb: 3, borderRadius: 3, bgcolor: 'background.paper', borderColor: 'divider' }}>\r\n                                                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5, mb: 2 }}>\r\n                                                        <ComputerIcon color=\"primary\" />\r\n                                                        <Typography variant=\"h6\" fontWeight=\"bold\">Technical Specifications</Typography>\r\n                                                    </Box>\r\n                                                    <Grid container spacing={2}>\r\n                                                        {Object.entries(product.specs).map(([key, value]) => (\r\n                                                            <Grid size={{ xs: 12, sm: 6 }} key={key}>\r\n                                                                <Box sx={{ display: 'flex', justifyContent: 'space-between', borderBottom: '1px solid', borderColor: 'divider', pb: 1 }}>\r\n                                                                    <Typography variant=\"body2\" color=\"text.secondary\">{key}</Typography>\r\n                                                                    <Typography variant=\"body2\" fontWeight=\"600\">{value}</Typography>\r\n                                                                </Box>\r\n                                                            </Grid>\r\n                                                        ))}\r\n                                                    </Grid>\r\n                                                </Paper>\r\n                                            )}\r\n\r\n                                            {/* Analysis / Verdict Card */}\r\n                                            {product.analysis && (\r\n                                                <Paper sx={{ p: 3, mb: 3, borderRadius: 3, background: 'linear-gradient(135deg, rgba(108, 99, 255, 0.05) 0%, rgba(108, 99, 255, 0.1) 100%)', border: '1px solid rgba(108, 99, 255, 0.2)' }}>\r\n                                                    <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', mb: 2 }}>\r\n                                                        <Typography variant=\"h6\" fontWeight=\"bold\">Antigravity Verdict</Typography>\r\n                                                        {product.analysis.verdict && (\r\n                                                            <Chip\r\n                                                                label={product.analysis.verdict.toUpperCase()}\r\n                                                                color={product.analysis.verdict === 'Buy' ? 'success' : product.analysis.verdict === 'Pass' ? 'error' : 'warning'}\r\n                                                                sx={{ fontWeight: 'bold' }}\r\n                                                            />\r\n                                                        )}\r\n                                                    </Box>\r\n                                                    <Typography variant=\"body1\" sx={{ mb: 2 }}>{product.analysis.verdict_text}</Typography>\r\n\r\n                                                    <Grid container spacing={2}>\r\n                                                        <Grid size={{ xs: 12, md: 6 }}>\r\n                                                            <Typography variant=\"subtitle2\" color=\"success.main\" fontWeight=\"bold\" gutterBottom>PROS</Typography>\r\n                                                            {product.analysis.pros?.map((pro, i) => (\r\n                                                                <Box key={i} sx={{ display: 'flex', gap: 1, mb: 0.5 }}>\r\n                                                                    <CheckCircleIcon color=\"success\" fontSize=\"small\" />\r\n                                                                    <Typography variant=\"body2\">{pro}</Typography>\r\n                                                                </Box>\r\n                                                            ))}\r\n                                                        </Grid>\r\n                                                        <Grid size={{ xs: 12, md: 6 }}>\r\n                                                            <Typography variant=\"subtitle2\" color=\"error.main\" fontWeight=\"bold\" gutterBottom>CONS</Typography>\r\n                                                            {product.analysis.cons?.map((con, i) => (\r\n                                                                <Box key={i} sx={{ display: 'flex', gap: 1, mb: 0.5 }}>\r\n                                                                    <CancelIcon color=\"error\" fontSize=\"small\" />\r\n                                                                    <Typography variant=\"body2\">{con}</Typography>\r\n                                                                </Box>\r\n                                                            ))}\r\n                                                        </Grid>\r\n                                                    </Grid>\r\n\r\n                                                    {product.analysis.price_analysis && (\r\n                                                        <Box sx={{ mt: 2, pt: 2, borderTop: '1px dashed', borderColor: 'divider' }}>\r\n                                                            <Typography variant=\"caption\" color=\"text.secondary\" fontWeight=\"bold\">PRICE ANALYSIS</Typography>\r\n                                                            <Typography variant=\"body2\">{product.analysis.price_analysis}</Typography>\r\n                                                        </Box>\r\n                                                    )}\r\n                                                </Paper>\r\n                                            )}\r\n                                        </>\r\n                                    );\r\n                                }\r\n\r\n                                // --- DEFAULT (FOOD) VIEW ---\r\n                                return (\r\n                                    <>\r\n                                        {/* NUTRITION & SENSORY SECTION */}\r\n                                        <Paper variant=\"outlined\" sx={{ p: 3, mb: 3, borderRadius: 3, bgcolor: 'background.paper', borderColor: 'divider' }}>\r\n                                            <Typography variant=\"h6\" gutterBottom>Nutrition Facts</Typography>\r\n                                            <Grid container spacing={2}>\r\n                                                {/* @ts-ignore */}\r\n                                                <Grid size={{ xs: 6, sm: 3 }}><Typography variant=\"subtitle2\" color=\"text.secondary\">Energy</Typography><Typography variant=\"body1\" fontWeight=\"bold\">{product.nutrition.calories_100g ? `${product.nutrition.calories_100g} kcal` : 'N/A'}</Typography></Grid>\r\n                                                {/* @ts-ignore */}\r\n                                                <Grid size={{ xs: 6, sm: 3 }}><Typography variant=\"subtitle2\" color=\"text.secondary\">Protein</Typography><Typography variant=\"body1\" fontWeight=\"bold\">{product.nutrition.proteins_100g ? `${product.nutrition.proteins_100g}g` : 'N/A'}</Typography></Grid>\r\n                                                {/* @ts-ignore */}\r\n                                                <Grid size={{ xs: 6, sm: 3 }}><Typography variant=\"subtitle2\" color=\"text.secondary\">Carbs</Typography><Typography variant=\"body1\" fontWeight=\"bold\">{product.nutrition.carbs_100g ? `${product.nutrition.carbs_100g}g` : 'N/A'}</Typography></Grid>\r\n                                                {/* @ts-ignore */}\r\n                                                <Grid size={{ xs: 6, sm: 3 }}><Typography variant=\"subtitle2\" color=\"text.secondary\">Fat</Typography><Typography variant=\"body1\" fontWeight=\"bold\">{product.nutrition.fat_100g ? `${product.nutrition.fat_100g}g` : 'N/A'}</Typography></Grid>\r\n                                            </Grid>\r\n                                        </Paper>\r\n\r\n                                        {/* Eco Score */}\r\n                                        {/* @ts-ignore */}\r\n                                        <Paper sx={{ p: 3, mb: 3, borderRadius: 3, bgcolor: '#f0fdf4', border: '1px solid #bbf7d0' }}>\r\n                                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>\r\n                                                <PublicIcon color=\"success\" />\r\n                                                <Typography variant=\"h6\" fontWeight=\"bold\" color=\"success.dark\">Sustainability Impact</Typography>\r\n                                            </Box>\r\n                                            {/* We can use product.grades.eco_score directly now */}\r\n                                            <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', mb: 1 }}>\r\n                                                <Typography variant=\"subtitle2\">Eco-Score Grade</Typography>\r\n                                                {/* @ts-ignore */}\r\n                                                <Chip label={product.grades.eco_score} color={product.grades.eco_score === 'A' || product.grades.eco_score === 'B' ? 'success' : 'warning'} size=\"small\" />\r\n                                            </Box>\r\n                                            {/* @ts-ignore */}\r\n                                            <Typography variant=\"caption\" color=\"text.secondary\">NOVA Group: {product.grades.processing_score}</Typography>\r\n                                        </Paper>\r\n\r\n                                        {/* Ingredients */}\r\n                                        <Paper variant=\"outlined\" sx={{ p: 3, borderRadius: 3, mt: 4, bgcolor: 'background.paper', position: 'relative', overflow: 'hidden' }}>\r\n                                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5, mb: 3 }}>\r\n                                                <Box sx={{ p: 1, borderRadius: '50%', bgcolor: 'primary.light', color: 'primary.main', display: 'flex' }}>\r\n                                                    <RestaurantMenuIcon />\r\n                                                </Box>\r\n                                                <Typography variant=\"h6\" fontWeight=\"bold\">Ingredients Breakdown</Typography>\r\n                                            </Box>\r\n\r\n                                            {product.ingredients && product.ingredients.length > 0 ? (\r\n                                                <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1 }}>\r\n                                                    {/* @ts-ignore */}\r\n                                                    {product.ingredients.map((ingredient: string, i: number) => (\r\n                                                        <Chip\r\n                                                            key={i}\r\n                                                            label={ingredient}\r\n                                                            sx={{\r\n                                                                bgcolor: i % 2 === 0 ? 'rgba(108, 99, 255, 0.05)' : 'rgba(0, 240, 255, 0.05)',\r\n                                                                color: 'text.primary',\r\n                                                                border: '1px solid',\r\n                                                                borderColor: 'divider',\r\n                                                                '&:hover': {\r\n                                                                    bgcolor: 'primary.light',\r\n                                                                    color: 'white',\r\n                                                                    borderColor: 'primary.main'\r\n                                                                },\r\n                                                                transition: 'all 0.2s'\r\n                                                            }}\r\n                                                        />\r\n                                                    ))}\r\n                                                </Box>\r\n                                            ) : (\r\n                                                <Box sx={{ textAlign: 'center', py: 4, bgcolor: 'rgba(0,0,0,0.02)', borderRadius: 2 }}>\r\n                                                    <Typography variant=\"body2\" color=\"text.secondary\">No ingredients details available</Typography>\r\n                                                </Box>\r\n                                            )}\r\n                                        </Paper>\r\n\r\n                                        {/* Deep Analysis (Antigravity AI) */}\r\n                                        {/* @ts-ignore */}\r\n                                        {isPro && <ProAnalysisView productName={product.identity.name} productBrand={product.identity.brand} />}\r\n\r\n                                        {isPro && truthDetectorResult && <ScrollReveal><Box sx={{ mb: 3 }}><AITruthDetector result={truthDetectorResult} loading={analyzing} /></Box></ScrollReveal>}\r\n                                        {isFree && <ScrollReveal><Box sx={{ mb: 3 }}><UpgradePrompt feature=\"AI Truth Detector\" variant=\"compact\" /></Box></ScrollReveal>}\r\n                                    </>\r\n                                );\r\n                            })()}\r\n                        </StaggerList>\r\n                    </Grid>\r\n                </Grid>\r\n\r\n                {/* AR Dialog */}\r\n                <Dialog open={showAR} onClose={() => setShowAR(false)} maxWidth=\"sm\" fullWidth PaperProps={{ sx: { borderRadius: 4, bgcolor: '#1a1a2e', color: 'white' } }}>\r\n                    <DialogTitle sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                        <ViewInArIcon color=\"secondary\" /> AR Spatial Preview\r\n                    </DialogTitle>\r\n                    <DialogContent>\r\n                        {/* @ts-ignore */}\r\n                        <ARProductVisualizer data={arData} loading={arAnalyzing} imageUrl={product.media.front_image} />\r\n                        <Typography variant=\"caption\" color=\"gray\" sx={{ display: 'block', mt: 2, textAlign: 'center' }}>\r\n                            Powered by Sambanova & Cerebras Vision AI\r\n                        </Typography>\r\n                    </DialogContent>\r\n                </Dialog>\r\n\r\n                {isFree && features.adsEnabled && <AdBanner position=\"bottom\" />}\r\n            </Container>\r\n        </PageTransition>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\profile\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\profile\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CircularProgress' is defined but never used.","line":5,"column":71,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":87},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Chip' is defined but never used.","line":5,"column":89,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":93},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Autocomplete' is defined but never used.","line":6,"column":86,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":98},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'StarIcon' is defined but never used.","line":9,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AutoAwesomeIcon' is defined but never used.","line":12,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userProfile' is assigned a value but never used.","line":38,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":79,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":79,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport {\r\n    Box, Button, Container, Typography, Paper, Avatar, Grid, Divider, CircularProgress, Chip,\r\n    Alert, Dialog, DialogTitle, DialogContent, DialogActions, TextField, IconButton, Autocomplete\r\n} from '@mui/material';\r\nimport PersonIcon from '@mui/icons-material/Person';\r\nimport StarIcon from '@mui/icons-material/Star';\r\nimport VerifiedIcon from '@mui/icons-material/Verified';\r\nimport CloseIcon from '@mui/icons-material/Close';\r\nimport AutoAwesomeIcon from '@mui/icons-material/AutoAwesome';\r\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\r\nimport { Badge } from '@mui/material';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { useRouter } from 'next/navigation';\r\nimport { updateDietaryPreferences } from '@/services/subscriptionService';\r\nimport { updateUserProfile, updateUserPassword } from '@/services/userService';\r\nimport { DietaryPreferences } from '@/types/user';\r\nimport Footer from '@/components/layout/Footer';\r\nimport PageTransition from '@/components/animation/PageTransition';\r\nimport ScrollReveal from '@/components/animation/ScrollReveal';\r\nimport AnimatedButton from '@/components/ui/AnimatedButton';\r\nimport LoadingSpinner from '@/components/ui/LoadingSpinner';\r\nimport AiPreferenceOnboarding from '@/components/features/AiPreferenceOnboarding';\r\nimport ThemeSelector from '@/components/theme/ThemeSelector';\r\nimport DietaryPreferencesSection from '@/components/user/DietaryPreferencesSection';\r\nimport TierBadge from '@/components/subscription/TierBadge';\r\n// import ApiKeyManager from '@/components/settings/ApiKeyManager';\r\n// import AIChatSettings from '@/components/settings/AIChatSettings';\r\n// import LanguageSelector from '@/components/profile/LanguageSelector';\r\n// import LocationSelector from '@/components/profile/LocationSelector';\r\n// import NotificationsSection from '@/components/profile/NotificationsSection';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nexport default function ProfilePage() {\r\n    const { t } = useTranslation();\r\n    const { user, userProfile, loading, logout, isPro, isFree, tier, refreshProfile, dietaryPreferences } = useAuth();\r\n    const router = useRouter();\r\n    const [savingPreferences, setSavingPreferences] = useState(false);\r\n    const [preferences, setPreferences] = useState<DietaryPreferences>(dietaryPreferences);\r\n\r\n    // Edit Profile State\r\n    const [openEditProfile, setOpenEditProfile] = useState(false);\r\n    const [newName, setNewName] = useState(user?.displayName || '');\r\n    const [newPhoto, setNewPhoto] = useState(user?.photoURL || '');\r\n    const [savingProfile, setSavingProfile] = useState(false);\r\n\r\n    // Change Password State\r\n    const [openChangePassword, setOpenChangePassword] = useState(false);\r\n    const [newPassword, setNewPassword] = useState('');\r\n    const [confirmPassword, setConfirmPassword] = useState('');\r\n    const [passwordError, setPasswordError] = useState('');\r\n    const [savingPassword, setSavingPassword] = useState(false);\r\n\r\n    // AI Onboarding State\r\n    const [openAiOnboarding, setOpenAiOnboarding] = useState(false);\r\n\r\n    if (loading) return <LoadingSpinner fullScreen />;\r\n\r\n    if (!user) {\r\n        router.push('/login');\r\n        return null;\r\n    }\r\n\r\n    // --- Handlers ---\r\n\r\n    const handlePreferenceChange = (key: keyof DietaryPreferences) => {\r\n        setPreferences(prev => ({ ...prev, [key]: !prev[key] }));\r\n    };\r\n\r\n    const handleSavePreferences = async () => {\r\n        if (!user || !isPro) return;\r\n        setSavingPreferences(true);\r\n        try {\r\n            await updateDietaryPreferences(user.uid, preferences);\r\n            await refreshProfile();\r\n            alert('Dietary preferences saved successfully!');\r\n        } catch (error) {\r\n            alert('Failed to save preferences');\r\n        } finally {\r\n            setSavingPreferences(false);\r\n        }\r\n    };\r\n\r\n    const handleUpdateProfile = async () => {\r\n        if (!user) return;\r\n        setSavingProfile(true);\r\n        const result = await updateUserProfile(user, newName, newPhoto);\r\n        if (result.success) {\r\n            await refreshProfile();\r\n            setOpenEditProfile(false);\r\n        } else {\r\n            alert('Failed to update profile: ' + result.error);\r\n        }\r\n        setSavingProfile(false);\r\n    };\r\n\r\n    const handleChangePassword = async () => {\r\n        if (!user) return;\r\n        if (newPassword !== confirmPassword) {\r\n            setPasswordError(\"Passwords do not match\");\r\n            return;\r\n        }\r\n        if (newPassword.length < 6) {\r\n            setPasswordError(\"Password must be at least 6 characters\");\r\n            return;\r\n        }\r\n\r\n        setSavingPassword(true);\r\n        setPasswordError('');\r\n        const result = await updateUserPassword(user, newPassword);\r\n        if (result.success) {\r\n            alert('Password updated successfully!');\r\n            setOpenChangePassword(false);\r\n            setNewPassword('');\r\n            setConfirmPassword('');\r\n        } else {\r\n            if (result.code === 'auth/requires-recent-login') {\r\n                alert('For security, please sign out and sign in again to change your password.');\r\n            } else {\r\n                setPasswordError(result.error || 'Failed to update password');\r\n            }\r\n        }\r\n        setSavingPassword(false);\r\n    };\r\n\r\n    return (\r\n        <PageTransition>\r\n            <Container maxWidth=\"md\" sx={{ mt: 5, mb: 4 }}>\r\n                <Box sx={{ mb: 2 }}>\r\n                    <Button\r\n                        startIcon={<ArrowBackIcon />}\r\n                        onClick={() => router.push('/')}\r\n                        sx={{ color: 'text.secondary', '&:hover': { color: 'primary.main', bgcolor: 'transparent' } }}\r\n                    >\r\n                        Back to Home\r\n                    </Button>\r\n                </Box>\r\n                <ScrollReveal>\r\n                    <Paper sx={{ p: { xs: 3, md: 4 }, mb: 4, borderRadius: 4 }}>\r\n                        <Box sx={{\r\n                            display: 'flex',\r\n                            flexDirection: { xs: 'column', sm: 'row' },\r\n                            alignItems: 'center',\r\n                            textAlign: { xs: 'center', sm: 'left' },\r\n                            gap: 3,\r\n                            mb: 4\r\n                        }}>\r\n                            <Badge\r\n                                overlap=\"circular\"\r\n                                anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}\r\n                                badgeContent={\r\n                                    isPro ? (\r\n                                        <VerifiedIcon\r\n                                            color=\"primary\"\r\n                                            sx={{\r\n                                                fontSize: 32,\r\n                                                bgcolor: 'background.paper',\r\n                                                borderRadius: '50%',\r\n                                                border: '2px solid background.paper'\r\n                                            }}\r\n                                        />\r\n                                    ) : null\r\n                                }\r\n                            >\r\n                                <Avatar src={user.photoURL || '/icons/icon-192x192.png'} sx={{ width: 80, height: 80 }}>\r\n                                    {!user.photoURL && <PersonIcon sx={{ fontSize: 50, opacity: 0 }} />}\r\n                                </Avatar>\r\n                            </Badge>\r\n\r\n                            <Box sx={{ flex: 1, width: { xs: '100%', sm: 'auto' } }}>\r\n                                <Typography variant=\"h4\" fontWeight=\"bold\">{user.displayName || 'User'}</Typography>\r\n                                <Typography variant=\"body1\" color=\"text.secondary\">{user.email}</Typography>\r\n                                {!user.emailVerified && <Typography variant=\"caption\" color=\"warning.main\">Email not verified</Typography>}\r\n                            </Box>\r\n\r\n                            <TierBadge tier={tier} size=\"medium\" sx={{ fontSize: '1rem', py: 2, px: 2 }} />\r\n                        </Box>\r\n\r\n                        <Divider sx={{ mb: 4 }} />\r\n\r\n                        <Grid container spacing={4}>\r\n                            <Grid size={{ xs: 12, md: 12 }}>\r\n                                <Typography variant=\"h6\" gutterBottom fontWeight=\"bold\">{t('profile_settings_title')}</Typography>\r\n                                <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>\r\n                                    <AnimatedButton\r\n                                        variant=\"outlined\"\r\n                                        color=\"primary\"\r\n                                        onClick={() => {\r\n                                            setNewName(user.displayName || '');\r\n                                            setNewPhoto(user.photoURL || '');\r\n                                            setOpenEditProfile(true);\r\n                                        }}\r\n                                    >\r\n                                        Update Profile\r\n                                    </AnimatedButton>\r\n                                    <AnimatedButton\r\n                                        variant=\"outlined\"\r\n                                        color=\"primary\"\r\n                                        onClick={() => setOpenChangePassword(true)}\r\n                                    >\r\n                                        Change Password\r\n                                    </AnimatedButton>\r\n                                    <AnimatedButton variant=\"contained\" color=\"error\" onClick={logout}>Sign Out</AnimatedButton>\r\n                                    {!isFree && (\r\n                                        <Button\r\n                                            variant=\"text\"\r\n                                            color=\"error\"\r\n                                            size=\"small\"\r\n                                            onClick={() => router.push('/cancel-membership')}\r\n                                            sx={{ mt: 1, textDecoration: 'underline', fontSize: '0.8rem' }}\r\n                                        >\r\n                                            Cancel Membership\r\n                                        </Button>\r\n                                    )}\r\n                                </Box>\r\n                            </Grid>\r\n                        </Grid>\r\n                    </Paper>\r\n                </ScrollReveal>\r\n\r\n                {/* Notifications Section - REMOVED (Now in Header) */}\r\n                {/* <NotificationsSection /> */}\r\n\r\n                {/* Appearance Section - Theme Settings + Language */}\r\n                <ScrollReveal>\r\n                    <Box sx={{ mt: 4 }}>\r\n                        <ThemeSelector />\r\n                        {/* Language Selector Removed */}\r\n                        {/* Location Selector Removed */}\r\n                    </Box>\r\n                </ScrollReveal>\r\n\r\n                {/* AI Settings removed as per user request (managed in TruthLens AI Chat) */}\r\n\r\n                {isPro && (\r\n                    <ScrollReveal>\r\n                        <Box sx={{ mt: 4 }}>\r\n                            <DietaryPreferencesSection\r\n                                preferences={preferences}\r\n                                onChange={handlePreferenceChange}\r\n                                onUpdateGranular={(key: keyof DietaryPreferences, value: string[]) => setPreferences({ ...preferences, [key]: value })}\r\n                                onSave={handleSavePreferences}\r\n                                onAiSetup={() => setOpenAiOnboarding(true)}\r\n                                isSaving={savingPreferences}\r\n                            />\r\n                        </Box>\r\n                    </ScrollReveal>\r\n                )}\r\n\r\n                {/* --- Dialogs --- */}\r\n\r\n                {/* Edit Profile Dialog */}\r\n                <Dialog open={openEditProfile} onClose={() => setOpenEditProfile(false)} maxWidth=\"xs\" fullWidth>\r\n                    <DialogTitle sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                        Edit Profile\r\n                        <IconButton onClick={() => setOpenEditProfile(false)}><CloseIcon /></IconButton>\r\n                    </DialogTitle>\r\n                    <DialogContent>\r\n                        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2, pt: 1 }}>\r\n                            <TextField\r\n                                label=\"Display Name\"\r\n                                fullWidth\r\n                                value={newName}\r\n                                onChange={(e) => setNewName(e.target.value)}\r\n                            />\r\n                            <TextField\r\n                                label=\"Photo URL\"\r\n                                fullWidth\r\n                                value={newPhoto}\r\n                                onChange={(e) => setNewPhoto(e.target.value)}\r\n                                helperText=\"Link to an image file\"\r\n                            />\r\n                        </Box>\r\n                    </DialogContent>\r\n                    <DialogActions sx={{ p: 2 }}>\r\n                        <Button onClick={() => setOpenEditProfile(false)}>Cancel</Button>\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            onClick={handleUpdateProfile}\r\n                            disabled={savingProfile}\r\n                        >\r\n                            {savingProfile ? 'Saving...' : 'Save Changes'}\r\n                        </Button>\r\n                    </DialogActions>\r\n                </Dialog>\r\n\r\n                {/* Change Password Dialog */}\r\n                <Dialog open={openChangePassword} onClose={() => setOpenChangePassword(false)} maxWidth=\"xs\" fullWidth>\r\n                    <DialogTitle sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                        Change Password\r\n                        <IconButton onClick={() => setOpenChangePassword(false)}><CloseIcon /></IconButton>\r\n                    </DialogTitle>\r\n                    <DialogContent>\r\n                        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2, pt: 1 }}>\r\n                            {passwordError && <Alert severity=\"error\">{passwordError}</Alert>}\r\n                            <TextField\r\n                                label=\"New Password\"\r\n                                type=\"password\"\r\n                                fullWidth\r\n                                value={newPassword}\r\n                                onChange={(e) => setNewPassword(e.target.value)}\r\n                            />\r\n                            <TextField\r\n                                label=\"Confirm New Password\"\r\n                                type=\"password\"\r\n                                fullWidth\r\n                                value={confirmPassword}\r\n                                onChange={(e) => setConfirmPassword(e.target.value)}\r\n                            />\r\n                        </Box>\r\n                    </DialogContent>\r\n                    <DialogActions sx={{ p: 2 }}>\r\n                        <Button onClick={() => setOpenChangePassword(false)}>Cancel</Button>\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            color=\"primary\"\r\n                            onClick={handleChangePassword}\r\n                            disabled={savingPassword}\r\n                        >\r\n                            {savingPassword ? 'Updating...' : 'Update Password'}\r\n                        </Button>\r\n                    </DialogActions>\r\n                </Dialog>\r\n\r\n                {/* AI Onboarding Dialog (Pro Only) */}\r\n                <AiPreferenceOnboarding open={openAiOnboarding} onClose={() => setOpenAiOnboarding(false)} />\r\n\r\n            </Container>\r\n            <Footer />\r\n        </PageTransition>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\quest\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used.","line":42,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":19},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":129,"column":37,"nodeType":"JSXOpeningElement","endLine":129,"endColumn":189}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Box, Typography, Button, Container, CircularProgress } from '@mui/material';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { generateLogoutQuest } from '@/services/aiService';\r\nimport { saveQuestHistory, getRecentQuests } from '@/services/questService';\r\nimport { Quest } from '@/types/quest';\r\nimport DirectionsRunIcon from '@mui/icons-material/DirectionsRun';\r\nimport EmojiPeopleIcon from '@mui/icons-material/EmojiPeople';\r\nimport SelfImprovementIcon from '@mui/icons-material/SelfImprovement';\r\nimport BrushIcon from '@mui/icons-material/Brush';\r\nimport ShareIcon from '@mui/icons-material/Share';\r\nimport LogoutIcon from '@mui/icons-material/Logout';\r\n\r\n// Custom styled components or consistent style objects\r\nconst pageStyle = {\r\n    background: 'radial-gradient(circle at center, #1a1a2e 0%, #0f0f1a 100%)',\r\n    minHeight: '100vh',\r\n    color: 'white',\r\n    display: 'flex',\r\n    flexDirection: 'column' as const,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    overflow: 'hidden',\r\n    position: 'relative' as const,\r\n};\r\n\r\nconst QUEST_ICONS = {\r\n    physical: DirectionsRunIcon,\r\n    social: EmojiPeopleIcon,\r\n    mindfulness: SelfImprovementIcon,\r\n    creative: BrushIcon,\r\n    easy: DirectionsRunIcon\r\n};\r\n\r\nexport default function QuestPage() {\r\n    const { user, immediateLogout } = useAuth();\r\n    const router = useRouter();\r\n    const [loading, setLoading] = useState(true);\r\n    const [quest, setQuest] = useState<Quest | null>(null);\r\n    const [step, setStep] = useState<'loading' | 'reveal' | 'accepted'>('loading');\r\n\r\n    useEffect(() => {\r\n        if (!user) {\r\n            router.push('/login');\r\n            return;\r\n        }\r\n\r\n        const fetchQuest = async () => {\r\n            // Artificial delay for \"Scanning reality...\" effect\r\n            await new Promise(r => setTimeout(r, 1500));\r\n\r\n            try {\r\n                const history = await getRecentQuests(user.uid, 5);\r\n                const newQuest = await generateLogoutQuest(user.displayName || 'Traveler', history);\r\n                setQuest(newQuest);\r\n                setLoading(false);\r\n                setStep('reveal');\r\n            } catch (error) {\r\n                console.error(\"Quest generation failed\", error);\r\n                // Fallback to logout\r\n                immediateLogout();\r\n            }\r\n        };\r\n\r\n        fetchQuest();\r\n    }, [user, router, immediateLogout]);\r\n\r\n    const handleAccept = async () => {\r\n        if (!user || !quest) return;\r\n        setStep('accepted');\r\n\r\n        await saveQuestHistory(user.uid, quest, 'completed');\r\n\r\n        // Wait for animation then logout\r\n        setTimeout(() => {\r\n            immediateLogout();\r\n        }, 2000);\r\n    };\r\n\r\n    const handleSkip = async () => {\r\n        if (user && quest) {\r\n            await saveQuestHistory(user.uid, quest, 'skipped');\r\n        }\r\n        immediateLogout();\r\n    };\r\n\r\n    const handleShare = () => {\r\n        if (!quest) return;\r\n        const text = `I just accepted a quest to \"${quest.title}\" before logging out of TruthLens! ≡ƒò╡∩╕ÅΓÇìΓÖé∩╕Å #IRLSideQuest`;\r\n        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, '_blank');\r\n    };\r\n\r\n    if (!user) return null;\r\n\r\n    const Icon = quest ? QUEST_ICONS[quest.type] || QUEST_ICONS.easy : QUEST_ICONS.easy;\r\n\r\n    return (\r\n        <Box sx={pageStyle}>\r\n            {/* Background Effects */}\r\n            <Box sx={{ position: 'absolute', inset: 0, opacity: 0.2, pointerEvents: 'none' }}>\r\n                {/* Simple CSS Grid or Starfield could go here */}\r\n                <div style={{\r\n                    position: 'absolute', width: '100%', height: '100%',\r\n                    backgroundImage: 'radial-gradient(rgba(108, 99, 255, 0.2) 2px, transparent 2px)',\r\n                    backgroundSize: '40px 40px'\r\n                }} />\r\n            </Box>\r\n\r\n            <Container maxWidth=\"xs\" sx={{ zIndex: 10, textAlign: 'center' }}>\r\n                <AnimatePresence mode=\"wait\">\r\n                    {step === 'loading' && (\r\n                        <motion.div\r\n                            key=\"loader\"\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0, scale: 0.9 }}\r\n                            transition={{ duration: 0.5 }}\r\n                        >\r\n                            <Box sx={{ position: 'relative', display: 'inline-flex' }}>\r\n                                <CircularProgress size={80} sx={{ color: '#00F0FF' }} thickness={2} />\r\n                                <Box sx={{\r\n                                    position: 'absolute', top: 0, left: 0, bottom: 0, right: 0,\r\n                                    display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n                                }}>\r\n                                    <img src=\"/icons/icon-192x192.png\" alt=\"logo\" style={{ width: 40, height: 40, opacity: 0.8 }} onError={(e) => e.currentTarget.style.display = 'none'} />\r\n                                </Box>\r\n                            </Box>\r\n                            <Typography variant=\"h6\" sx={{ mt: 3, color: '#00F0FF', letterSpacing: 1, fontFamily: 'monospace' }}>\r\n                                SCANNING REALITY...\r\n                            </Typography>\r\n                            <Typography variant=\"body2\" sx={{ mt: 1, color: 'rgba(255,255,255,0.5)', fontFamily: 'monospace' }}>\r\n                                Generating Side Quest\r\n                            </Typography>\r\n                        </motion.div>\r\n                    )}\r\n\r\n                    {step === 'reveal' && quest && (\r\n                        <motion.div\r\n                            key=\"quest\"\r\n                            initial={{ opacity: 0, y: 50 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            exit={{ opacity: 0, y: -50 }}\r\n                            transition={{ type: 'spring', damping: 20 }}\r\n                        >\r\n                            <motion.div\r\n                                initial={{ scale: 0 }}\r\n                                animate={{ scale: 1 }}\r\n                                transition={{ delay: 0.2, type: 'spring' }}\r\n                            >\r\n                                <Box sx={{\r\n                                    width: 100, height: 100, borderRadius: '50%',\r\n                                    background: 'linear-gradient(45deg, #6C63FF, #00F0FF)',\r\n                                    display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                                    mx: 'auto', mb: 3,\r\n                                    boxShadow: '0 0 30px rgba(108, 99, 255, 0.5)'\r\n                                }}>\r\n                                    <Icon sx={{ fontSize: 50, color: 'white' }} />\r\n                                </Box>\r\n                            </motion.div>\r\n\r\n                            <Typography variant=\"overline\" sx={{ color: '#00F0FF', letterSpacing: 3, fontWeight: 'bold' }}>\r\n                                NEW OBJECTIVE DETECTED\r\n                            </Typography>\r\n\r\n                            <Typography variant=\"h4\" fontWeight=\"900\" sx={{\r\n                                mb: 2, mt: 1,\r\n                                background: 'linear-gradient(45deg, white, #a5a5a5)',\r\n                                WebkitBackgroundClip: 'text',\r\n                                WebkitTextFillColor: 'transparent',\r\n                                textTransform: 'uppercase'\r\n                            }}>\r\n                                {quest.title}\r\n                            </Typography>\r\n\r\n                            <Box sx={{\r\n                                bgcolor: 'rgba(255,255,255,0.05)',\r\n                                p: 3, borderRadius: 4, mb: 4,\r\n                                border: '1px solid rgba(255,255,255,0.1)',\r\n                                backdropFilter: 'blur(10px)'\r\n                            }}>\r\n                                <Typography variant=\"body1\" sx={{ color: 'rgba(255,255,255,0.9)', fontSize: '1.1rem', lineHeight: 1.6 }}>\r\n                                    {quest.description}\r\n                                </Typography>\r\n                            </Box>\r\n\r\n                            <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>\r\n                                <Button\r\n                                    variant=\"contained\"\r\n                                    size=\"large\"\r\n                                    onClick={handleAccept}\r\n                                    sx={{\r\n                                        py: 2,\r\n                                        borderRadius: 3,\r\n                                        fontSize: '1.1rem',\r\n                                        fontWeight: 'bold',\r\n                                        background: 'linear-gradient(90deg, #6C63FF, #00F0FF)',\r\n                                        boxShadow: '0 0 20px rgba(108, 99, 255, 0.4)',\r\n                                        '&:hover': {\r\n                                            boxShadow: '0 0 30px rgba(108, 99, 255, 0.6)',\r\n                                            transform: 'scale(1.02)'\r\n                                        },\r\n                                        transition: 'all 0.2s'\r\n                                    }}\r\n                                >\r\n                                    ACCEPT MISSION\r\n                                </Button>\r\n\r\n                                <Box sx={{ display: 'flex', gap: 2 }}>\r\n                                    <Button\r\n                                        fullWidth variant=\"outlined\"\r\n                                        onClick={handleShare}\r\n                                        startIcon={<ShareIcon />}\r\n                                        sx={{\r\n                                            color: 'white', borderColor: 'rgba(255,255,255,0.3)', py: 1.5, borderRadius: 3,\r\n                                            '&:hover': { borderColor: 'white', bgcolor: 'rgba(255,255,255,0.05)' }\r\n                                        }}\r\n                                    >\r\n                                        Share\r\n                                    </Button>\r\n                                    <Button\r\n                                        fullWidth variant=\"text\"\r\n                                        onClick={handleSkip}\r\n                                        startIcon={<LogoutIcon />}\r\n                                        sx={{ color: 'rgba(255,255,255,0.5)', py: 1.5, borderRadius: 3 }}\r\n                                    >\r\n                                        Skip\r\n                                    </Button>\r\n                                </Box>\r\n                            </Box>\r\n                        </motion.div>\r\n                    )}\r\n\r\n                    {step === 'accepted' && (\r\n                        <motion.div\r\n                            key=\"accepted\"\r\n                            initial={{ scale: 0.8, opacity: 0 }}\r\n                            animate={{ scale: 1, opacity: 1 }}\r\n                            transition={{ type: 'spring' }}\r\n                        >\r\n                            <Box sx={{\r\n                                width: 120, height: 120, borderRadius: '50%',\r\n                                border: '4px solid #4CAF50',\r\n                                display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                                mx: 'auto', mb: 3\r\n                            }}>\r\n                                <DirectionsRunIcon sx={{ fontSize: 60, color: '#4CAF50' }} />\r\n                            </Box>\r\n                            <Typography variant=\"h4\" sx={{ color: '#4CAF50', fontWeight: 'bold', mb: 1 }}>\r\n                                QUEST ACCEPTED\r\n                            </Typography>\r\n                            <Typography variant=\"body1\" sx={{ color: 'rgba(255,255,255,0.6)' }}>\r\n                                Good luck, agent. Logging out...\r\n                            </Typography>\r\n                        </motion.div>\r\n                    )}\r\n                </AnimatePresence>\r\n            </Container>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\recommendations\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userProfile' is assigned a value but never used.","line":45,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":30},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchRecommendations'. Either include it or remove the dependency array.","line":77,"column":8,"nodeType":"ArrayExpression","endLine":77,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchRecommendations, user]","fix":{"range":[2595,2601],"text":"[fetchRecommendations, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { Container, Grid, Typography, Box, CircularProgress, Button, Alert, Paper, IconButton } from '@mui/material';\r\nimport AutoAwesomeIcon from '@mui/icons-material/AutoAwesome';\r\nimport RefreshIcon from '@mui/icons-material/Refresh';\r\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { getUserPairedRecommendations, RecommendationPairResult } from '@/services/recommendationService';\r\nimport RecommendationPairCard from '@/components/features/RecommendationPairCard';\r\nimport { motion, AnimatePresence, Variants } from 'framer-motion';\r\n\r\n// Animation Variants\r\nconst containerVariants: Variants = {\r\n    hidden: { opacity: 0 },\r\n    visible: {\r\n        opacity: 1,\r\n        transition: {\r\n            staggerChildren: 0.15,\r\n            delayChildren: 0.2\r\n        }\r\n    }\r\n};\r\n\r\nconst itemVariants: Variants = {\r\n    hidden: { opacity: 0, y: 30, scale: 0.95 },\r\n    visible: {\r\n        opacity: 1,\r\n        y: 0,\r\n        scale: 1,\r\n        transition: {\r\n            type: \"spring\",\r\n            stiffness: 100,\r\n            damping: 15\r\n        }\r\n    }\r\n};\r\n\r\nconst fadeInVariants: Variants = {\r\n    hidden: { opacity: 0, y: 20 },\r\n    visible: { opacity: 1, y: 0, transition: { duration: 0.6, ease: \"easeOut\" } }\r\n};\r\n\r\nexport default function RecommendationsPage() {\r\n    const { user, userProfile, features } = useAuth();\r\n    const router = useRouter();\r\n    const [recommendations, setRecommendations] = useState<RecommendationPairResult[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState('');\r\n\r\n    const fetchRecommendations = async () => {\r\n        if (!user) return;\r\n        setLoading(true);\r\n        setError('');\r\n        try {\r\n            // Artificial delay for smooth animation if loading is too fast\r\n            const minTime = new Promise(resolve => setTimeout(resolve, 800));\r\n            const [data] = await Promise.all([\r\n                getUserPairedRecommendations(user.uid),\r\n                minTime\r\n            ]);\r\n            setRecommendations(data);\r\n        } catch (err) {\r\n            console.error(err);\r\n            setError('Failed to load personalized recommendations. Please try again.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (user) {\r\n            fetchRecommendations();\r\n        } else {\r\n            setLoading(false);\r\n        }\r\n    }, [user]);\r\n\r\n    if (!user) {\r\n        return (\r\n            <Container maxWidth=\"md\" sx={{ mt: 10, textAlign: 'center' }}>\r\n                <Typography variant=\"h5\">Please log in to view personalized recommendations.</Typography>\r\n            </Container>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Container maxWidth=\"md\" sx={{ mt: 4, mb: 10 }}>\r\n            {/* Header Section */}\r\n            <motion.div\r\n                initial=\"hidden\"\r\n                animate=\"visible\"\r\n                variants={fadeInVariants}\r\n            >\r\n                <Box sx={{ mb: 5, display: 'flex', flexDirection: 'column', gap: 3 }}>\r\n                    <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>\r\n                        <IconButton\r\n                            onClick={() => router.back()}\r\n                            component={motion.button}\r\n                            whileHover={{ scale: 1.1, backgroundColor: 'rgba(255,255,255,0.15)' }}\r\n                            whileTap={{ scale: 0.95 }}\r\n                            sx={{\r\n                                bgcolor: 'rgba(255,255,255,0.05)',\r\n                                border: '1px solid rgba(255,255,255,0.1)',\r\n                                backdropFilter: 'blur(10px)',\r\n                                color: 'white',\r\n                                width: 44,\r\n                                height: 44,\r\n                            }}\r\n                        >\r\n                            <ArrowBackIcon />\r\n                        </IconButton>\r\n\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            component={motion.button}\r\n                            whileHover={{ scale: 1.05, boxShadow: '0 6px 20px rgba(255, 107, 107, 0.5)' }}\r\n                            whileTap={{ scale: 0.95 }}\r\n                            startIcon={loading ? <CircularProgress size={16} color=\"inherit\" /> : <RefreshIcon sx={{ fontSize: 20 }} />}\r\n                            onClick={fetchRecommendations}\r\n                            disabled={loading}\r\n                            sx={{\r\n                                borderRadius: '100px',\r\n                                textTransform: 'none',\r\n                                background: 'linear-gradient(135deg, #FF8E53 0%, #FF6B6B 100%)',\r\n                                boxShadow: '0 4px 14px rgba(255, 107, 107, 0.4)',\r\n                                px: 3,\r\n                                py: 1,\r\n                                fontSize: '0.9rem',\r\n                                fontWeight: 600\r\n                            }}\r\n                        >\r\n                            {loading ? 'Analyzing...' : 'Refresh Info'}\r\n                        </Button>\r\n                    </Box>\r\n\r\n                    <Box>\r\n                        <motion.div\r\n                            initial={{ opacity: 0, x: -20 }}\r\n                            animate={{ opacity: 1, x: 0 }}\r\n                            transition={{ delay: 0.2, duration: 0.5 }}\r\n                        >\r\n                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5, mb: 1 }}>\r\n                                <AutoAwesomeIcon sx={{ color: '#FF8E53', fontSize: 28 }} />\r\n                                <Typography variant=\"overline\" sx={{ color: '#FF8E53', fontWeight: 700, letterSpacing: 1.2 }}>\r\n                                    AI INSIGHTS\r\n                                </Typography>\r\n                            </Box>\r\n                        </motion.div>\r\n\r\n                        <motion.div\r\n                            initial={{ opacity: 0, y: 20 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            transition={{ delay: 0.3, duration: 0.6 }}\r\n                        >\r\n                            <Typography\r\n                                variant=\"h3\"\r\n                                fontWeight=\"800\"\r\n                                sx={{\r\n                                    fontSize: { xs: '2.5rem', md: '3rem' },\r\n                                    background: 'linear-gradient(90deg, #FFFFFF 0%, #e0e0e0 100%)',\r\n                                    backgroundClip: 'text',\r\n                                    textFillColor: 'transparent',\r\n                                    mb: 1,\r\n                                    letterSpacing: '-0.02em',\r\n                                    textShadow: '0 0 40px rgba(255,255,255,0.1)'\r\n                                }}\r\n                            >\r\n                                Smart Swaps\r\n                            </Typography>\r\n                        </motion.div>\r\n\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            transition={{ delay: 0.5, duration: 0.6 }}\r\n                        >\r\n                            <Typography variant=\"body1\" color=\"text.secondary\" sx={{ maxWidth: '90%', lineHeight: 1.6, fontSize: '1.1rem' }}>\r\n                                Healthier alternatives tailored to your habits.\r\n                            </Typography>\r\n                        </motion.div>\r\n                    </Box>\r\n                </Box>\r\n            </motion.div>\r\n\r\n            {/* Error State */}\r\n            <AnimatePresence>\r\n                {error && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0, height: 0 }}\r\n                        animate={{ opacity: 1, height: 'auto' }}\r\n                        exit={{ opacity: 0, height: 0 }}\r\n                    >\r\n                        <Alert severity=\"error\" sx={{ mb: 4, borderRadius: 3 }}>{error}</Alert>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Loading State */}\r\n            <AnimatePresence mode=\"wait\">\r\n                {loading && (\r\n                    <motion.div\r\n                        key=\"loading\"\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                    >\r\n                        <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', py: 12 }}>\r\n                            <Box sx={{ position: 'relative', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                                <CircularProgress\r\n                                    size={80}\r\n                                    thickness={2}\r\n                                    sx={{\r\n                                        color: '#FF8E53',\r\n                                        position: 'absolute',\r\n                                        left: 0,\r\n                                        top: 0\r\n                                    }}\r\n                                    disableShrink\r\n                                />\r\n                                <CircularProgress\r\n                                    size={80}\r\n                                    thickness={2}\r\n                                    sx={{\r\n                                        color: 'rgba(255, 142, 83, 0.2)',\r\n                                    }}\r\n                                    variant=\"determinate\"\r\n                                    value={100}\r\n                                />\r\n                            </Box>\r\n                            <Typography variant=\"h6\" sx={{ mt: 4, mb: 1, fontWeight: 600, background: 'linear-gradient(135deg, #FFF 0%, #CCC 100%)', backgroundClip: 'text', textFillColor: 'transparent' }}>\r\n                                Curating Recommendations...\r\n                            </Typography>\r\n                            <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                Analyzing your history to find the best matches.\r\n                            </Typography>\r\n                        </Box>\r\n                    </motion.div>\r\n                )}\r\n\r\n                {/* Empty State */}\r\n                {!loading && !error && recommendations.length === 0 && (\r\n                    <motion.div\r\n                        key=\"empty\"\r\n                        initial={{ opacity: 0, scale: 0.9 }}\r\n                        animate={{ opacity: 1, scale: 1 }}\r\n                        exit={{ opacity: 0, scale: 0.9 }}\r\n                        transition={{ type: \"spring\", stiffness: 200, damping: 20 }}\r\n                    >\r\n                        <Paper sx={{\r\n                            p: 6,\r\n                            textAlign: 'center',\r\n                            borderRadius: 6,\r\n                            background: 'linear-gradient(145deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%)',\r\n                            backdropFilter: 'blur(20px)',\r\n                            border: '1px solid rgba(255,255,255,0.05)',\r\n                            boxShadow: '0 8px 32px rgba(0,0,0,0.2)'\r\n                        }}>\r\n                            <Typography variant=\"h5\" gutterBottom fontWeight=\"bold\">No Swaps Found Yet</Typography>\r\n                            <Typography color=\"text.secondary\" sx={{ mb: 4, maxWidth: 320, mx: 'auto', lineHeight: 1.6 }}>\r\n                                We need a bit more data to find the perfect healthier alternatives for you. Start scanning items!\r\n                            </Typography>\r\n                            <Button\r\n                                component={motion.button}\r\n                                whileHover={{ scale: 1.05 }}\r\n                                whileTap={{ scale: 0.95 }}\r\n                                variant=\"contained\"\r\n                                onClick={() => router.push('/scan')}\r\n                                sx={{\r\n                                    borderRadius: '100px',\r\n                                    px: 5,\r\n                                    py: 1.5,\r\n                                    background: 'white',\r\n                                    color: 'black',\r\n                                    fontWeight: 'bold',\r\n                                    boxShadow: '0 4px 15px rgba(255,255,255,0.2)',\r\n                                    '&:hover': {\r\n                                        background: '#f0f0f0'\r\n                                    }\r\n                                }}\r\n                            >\r\n                                Start Scanning\r\n                            </Button>\r\n                        </Paper>\r\n                    </motion.div>\r\n                )}\r\n\r\n                {/* Results Grid */}\r\n                {!loading && !error && recommendations.length > 0 && (\r\n                    <motion.div\r\n                        key=\"results\"\r\n                        variants={containerVariants}\r\n                        initial=\"hidden\"\r\n                        animate=\"visible\"\r\n                    >\r\n                        <Grid container spacing={4}>\r\n                            {/* Visible Recommendations */}\r\n                            {recommendations.slice(0, features?.recommendationLimit === -1 ? undefined : features.recommendationLimit).map((pair) => (\r\n                                <Grid key={pair.id} size={{ xs: 12 }}>\r\n                                    <motion.div variants={itemVariants}>\r\n                                        <RecommendationPairCard\r\n                                            rejected={pair.rejected}\r\n                                            recommended={pair.recommended}\r\n                                        />\r\n                                    </motion.div>\r\n                                </Grid>\r\n                            ))}\r\n\r\n                            {/* Locked State for Free/Plus Users */}\r\n                            {features?.recommendationLimit !== -1 && recommendations.length > features.recommendationLimit && (\r\n                                <Grid size={{ xs: 12 }}>\r\n                                    <motion.div variants={itemVariants}>\r\n                                        <Paper sx={{\r\n                                            p: 4,\r\n                                            textAlign: 'center',\r\n                                            borderRadius: 4,\r\n                                            background: 'linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%)',\r\n                                            border: '1px dashed rgba(255,255,255,0.2)',\r\n                                            backdropFilter: 'blur(10px)',\r\n                                            display: 'flex',\r\n                                            flexDirection: 'column',\r\n                                            alignItems: 'center',\r\n                                            gap: 2\r\n                                        }}>\r\n                                            <AutoAwesomeIcon sx={{ fontSize: 40, color: '#FFD700', opacity: 0.8 }} />\r\n                                            <Typography variant=\"h6\" fontWeight=\"bold\">\r\n                                                Unlock {recommendations.length - features.recommendationLimit} More Insights\r\n                                            </Typography>\r\n                                            <Typography variant=\"body2\" color=\"text.secondary\" sx={{ maxWidth: 400 }}>\r\n                                                Upgrade to Pro to see all your personalized swaps and unlock unlimited AI recommendations.\r\n                                            </Typography>\r\n                                            <Button\r\n                                                variant=\"contained\"\r\n                                                onClick={() => router.push('/upgrade')}\r\n                                                sx={{\r\n                                                    mt: 1,\r\n                                                    borderRadius: '100px',\r\n                                                    background: 'linear-gradient(90deg, #FFD700 0%, #FFA500 100%)',\r\n                                                    color: 'black',\r\n                                                    fontWeight: 'bold',\r\n                                                    px: 4,\r\n                                                    boxShadow: '0 8px 20px rgba(255, 215, 0, 0.3)'\r\n                                                }}\r\n                                            >\r\n                                                Unlock Pro Access\r\n                                            </Button>\r\n                                        </Paper>\r\n                                    </motion.div>\r\n                                </Grid>\r\n                            )}\r\n                        </Grid>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </Container>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\request-access\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'codeValid' is assigned a value but never used.","line":38,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":21},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\request-access\\page.tsx:55:13\n  53 |     useEffect(() => {\n  54 |         if (userProfile) {\n> 55 |             setFullName(userProfile.displayName || '');\n     |             ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  56 |             setEmail(userProfile.email || '');\n  57 |         }\n  58 |     }, [userProfile]);","line":55,"column":13,"nodeType":null,"endLine":55,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5478,5481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5478,5481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n    Box, Container, Typography, Paper, TextField, Button,\r\n    CircularProgress, Alert, FormControlLabel, Switch,\r\n    Stepper, Step, StepLabel, InputAdornment, Chip\r\n} from '@mui/material';\r\nimport PersonIcon from '@mui/icons-material/Person';\r\nimport EmailIcon from '@mui/icons-material/Email';\r\nimport PhoneIcon from '@mui/icons-material/Phone';\r\nimport KeyIcon from '@mui/icons-material/Key';\r\nimport SchoolIcon from '@mui/icons-material/School';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\r\nimport CloudUploadIcon from '@mui/icons-material/CloudUpload';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { useRouter } from 'next/navigation';\r\nimport { validateAccessCode, submitAccessRequest } from '@/services/accessRequestService';\r\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\nimport { storage } from '@/lib/firebase';\r\nimport { motion } from 'framer-motion';\r\n\r\nconst steps = ['Enter Code', 'Fill Details', 'Submit'];\r\n\r\nexport default function RequestAccessPage() {\r\n    const { user, userProfile, loading: authLoading } = useAuth();\r\n    const router = useRouter();\r\n\r\n    const [activeStep, setActiveStep] = useState(0);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n    const [success, setSuccess] = useState(false);\r\n    const [autoApproved, setAutoApproved] = useState(false);\r\n\r\n    // Step 1: Code\r\n    const [code, setCode] = useState('');\r\n    const [codeValid, setCodeValid] = useState(false);\r\n    const [codeTier, setCodeTier] = useState<string>('');\r\n\r\n    // Step 2: Form\r\n    const [fullName, setFullName] = useState('');\r\n    const [username, setUsername] = useState('');\r\n    const [email, setEmail] = useState('');\r\n    const [useAccountEmail, setUseAccountEmail] = useState(true);\r\n    const [phone, setPhone] = useState('');\r\n    const [reason, setReason] = useState('');\r\n    const [isStudent, setIsStudent] = useState(false);\r\n    const [studentProof, setStudentProof] = useState<File | null>(null);\r\n    const [uploadingProof, setUploadingProof] = useState(false);\r\n\r\n    // Pre-fill from profile\r\n    useEffect(() => {\r\n        if (userProfile) {\r\n            setFullName(userProfile.displayName || '');\r\n            setEmail(userProfile.email || '');\r\n        }\r\n    }, [userProfile]);\r\n\r\n    // Redirect if not logged in\r\n    useEffect(() => {\r\n        if (!authLoading && !user) {\r\n            router.push('/login?redirect=/request-access');\r\n        }\r\n    }, [user, authLoading, router]);\r\n\r\n    const handleValidateCode = async () => {\r\n        if (!code.trim()) {\r\n            setError('Please enter an access code');\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        const result = await validateAccessCode(code);\r\n\r\n        if (result.valid && result.codeData) {\r\n            setCodeValid(true);\r\n            setCodeTier(result.codeData.tier);\r\n            setActiveStep(1);\r\n        } else {\r\n            setError(result.error || 'Invalid code');\r\n        }\r\n\r\n        setLoading(false);\r\n    };\r\n\r\n    const handleProofUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        // Validate file type\r\n        if (!file.type.startsWith('image/') && file.type !== 'application/pdf') {\r\n            setError('Please upload an image or PDF file');\r\n            return;\r\n        }\r\n\r\n        setStudentProof(file);\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        // Validate form\r\n        if (!fullName.trim()) { setError('Full name is required'); return; }\r\n        if (!username.trim()) { setError('Username is required'); return; }\r\n        if (!useAccountEmail && !email.trim()) { setError('Email is required'); return; }\r\n        if (!phone.trim()) { setError('Phone number is required'); return; }\r\n        if (!reason.trim()) { setError('Reason is required'); return; }\r\n        if (isStudent && !studentProof) { setError('Student proof is required'); return; }\r\n\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        try {\r\n            // Upload student proof if exists\r\n            let studentProofUrl: string | null = null;\r\n            if (isStudent && studentProof && user) {\r\n                setUploadingProof(true);\r\n                const proofRef = ref(storage, `student-proofs/${user.uid}/${Date.now()}_${studentProof.name}`);\r\n                await uploadBytes(proofRef, studentProof);\r\n                studentProofUrl = await getDownloadURL(proofRef);\r\n                setUploadingProof(false);\r\n            }\r\n\r\n            // Submit request\r\n            const result = await submitAccessRequest(user!.uid, {\r\n                fullName,\r\n                username,\r\n                email: useAccountEmail ? (userProfile?.email || '') : email,\r\n                useAccountEmail,\r\n                phone,\r\n                reason,\r\n                code,\r\n                isStudent,\r\n                studentProofUrl\r\n            });\r\n\r\n            if (result.success) {\r\n                setSuccess(true);\r\n                setAutoApproved(result.autoApproved || false);\r\n                setActiveStep(2);\r\n            } else {\r\n                setError(result.error || 'Failed to submit request');\r\n            }\r\n        } catch (err: any) {\r\n            setError(err.message || 'An error occurred');\r\n        }\r\n\r\n        setLoading(false);\r\n    };\r\n\r\n    if (authLoading) {\r\n        return (\r\n            <Box sx={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                <CircularProgress />\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Box sx={{ minHeight: '100vh', bgcolor: 'background.default', py: 4 }}>\r\n            <Container maxWidth=\"sm\">\r\n                <Button\r\n                    startIcon={<ArrowBackIcon />}\r\n                    onClick={() => router.back()}\r\n                    sx={{ mb: 3 }}\r\n                >\r\n                    Back\r\n                </Button>\r\n\r\n                <Paper\r\n                    component={motion.div}\r\n                    initial={{ opacity: 0, y: 20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    sx={{ p: 4, borderRadius: 3 }}\r\n                >\r\n                    <Typography variant=\"h5\" fontWeight=\"bold\" gutterBottom textAlign=\"center\">\r\n                        ≡ƒÄü Request Free Access\r\n                    </Typography>\r\n                    <Typography variant=\"body2\" color=\"text.secondary\" textAlign=\"center\" sx={{ mb: 4 }}>\r\n                        Get 3 months of premium access\r\n                    </Typography>\r\n\r\n                    <Stepper activeStep={activeStep} sx={{ mb: 4 }}>\r\n                        {steps.map((label) => (\r\n                            <Step key={label}>\r\n                                <StepLabel>{label}</StepLabel>\r\n                            </Step>\r\n                        ))}\r\n                    </Stepper>\r\n\r\n                    {error && <Alert severity=\"error\" sx={{ mb: 3 }}>{error}</Alert>}\r\n\r\n                    {/* Step 1: Enter Code */}\r\n                    {activeStep === 0 && (\r\n                        <Box component={motion.div} initial={{ opacity: 0 }} animate={{ opacity: 1 }}>\r\n                            <Typography variant=\"body1\" sx={{ mb: 2 }}>\r\n                                Enter your access code provided by admin:\r\n                            </Typography>\r\n                            <TextField\r\n                                fullWidth\r\n                                label=\"Access Code\"\r\n                                value={code}\r\n                                onChange={(e) => setCode(e.target.value.toUpperCase())}\r\n                                placeholder=\"e.g., TL2024-STUDENT\"\r\n                                InputProps={{\r\n                                    startAdornment: <InputAdornment position=\"start\"><KeyIcon /></InputAdornment>\r\n                                }}\r\n                                sx={{ mb: 3 }}\r\n                            />\r\n                            <Button\r\n                                fullWidth\r\n                                variant=\"contained\"\r\n                                size=\"large\"\r\n                                onClick={handleValidateCode}\r\n                                disabled={loading || !code.trim()}\r\n                            >\r\n                                {loading ? <CircularProgress size={24} /> : 'Validate Code'}\r\n                            </Button>\r\n                        </Box>\r\n                    )}\r\n\r\n                    {/* Step 2: Fill Form */}\r\n                    {activeStep === 1 && (\r\n                        <Box component={motion.div} initial={{ opacity: 0 }} animate={{ opacity: 1 }}>\r\n                            <Alert severity=\"success\" sx={{ mb: 3 }}>\r\n                                Code valid! This grants <Chip label={codeTier.toUpperCase()} color=\"primary\" size=\"small\" /> access for 3 months.\r\n                            </Alert>\r\n\r\n                            <TextField\r\n                                fullWidth\r\n                                label=\"Full Name\"\r\n                                value={fullName}\r\n                                onChange={(e) => setFullName(e.target.value)}\r\n                                InputProps={{\r\n                                    startAdornment: <InputAdornment position=\"start\"><PersonIcon /></InputAdornment>\r\n                                }}\r\n                                sx={{ mb: 2 }}\r\n                            />\r\n\r\n                            <TextField\r\n                                fullWidth\r\n                                label=\"Username\"\r\n                                value={username}\r\n                                onChange={(e) => setUsername(e.target.value)}\r\n                                placeholder=\"Your TruthLens username\"\r\n                                sx={{ mb: 2 }}\r\n                            />\r\n\r\n                            <FormControlLabel\r\n                                control={<Switch checked={useAccountEmail} onChange={(e) => setUseAccountEmail(e.target.checked)} />}\r\n                                label={`Use account email (${userProfile?.email || 'N/A'})`}\r\n                                sx={{ mb: 1 }}\r\n                            />\r\n\r\n                            {!useAccountEmail && (\r\n                                <TextField\r\n                                    fullWidth\r\n                                    label=\"Alternative Email\"\r\n                                    type=\"email\"\r\n                                    value={email}\r\n                                    onChange={(e) => setEmail(e.target.value)}\r\n                                    InputProps={{\r\n                                        startAdornment: <InputAdornment position=\"start\"><EmailIcon /></InputAdornment>\r\n                                    }}\r\n                                    sx={{ mb: 2 }}\r\n                                />\r\n                            )}\r\n\r\n                            <TextField\r\n                                fullWidth\r\n                                label=\"Phone Number\"\r\n                                value={phone}\r\n                                onChange={(e) => setPhone(e.target.value)}\r\n                                placeholder=\"+1 234 567 8900\"\r\n                                InputProps={{\r\n                                    startAdornment: <InputAdornment position=\"start\"><PhoneIcon /></InputAdornment>\r\n                                }}\r\n                                sx={{ mb: 2 }}\r\n                            />\r\n\r\n                            <TextField\r\n                                fullWidth\r\n                                label=\"Reason for Request\"\r\n                                value={reason}\r\n                                onChange={(e) => setReason(e.target.value)}\r\n                                multiline\r\n                                rows={3}\r\n                                placeholder=\"Why do you need free access?\"\r\n                                sx={{ mb: 3 }}\r\n                            />\r\n\r\n                            <Paper variant=\"outlined\" sx={{ p: 2, mb: 3 }}>\r\n                                <FormControlLabel\r\n                                    control={<Switch checked={isStudent} onChange={(e) => setIsStudent(e.target.checked)} color=\"secondary\" />}\r\n                                    label={<Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}><SchoolIcon /> I am a student</Box>}\r\n                                />\r\n                                {isStudent && (\r\n                                    <Box sx={{ mt: 2 }}>\r\n                                        <Typography variant=\"caption\" color=\"text.secondary\" sx={{ mb: 1, display: 'block' }}>\r\n                                            Upload student ID or proof (instant approval!)\r\n                                        </Typography>\r\n                                        <Button\r\n                                            variant=\"outlined\"\r\n                                            component=\"label\"\r\n                                            startIcon={<CloudUploadIcon />}\r\n                                            fullWidth\r\n                                        >\r\n                                            {studentProof ? studentProof.name : 'Upload Proof'}\r\n                                            <input type=\"file\" hidden accept=\"image/*,.pdf\" onChange={handleProofUpload} />\r\n                                        </Button>\r\n                                    </Box>\r\n                                )}\r\n                            </Paper>\r\n\r\n                            <Button\r\n                                fullWidth\r\n                                variant=\"contained\"\r\n                                size=\"large\"\r\n                                onClick={handleSubmit}\r\n                                disabled={loading}\r\n                                sx={{ background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)' }}\r\n                            >\r\n                                {loading ? (uploadingProof ? 'Uploading...' : <CircularProgress size={24} />) : 'Submit Request'}\r\n                            </Button>\r\n                        </Box>\r\n                    )}\r\n\r\n                    {/* Step 3: Success */}\r\n                    {activeStep === 2 && success && (\r\n                        <Box component={motion.div} initial={{ scale: 0.8, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} textAlign=\"center\">\r\n                            <CheckCircleIcon sx={{ fontSize: 80, color: 'success.main', mb: 2 }} />\r\n                            <Typography variant=\"h5\" fontWeight=\"bold\" gutterBottom>\r\n                                {autoApproved ? '≡ƒÄë Instant Approval!' : 'Request Submitted!'}\r\n                            </Typography>\r\n                            <Typography color=\"text.secondary\" sx={{ mb: 3 }}>\r\n                                {autoApproved\r\n                                    ? `Your student verification was approved! You now have ${codeTier.toUpperCase()} access for 3 months.`\r\n                                    : 'Your request is pending admin review. You will be notified once it is processed.'}\r\n                            </Typography>\r\n                            <Button variant=\"contained\" onClick={() => router.push('/profile')}>\r\n                                Go to Profile\r\n                            </Button>\r\n                        </Box>\r\n                    )}\r\n                </Paper>\r\n            </Container>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\reset-password\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":4,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1097,1100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1097,1100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":46,"column":27,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[1831,1940],"text":"\r\n                        We&apos;ve sent password reset instructions to your email address.\r\n                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[1831,1940],"text":"\r\n                        We&lsquo;ve sent password reset instructions to your email address.\r\n                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[1831,1940],"text":"\r\n                        We&#39;ve sent password reset instructions to your email address.\r\n                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[1831,1940],"text":"\r\n                        We&rsquo;ve sent password reset instructions to your email address.\r\n                    "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":71,"column":60,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3183,3318],"text":"\r\n                            Enter your email address and we&apos;ll send you instructions to reset your password\r\n                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3183,3318],"text":"\r\n                            Enter your email address and we&lsquo;ll send you instructions to reset your password\r\n                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3183,3318],"text":"\r\n                            Enter your email address and we&#39;ll send you instructions to reset your password\r\n                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3183,3318],"text":"\r\n                            Enter your email address and we&rsquo;ll send you instructions to reset your password\r\n                        "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { Box, Button, Container, TextField, Typography, Paper, Alert } from '@mui/material';\r\nimport LockResetIcon from '@mui/icons-material/LockReset';\r\nimport EmailIcon from '@mui/icons-material/Email';\r\nimport Link from 'next/link';\r\nimport { sendPasswordResetEmail } from 'firebase/auth';\r\nimport { auth } from '@/lib/firebase';\r\nimport AnimatedButton from '@/components/ui/AnimatedButton';\r\nimport ScrollReveal from '@/components/animation/ScrollReveal';\r\n\r\nexport default function ResetPasswordPage() {\r\n    const [loading, setLoading] = useState(false);\r\n    const [sent, setSent] = useState(false);\r\n    const [error, setError] = useState('');\r\n\r\n    const handleReset = async (e: React.FormEvent<HTMLFormElement>) => {\r\n        e.preventDefault();\r\n        const data = new FormData(e.currentTarget);\r\n        const email = data.get('email') as string;\r\n\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        try {\r\n            await sendPasswordResetEmail(auth, email);\r\n            setSent(true);\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            setError(err.message || 'Failed to send reset email.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (sent) {\r\n        return (\r\n            <Container maxWidth=\"sm\" sx={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                <Paper sx={{ p: 6, textAlign: 'center' }}>\r\n                    <EmailIcon sx={{ fontSize: 80, color: 'primary.main', mb: 3 }} />\r\n                    <Typography variant=\"h4\" fontWeight=\"bold\" gutterBottom>\r\n                        Check Your Email\r\n                    </Typography>\r\n                    <Typography variant=\"body1\" color=\"text.secondary\" paragraph>\r\n                        We've sent password reset instructions to your email address.\r\n                    </Typography>\r\n                    <Box sx={{ mt: 3, display: 'flex', gap: 2, justifyContent: 'center' }}>\r\n                        <AnimatedButton variant=\"outlined\" onClick={() => setSent(false)}>\r\n                            Try Again\r\n                        </AnimatedButton>\r\n                        <AnimatedButton variant=\"contained\" component={Link} href=\"/login\">\r\n                            Back to Login\r\n                        </AnimatedButton>\r\n                    </Box>\r\n                </Paper>\r\n            </Container>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Container maxWidth=\"sm\" sx={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', p: 3 }}>\r\n            <Paper elevation={0} sx={{ p: { xs: 3, md: 5 }, width: '100%', bgcolor: 'transparent' }}>\r\n                <ScrollReveal>\r\n                    <Box sx={{ textAlign: 'center', mb: 4 }}>\r\n                        <LockResetIcon sx={{ fontSize: 64, color: 'primary.main', mb: 2 }} />\r\n                        <Typography variant=\"h4\" fontWeight=\"bold\" gutterBottom>\r\n                            Reset Password\r\n                        </Typography>\r\n                        <Typography variant=\"body2\" color=\"text.secondary\">\r\n                            Enter your email address and we'll send you instructions to reset your password\r\n                        </Typography>\r\n                    </Box>\r\n\r\n                    {error && <Alert severity=\"error\" sx={{ mb: 3 }}>{error}</Alert>}\r\n\r\n                    <Box component=\"form\" onSubmit={handleReset} sx={{ display: 'flex', flexDirection: 'column', gap: 3 }}>\r\n                        <TextField\r\n                            name=\"email\"\r\n                            label=\"Email Address\"\r\n                            type=\"email\"\r\n                            required\r\n                            fullWidth\r\n                            disabled={loading}\r\n                            autoComplete=\"email\"\r\n                            autoFocus\r\n                        />\r\n\r\n                        <AnimatedButton\r\n                            type=\"submit\"\r\n                            fullWidth\r\n                            size=\"large\"\r\n                            variant=\"contained\"\r\n                            disabled={loading}\r\n                            sx={{\r\n                                py: 1.5,\r\n                                background: 'linear-gradient(45deg, #6C63FF 30%, #00F0FF 90%)',\r\n                            }}\r\n                        >\r\n                            {loading ? 'Sending...' : 'Send Reset Link'}\r\n                        </AnimatedButton>\r\n\r\n                        <Box sx={{ textAlign: 'center', mt: 2 }}>\r\n                            <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                Remember your password?{' '}\r\n                                <Link href=\"/login\" style={{ color: '#6C63FF', fontWeight: 600, textDecoration: 'none' }}>\r\n                                    Sign In\r\n                                </Link>\r\n                            </Typography>\r\n                        </Box>\r\n                    </Box>\r\n                </ScrollReveal>\r\n            </Paper>\r\n        </Container>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\scan\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\scan\\page.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`stopScanner` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\scan\\page.tsx:36:13\n  34 |     useEffect(() => {\n  35 |         return () => {\n> 36 |             stopScanner();\n     |             ^^^^^^^^^^^ `stopScanner` accessed before it is declared\n  37 |         };\n  38 |     }, []);\n  39 |\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\scan\\page.tsx:87:5\n   85 |     };\n   86 |\n>  87 |     const stopScanner = async () => {\n      |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  88 |         if (scannerRef.current && scannerRef.current.isScanning) {\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  89 |             try {\n      ΓÇª\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  97 |         setShowStartScreen(true);\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  98 |     };\n      | ^^^^^^^ `stopScanner` is declared here\n   99 |\n  100 |     const onScanSuccess = (decodedText: string, decodedResult: any) => {\n  101 |         // Beep Sound","line":36,"column":13,"nodeType":null,"endLine":36,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2705,2708],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2705,2708],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3367,3370],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3367,3370],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5274,5277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5274,5277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Html5Qrcode, Html5QrcodeSupportedFormats } from 'html5-qrcode';\r\nimport Image from 'next/image';\r\n\r\nconst SCANNER_REGION_ID = 'scanner-region';\r\n\r\n// Project Theme Colors (from theme/theme.ts)\r\nconst THEME = {\r\n    primary: '#6C63FF',    // Vibrant Purple\r\n    secondary: '#00F0FF',  // Cyber Neon Cyan\r\n    bgDark: '#0A0A0A',     // Deep Black\r\n    bgPaper: '#1F1F1F',    // Dark Gray\r\n    text: '#FFFFFF',\r\n    textSecondary: '#B0B0B0',\r\n};\r\n\r\nexport default function ScanPage() {\r\n    const router = useRouter();\r\n    const scannerRef = useRef<Html5Qrcode | null>(null);\r\n\r\n    const [showStartScreen, setShowStartScreen] = useState(true);\r\n    const [isScanning, setIsScanning] = useState(false);\r\n    const [isProcessing, setIsProcessing] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // Result Modal State\r\n    const [showResult, setShowResult] = useState(false);\r\n    const [scannedCode, setScannedCode] = useState('');\r\n    const [scannedFormat, setScannedFormat] = useState('');\r\n\r\n    useEffect(() => {\r\n        return () => {\r\n            stopScanner();\r\n        };\r\n    }, []);\r\n\r\n    const startScanner = async () => {\r\n        setShowStartScreen(false);\r\n        setError(null);\r\n\r\n        try {\r\n            // Check HTTPS\r\n            if (typeof window !== 'undefined' && !window.isSecureContext) {\r\n                setError('Camera requires HTTPS.');\r\n                return;\r\n            }\r\n\r\n            const html5QrCode = new Html5Qrcode(SCANNER_REGION_ID, {\r\n                formatsToSupport: [\r\n                    Html5QrcodeSupportedFormats.EAN_13,\r\n                    Html5QrcodeSupportedFormats.EAN_8,\r\n                    Html5QrcodeSupportedFormats.UPC_A,\r\n                    Html5QrcodeSupportedFormats.UPC_E,\r\n                    Html5QrcodeSupportedFormats.CODE_128,\r\n                    Html5QrcodeSupportedFormats.CODE_39,\r\n                    Html5QrcodeSupportedFormats.QR_CODE\r\n                ],\r\n                verbose: false\r\n            });\r\n            scannerRef.current = html5QrCode;\r\n\r\n            const aspectRatio = window.innerWidth / window.innerHeight;\r\n\r\n            await html5QrCode.start(\r\n                { facingMode: 'environment' },\r\n                {\r\n                    fps: 15,\r\n                    qrbox: { width: 250, height: 250 },\r\n                    aspectRatio: aspectRatio\r\n                },\r\n                onScanSuccess,\r\n                () => { } // Ignore per-frame errors\r\n            );\r\n\r\n            setIsScanning(true);\r\n\r\n        } catch (err: any) {\r\n            console.error('Scanner start error:', err);\r\n            setError(err.message || 'Camera access denied.');\r\n            setShowStartScreen(true);\r\n        }\r\n    };\r\n\r\n    const stopScanner = async () => {\r\n        if (scannerRef.current && scannerRef.current.isScanning) {\r\n            try {\r\n                await scannerRef.current.stop();\r\n                scannerRef.current.clear();\r\n            } catch (e) {\r\n                console.warn('Error stopping scanner:', e);\r\n            }\r\n        }\r\n        setIsScanning(false);\r\n        setShowStartScreen(true);\r\n    };\r\n\r\n    const onScanSuccess = (decodedText: string, decodedResult: any) => {\r\n        // Beep Sound\r\n        playBeep();\r\n\r\n        // Pause scanning\r\n        scannerRef.current?.pause();\r\n\r\n        setScannedCode(decodedText);\r\n        setScannedFormat(decodedResult?.result?.format?.formatName || 'Unknown');\r\n        setShowResult(true);\r\n    };\r\n\r\n    const handleProcessProduct = async () => {\r\n        setIsProcessing(true);\r\n        setShowResult(false);\r\n\r\n        // Haptic feedback\r\n        if (typeof navigator !== 'undefined' && navigator.vibrate) {\r\n            navigator.vibrate(200);\r\n        }\r\n\r\n        try {\r\n            const response = await fetch('/api/product/scan', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ barcode: scannedCode })\r\n            });\r\n\r\n            if (response.ok) {\r\n                await stopScanner();\r\n                router.push(`/product/${scannedCode}?source=scan`);\r\n            } else if (response.status === 404) {\r\n                setError('Product not found.');\r\n                setIsProcessing(false);\r\n                scannerRef.current?.resume();\r\n            } else {\r\n                const data = await response.json();\r\n                setError(data.error || 'Scan failed');\r\n                setIsProcessing(false);\r\n                scannerRef.current?.resume();\r\n            }\r\n        } catch (err) {\r\n            console.error('API Error:', err);\r\n            setError('Network error.');\r\n            setIsProcessing(false);\r\n            scannerRef.current?.resume();\r\n        }\r\n    };\r\n\r\n    const handleScanNext = () => {\r\n        setShowResult(false);\r\n        scannerRef.current?.resume();\r\n    };\r\n\r\n    const handleClose = () => {\r\n        stopScanner();\r\n        router.back();\r\n    };\r\n\r\n    const playBeep = () => {\r\n        try {\r\n            const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n            const oscillator = audioContext.createOscillator();\r\n            const gainNode = audioContext.createGain();\r\n            oscillator.connect(gainNode);\r\n            gainNode.connect(audioContext.destination);\r\n            oscillator.type = 'square';\r\n            oscillator.frequency.setValueAtTime(1200, audioContext.currentTime);\r\n            gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);\r\n            oscillator.start();\r\n            setTimeout(() => oscillator.stop(), 100);\r\n        } catch { }\r\n    };\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'fixed',\r\n            inset: 0,\r\n            backgroundColor: THEME.bgDark,\r\n            color: THEME.text,\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            fontFamily: 'sans-serif',\r\n            overflow: 'hidden',\r\n            zIndex: 9999\r\n        }}>\r\n            {/* Header Overlay */}\r\n            <div style={{\r\n                position: 'absolute',\r\n                top: 0,\r\n                left: 0,\r\n                right: 0,\r\n                padding: '16px',\r\n                zIndex: 30,\r\n                background: 'linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 100%)',\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center',\r\n                pointerEvents: 'none'\r\n            }}>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: 8, pointerEvents: 'auto' }}>\r\n                    <div style={{\r\n                        width: 32,\r\n                        height: 32,\r\n                        borderRadius: 8,\r\n                        background: `linear-gradient(135deg, ${THEME.primary} 0%, ${THEME.secondary} 100%)`,\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        boxShadow: `0 4px 12px ${THEME.primary}40`\r\n                    }}>\r\n                        <Image src=\"/icons/icon-192x192.png\" alt=\"Logo\" width={20} height={20} style={{ borderRadius: 4 }} />\r\n                    </div>\r\n                    <span style={{ fontSize: 18, fontWeight: 700, letterSpacing: '0.5px' }}>TruthLens</span>\r\n                </div>\r\n                <div style={{\r\n                    fontSize: 12,\r\n                    color: isScanning ? THEME.secondary : THEME.textSecondary,\r\n                    backgroundColor: 'rgba(255,255,255,0.1)',\r\n                    backdropFilter: 'blur(8px)',\r\n                    padding: '4px 12px',\r\n                    borderRadius: 20,\r\n                    border: '1px solid rgba(255,255,255,0.1)',\r\n                    pointerEvents: 'auto'\r\n                }}>\r\n                    {isScanning ? 'Scanning' : 'Ready'}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Main Content */}\r\n            <div style={{ flex: 1, position: 'relative', width: '100%', height: '100%' }}>\r\n\r\n                {/* Camera Feed */}\r\n                <div id={SCANNER_REGION_ID} style={{ width: '100%', height: '100%' }} />\r\n\r\n                {/* Scan Overlay (Visible when scanning) */}\r\n                {isScanning && !showStartScreen && (\r\n                    <div style={{\r\n                        position: 'absolute',\r\n                        inset: 0,\r\n                        display: 'flex',\r\n                        flexDirection: 'column',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        pointerEvents: 'none',\r\n                        zIndex: 10\r\n                    }}>\r\n                        {/* Top Dim */}\r\n                        <div style={{ flex: 1, width: '100%', backgroundColor: 'rgba(0,0,0,0.6)' }} />\r\n\r\n                        {/* Middle Row */}\r\n                        <div style={{ display: 'flex', width: '100%', height: 260 }}>\r\n                            <div style={{ flex: 1, backgroundColor: 'rgba(0,0,0,0.6)' }} />\r\n\r\n                            {/* Viewfinder */}\r\n                            <div style={{\r\n                                position: 'relative',\r\n                                width: 260,\r\n                                height: 260,\r\n                                backgroundColor: 'transparent'\r\n                            }}>\r\n                                {/* Corners */}\r\n                                <Corner position=\"tl\" color={THEME.secondary} />\r\n                                <Corner position=\"tr\" color={THEME.secondary} />\r\n                                <Corner position=\"bl\" color={THEME.secondary} />\r\n                                <Corner position=\"br\" color={THEME.secondary} />\r\n\r\n                                {/* Laser */}\r\n                                <div style={{\r\n                                    position: 'absolute',\r\n                                    width: '100%',\r\n                                    height: 4,\r\n                                    background: `linear-gradient(to right, transparent, ${THEME.secondary}, ${THEME.primary}, ${THEME.secondary}, transparent)`,\r\n                                    boxShadow: `0 0 15px ${THEME.secondary}CC, 0 0 5px ${THEME.secondary}80`,\r\n                                    borderRadius: 10,\r\n                                    animation: 'scan 1.5s infinite ease-in-out alternate'\r\n                                }} />\r\n\r\n                                {/* Instruction */}\r\n                                <div style={{\r\n                                    position: 'absolute',\r\n                                    bottom: -48,\r\n                                    left: 0,\r\n                                    right: 0,\r\n                                    textAlign: 'center'\r\n                                }}>\r\n                                    <span style={{\r\n                                        fontSize: 14,\r\n                                        fontWeight: 500,\r\n                                        color: THEME.text,\r\n                                        textShadow: '0 2px 4px rgba(0,0,0,0.8)'\r\n                                    }}>\r\n                                        Align code within frame\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div style={{ flex: 1, backgroundColor: 'rgba(0,0,0,0.6)' }} />\r\n                        </div>\r\n\r\n                        {/* Bottom Dim */}\r\n                        <div style={{ flex: 1, width: '100%', backgroundColor: 'rgba(0,0,0,0.6)' }} />\r\n                    </div>\r\n                )}\r\n\r\n                {/* Start Screen */}\r\n                {showStartScreen && (\r\n                    <div style={{\r\n                        position: 'absolute',\r\n                        inset: 0,\r\n                        display: 'flex',\r\n                        flexDirection: 'column',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        backgroundColor: THEME.bgDark,\r\n                        zIndex: 20,\r\n                        padding: 24\r\n                    }}>\r\n                        {/* Icon */}\r\n                        <div style={{\r\n                            position: 'relative',\r\n                            marginBottom: 32\r\n                        }}>\r\n                            <div style={{\r\n                                position: 'absolute',\r\n                                inset: -20,\r\n                                background: `radial-gradient(circle, ${THEME.primary}40 0%, transparent 70%)`,\r\n                                filter: 'blur(20px)'\r\n                            }} />\r\n                            <div style={{\r\n                                width: 96,\r\n                                height: 96,\r\n                                borderRadius: 24,\r\n                                backgroundColor: THEME.bgPaper,\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                                border: `1px solid ${THEME.bgPaper}`,\r\n                                boxShadow: `0 20px 60px ${THEME.primary}30`\r\n                            }}>\r\n                                <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke={THEME.secondary} strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                                    <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\" rx=\"1\" />\r\n                                    <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\" rx=\"1\" />\r\n                                    <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\" rx=\"1\" />\r\n                                    <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\" rx=\"1\" />\r\n                                </svg>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <h2 style={{ fontSize: 24, fontWeight: 700, marginBottom: 8 }}>TruthLens</h2>\r\n                        <p style={{\r\n                            color: THEME.textSecondary,\r\n                            marginBottom: 32,\r\n                            textAlign: 'center',\r\n                            maxWidth: 280,\r\n                            lineHeight: 1.6\r\n                        }}>\r\n                            Scan barcodes and QR codes to reveal product truths instantly.\r\n                        </p>\r\n\r\n                        <button\r\n                            onClick={startScanner}\r\n                            style={{\r\n                                padding: '16px 32px',\r\n                                background: `linear-gradient(135deg, ${THEME.primary} 0%, ${THEME.secondary} 100%)`,\r\n                                border: 'none',\r\n                                borderRadius: 24,\r\n                                color: THEME.text,\r\n                                fontWeight: 700,\r\n                                fontSize: 16,\r\n                                cursor: 'pointer',\r\n                                boxShadow: `0 8px 32px ${THEME.primary}50`,\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                gap: 12\r\n                            }}\r\n                        >\r\n                            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                                <path d=\"M12 5v14M5 12h14\" />\r\n                            </svg>\r\n                            Activate Scanner\r\n                        </button>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Controls (when scanning) */}\r\n                {isScanning && !showStartScreen && (\r\n                    <div style={{\r\n                        position: 'absolute',\r\n                        bottom: 40,\r\n                        left: 0,\r\n                        right: 0,\r\n                        display: 'flex',\r\n                        justifyContent: 'center',\r\n                        gap: 24,\r\n                        zIndex: 20,\r\n                        pointerEvents: 'none'\r\n                    }}>\r\n                        <button\r\n                            onClick={handleClose}\r\n                            style={{\r\n                                pointerEvents: 'auto',\r\n                                width: 56,\r\n                                height: 56,\r\n                                borderRadius: '50%',\r\n                                backgroundColor: 'rgba(255,255,255,0.1)',\r\n                                backdropFilter: 'blur(8px)',\r\n                                border: '1px solid rgba(255,255,255,0.2)',\r\n                                color: THEME.text,\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                                cursor: 'pointer',\r\n                                boxShadow: '0 4px 12px rgba(0,0,0,0.3)'\r\n                            }}\r\n                        >\r\n                            <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                                <path d=\"M18 6L6 18M6 6l12 12\" />\r\n                            </svg>\r\n                        </button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Result Modal */}\r\n            {showResult && (\r\n                <div style={{\r\n                    position: 'fixed',\r\n                    inset: 0,\r\n                    backgroundColor: 'rgba(0,0,0,0.9)',\r\n                    backdropFilter: 'blur(8px)',\r\n                    display: 'flex',\r\n                    alignItems: 'flex-end',\r\n                    justifyContent: 'center',\r\n                    zIndex: 50\r\n                }}>\r\n                    <div style={{\r\n                        width: '100%',\r\n                        maxWidth: 420,\r\n                        maxHeight: '85vh',\r\n                        backgroundColor: THEME.bgPaper,\r\n                        borderTopLeftRadius: 24,\r\n                        borderTopRightRadius: 24,\r\n                        padding: 24,\r\n                        overflow: 'auto',\r\n                        position: 'relative'\r\n                    }}>\r\n                        {/* Decorative Top Line */}\r\n                        <div style={{\r\n                            position: 'absolute',\r\n                            top: 0,\r\n                            left: '50%',\r\n                            transform: 'translateX(-50%)',\r\n                            width: 80,\r\n                            height: 4,\r\n                            borderRadius: 2,\r\n                            background: `linear-gradient(90deg, ${THEME.primary}, ${THEME.secondary})`,\r\n                            opacity: 0.6\r\n                        }} />\r\n\r\n                        {/* Header */}\r\n                        <div style={{\r\n                            display: 'flex',\r\n                            justifyContent: 'space-between',\r\n                            alignItems: 'flex-start',\r\n                            marginBottom: 16,\r\n                            marginTop: 12\r\n                        }}>\r\n                            <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\r\n                                <div style={{\r\n                                    width: 40,\r\n                                    height: 40,\r\n                                    borderRadius: '50%',\r\n                                    backgroundColor: 'rgba(16, 185, 129, 0.2)',\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    justifyContent: 'center'\r\n                                }}>\r\n                                    <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#10B981\" strokeWidth=\"2\">\r\n                                        <polyline points=\"20 6 9 17 4 12\" />\r\n                                    </svg>\r\n                                </div>\r\n                                <div>\r\n                                    <h2 style={{ fontSize: 18, fontWeight: 700, margin: 0 }}>Code Detected</h2>\r\n                                    <span style={{ fontSize: 12, color: THEME.textSecondary }}>{scannedFormat}</span>\r\n                                </div>\r\n                            </div>\r\n                            <button\r\n                                onClick={handleScanNext}\r\n                                style={{\r\n                                    width: 32,\r\n                                    height: 32,\r\n                                    borderRadius: '50%',\r\n                                    backgroundColor: THEME.bgDark,\r\n                                    border: 'none',\r\n                                    color: THEME.textSecondary,\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    justifyContent: 'center',\r\n                                    cursor: 'pointer'\r\n                                }}\r\n                            >\r\n                                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                                    <path d=\"M18 6L6 18M6 6l12 12\" />\r\n                                </svg>\r\n                            </button>\r\n                        </div>\r\n\r\n                        {/* Raw Data */}\r\n                        <div style={{\r\n                            backgroundColor: 'rgba(0,0,0,0.5)',\r\n                            borderRadius: 12,\r\n                            padding: 16,\r\n                            marginBottom: 16,\r\n                            border: `1px solid ${THEME.bgDark}`\r\n                        }}>\r\n                            <p style={{ fontSize: 12, color: THEME.textSecondary, marginBottom: 8, textTransform: 'uppercase', letterSpacing: 1 }}>\r\n                                Scanned Data\r\n                            </p>\r\n                            <p style={{\r\n                                fontSize: 18,\r\n                                fontFamily: 'monospace',\r\n                                wordBreak: 'break-all',\r\n                                margin: 0\r\n                            }}>\r\n                                {scannedCode}\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Actions */}\r\n                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12 }}>\r\n                            <button\r\n                                onClick={() => navigator.clipboard.writeText(scannedCode)}\r\n                                style={{\r\n                                    padding: 14,\r\n                                    backgroundColor: THEME.bgDark,\r\n                                    border: `1px solid ${THEME.bgPaper}`,\r\n                                    borderRadius: 12,\r\n                                    color: THEME.text,\r\n                                    fontWeight: 600,\r\n                                    cursor: 'pointer',\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    justifyContent: 'center',\r\n                                    gap: 8\r\n                                }}\r\n                            >\r\n                                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                                    <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" />\r\n                                    <path d=\"M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1\" />\r\n                                </svg>\r\n                                Copy\r\n                            </button>\r\n                            <button\r\n                                onClick={handleProcessProduct}\r\n                                disabled={isProcessing}\r\n                                style={{\r\n                                    padding: 14,\r\n                                    background: `linear-gradient(135deg, ${THEME.primary} 0%, #8B5CF6 100%)`,\r\n                                    border: 'none',\r\n                                    borderRadius: 12,\r\n                                    color: THEME.text,\r\n                                    fontWeight: 600,\r\n                                    cursor: 'pointer',\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    justifyContent: 'center',\r\n                                    gap: 8,\r\n                                    boxShadow: `0 4px 12px ${THEME.primary}40`,\r\n                                    opacity: isProcessing ? 0.7 : 1\r\n                                }}\r\n                            >\r\n                                {isProcessing ? 'Loading...' : 'Γ£¿ View Product'}\r\n                            </button>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={handleScanNext}\r\n                            style={{\r\n                                width: '100%',\r\n                                marginTop: 12,\r\n                                padding: 14,\r\n                                background: THEME.secondary,\r\n                                border: 'none',\r\n                                borderRadius: 12,\r\n                                color: '#000',\r\n                                fontWeight: 600,\r\n                                cursor: 'pointer',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                                gap: 8,\r\n                                boxShadow: `0 4px 12px ${THEME.secondary}40`\r\n                            }}\r\n                        >\r\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                                <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\" />\r\n                                <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\" />\r\n                                <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\" />\r\n                                <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\" />\r\n                            </svg>\r\n                            Scan Next\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Error Toast */}\r\n            {error && (\r\n                <div style={{\r\n                    position: 'fixed',\r\n                    top: 80,\r\n                    left: '50%',\r\n                    transform: 'translateX(-50%)',\r\n                    backgroundColor: 'rgba(239, 68, 68, 0.9)',\r\n                    backdropFilter: 'blur(8px)',\r\n                    color: THEME.text,\r\n                    padding: '12px 24px',\r\n                    borderRadius: 24,\r\n                    boxShadow: '0 8px 32px rgba(239, 68, 68, 0.3)',\r\n                    zIndex: 100,\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    gap: 8,\r\n                    fontSize: 14,\r\n                    fontWeight: 500\r\n                }}>\r\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                        <path d=\"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z\" />\r\n                        <line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"13\" />\r\n                        <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\" />\r\n                    </svg>\r\n                    {error}\r\n                </div>\r\n            )}\r\n\r\n            {/* CSS Animations */}\r\n            <style jsx global>{`\r\n                @keyframes scan {\r\n                    0% { top: 0%; transform: scaleX(0.9); }\r\n                    100% { top: calc(100% - 4px); transform: scaleX(1); }\r\n                }\r\n                \r\n                #${SCANNER_REGION_ID} video {\r\n                    width: 100% !important;\r\n                    height: 100% !important;\r\n                    object-fit: cover !important;\r\n                    border-radius: 0 !important;\r\n                }\r\n                \r\n                #${SCANNER_REGION_ID} > div {\r\n                    display: none !important;\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n}\r\n\r\n// Corner Component\r\nfunction Corner({ position, color }: { position: 'tl' | 'tr' | 'bl' | 'br'; color: string }) {\r\n    const styles: React.CSSProperties = {\r\n        position: 'absolute',\r\n        width: 32,\r\n        height: 32,\r\n        borderStyle: 'solid',\r\n        borderColor: color,\r\n        boxShadow: `0 0 8px ${color}60`\r\n    };\r\n\r\n    switch (position) {\r\n        case 'tl':\r\n            return <div style={{ ...styles, top: 0, left: 0, borderWidth: '4px 0 0 4px', borderTopLeftRadius: 8 }} />;\r\n        case 'tr':\r\n            return <div style={{ ...styles, top: 0, right: 0, borderWidth: '4px 4px 0 0', borderTopRightRadius: 8 }} />;\r\n        case 'bl':\r\n            return <div style={{ ...styles, bottom: 0, left: 0, borderWidth: '0 0 4px 4px', borderBottomLeftRadius: 8 }} />;\r\n        case 'br':\r\n            return <div style={{ ...styles, bottom: 0, right: 0, borderWidth: '0 4px 4px 0', borderBottomRightRadius: 8 }} />;\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\search\\photo\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":76,"column":27,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3714,3899],"text":"\r\n                        Take a clear photo of a product or upload an image.\r\n                        We&apos;ll look for barcodes first, then perform a visual search.\r\n                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3714,3899],"text":"\r\n                        Take a clear photo of a product or upload an image.\r\n                        We&lsquo;ll look for barcodes first, then perform a visual search.\r\n                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3714,3899],"text":"\r\n                        Take a clear photo of a product or upload an image.\r\n                        We&#39;ll look for barcodes first, then perform a visual search.\r\n                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3714,3899],"text":"\r\n                        Take a clear photo of a product or upload an image.\r\n                        We&rsquo;ll look for barcodes first, then perform a visual search.\r\n                    "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport React from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { ArrowLeft, Camera, Lock } from 'lucide-react';\r\nimport ImageProductSearcher from '@/components/search/ImageProductSearcher';\r\nimport QuickActionHistory from '@/components/search/QuickActionHistory';\r\nimport Link from 'next/link';\r\n\r\nexport default function SearchByPhotoPage() {\r\n    const router = useRouter();\r\n    const { features, userProfile, loading } = useAuth();\r\n\r\n    // Eligibility Check - Use tier-based feature flag\r\n    const hasAccess = features.visualSearch || userProfile?.hasBetaAccess;\r\n\r\n    if (loading) {\r\n        return <div className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-black\">\r\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500\"></div>\r\n        </div>;\r\n    }\r\n\r\n    if (!hasAccess) {\r\n        return (\r\n            <div className=\"min-h-screen bg-gray-50 dark:bg-black flex flex-col items-center justify-center p-4\">\r\n                <div className=\"w-full max-w-md bg-white dark:bg-zinc-900 rounded-2xl shadow-xl overflow-hidden text-center p-8\">\r\n                    <div className=\"w-16 h-16 mx-auto bg-amber-100 dark:bg-amber-500/10 rounded-full flex items-center justify-center mb-6\">\r\n                        <Lock className=\"w-8 h-8 text-amber-500\" />\r\n                    </div>\r\n                    <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">Premium Feature</h1>\r\n                    <p className=\"text-gray-600 dark:text-gray-400 mb-8\">\r\n                        Search by Photo is available exclusively for Pro and Ultimate members.\r\n                    </p>\r\n                    <Link\r\n                        href=\"/pricing\"\r\n                        className=\"block w-full py-3 px-4 bg-amber-500 hover:bg-amber-600 text-white rounded-xl font-semibold transition-colors\"\r\n                    >\r\n                        Upgrade to Unlock\r\n                    </Link>\r\n                    <button\r\n                        onClick={() => router.back()}\r\n                        className=\"mt-4 text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\"\r\n                    >\r\n                        Go Back\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50 dark:bg-black flex flex-col\">\r\n            {/* Header */}\r\n            <div className=\"bg-white dark:bg-zinc-900 border-b border-gray-200 dark:border-zinc-800 p-4 flex items-center sticky top-0 z-30\">\r\n                <button\r\n                    onClick={() => router.back()}\r\n                    className=\"p-2 -ml-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-zinc-800 rounded-lg transition-colors\"\r\n                >\r\n                    <ArrowLeft className=\"w-5 h-5\" />\r\n                </button>\r\n                <div className=\"ml-3 flex items-center gap-2\">\r\n                    <div className=\"p-1.5 bg-emerald-100 dark:bg-emerald-500/10 rounded-md\">\r\n                        <Camera className=\"w-5 h-5 text-emerald-600 dark:text-emerald-400\" />\r\n                    </div>\r\n                    <h1 className=\"font-semibold text-gray-900 dark:text-white\">Search by Photo</h1>\r\n                </div>\r\n            </div>\r\n\r\n            <main className=\"flex-1 p-4 max-w-md w-full mx-auto space-y-6\">\r\n\r\n                {/* Search Area */}\r\n                <section>\r\n                    <ImageProductSearcher />\r\n                    <p className=\"mt-3 text-xs text-center text-gray-500 dark:text-gray-400\">\r\n                        Take a clear photo of a product or upload an image.\r\n                        We'll look for barcodes first, then perform a visual search.\r\n                    </p>\r\n                </section>\r\n\r\n                {/* History Section */}\r\n                <section>\r\n                    <QuickActionHistory />\r\n                </section>\r\n\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\set-admin\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'doc' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateDoc' is defined but never used.","line":5,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'serverTimestamp' is defined but never used.","line":5,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'db' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2038,2041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2038,2041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { Container, Paper, Typography, Button, Alert, Box, TextField } from '@mui/material';\r\nimport { doc, updateDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { db } from '@/lib/firebase';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { useRouter } from 'next/navigation';\r\nimport { recoverAdminAccount } from '@/app/actions/adminRecovery';\r\n\r\n/**\r\n * Temporary page to set current user as admin\r\n * Visit: http://localhost:3000/set-admin\r\n * Login first, then visit this page and click the button\r\n */\r\nexport default function SetAdminPage() {\r\n    const { user } = useAuth();\r\n    const router = useRouter();\r\n    const [loading, setLoading] = useState(false);\r\n    const [success, setSuccess] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [token, setToken] = useState('');\r\n    const [code, setCode] = useState('');\r\n\r\n    const setAsAdmin = async () => {\r\n        if (!user) {\r\n            setError('Please login first');\r\n            return;\r\n        }\r\n\r\n        if (!token) {\r\n            setError('Please enter a valid Token');\r\n            return;\r\n        }\r\n\r\n        if (!user.email) {\r\n            setError('User email is required.');\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            console.log('Validating 2FA token for:', user.email);\r\n\r\n            // Use Server Action Key + Code\r\n            const result = await recoverAdminAccount(token, code, user.email, user.uid);\r\n\r\n            if (!result.success) {\r\n                throw new Error(result.message);\r\n            }\r\n\r\n            setSuccess(true);\r\n            console.log('Γ£à Successfully set', user.email, 'as admin!');\r\n\r\n            // Redirect to admin dashboard after 2 seconds\r\n            // Force reload to update claims/context\r\n            setTimeout(() => {\r\n                window.location.href = '/admin';\r\n            }, 2000);\r\n        } catch (err: any) {\r\n            console.error('Error details:', err);\r\n            setError(err.message || 'Failed to set admin role');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (!user) {\r\n        return (\r\n            <Container maxWidth=\"sm\" sx={{ mt: 5 }}>\r\n                <Alert severity=\"warning\">\r\n                    Please <a href=\"/login\" style={{ color: 'inherit', fontWeight: 'bold' }}>login</a> first\r\n                </Alert>\r\n            </Container>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Container maxWidth=\"sm\" sx={{ mt: 5 }}>\r\n            <Paper sx={{ p: 4 }}>\r\n                <Typography variant=\"h5\" fontWeight=\"bold\" gutterBottom>\r\n                    Set Admin Role\r\n                </Typography>\r\n\r\n                <Typography variant=\"body2\" color=\"text.secondary\" paragraph>\r\n                    Current user: <strong>{user.email}</strong>\r\n                </Typography>\r\n\r\n                <Typography variant=\"body2\" paragraph>\r\n                    Click the button below to set this user as an administrator.\r\n                </Typography>\r\n\r\n                {error && (\r\n                    <Alert severity=\"error\" sx={{ mb: 2 }}>\r\n                        {error}\r\n                    </Alert>\r\n                )}\r\n\r\n                {success && (\r\n                    <Alert severity=\"success\" sx={{ mb: 2 }}>\r\n                        Γ£à Successfully set as admin! Redirecting to admin dashboard...\r\n                    </Alert>\r\n                )}\r\n\r\n                <Box sx={{ mb: 3 }}>\r\n                    <TextField\r\n                        label=\"Recovery Token ID\"\r\n                        fullWidth\r\n                        variant=\"outlined\"\r\n                        value={token}\r\n                        onChange={(e) => setToken(e.target.value)}\r\n                        placeholder=\"e.g. admin-recovery-key\"\r\n                    />\r\n                </Box>\r\n\r\n                <Box sx={{ mb: 3 }}>\r\n                    <TextField\r\n                        label=\"Authenticator Code (2FA)\"\r\n                        fullWidth\r\n                        variant=\"outlined\"\r\n                        value={code}\r\n                        onChange={(e) => setCode(e.target.value.replace(/\\D/g, ''))} // Integers only\r\n                        placeholder=\"000 000\"\r\n                        inputProps={{ maxLength: 6 }}\r\n                    />\r\n                </Box>\r\n\r\n                <Box sx={{ display: 'flex', gap: 2 }}>\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        onClick={setAsAdmin}\r\n                        disabled={loading || success || !token}\r\n                        fullWidth\r\n                    >\r\n                        {loading ? 'Verifying...' : success ? 'Γ£à Done!' : 'Verify & Recover'}\r\n                    </Button>\r\n\r\n                    <Button\r\n                        variant=\"outlined\"\r\n                        onClick={() => router.push('/profile')}\r\n                        disabled={loading}\r\n                    >\r\n                        Cancel\r\n                    </Button>\r\n                </Box>\r\n            </Paper>\r\n        </Container>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\signup\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3082,3085],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3082,3085],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useRef } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Box, TextField, Typography, Alert, Grid, Paper } from '@mui/material';\r\nimport PersonAddIcon from '@mui/icons-material/PersonAdd';\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/navigation';\r\nimport { signInWithCustomToken, sendEmailVerification } from 'firebase/auth';\r\nimport { auth } from '@/lib/firebase';\r\nimport AnimatedButton from '@/components/ui/AnimatedButton';\r\nimport ScrollReveal from '@/components/animation/ScrollReveal';\r\nimport QrCodeScannerIcon from '@mui/icons-material/QrCodeScanner';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport ReCAPTCHA from 'react-google-recaptcha';\r\nimport { registerUser } from '@/app/actions';\r\n\r\nconst RECAPTCHA_SITE_KEY = '6LeYMiYsAAAAAJ4yVoBV_fuMTNQgO2eni4WSAc1P'; // v2 Site Key\r\n\r\nexport default function SignupPage() {\r\n    const [loading, setLoading] = useState(false);\r\n    const [signedUp, setSignedUp] = useState(false);\r\n    const [error, setError] = useState('');\r\n    const [passwordError, setPasswordError] = useState('');\r\n    const router = useRouter();\r\n    const { t } = useTranslation();\r\n\r\n    const recaptchaRef = useRef<ReCAPTCHA>(null);\r\n\r\n    const handleSignup = async (e: React.FormEvent<HTMLFormElement>) => {\r\n        e.preventDefault();\r\n        const data = new FormData(e.currentTarget);\r\n        const password = data.get('password') as string;\r\n        const confirmPassword = data.get('confirmPassword') as string;\r\n\r\n        if (password !== confirmPassword) {\r\n            setPasswordError(t('auth_password_mismatch'));\r\n            return;\r\n        }\r\n        if (password.length < 6) {\r\n            setPasswordError(t('auth_password_too_short'));\r\n            return;\r\n        }\r\n\r\n        setPasswordError('');\r\n        setError('');\r\n        setLoading(true);\r\n\r\n        try {\r\n            // Execute invisible reCAPTCHA\r\n            // This will trigger the challenge if needed, or return token immediately\r\n            const token = await recaptchaRef.current?.executeAsync();\r\n\r\n            if (!token) {\r\n                console.warn('reCAPTCHA failed to generate token');\r\n                setError(t('auth_captcha_failed'));\r\n                return;\r\n            }\r\n\r\n            console.log(\"reCAPTCHA Token obtained, calling server...\");\r\n            const result = await registerUser(data, token);\r\n\r\n            if (!result.success) {\r\n                // If failed, reset captcha so user can try again\r\n                recaptchaRef.current?.reset();\r\n                throw new Error(result.error || t('auth_registration_failed'));\r\n            }\r\n\r\n            if (result.token) {\r\n                console.log(\"Signing in with custom token...\");\r\n                await signInWithCustomToken(auth, result.token);\r\n\r\n                if (auth.currentUser) {\r\n                    await sendEmailVerification(auth.currentUser);\r\n                }\r\n\r\n                setSignedUp(true);\r\n            }\r\n\r\n        } catch (err: any) {\r\n            console.error('Signup error:', err);\r\n            setError(err.message || t('auth_create_account_failed'));\r\n            recaptchaRef.current?.reset();\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (signedUp) {\r\n        return (\r\n            <Box sx={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', p: 3 }}>\r\n                <Paper sx={{ p: 6, maxWidth: 500, textAlign: 'center' }}>\r\n                    <CheckCircleIcon sx={{ fontSize: 80, color: 'success.main', mb: 3 }} />\r\n                    <Typography variant=\"h4\" fontWeight=\"bold\" gutterBottom>\r\n                        {t('auth_account_created')}\r\n                    </Typography>\r\n                    <Typography variant=\"body1\" color=\"text.secondary\" paragraph>\r\n                        {t('auth_check_email_verify')}\r\n                    </Typography>\r\n                    <AnimatedButton variant=\"contained\" size=\"large\" onClick={() => router.push('/login')} sx={{ mt: 2 }}>\r\n                        {t('auth_go_to_login')}\r\n                    </AnimatedButton>\r\n                </Paper>\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Grid container sx={{ minHeight: '100vh' }}>\r\n            {/* Left Side - Form */}\r\n            <Grid\r\n                size={{ xs: 12, md: 6 }}\r\n                sx={{\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    justifyContent: 'center',\r\n                    p: { xs: 3, md: 8 },\r\n                }}\r\n            >\r\n                <Paper elevation={0} sx={{ maxWidth: 450, mx: 'auto', width: '100%', p: { xs: 3, md: 4 }, bgcolor: 'transparent' }}>\r\n                    <ScrollReveal>\r\n                        <Box sx={{ textAlign: 'center', mb: 4 }}>\r\n                            <PersonAddIcon sx={{ fontSize: 48, color: 'primary.main', mb: 2 }} />\r\n                            <Typography variant=\"h4\" fontWeight=\"bold\" gutterBottom>\r\n                                {t('auth_create_account_title')}\r\n                            </Typography>\r\n                            <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                {t('auth_create_account_subtitle')}\r\n                            </Typography>\r\n                        </Box>\r\n\r\n                        {error && <Alert severity=\"error\" sx={{ mb: 3 }}>{error}</Alert>}\r\n\r\n                        <Box component=\"form\" onSubmit={handleSignup} sx={{ display: 'flex', flexDirection: 'column', gap: 2.5 }}>\r\n                            <TextField\r\n                                name=\"email\"\r\n                                label={t('auth_email')}\r\n                                type=\"email\"\r\n                                required\r\n                                fullWidth\r\n                                disabled={loading}\r\n                                autoComplete=\"email\"\r\n                            />\r\n                            <TextField\r\n                                name=\"password\"\r\n                                label={t('auth_password')}\r\n                                type=\"password\"\r\n                                required\r\n                                fullWidth\r\n                                helperText={t('auth_password_helper')}\r\n                                disabled={loading}\r\n                                autoComplete=\"new-password\"\r\n                            />\r\n                            <TextField\r\n                                name=\"confirmPassword\"\r\n                                label={t('auth_confirm_password')}\r\n                                type=\"password\"\r\n                                required\r\n                                fullWidth\r\n                                error={!!passwordError}\r\n                                helperText={passwordError}\r\n                                disabled={loading}\r\n                                autoComplete=\"new-password\"\r\n                            />\r\n\r\n                            {/* Invisible reCAPTCHA - ensure it is mounted */}\r\n                            <ReCAPTCHA\r\n                                ref={recaptchaRef}\r\n                                size=\"invisible\"\r\n                                sitekey={RECAPTCHA_SITE_KEY}\r\n                            />\r\n\r\n                            <AnimatedButton\r\n                                type=\"submit\"\r\n                                fullWidth\r\n                                size=\"large\"\r\n                                variant=\"contained\"\r\n                                disabled={loading}\r\n                                sx={{\r\n                                    py: 1.5,\r\n                                    mt: 1,\r\n                                    background: 'linear-gradient(45deg, #6C63FF 30%, #00F0FF 90%)',\r\n                                }}\r\n                            >\r\n                                {loading ? t('auth_creating_account') : t('auth_sign_up_button')}\r\n                            </AnimatedButton>\r\n                        </Box>\r\n\r\n                        <Box sx={{ mt: 4, textAlign: 'center' }}>\r\n                            <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                {t('auth_already_have_account')}{' '}\r\n                                <Link href=\"/login\" style={{ color: '#6C63FF', fontWeight: 600, textDecoration: 'none' }}>\r\n                                    {t('auth_sign_in_link')}\r\n                                </Link>\r\n                            </Typography>\r\n                        </Box>\r\n                    </ScrollReveal>\r\n                </Paper>\r\n            </Grid>\r\n\r\n            {/* Right Side - Branding */}\r\n            <Grid\r\n                size={{ xs: 12, md: 6 }}\r\n                sx={{\r\n                    display: { xs: 'none', md: 'flex' },\r\n                    flexDirection: 'column',\r\n                    justifyContent: 'center',\r\n                    alignItems: 'center',\r\n                    background: 'linear-gradient(135deg, #00F0FF 0%, #6C63FF 100%)',\r\n                    color: 'white',\r\n                    p: 6,\r\n                }}\r\n            >\r\n                <ScrollReveal>\r\n                    <QrCodeScannerIcon sx={{ fontSize: 80, mb: 3 }} />\r\n                    <Typography variant=\"h3\" fontWeight=\"bold\" gutterBottom textAlign=\"center\">\r\n                        {t('auth_signup_welcome_title')}\r\n                    </Typography>\r\n                    <Typography variant=\"h6\" sx={{ opacity: 0.9, maxWidth: 400, textAlign: 'center' }}>\r\n                        {t('auth_signup_welcome_desc')}\r\n                    </Typography>\r\n                </ScrollReveal>\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\support\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\template.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\app\\upgrade\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CircularProgress' is defined but never used.","line":4,"column":66,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":82},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserTier' is defined but never used.","line":16,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'refreshProfile' is assigned a value but never used.","line":20,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2051,2054],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2051,2054],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":225,"column":48,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[10712,10823],"text":"\r\n                                            You&apos;re on the Top Tier!\r\n                                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[10712,10823],"text":"\r\n                                            You&lsquo;re on the Top Tier!\r\n                                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[10712,10823],"text":"\r\n                                            You&#39;re on the Top Tier!\r\n                                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[10712,10823],"text":"\r\n                                            You&rsquo;re on the Top Tier!\r\n                                        "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isCurrent' is assigned a value but never used.","line":239,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":239,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":321,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":321,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17767,17770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17767,17770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Container, Paper, Typography, Button, Box, Chip, Alert, CircularProgress, List, ListItem, ListItemIcon, ListItemText, Grid } from '@mui/material';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport StarIcon from '@mui/icons-material/Star';\r\nimport WorkspacePremiumIcon from '@mui/icons-material/WorkspacePremium';\r\nimport DiamondIcon from '@mui/icons-material/Diamond';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { createCheckoutSession } from '@/app/actions/stripe';\r\nimport PageTransition from '@/components/animation/PageTransition';\r\nimport ScrollReveal from '@/components/animation/ScrollReveal';\r\nimport AnimatedButton from '@/components/ui/AnimatedButton';\r\nimport LoadingSpinner from '@/components/ui/LoadingSpinner';\r\nimport { UserTier } from '@/types/user';\r\n\r\nexport default function UpgradePage() {\r\n    const router = useRouter();\r\n    const { user, tier, refreshProfile, tierConfig } = useAuth();\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const [billingCycle, setBillingCycle] = useState<'monthly' | 'lifetime'>('monthly');\r\n\r\n    useEffect(() => {\r\n        if (!user) {\r\n            router.push('/login');\r\n        }\r\n    }, [user, router]);\r\n\r\n    const handleStripeCheckout = async (targetTier: 'plus' | 'pro' | 'ultimate') => {\r\n        if (!user) return;\r\n        setLoading(true);\r\n        setError(null);\r\n        try {\r\n            // Real Stripe Flow\r\n            const { url } = await createCheckoutSession({\r\n                userId: user.uid,\r\n                userEmail: user.email || '',\r\n                tier: targetTier,\r\n                billingCycle\r\n            });\r\n\r\n            if (url) {\r\n                window.location.href = url; // Redirect to Stripe\r\n            } else {\r\n                throw new Error('Failed to start checkout');\r\n            }\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            setError(err.message || 'Failed to process request');\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (!user) return <LoadingSpinner fullScreen />;\r\n\r\n    const tiers = tierConfig ? (['plus', 'pro', 'ultimate'] as const).map(id => {\r\n        const def = tierConfig[id];\r\n        // Helper to format feature list based on config flags\r\n        const featureList = [];\r\n        if (def.features.dailyScanLimit === -1) featureList.push('Unlimited Scans');\r\n        else featureList.push(`${def.features.dailyScanLimit} Daily Scans`);\r\n\r\n        if (def.features.multiScanLimit > 1) featureList.push(`${def.features.multiScanLimit} Product Multi-Scan`);\r\n\r\n        featureList.push(def.features.aiAnalysis === 'premium' ? 'Premium AI Analysis' : (def.features.aiAnalysis === 'advanced' ? 'Advanced AI Insights' : 'Basic AI'));\r\n\r\n        if (def.features.historyLimit === -1) featureList.push('Unlimited History');\r\n        else featureList.push(`${def.features.historyLimit} History Items`);\r\n\r\n        if (def.features.exportFormats.length > 0) featureList.push(`${def.features.exportFormats.join('/').toUpperCase()} Export`);\r\n        if (def.features.aiTruthDetector) featureList.push('AI Truth Detector');\r\n        if (def.features.smartGrading) featureList.push('Smart Grading');\r\n        if (def.features.whiteLabel) featureList.push('White Label Reports');\r\n        if (def.features.prioritySupport) featureList.push('Priority Support');\r\n        if (!def.features.adsEnabled) featureList.push('Ad-Free Experience');\r\n\r\n        return {\r\n            id: def.id,\r\n            name: def.name,\r\n            price: billingCycle === 'monthly' ? `$${def.pricing.monthly}` : `$${def.pricing.lifetime}`,\r\n            originalPrice: billingCycle === 'lifetime' && def.metadata.originalPriceLifetime ? `$${def.metadata.originalPriceLifetime}` : null,\r\n            period: billingCycle === 'monthly' ? '/mo' : '/once',\r\n            color: def.id === 'pro' ? '#FFD700' : (def.id === 'ultimate' ? '#E040FB' : 'primary.main'),\r\n            icon: def.id === 'pro' ? <WorkspacePremiumIcon fontSize=\"large\" /> : (def.id === 'ultimate' ? <DiamondIcon fontSize=\"large\" /> : <StarIcon fontSize=\"large\" />),\r\n            features: featureList,\r\n            isPopular: def.metadata.isPopular || false,\r\n        };\r\n    }) : [\r\n        {\r\n            id: 'plus',\r\n            name: 'Plus',\r\n            price: billingCycle === 'monthly' ? '$3.99' : '$19.99',\r\n            originalPrice: billingCycle === 'lifetime' ? '$39.99' : null,\r\n            period: billingCycle === 'monthly' ? '/mo' : '/once',\r\n            color: 'primary.main',\r\n            icon: <StarIcon fontSize=\"large\" />,\r\n            features: [\r\n                '20 Daily Scans',\r\n                'Advanced AI Insights',\r\n                'Bring Your Own Key (Premium AI)',\r\n                '3 Product Multi-Scan',\r\n                '50 History Items',\r\n                'CSV Export',\r\n                'Ad-Free Experience'\r\n            ],\r\n            isPopular: false,\r\n        },\r\n        {\r\n            id: 'pro',\r\n            name: 'Pro',\r\n            price: billingCycle === 'monthly' ? '$7.99' : '$49.99',\r\n            originalPrice: billingCycle === 'lifetime' ? '$99.99' : null,\r\n            period: billingCycle === 'monthly' ? '/mo' : '/once',\r\n            color: '#FFD700', // Gold\r\n            icon: <WorkspacePremiumIcon fontSize=\"large\" />,\r\n            features: [\r\n                'Unlimited Scans',\r\n                'Premium AI (Groq/Gemini/DeepSeek) Included',\r\n                'Global Search Access',\r\n                '10 Product Multi-Scan',\r\n                'Unlimited History',\r\n                'PDF & CSV Export',\r\n                'AI Truth Detector',\r\n                'Smart Grading'\r\n            ],\r\n            isPopular: true,\r\n        },\r\n        {\r\n            id: 'ultimate',\r\n            name: 'Ultimate',\r\n            price: billingCycle === 'monthly' ? '$14.99' : '$79.99',\r\n            originalPrice: billingCycle === 'lifetime' ? '$159.99' : null,\r\n            period: billingCycle === 'monthly' ? '/mo' : '/once',\r\n            color: '#E040FB', // Purple detail\r\n            icon: <DiamondIcon fontSize=\"large\" />,\r\n            features: [\r\n                'Everything in Pro',\r\n                'Unlimited Multi-Scan',\r\n                'White Label Reports',\r\n                'Priority Support (Fast Lane)',\r\n                'Early Beta Access',\r\n                'Custom Health Alerts',\r\n                'Export to Excel (XLSX)',\r\n                'Dedicated Account Support'\r\n            ],\r\n            isPopular: false,\r\n        }\r\n    ];\r\n\r\n    return (\r\n        <PageTransition>\r\n            <Container maxWidth=\"lg\" sx={{ mt: 5, mb: 10 }}>\r\n                <Box sx={{ textAlign: 'center', mb: 4 }}>\r\n                    <Typography variant=\"h3\" fontWeight=\"bold\" gutterBottom>\r\n                        Choose Your Plan\r\n                    </Typography>\r\n                    <Typography variant=\"h6\" color=\"text.secondary\">\r\n                        Unlock the power of AI food analysis with our flexible pricing tiers.\r\n                    </Typography>\r\n                </Box>\r\n\r\n                {/* Billing Cycle Toggle */}\r\n                <Box sx={{ display: 'flex', justifyContent: 'center', mb: 8 }}>\r\n                    <Paper\r\n                        elevation={0}\r\n                        sx={{\r\n                            display: 'flex',\r\n                            p: 0.5,\r\n                            borderRadius: 10,\r\n                            bgcolor: 'grey.100',\r\n                            border: '1px solid',\r\n                            borderColor: 'divider'\r\n                        }}\r\n                    >\r\n                        <Button\r\n                            onClick={() => setBillingCycle('monthly')}\r\n                            variant={billingCycle === 'monthly' ? 'contained' : 'text'}\r\n                            sx={{\r\n                                borderRadius: 10,\r\n                                px: 4,\r\n                                py: 1,\r\n                                boxShadow: billingCycle === 'monthly' ? 2 : 0,\r\n                                bgcolor: billingCycle === 'monthly' ? 'white' : 'transparent',\r\n                                color: billingCycle === 'monthly' ? 'primary.main' : 'text.secondary',\r\n                                '&:hover': { bgcolor: billingCycle === 'monthly' ? 'white' : 'transparent' }\r\n                            }}\r\n                        >\r\n                            Monthly\r\n                        </Button>\r\n                        <Button\r\n                            onClick={() => setBillingCycle('lifetime')}\r\n                            variant={billingCycle === 'lifetime' ? 'contained' : 'text'}\r\n                            sx={{\r\n                                borderRadius: 10,\r\n                                px: 4,\r\n                                py: 1,\r\n                                boxShadow: billingCycle === 'lifetime' ? 2 : 0,\r\n                                bgcolor: billingCycle === 'lifetime' ? 'primary.main' : 'transparent',\r\n                                color: billingCycle === 'lifetime' ? 'white' : 'text.secondary',\r\n                                '&:hover': { bgcolor: billingCycle === 'lifetime' ? 'primary.main' : 'transparent' }\r\n                            }}\r\n                        >\r\n                            Lifetime (Launch Sale)\r\n                        </Button>\r\n                    </Paper>\r\n                </Box>\r\n\r\n                {error && <Alert severity=\"error\" sx={{ mb: 4, maxWidth: 600, mx: 'auto' }}>{error}</Alert>}\r\n\r\n                <Grid container spacing={4} alignItems=\"stretch\" justifyContent=\"center\">\r\n                    {(() => {\r\n                        const tierLevels: Record<string, number> = { free: 0, plus: 1, pro: 2, ultimate: 3 };\r\n                        const currentLevel = tierLevels[tier || 'free'] || 0;\r\n                        const visibleTiers = tiers.filter((plan) => (tierLevels[plan.id] || 0) > currentLevel);\r\n\r\n                        if (visibleTiers.length === 0) {\r\n                            return (\r\n                                <Grid size={{ xs: 12 }}>\r\n                                    <Paper sx={{ p: 6, textAlign: 'center', borderRadius: 4, bgcolor: 'background.paper' }}>\r\n                                        <DiamondIcon sx={{ fontSize: 60, color: 'primary.main', mb: 2 }} />\r\n                                        <Typography variant=\"h4\" fontWeight=\"bold\" gutterBottom>\r\n                                            You're on the Top Tier!\r\n                                        </Typography>\r\n                                        <Typography variant=\"body1\" color=\"text.secondary\" sx={{ mb: 4 }}>\r\n                                            You have access to all features. Thank you for being an Ultimate member.\r\n                                        </Typography>\r\n                                        <Button variant=\"outlined\" onClick={() => router.push('/profile')}>\r\n                                            Go to Profile\r\n                                        </Button>\r\n                                    </Paper>\r\n                                </Grid>\r\n                            );\r\n                        }\r\n\r\n                        return visibleTiers.map((plan) => {\r\n                            const isCurrent = tier === plan.id;\r\n                            const isPopular = plan.isPopular;\r\n\r\n                            return (\r\n                                <Grid size={{ xs: 12, md: 4 }} key={plan.id}>\r\n                                    <ScrollReveal delay={0.1 * (plan.id === 'plus' ? 1 : plan.id === 'pro' ? 2 : 3)} className=\"h-full\">\r\n                                        <Paper\r\n                                            elevation={isPopular ? 8 : 2}\r\n                                            sx={{\r\n                                                p: 4,\r\n                                                height: '100%',\r\n                                                borderRadius: 4,\r\n                                                position: 'relative',\r\n                                                display: 'flex',\r\n                                                flexDirection: 'column',\r\n                                                transition: 'transform 0.2s',\r\n                                                border: isPopular ? '2px solid' : '1px solid',\r\n                                                borderColor: isPopular ? 'warning.main' : 'divider',\r\n                                                transform: isPopular ? { md: 'scale(1.05)' } : 'none',\r\n                                                zIndex: isPopular ? 2 : 1,\r\n                                                '&:hover': {\r\n                                                    transform: isPopular ? { md: 'scale(1.06)' } : 'translateY(-4px)',\r\n                                                    boxShadow: 8\r\n                                                }\r\n                                            }}\r\n                                        >\r\n                                            {isPopular && (\r\n                                                <Chip\r\n                                                    label=\"MOST POPULAR\"\r\n                                                    color=\"warning\"\r\n                                                    sx={{\r\n                                                        position: 'absolute',\r\n                                                        top: -16,\r\n                                                        left: '50%',\r\n                                                        transform: 'translateX(-50%)',\r\n                                                        fontWeight: 'bold',\r\n                                                        boxShadow: 2\r\n                                                    }}\r\n                                                />\r\n                                            )}\r\n\r\n                                            <Box sx={{ textAlign: 'center', mb: 4 }}>\r\n                                                <Box sx={{ color: plan.color, mb: 2 }}>\r\n                                                    {plan.icon}\r\n                                                </Box>\r\n                                                <Typography variant=\"h5\" fontWeight=\"bold\">\r\n                                                    {plan.name}\r\n                                                </Typography>\r\n                                                <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'baseline', mt: 2, flexDirection: 'column' }}>\r\n                                                    {plan.originalPrice && (\r\n                                                        <Typography variant=\"body1\" sx={{ textDecoration: 'line-through', color: 'text.secondary', mb: -0.5 }}>\r\n                                                            {plan.originalPrice}\r\n                                                        </Typography>\r\n                                                    )}\r\n                                                    <Box sx={{ display: 'flex', alignItems: 'baseline', justifyContent: 'center', width: '100%' }}>\r\n                                                        <Typography variant=\"h3\" fontWeight=\"bold\" color={plan.originalPrice ? 'error.main' : 'inherit'}>\r\n                                                            {plan.price}\r\n                                                        </Typography>\r\n                                                        <Typography variant=\"subtitle1\" color=\"text.secondary\">\r\n                                                            {plan.period}\r\n                                                        </Typography>\r\n                                                    </Box>\r\n                                                </Box>\r\n                                            </Box>\r\n\r\n                                            <List sx={{ mb: 4, flex: 1 }}>\r\n                                                {plan.features.map((feature, idx) => (\r\n                                                    <ListItem key={idx} disablePadding sx={{ mb: 1.5 }}>\r\n                                                        <ListItemIcon sx={{ minWidth: 36 }}>\r\n                                                            <CheckCircleIcon fontSize=\"small\" color={plan.id === 'free' ? 'disabled' : 'success'} />\r\n                                                        </ListItemIcon>\r\n                                                        <ListItemText primary={feature} secondaryTypographyProps={{ variant: 'caption' }} />\r\n                                                    </ListItem>\r\n                                                ))}\r\n                                            </List>\r\n\r\n                                            <Box sx={{ mt: 'auto', display: 'flex', flexDirection: 'column', gap: 2 }}>\r\n                                                <AnimatedButton\r\n                                                    variant=\"contained\"\r\n                                                    color={isPopular ? 'warning' : 'primary'}\r\n                                                    fullWidth\r\n                                                    size=\"large\"\r\n                                                    onClick={() => handleStripeCheckout(plan.id as any)}\r\n                                                    disabled={loading}\r\n                                                >\r\n                                                    {loading ? 'Processing...' : billingCycle === 'lifetime' ? 'Get Lifetime Access' : `Subscribe Monthly`}\r\n                                                </AnimatedButton>\r\n                                                <Button\r\n                                                    variant=\"text\"\r\n                                                    size=\"small\"\r\n                                                    onClick={() => router.push('/request-access')}\r\n                                                    sx={{ color: 'text.secondary' }}\r\n                                                >\r\n                                                    Request Free Access\r\n                                                </Button>\r\n                                            </Box>\r\n                                        </Paper>\r\n                                    </ScrollReveal>\r\n                                </Grid>\r\n                            );\r\n                        });\r\n                    })()}\r\n                </Grid>\r\n\r\n                <Box sx={{ textAlign: 'center', mt: 8 }}>\r\n                    <Button onClick={() => router.push('/')} color=\"inherit\">\r\n                        Maybe Later\r\n                    </Button>\r\n                </Box>\r\n            </Container>\r\n        </PageTransition>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\PushNotificationSetup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\SpecialWelcome.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TOTAL_DURATION' is assigned a value but never used.","line":11,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'startSequence'. Either include it or remove the dependency array.","line":40,"column":8,"nodeType":"ArrayExpression","endLine":40,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [user, userProfile, loading, startSequence]","fix":{"range":[1969,1997],"text":"[user, userProfile, loading, startSequence]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState, useRef } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport Confetti from 'react-confetti';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { markUserAsWelcomed } from '@/services/subscriptionService';\r\nimport { Play } from 'lucide-react';\r\n\r\nconst TARGET_EMAIL = 'fatimazahrafliou@gmail.com';\r\nconst TOTAL_DURATION = 50000; // 50s failsafe check\r\n\r\nconst LETTER_TEXT = \"Mer7ba bik a Titim Γ¥ñ∩╕Å ... Bghit nakhod had lweqt sghir bash ngoul lik thanks ... Nti machi ghir 'First User', nti awel wa7ed knt baghito ychouf had lkhdma ... Had l'project bditou b bzaf dyal l'efforts ... Walakin l fact annaki nti hna bash tjrbih ... 3ndo m3na special bzaf liya ... Ntmna ikon 3jbk l'experience kima 3jbni nswabha lik ... Welcome to TruthLens (DEAD ENGINE).\";\r\n\r\nexport default function SpecialWelcome() {\r\n    const { user, userProfile, loading } = useAuth();\r\n    const [isVisible, setIsVisible] = useState(false);\r\n    const [stage, setStage] = useState<'idle' | 'boot' | 'drop' | 'letter'>('idle');\r\n    const [bootLines, setBootLines] = useState<string[]>([]);\r\n    const [displayedText, setDisplayedText] = useState('');\r\n    const [showButton, setShowButton] = useState(false);\r\n\r\n    // Refs for audio and confetti\r\n    const audioRef = useRef<HTMLAudioElement | null>(null);\r\n    const [windowSize, setWindowSize] = useState({ width: 0, height: 0 });\r\n\r\n    useEffect(() => {\r\n        // Wait for profile to load\r\n        if (loading || !user || !userProfile) return;\r\n\r\n        // Check persistent flag in Firestore profile\r\n        const hasSeen = userProfile.hasSeenWelcome || false;\r\n\r\n        if (user.email === TARGET_EMAIL && !hasSeen) {\r\n            setIsVisible(true);\r\n            startSequence();\r\n            // We now mark it as seen ONLY after they reach the letter stage or finish.\r\n            // This prevents \"missed\" animations on refresh.\r\n        }\r\n    }, [user, userProfile, loading]);\r\n\r\n    // Cleanup sessionStorage usage as we now use Firestore\r\n    // (Optional: clear legacy storage if it exists)\r\n    useEffect(() => {\r\n        if (typeof window !== 'undefined') {\r\n            sessionStorage.removeItem('hasSeenWelcome');\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        // Window size for confetti\r\n        if (typeof window !== 'undefined') {\r\n            setWindowSize({ width: window.innerWidth, height: window.innerHeight });\r\n            const handleResize = () => setWindowSize({ width: window.innerWidth, height: window.innerHeight });\r\n            window.addEventListener('resize', handleResize);\r\n            return () => window.removeEventListener('resize', handleResize);\r\n        }\r\n    }, []);\r\n\r\n    const startSequence = async () => {\r\n        // 0s-7s: Hacker Intro\r\n        setStage('boot');\r\n        const lines = [\r\n            '> SYSTEM BOOT INITIALIZED...',\r\n            '> CONNECTING TO SECURE SERVER...',\r\n            '> BYPASSING FIREWALL (LAYER 7)...',\r\n            '> DECRYPTING USER DATA...',\r\n            '> ...',\r\n            '> ...',\r\n            '> TARGET IDENTIFIED: VIP_USER_001',\r\n            '> ACCESS GRANTED.'\r\n        ];\r\n\r\n        // Typewriter logic for boot lines\r\n        for (let i = 0; i < lines.length; i++) {\r\n            await new Promise(r => setTimeout(r, 800)); // Stagger lines\r\n            setBootLines(prev => [...prev, lines[i]]);\r\n        }\r\n\r\n        // Wait until 7s mark exactly\r\n        await new Promise(r => setTimeout(r, 7000 - (lines.length * 800)));\r\n\r\n        // 7s: The Drop\r\n        setStage('drop');\r\n        if (audioRef.current) {\r\n            audioRef.current.volume = 0;\r\n            audioRef.current.play().catch(e => console.error(\"Audio play failed\", e));\r\n            // Fade in volume\r\n            const fadeAudio = setInterval(() => {\r\n                if (audioRef.current && audioRef.current.volume < 1) {\r\n                    audioRef.current.volume = Math.min(1, audioRef.current.volume + 0.1);\r\n                } else {\r\n                    clearInterval(fadeAudio);\r\n                }\r\n            }, 200);\r\n        }\r\n\r\n        // 12s: The Letter (5s after drop starts)\r\n        setTimeout(() => {\r\n            setStage('letter');\r\n            startLetterTypewriter();\r\n\r\n            // Mark as seen when the letter reveals (they have seen the effect)\r\n            if (user && user.uid) {\r\n                markUserAsWelcomed(user.uid).catch(e => console.error(\"Welcome mark failed\", e));\r\n            }\r\n        }, 5000);\r\n    };\r\n\r\n    const startLetterTypewriter = async () => {\r\n        const words = LETTER_TEXT.split(' ');\r\n\r\n        for (let i = 0; i < words.length; i++) {\r\n            setDisplayedText(prev => prev + (i === 0 ? '' : ' ') + words[i]);\r\n            const speed = 500 + Math.random() * 200;\r\n            await new Promise(r => setTimeout(r, speed));\r\n        }\r\n    };\r\n\r\n    // Strict timing for button appearance\r\n    useEffect(() => {\r\n        if (stage === 'idle') return;\r\n\r\n        const timer = setTimeout(() => {\r\n            setShowButton(true);\r\n        }, 45000);\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [stage]);\r\n\r\n\r\n    const handleEnterApp = () => {\r\n        // No need to set sessionStorage anymore, Firestore handles it.\r\n\r\n        // Fade out audio\r\n        if (audioRef.current) {\r\n            const fadeOut = setInterval(() => {\r\n                if (audioRef.current && audioRef.current.volume > 0) {\r\n                    audioRef.current.volume = Math.max(0, audioRef.current.volume - 0.1);\r\n                } else {\r\n                    clearInterval(fadeOut);\r\n                    audioRef.current?.pause();\r\n                }\r\n            }, 200);\r\n        }\r\n        setIsVisible(false);\r\n    };\r\n\r\n    // Auto-enter when music ends\r\n    const handleAudioEnded = () => {\r\n        handleEnterApp();\r\n    };\r\n\r\n    if (!isVisible) return null;\r\n\r\n    // Creative \"TITIM\" Animation Variants\r\n    const containerVariants = {\r\n        hidden: { opacity: 0 },\r\n        visible: {\r\n            opacity: 1,\r\n            transition: {\r\n                staggerChildren: 0.1,\r\n                delayChildren: 0.3\r\n            }\r\n        }\r\n    };\r\n\r\n    const letterVariants = {\r\n        hidden: { y: 100, opacity: 0, rotate: -20, scale: 0.5 },\r\n        visible: {\r\n            y: 0,\r\n            opacity: 1,\r\n            rotate: 0,\r\n            scale: 1,\r\n            transition: {\r\n                type: \"spring\" as const,\r\n                damping: 10,\r\n                stiffness: 100\r\n            }\r\n        }\r\n    };\r\n\r\n    const crownVariants = {\r\n        hidden: { y: -50, opacity: 0 },\r\n        visible: {\r\n            y: 0,\r\n            opacity: 1,\r\n            transition: { delay: 1.5, type: 'spring' as const, bounce: 0.5 }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <AnimatePresence>\r\n            {isVisible && (\r\n                <motion.div\r\n                    initial={{ opacity: 0 }}\r\n                    animate={{ opacity: 1 }}\r\n                    exit={{ opacity: 0, transition: { duration: 1.5 } }}\r\n                    className=\"fixed inset-0 z-[9999] bg-black text-white overflow-hidden flex flex-col items-center justify-center p-4\"\r\n                >\r\n                    {/* Audio Element with Auto-Redirect */}\r\n                    <audio\r\n                        ref={audioRef}\r\n                        src=\"/special-song.mp3\"\r\n                        preload=\"auto\"\r\n                        onEnded={handleAudioEnded}\r\n                    />\r\n\r\n                    {/* CONFETTI */}\r\n                    {(stage === 'drop' || stage === 'letter') && (\r\n                        <div className=\"absolute inset-0 pointer-events-none z-0\">\r\n                            <Confetti\r\n                                width={windowSize.width}\r\n                                height={windowSize.height}\r\n                                numberOfPieces={300}\r\n                                gravity={0.12} // Slower gravity for floats\r\n                                colors={['#FFD700', '#FFA500', '#ffffff', '#E5E4E2']}\r\n                            />\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* STAGE 1: HACKER BOOT SCREEN (Mobile Optimized) */}\r\n                    {stage === 'boot' && (\r\n                        <div className=\"w-full max-w-lg font-mono text-sm md:text-base p-4 bg-black/80 border border-green-900 rounded shadow-[0_0_20px_rgba(34,197,94,0.2)]\">\r\n                            {bootLines.map((line, i) => (\r\n                                <motion.div\r\n                                    key={i}\r\n                                    initial={{ opacity: 0, x: -10 }}\r\n                                    animate={{ opacity: 1, x: 0 }}\r\n                                    className=\"mb-1 break-words whitespace-pre-wrap\"\r\n                                >\r\n                                    <span className=\"text-green-500 mr-2 opacity-70\">Γ₧£</span>\r\n                                    <span className={line.includes('ACCESS GRANTED') ? 'text-green-400 font-bold' : 'text-green-700'}>\r\n                                        {line}\r\n                                    </span>\r\n                                </motion.div>\r\n                            ))}\r\n                            <motion.div\r\n                                animate={{ opacity: [0, 1, 0] }}\r\n                                transition={{ repeat: Infinity, duration: 0.8 }}\r\n                                className=\"inline-block w-2 h-4 bg-green-500 ml-1 translate-y-0.5\"\r\n                            />\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* STAGE 2: THE DROP (TITIM) */}\r\n                    {stage !== 'boot' && (\r\n                        <div className=\"absolute top-0 w-full h-full flex flex-col items-center justify-center pointer-events-none\">\r\n                            {/* TITIM Container */}\r\n                            <motion.div\r\n                                variants={containerVariants}\r\n                                initial=\"hidden\"\r\n                                animate=\"visible\"\r\n                                className=\"relative flex items-center justify-center gap-1 md:gap-4 z-20 mb-[30vh]\" // Moved up\r\n                            >\r\n                                {/* Left Crown */}\r\n                                <motion.div variants={crownVariants} className=\"text-4xl md:text-7xl absolute -left-8 md:-left-20 -top-8 md:-top-12 -rotate-12\">\r\n                                    ≡ƒææ\r\n                                </motion.div>\r\n\r\n                                {/* LETTERS */}\r\n                                {['T', 'I', 'T', 'I', 'M'].map((char, index) => (\r\n                                    <motion.span\r\n                                        key={index}\r\n                                        variants={letterVariants}\r\n                                        className=\"text-7xl min-[400px]:text-8xl md:text-9xl lg:text-[12rem] font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 via-yellow-500 to-yellow-800 drop-shadow-[0_0_15px_rgba(234,179,8,0.6)]\"\r\n                                        style={{ fontFamily: 'Impact, sans-serif' }} // Bold impactful font\r\n                                    >\r\n                                        {char}\r\n                                    </motion.span>\r\n                                ))}\r\n\r\n                                {/* Right Crown */}\r\n                                <motion.div variants={crownVariants} className=\"text-4xl md:text-7xl absolute -right-8 md:-right-20 -top-8 md:-top-12 rotate-12\">\r\n                                    ≡ƒææ\r\n                                </motion.div>\r\n                            </motion.div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* STAGE 3: THE LETTER (Mobile Optimized Card) */}\r\n                    <AnimatePresence>\r\n                        {stage === 'letter' && (\r\n                            <motion.div\r\n                                initial={{ y: '100%', opacity: 0 }}\r\n                                animate={{ y: 0, opacity: 1 }}\r\n                                exit={{ opacity: 0 }}\r\n                                transition={{ type: 'spring', damping: 20 }}\r\n                                className=\"absolute bottom-0 w-full z-30 flex justify-center pb-6 md:pb-12 px-4\"\r\n                            >\r\n                                <div className=\"w-full max-w-xl backdrop-blur-md bg-black/70 border border-yellow-500/30 rounded-3xl p-6 md:p-8 shadow-[0_0_50px_rgba(0,0,0,0.8)] relative overflow-hidden\">\r\n                                    {/* Golden Glow Effect */}\r\n                                    <div className=\"absolute -top-20 -right-20 w-40 h-40 bg-yellow-500/20 blur-3xl rounded-full pointer-events-none\" />\r\n                                    <div className=\"absolute -bottom-20 -left-20 w-40 h-40 bg-orange-500/20 blur-3xl rounded-full pointer-events-none\" />\r\n\r\n                                    <p className=\"text-base md:text-xl leading-relaxed text-gray-100 font-medium\" style={{ fontFamily: 'Georgia, serif', textShadow: '0 1px 2px rgba(0,0,0,0.8)' }}>\r\n                                        {displayedText}\r\n                                        <motion.span\r\n                                            animate={{ opacity: [0, 1, 0] }}\r\n                                            transition={{ repeat: Infinity, duration: 0.8 }}\r\n                                            className=\"inline-block text-yellow-500 ml-1\"\r\n                                        >\r\n                                            |\r\n                                        </motion.span>\r\n                                    </p>\r\n\r\n                                    {/* Inline Button (Replaces floating button for better mobile UX) */}\r\n                                    {showButton && (\r\n                                        <motion.div\r\n                                            initial={{ opacity: 0, height: 0 }}\r\n                                            animate={{ opacity: 1, height: 'auto' }}\r\n                                            className=\"mt-6 flex justify-center w-full\"\r\n                                        >\r\n                                            <button\r\n                                                onClick={handleEnterApp}\r\n                                                className=\"w-full md:w-auto px-8 py-3 bg-gradient-to-r from-yellow-500 to-yellow-700 text-black font-bold text-lg rounded-xl hover:scale-105 active:scale-95 transition-transform shadow-lg flex items-center justify-center gap-2\"\r\n                                            >\r\n                                                <span>Enter TruthLens</span>\r\n                                                <Play className=\"w-4 h-4 fill-black\" />\r\n                                            </button>\r\n                                        </motion.div>\r\n                                    )}\r\n                                </div>\r\n                            </motion.div>\r\n                        )}\r\n                    </AnimatePresence>\r\n                </motion.div>\r\n            )}\r\n        </AnimatePresence>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\admin\\ActiveUsersGraph.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\admin\\AdminChatWindow.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MoreVertical' is defined but never used.","line":6,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronDown' is defined but never used.","line":6,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { listenForMessages, sendMessage, markChatAsRead, toggleAdminVisibility } from '@/services/supportService';\r\nimport { ChatMessage } from '@/types/chat';\r\nimport { Send, MoreVertical, ChevronDown, Paperclip, Smile } from 'lucide-react';\r\nimport { Box, Switch, Typography } from '@mui/material'; // Keeping imports clean, although using Tailwind mainly\r\nimport { doc, onSnapshot } from 'firebase/firestore';\r\nimport { db } from '@/lib/firebase';\r\nimport { useTheme } from '@mui/material';\r\n\r\ninterface AdminChatWindowProps {\r\n    chatId: string;\r\n    currentUserId: string;\r\n    chatPartnerEmail?: string; // To show in header if name missing\r\n    chatPartnerName?: string;\r\n    onBack: () => void; // For mobile back\r\n}\r\n\r\nconst EMOJIS = ['≡ƒæì', '≡ƒæï', '≡ƒÄë', '≡ƒÿè', '≡ƒÿé', 'Γ¥ñ∩╕Å', '≡ƒöÑ', '≡ƒñö', '≡ƒæÇ', 'Γ£à', '≡ƒÖÅ', '≡ƒÜÇ'];\r\n\r\nconst AdminChatWindow: React.FC<AdminChatWindowProps> = ({ chatId, currentUserId, chatPartnerEmail, chatPartnerName, onBack }) => {\r\n    const [messages, setMessages] = useState<ChatMessage[]>([]);\r\n    const [newMessage, setNewMessage] = useState('');\r\n    const [showEmojiPicker, setShowEmojiPicker] = useState(false);\r\n    const [userUnreadCount, setUserUnreadCount] = useState<number | null>(null);\r\n    const [adminVisible, setAdminVisible] = useState(false); // New State\r\n    const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n    const [partnerStatus, setPartnerStatus] = useState<'online' | 'offline'>('offline');\r\n    const [lastSeen, setLastSeen] = useState<Date | null>(null);\r\n\r\n    // Fetch Chat Data to get User ID for Presence Check\r\n    const [targetUserId, setTargetUserId] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (!chatId) return;\r\n\r\n        // Mark as read for admin\r\n        markChatAsRead(chatId, 'admin');\r\n\r\n        // Listen for messages\r\n        const unsubscribeMessages = listenForMessages(chatId, (msgs) => {\r\n            setMessages(msgs);\r\n            markChatAsRead(chatId, 'admin');\r\n        });\r\n\r\n        // Listen for chat metadata AND User Presence\r\n        const unsubscribeChat = onSnapshot(doc(db, 'chats', chatId), (docSnap) => {\r\n            if (docSnap.exists()) {\r\n                const data = docSnap.data();\r\n                setUserUnreadCount(data.unreadCountUser);\r\n                setAdminVisible(data.adminVisible || false); // Update state\r\n                if (data.userId) setTargetUserId(data.userId);\r\n            }\r\n        });\r\n\r\n        return () => {\r\n            unsubscribeMessages();\r\n            unsubscribeChat();\r\n        };\r\n    }, [chatId]);\r\n\r\n    const handleToggleVisibility = async (checked: boolean) => {\r\n        setAdminVisible(checked); // Optimistic update\r\n        await toggleAdminVisibility(chatId, checked);\r\n    };\r\n\r\n    // Listen for Realtime User Presence\r\n    useEffect(() => {\r\n        if (!targetUserId) return;\r\n\r\n        const unsubscribeUser = onSnapshot(doc(db, 'users', targetUserId), (docSnap) => {\r\n            if (docSnap.exists()) {\r\n                const userData = docSnap.data();\r\n                const now = new Date();\r\n                const lastSeenDate = userData.lastSeen?.toDate ? userData.lastSeen.toDate() : null;\r\n                setLastSeen(lastSeenDate);\r\n\r\n                // Deterministic Online Check:\r\n                // 1. status === 'online' (from visibility API)\r\n                // 2. lastSeen < 60 seconds ago (Heartbeat check)\r\n                const isHeartbeatAlive = lastSeenDate && (now.getTime() - lastSeenDate.getTime() < 60000);\r\n\r\n                if (userData.status === 'online' && isHeartbeatAlive) {\r\n                    setPartnerStatus('online');\r\n                } else {\r\n                    setPartnerStatus('offline');\r\n                }\r\n            }\r\n        });\r\n\r\n        return () => unsubscribeUser();\r\n    }, [targetUserId]);\r\n\r\n    useEffect(() => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n    }, [messages]);\r\n\r\n    const handleSend = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!newMessage.trim()) return;\r\n        try {\r\n            await sendMessage(chatId, currentUserId, newMessage, 'admin');\r\n            setNewMessage('');\r\n            setShowEmojiPicker(false);\r\n        } catch (error) {\r\n            console.error(\"Error sending message:\", error);\r\n        }\r\n    };\r\n\r\n    const addEmoji = (emoji: string) => {\r\n        setNewMessage(prev => prev + emoji);\r\n    };\r\n\r\n    const theme = useTheme();\r\n\r\n    return (\r\n        <Box sx={{\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            height: '100%',\r\n            bgcolor: 'background.default',\r\n            overflow: 'hidden',\r\n            position: 'relative'\r\n        }}>\r\n            {/* Header */}\r\n            <Box sx={{\r\n                p: 2,\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'space-between',\r\n                borderBottom: 1,\r\n                borderColor: 'divider',\r\n                bgcolor: 'background.paper'\r\n            }}>\r\n                <div className=\"flex items-center gap-3\">\r\n                    {/* Mobile Back Button */}\r\n                    <button\r\n                        onClick={onBack}\r\n                        className=\"md:hidden text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors\"\r\n                    >\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"m15 18-6-6 6-6\" /></svg>\r\n                    </button>\r\n\r\n                    <div className=\"relative\">\r\n                        <div className=\"w-10 h-10 rounded-full flex items-center justify-center text-lg font-bold border border-gray-200 dark:border-gray-700 overflow-hidden\" style={{ backgroundColor: theme.palette.action.hover }}>\r\n                            <span style={{ color: theme.palette.text.primary }}>\r\n                                {(chatPartnerName || chatPartnerEmail || 'U')[0]?.toUpperCase()}\r\n                            </span>\r\n                        </div>\r\n                        {/* Real Status Indicator */}\r\n                        <div className={`absolute bottom-0 right-0 w-3 h-3 border-2 border-white dark:border-gray-800 rounded-full ${partnerStatus === 'online' ? 'bg-green-500' : 'bg-gray-400'}`}></div>\r\n                    </div>\r\n                    <div>\r\n                        <h3 className=\"font-bold text-sm md:text-base leading-tight\" style={{ color: theme.palette.text.primary }}>\r\n                            {chatPartnerName || chatPartnerEmail || 'User'}\r\n                        </h3>\r\n                        <p className=\"text-xs\" style={{ color: partnerStatus === 'online' ? theme.palette.success.main : theme.palette.text.secondary }}>\r\n                            {partnerStatus === 'online' ? 'Online' : lastSeen ? `Last seen ${lastSeen.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}` : 'Offline'}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Visibility Toggle */}\r\n                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                    <Typography variant=\"caption\" sx={{ color: adminVisible ? 'success.main' : 'text.disabled', fontWeight: 500 }}>\r\n                        {adminVisible ? 'Visible' : 'Hidden'}\r\n                    </Typography>\r\n                    <Switch\r\n                        checked={adminVisible}\r\n                        onChange={(e) => handleToggleVisibility(e.target.checked)}\r\n                        size=\"small\"\r\n                        color=\"success\"\r\n                    />\r\n                </Box>\r\n            </Box>\r\n\r\n\r\n            {/* Messages Area */}\r\n            <Box sx={{\r\n                flex: 1,\r\n                overflowY: 'auto',\r\n                p: 2,\r\n                bgcolor: 'background.default',\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                gap: 2\r\n            }}>\r\n                {messages.length === 0 && (\r\n                    <div className=\"text-center text-gray-400 text-sm my-4\">\r\n                        This is the beginning of the conversation.\r\n                    </div>\r\n                )}\r\n\r\n                {messages.map((msg, index) => {\r\n                    const isMe = msg.senderId === currentUserId; // Current User is Admin\r\n                    const isLastMessage = index === messages.length - 1;\r\n\r\n                    return (\r\n                        <div key={msg.id} className=\"flex flex-col\">\r\n                            <div className={`flex ${isMe ? 'justify-end' : 'justify-start'} group mb-1`}>\r\n                                <Box\r\n                                    sx={{\r\n                                        maxWidth: '80%',\r\n                                        px: 2,\r\n                                        py: 1.5,\r\n                                        fontSize: '0.875rem',\r\n                                        boxShadow: 1,\r\n                                        borderRadius: 2,\r\n                                        borderBottomRightRadius: isMe ? 4 : 16,\r\n                                        borderBottomLeftRadius: isMe ? 16 : 4,\r\n                                        bgcolor: isMe ? 'primary.main' : 'background.paper',\r\n                                        color: isMe ? 'primary.contrastText' : 'text.primary',\r\n                                        border: isMe ? 'none' : '1px solid',\r\n                                        borderColor: 'divider'\r\n                                    }}\r\n                                >\r\n                                    {msg.text}\r\n                                    <div className={`text-[10px] mt-1 text-right ${isMe ? 'opacity-70' : 'text-gray-400'}`}>\r\n                                        {msg.createdAt?.toDate ? msg.createdAt.toDate().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : ''}\r\n                                    </div>\r\n                                </Box>\r\n                            </div>\r\n\r\n                            {/* Seen Indicator */}\r\n                            {isLastMessage && isMe && userUnreadCount === 0 && (\r\n                                <div className=\"flex justify-end pr-1\">\r\n                                    <span className=\"text-[10px] text-gray-400 font-medium\">Seen</span>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    );\r\n                })}\r\n                <div ref={messagesEndRef} />\r\n            </Box>\r\n\r\n            {/* Input Area */}\r\n            <Box\r\n                component=\"form\"\r\n                onSubmit={handleSend}\r\n                sx={{\r\n                    p: 2,\r\n                    borderTop: 1,\r\n                    borderColor: 'divider',\r\n                    bgcolor: 'background.paper',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    gap: 1.5\r\n                }}\r\n            >\r\n                <div className=\"flex gap-2 relative\">\r\n                    <button type=\"button\" className=\"text-gray-400 hover:text-blue-500 transition-colors\"><Paperclip size={20} /></button>\r\n                    <button\r\n                        type=\"button\"\r\n                        onClick={() => setShowEmojiPicker(!showEmojiPicker)}\r\n                        className={`transition-colors ${showEmojiPicker ? 'text-blue-500' : 'text-gray-400 hover:text-blue-500'}`}\r\n                    >\r\n                        <Smile size={20} />\r\n                    </button>\r\n\r\n                    {/* Simple Custom Emoji Picker */}\r\n                    {showEmojiPicker && (\r\n                        <div className=\"absolute bottom-10 left-0 bg-white dark:bg-gray-800 shadow-xl border border-gray-100 dark:border-gray-700 rounded-xl p-2 grid grid-cols-4 gap-2 w-48 z-50\">\r\n                            {EMOJIS.map(emoji => (\r\n                                <button\r\n                                    key={emoji}\r\n                                    type=\"button\"\r\n                                    onClick={() => addEmoji(emoji)}\r\n                                    className=\"text-2xl hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded-lg transition-colors\"\r\n                                >\r\n                                    {emoji}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <input\r\n                    type=\"text\"\r\n                    value={newMessage}\r\n                    onChange={(e) => setNewMessage(e.target.value)}\r\n                    placeholder=\"Enter your message...\"\r\n                    className=\"flex-1 py-2 px-0 bg-transparent focus:outline-none placeholder-gray-400\"\r\n                    style={{ color: theme.palette.text.primary }}\r\n                />\r\n\r\n                <button\r\n                    type=\"submit\"\r\n                    disabled={!newMessage.trim()}\r\n                    className=\"p-3 rounded-full bg-blue-500 text-white shadow-md hover:bg-blue-600 hover:scale-105 active:scale-95 transition-all disabled:opacity-50 disabled:shadow-none flex items-center justify-center\"\r\n                >\r\n                    <Send size={18} />\r\n                </button>\r\n            </Box>\r\n        </Box>\r\n    );\r\n};\r\n\r\nexport default AdminChatWindow;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\admin\\AdminNotificationsMenu.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MenuItem' is defined but never used.","line":2,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Menu, MenuItem, ListItemText, Typography, Box, Badge, Divider, List, ListItemAvatar, Avatar, ListItemButton } from '@mui/material';\r\nimport { useRouter } from 'next/navigation';\r\nimport ChatIcon from '@mui/icons-material/ChatBubbleOutline';\r\nimport CardMembershipIcon from '@mui/icons-material/CardMembership';\r\nimport AccessTimeIcon from '@mui/icons-material/AccessTime';\r\nimport CircleIcon from '@mui/icons-material/Circle';\r\nimport { listenForAdminChatList } from '@/services/supportService';\r\nimport { getPendingRequests } from '@/services/accessRequestService';\r\nimport { Timestamp } from 'firebase/firestore';\r\n\r\n// Helper for relative time to avoid date-fns dependency issues\r\nconst getTimeAgo = (date: Date) => {\r\n    const seconds = Math.floor((new Date().getTime() - date.getTime()) / 1000);\r\n\r\n    let interval = seconds / 31536000;\r\n    if (interval > 1) return Math.floor(interval) + \" years ago\";\r\n\r\n    interval = seconds / 2592000;\r\n    if (interval > 1) return Math.floor(interval) + \" months ago\";\r\n\r\n    interval = seconds / 86400;\r\n    if (interval > 1) return Math.floor(interval) + \" days ago\";\r\n\r\n    interval = seconds / 3600;\r\n    if (interval > 1) return Math.floor(interval) + \" hours ago\";\r\n\r\n    interval = seconds / 60;\r\n    if (interval > 1) return Math.floor(interval) + \" minutes ago\";\r\n\r\n    return Math.floor(seconds) + \" seconds ago\";\r\n};\r\n\r\ninterface AdminNotification {\r\n    id: string;\r\n    type: 'message' | 'request';\r\n    title: string;\r\n    description: string;\r\n    timestamp: Date;\r\n    link: string;\r\n    unread: boolean;\r\n    priority?: 'high' | 'normal';\r\n}\r\n\r\ninterface AdminNotificationsMenuProps {\r\n    anchorEl: null | HTMLElement;\r\n    open: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport default function AdminNotificationsMenu({ anchorEl, open, onClose }: AdminNotificationsMenuProps) {\r\n    const router = useRouter();\r\n    const [notifications, setNotifications] = useState<AdminNotification[]>([]);\r\n\r\n    // Real-time listener for CHATS to merge into the list\r\n    useEffect(() => {\r\n        const unsubscribe = listenForAdminChatList((chats) => {\r\n            // Filter only chats with unread messages for admin\r\n            const unreadChats = chats.filter(c => c.unreadCountAdmin > 0);\r\n\r\n            const chatNotifications: AdminNotification[] = unreadChats.map(chat => {\r\n                const updatedAt = chat.updatedAt instanceof Timestamp ? chat.updatedAt.toDate() : new Date(chat.updatedAt || Date.now());\r\n                return {\r\n                    id: chat.id,\r\n                    type: 'message',\r\n                    title: chat.userName || 'User Message',\r\n                    description: chat.lastMessage?.text || 'New message',\r\n                    timestamp: updatedAt,\r\n                    // Use query param to potentially deep link in future, or just open chat list\r\n                    link: `/admin/chat?chatId=${chat.id}`,\r\n                    unread: true,\r\n                    priority: 'normal'\r\n                };\r\n            });\r\n\r\n            // Fetch pending requests and merge\r\n            getPendingRequests().then(requests => {\r\n                const reqNotifications: AdminNotification[] = requests.map(req => {\r\n                    const createdAt = req.createdAt instanceof Timestamp ? req.createdAt.toDate() : new Date(req.createdAt);\r\n                    return {\r\n                        id: req.id,\r\n                        type: 'request',\r\n                        title: 'Access Request',\r\n                        description: `${req.fullName} ΓÇó ${req.codeTier.toUpperCase()}`,\r\n                        timestamp: createdAt,\r\n                        link: '/admin/access-requests',\r\n                        unread: true,\r\n                        priority: 'high'\r\n                    };\r\n                });\r\n\r\n                // Combine and sort by newest first\r\n                const combined = [...chatNotifications, ...reqNotifications].sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());\r\n                setNotifications(combined);\r\n            }).catch(err => {\r\n                console.error(\"Error fetching requests:\", err);\r\n                // Even if requests fail, show chats\r\n                setNotifications(chatNotifications.sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime()));\r\n            });\r\n        });\r\n\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n\r\n    const handleItemClick = (link: string) => {\r\n        onClose();\r\n        router.push(link);\r\n    };\r\n\r\n    return (\r\n        <Menu\r\n            anchorEl={anchorEl}\r\n            open={open}\r\n            onClose={onClose}\r\n            PaperProps={{\r\n                elevation: 0,\r\n                sx: {\r\n                    overflow: 'visible',\r\n                    filter: 'drop-shadow(0px 2px 8px rgba(0,0,0,0.32))',\r\n                    mt: 1.5,\r\n                    width: 360,\r\n                    maxHeight: 500,\r\n                    borderRadius: 3,\r\n                    bgcolor: '#1E1E1E', // Dark mode background\r\n                    color: 'white',\r\n                    border: '1px solid rgba(255,255,255,0.1)',\r\n                },\r\n            }}\r\n            transformOrigin={{ horizontal: 'right', vertical: 'top' }}\r\n            anchorOrigin={{ horizontal: 'right', vertical: 'bottom' }}\r\n        >\r\n            <Box sx={{ p: 2, pb: 1, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                <Typography variant=\"h6\" fontWeight=\"bold\">Notifications</Typography>\r\n                {notifications.length > 0 && (\r\n                    <Badge badgeContent={notifications.length} color=\"error\" max={99} />\r\n                )}\r\n            </Box>\r\n            <Divider sx={{ borderColor: 'rgba(255,255,255,0.1)' }} />\r\n\r\n            <List sx={{ p: 0 }}>\r\n                {notifications.length === 0 ? (\r\n                    <Box sx={{ p: 4, textAlign: 'center', opacity: 0.6 }}>\r\n                        <AccessTimeIcon sx={{ fontSize: 40, mb: 1, opacity: 0.5 }} />\r\n                        <Typography variant=\"body2\">No new notifications</Typography>\r\n                    </Box>\r\n                ) : (\r\n                    notifications.map((notif) => (\r\n                        <ListItemButton\r\n                            key={`${notif.type}-${notif.id}`}\r\n                            onClick={() => handleItemClick(notif.link)}\r\n                            alignItems=\"flex-start\"\r\n                            sx={{\r\n                                py: 2,\r\n                                borderBottom: '1px solid rgba(255,255,255,0.05)',\r\n                                '&:hover': { bgcolor: 'rgba(255,255,255,0.05)' }\r\n                            }}\r\n                        >\r\n                            <ListItemAvatar>\r\n                                <Avatar sx={{\r\n                                    bgcolor: notif.type === 'request' ? 'secondary.main' : 'primary.main',\r\n                                    color: 'white'\r\n                                }}>\r\n                                    {notif.type === 'request' ? <CardMembershipIcon /> : <ChatIcon />}\r\n                                </Avatar>\r\n                            </ListItemAvatar>\r\n                            <ListItemText\r\n                                primary={\r\n                                    <Box sx={{ display: 'flex', justifyContent: 'space-between' }}>\r\n                                        <Typography variant=\"subtitle2\" component=\"span\" fontWeight=\"bold\">\r\n                                            {notif.title}\r\n                                        </Typography>\r\n                                        <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                            {getTimeAgo(notif.timestamp)}\r\n                                        </Typography>\r\n                                    </Box>\r\n                                }\r\n                                secondary={\r\n                                    <React.Fragment>\r\n                                        <Typography\r\n                                            sx={{ display: 'block', mb: 0.5 }}\r\n                                            component=\"span\"\r\n                                            variant=\"body2\"\r\n                                            color=\"text.secondary\"\r\n                                            noWrap\r\n                                        >\r\n                                            {notif.description}\r\n                                        </Typography>\r\n                                        {notif.priority === 'high' && (\r\n                                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 0.5, mt: 0.5 }}>\r\n                                                <CircleIcon sx={{ fontSize: 8, color: '#F44336' }} />\r\n                                                <Typography variant=\"caption\" color=\"#F44336\" fontWeight=\"bold\">Action Required</Typography>\r\n                                            </Box>\r\n                                        )}\r\n                                    </React.Fragment>\r\n                                }\r\n                            />\r\n                        </ListItemButton>\r\n                    ))\r\n                )}\r\n            </List>\r\n\r\n            {notifications.length > 0 && (\r\n                <Box sx={{ p: 1, borderTop: '1px solid rgba(255,255,255,0.1)', textAlign: 'center' }}>\r\n                    <Typography variant=\"caption\" color=\"primary\" sx={{ cursor: 'pointer' }} onClick={onClose}>\r\n                        Close\r\n                    </Typography>\r\n                </Box>\r\n            )}\r\n        </Menu>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\admin\\AdminSidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Divider' is defined but never used.","line":20,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PaymentIcon' is defined but never used.","line":29,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Admin Sidebar Component\r\n * Mobile-First Design: Large touch targets, responsive drawer, modern aesthetics.\r\n */\r\n\r\n'use client';\r\n\r\nimport React from 'react';\r\nimport {\r\n    Box,\r\n    Drawer,\r\n    SwipeableDrawer,\r\n    List,\r\n    ListItem,\r\n    ListItemButton,\r\n    ListItemIcon,\r\n    ListItemText,\r\n    Typography,\r\n    Avatar,\r\n    Divider,\r\n    useMediaQuery,\r\n    useTheme,\r\n    alpha,\r\n} from '@mui/material';\r\nimport { motion } from 'framer-motion';\r\nimport { useRouter, usePathname } from 'next/navigation';\r\nimport DashboardIcon from '@mui/icons-material/DashboardRounded';\r\nimport PeopleIcon from '@mui/icons-material/PeopleRounded';\r\nimport PaymentIcon from '@mui/icons-material/PaymentRounded';\r\nimport SettingsIcon from '@mui/icons-material/Settings';\r\nimport ComputerIcon from '@mui/icons-material/Computer';\r\nimport LogoutIcon from '@mui/icons-material/Logout';\r\nimport EventBusyIcon from '@mui/icons-material/EventBusyRounded';\r\nimport ChatBubbleOutlineIcon from '@mui/icons-material/ChatBubbleOutlineRounded';\r\nimport CardMembershipIcon from '@mui/icons-material/CardMembershipRounded';\r\nimport CardGiftcardIcon from '@mui/icons-material/CardGiftcardRounded';\r\nimport KeyIcon from '@mui/icons-material/VpnKeyRounded';\r\nimport CelebrationRoundedIcon from '@mui/icons-material/CelebrationRounded';\r\nimport { useAuth } from '@/context/AuthContext';\r\n\r\ninterface AdminSidebarProps {\r\n    mobileOpen: boolean;\r\n    setMobileOpen: (open: boolean) => void;\r\n    desktopOpen?: boolean;\r\n    unreadCount?: number;\r\n}\r\n\r\nconst SIDEBAR_WIDTH = 280; // Slightly wider for better readability on tablets/desktop\r\n\r\nconst menuItems = [\r\n    { name: 'Dashboard', path: '/admin', icon: DashboardIcon },\r\n    { name: 'Users', path: '/admin/users', icon: PeopleIcon },\r\n    { name: 'Access Requests', path: '/admin/access-requests', icon: CardGiftcardIcon },\r\n    { name: 'Access Codes', path: '/admin/access-codes', icon: KeyIcon },\r\n    { name: 'Cancellations', path: '/admin/cancellations', icon: EventBusyIcon },\r\n    { name: 'Events', path: '/admin/events', icon: CelebrationRoundedIcon },\r\n    { name: 'Chat', path: '/admin/chat', icon: ChatBubbleOutlineIcon },\r\n    { name: 'PC Requests', path: '/admin/pc-requests', icon: ComputerIcon },\r\n    { name: 'Subscriptions', path: '/admin/tiers', icon: CardMembershipIcon },\r\n    { name: 'Settings', path: '/admin/settings', icon: SettingsIcon },\r\n];\r\n\r\nexport default function AdminSidebar({ mobileOpen, setMobileOpen, desktopOpen = true, unreadCount = 0 }: AdminSidebarProps) {\r\n    const router = useRouter();\r\n    const pathname = usePathname();\r\n    const theme = useTheme();\r\n    const isMobile = useMediaQuery(theme.breakpoints.down('md'));\r\n    const iOS = typeof navigator !== 'undefined' && /iPad|iPhone|iPod/.test(navigator.userAgent);\r\n    const { logout, user } = useAuth();\r\n\r\n    const handleNavigation = (path: string) => {\r\n        router.push(path);\r\n        if (isMobile) setMobileOpen(false);\r\n    };\r\n\r\n    const handleLogout = async () => {\r\n        await logout();\r\n        if (isMobile) setMobileOpen(false);\r\n    };\r\n\r\n    const isActive = (path: string) => {\r\n        if (path === '/admin') return pathname === '/admin';\r\n        return pathname.startsWith(path);\r\n    };\r\n\r\n    const drawerContent = (\r\n        <Box\r\n            sx={{\r\n                height: '100%',\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                bgcolor: 'background.paper',\r\n                color: 'text.primary',\r\n                borderRight: '1px solid',\r\n                borderColor: 'divider',\r\n            }}\r\n        >\r\n            {/* Header Profile Section */}\r\n            <Box\r\n                sx={{\r\n                    p: 4,\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    alignItems: 'center',\r\n                    gap: 1.5,\r\n                    borderBottom: '1px solid',\r\n                    borderColor: 'divider',\r\n                }}\r\n            >\r\n                <Avatar\r\n                    sx={{\r\n                        bgcolor: 'primary.main',\r\n                        width: 64,\r\n                        height: 64,\r\n                        boxShadow: 3,\r\n                        fontSize: '1.5rem',\r\n                        fontWeight: 'bold',\r\n                        color: 'primary.contrastText',\r\n                    }}\r\n                >\r\n                    {user?.displayName?.[0] || 'A'}\r\n                </Avatar>\r\n                <Box sx={{ textAlign: 'center' }}>\r\n                    <Typography variant=\"h6\" fontWeight=\"700\" sx={{ letterSpacing: 0.5 }}>\r\n                        TruthLens\r\n                    </Typography>\r\n                    <Typography variant=\"caption\" sx={{ color: 'text.secondary', fontWeight: 500 }}>\r\n                        Admin Workspace\r\n                    </Typography>\r\n                </Box>\r\n            </Box>\r\n\r\n            {/* Navigation List */}\r\n            <Box sx={{ flexGrow: 1, py: 3, px: 2, overflowY: 'auto' }}>\r\n                <Typography\r\n                    variant=\"caption\"\r\n                    sx={{\r\n                        px: 2,\r\n                        mb: 1,\r\n                        display: 'block',\r\n                        color: 'text.secondary',\r\n                        fontWeight: 700,\r\n                        textTransform: 'uppercase',\r\n                        letterSpacing: 1,\r\n                    }}\r\n                >\r\n                    Menu\r\n                </Typography>\r\n                <List disablePadding>\r\n                    {menuItems.map((item) => {\r\n                        const Icon = item.icon;\r\n                        const active = isActive(item.path);\r\n\r\n                        return (\r\n                            <ListItem key={item.name} disablePadding sx={{ mb: 1 }}>\r\n                                <ListItemButton\r\n                                    component={motion.div}\r\n                                    whileTap={{ scale: 0.96 }}\r\n                                    onClick={() => handleNavigation(item.path)}\r\n                                    sx={{\r\n                                        borderRadius: '12px',\r\n                                        minHeight: 56, // Touch-friendly target\r\n                                        bgcolor: active ? alpha(theme.palette.primary.main, 0.15) : 'transparent',\r\n                                        color: active ? 'primary.main' : 'text.secondary',\r\n                                        px: 2.5,\r\n                                        position: 'relative',\r\n                                        overflow: 'hidden',\r\n                                        '&:hover': {\r\n                                            bgcolor: active ? alpha(theme.palette.primary.main, 0.25) : 'action.hover',\r\n                                            color: active ? 'primary.main' : 'text.primary',\r\n                                        },\r\n                                        transition: 'all 0.2s cubic-bezier(0.4, 0, 0.2, 1)',\r\n                                    }}\r\n                                >\r\n                                    {active && (\r\n                                        <Box\r\n                                            component={motion.div}\r\n                                            layoutId=\"activeIndicator\"\r\n                                            sx={{\r\n                                                position: 'absolute',\r\n                                                left: 0,\r\n                                                width: 4,\r\n                                                height: '60%',\r\n                                                bgcolor: 'primary.main',\r\n                                                borderRadius: '0 4px 4px 0',\r\n                                            }}\r\n                                        />\r\n                                    )}\r\n                                    <ListItemIcon\r\n                                        sx={{\r\n                                            color: 'inherit',\r\n                                            minWidth: 40,\r\n                                        }}\r\n                                    >\r\n                                        <Icon fontSize=\"medium\" />\r\n                                    </ListItemIcon>\r\n                                    <ListItemText\r\n                                        primary={item.name}\r\n                                        primaryTypographyProps={{\r\n                                            fontWeight: active ? 600 : 500,\r\n                                            fontSize: '0.95rem',\r\n                                        }}\r\n                                    />\r\n                                    {item.name === 'Chat' && unreadCount > 0 && (\r\n                                        <Box\r\n                                            sx={{\r\n                                                bgcolor: '#EF4444',\r\n                                                color: 'white',\r\n                                                borderRadius: '99px',\r\n                                                px: 1,\r\n                                                py: 0.25,\r\n                                                fontSize: '0.75rem',\r\n                                                fontWeight: 'bold',\r\n                                                minWidth: '20px',\r\n                                                textAlign: 'center',\r\n                                            }}\r\n                                        >\r\n                                            {unreadCount}\r\n                                        </Box>\r\n                                    )}\r\n                                </ListItemButton>\r\n                            </ListItem>\r\n                        );\r\n                    })}\r\n                </List>\r\n            </Box>\r\n\r\n            {/* Logout Section */}\r\n            <Box sx={{ p: 2, borderTop: '1px solid', borderColor: 'divider' }}>\r\n                <ListItemButton\r\n                    onClick={handleLogout}\r\n                    sx={{\r\n                        borderRadius: '12px',\r\n                        minHeight: 56,\r\n                        color: 'error.main',\r\n                        '&:hover': {\r\n                            bgcolor: 'action.hover',\r\n                        },\r\n                    }}\r\n                >\r\n                    <ListItemIcon sx={{ color: 'inherit', minWidth: 40 }}>\r\n                        <LogoutIcon />\r\n                    </ListItemIcon>\r\n                    <ListItemText\r\n                        primary=\"Sign Out\"\r\n                        primaryTypographyProps={{ fontWeight: 600 }}\r\n                    />\r\n                </ListItemButton>\r\n            </Box>\r\n        </Box>\r\n    );\r\n\r\n    return (\r\n        <Box\r\n            component=\"nav\"\r\n            sx={{\r\n                width: { md: desktopOpen ? SIDEBAR_WIDTH : 0 },\r\n                flexShrink: { md: 0 },\r\n                transition: 'width 0.3s ease',\r\n                overflow: 'hidden'\r\n            }}\r\n            aria-label=\"admin folders\"\r\n        >\r\n            {/* Mobile Drawer */}\r\n            <SwipeableDrawer\r\n                variant=\"temporary\"\r\n                anchor=\"left\"\r\n                open={mobileOpen}\r\n                onClose={() => setMobileOpen(false)}\r\n                onOpen={() => setMobileOpen(true)}\r\n                disableBackdropTransition={!iOS}\r\n                disableDiscovery={iOS}\r\n                ModalProps={{ keepMounted: true }}\r\n                PaperProps={{\r\n                    sx: {\r\n                        width: SIDEBAR_WIDTH,\r\n                        bgcolor: 'background.paper',\r\n                        border: 'none',\r\n                    },\r\n                }}\r\n                sx={{\r\n                    display: { xs: 'block', md: 'none' },\r\n                }}\r\n            >\r\n                {drawerContent}\r\n            </SwipeableDrawer>\r\n\r\n            {/* Desktop Drawer */}\r\n            <Drawer\r\n                variant=\"persistent\"\r\n                sx={{\r\n                    display: { xs: 'none', md: 'block' },\r\n                    '& .MuiDrawer-paper': {\r\n                        width: SIDEBAR_WIDTH,\r\n                        boxSizing: 'border-box',\r\n                        bgcolor: 'background.paper',\r\n                        borderRight: '1px solid',\r\n                        borderColor: 'divider',\r\n                    },\r\n                }}\r\n                open={desktopOpen}\r\n            >\r\n                {drawerContent}\r\n            </Drawer>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\admin\\StatsCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\admin\\SystemControl.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":30,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":44,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport {\r\n    Paper,\r\n    Typography,\r\n    Switch,\r\n    Box,\r\n    FormControlLabel,\r\n    Alert,\r\n    LinearProgress\r\n} from '@mui/material';\r\nimport { getSystemSettings, updateSystemSettings, DEFAULT_SETTINGS } from '@/services/systemService';\r\nimport { ExtendedSystemSettings as SystemSettings } from '@/types/system';\r\nimport EngineeringIcon from '@mui/icons-material/Engineering';\r\n\r\nexport default function SystemControl() {\r\n    const [settings, setSettings] = useState<SystemSettings>(DEFAULT_SETTINGS);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState('');\r\n\r\n    useEffect(() => {\r\n        loadSettings();\r\n    }, []);\r\n\r\n    const loadSettings = async () => {\r\n        try {\r\n            const data = await getSystemSettings();\r\n            setSettings(data);\r\n        } catch (err) {\r\n            setError('Failed to load system settings');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleMaintenanceToggle = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const newValue = event.target.checked;\r\n        // Optimistic update\r\n        setSettings(prev => ({ ...prev, maintenanceMode: newValue }));\r\n\r\n        try {\r\n            await updateSystemSettings({ maintenanceMode: newValue });\r\n        } catch (err) {\r\n            setError('Failed to update maintenance mode');\r\n            // Revert on error\r\n            setSettings(prev => ({ ...prev, maintenanceMode: !newValue }));\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Paper sx={{ p: 3, height: '100%' }}>\r\n            <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>\r\n                <EngineeringIcon sx={{ mr: 1, color: '#F59E0B' }} />\r\n                <Typography variant=\"h6\">\r\n                    System Control\r\n                </Typography>\r\n            </Box>\r\n\r\n            {loading && <LinearProgress sx={{ mb: 2 }} />}\r\n            {error && <Alert severity=\"error\" sx={{ mb: 2 }}>{error}</Alert>}\r\n\r\n            <Box>\r\n                <FormControlLabel\r\n                    control={\r\n                        <Switch\r\n                            checked={settings.maintenanceMode}\r\n                            onChange={handleMaintenanceToggle}\r\n                            color=\"error\"\r\n                        />\r\n                    }\r\n                    label={\r\n                        <Box>\r\n                            <Typography fontWeight=\"bold\">Maintenance Mode</Typography>\r\n                            <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                When enabled, only admins can access the site.\r\n                                <br />\r\n                                All other users will see the maintenance page.\r\n                            </Typography>\r\n                        </Box>\r\n                    }\r\n                />\r\n            </Box>\r\n        </Paper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\admin\\UpgradeRequestList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Chip' is defined but never used.","line":14,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":17,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":61,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":74,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":74,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n    Paper,\r\n    Typography,\r\n    Box,\r\n    List,\r\n    ListItem,\r\n    ListItemText,\r\n    ListItemAvatar,\r\n    Avatar,\r\n    IconButton,\r\n    Chip,\r\n    Tooltip,\r\n    Alert,\r\n    Button,\r\n    CircularProgress,\r\n    Divider\r\n} from '@mui/material';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport CancelIcon from '@mui/icons-material/Cancel';\r\nimport PersonIcon from '@mui/icons-material/Person';\r\nimport RefreshIcon from '@mui/icons-material/Refresh';\r\nimport { getAllPaymentRequests, approvePaymentRequest, rejectPaymentRequest } from '@/services/paymentService';\r\nimport { PaymentRequest } from '@/types/payment';\r\nimport { useAuth } from '@/context/AuthContext';\r\n\r\nexport default function UpgradeRequestList() {\r\n    const { user } = useAuth();\r\n    const [requests, setRequests] = useState<PaymentRequest[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [actionLoading, setActionLoading] = useState<string | null>(null);\r\n\r\n    const fetchRequests = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const data = await getAllPaymentRequests('pending');\r\n            setRequests(data);\r\n            setError(null);\r\n        } catch (err) {\r\n            setError('Failed to load requests');\r\n            console.error(err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchRequests();\r\n    }, []);\r\n\r\n    const handleApprove = async (requestId: string) => {\r\n        if (!user) return;\r\n        setActionLoading(requestId);\r\n        try {\r\n            await approvePaymentRequest(requestId, user.uid);\r\n            // Refresh list\r\n            setRequests(prev => prev.filter(req => req.id !== requestId));\r\n        } catch (err) {\r\n            alert('Failed to approve request');\r\n        } finally {\r\n            setActionLoading(null);\r\n        }\r\n    };\r\n\r\n    const handleReject = async (requestId: string) => {\r\n        setActionLoading(requestId);\r\n        try {\r\n            await rejectPaymentRequest(requestId, 'Admin rejected');\r\n            // Refresh list\r\n            setRequests(prev => prev.filter(req => req.id !== requestId));\r\n        } catch (err) {\r\n            alert('Failed to reject request');\r\n        } finally {\r\n            setActionLoading(null);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Paper sx={{ p: 3, height: '100%', maxHeight: 500, overflow: 'auto' }}>\r\n            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\r\n                <Typography variant=\"h6\" fontWeight=\"bold\">\r\n                    Pending Upgrade Requests\r\n                </Typography>\r\n                <IconButton onClick={fetchRequests} disabled={loading} size=\"small\">\r\n                    <RefreshIcon />\r\n                </IconButton>\r\n            </Box>\r\n\r\n            {error && <Alert severity=\"error\" sx={{ mb: 2 }}>{error}</Alert>}\r\n\r\n            {loading ? (\r\n                <Box sx={{ display: 'flex', justifyContent: 'center', p: 4 }}>\r\n                    <CircularProgress />\r\n                </Box>\r\n            ) : requests.length === 0 ? (\r\n                <Box sx={{ textAlign: 'center', py: 4, color: 'text.secondary' }}>\r\n                    <Typography>No pending requests</Typography>\r\n                </Box>\r\n            ) : (\r\n                <List disablePadding>\r\n                    {requests.map((request, index) => (\r\n                        <React.Fragment key={request.id}>\r\n                            {index > 0 && <Divider component=\"li\" />}\r\n                            <ListItem\r\n                                secondaryAction={\r\n                                    <Box sx={{ display: 'flex', gap: 1 }}>\r\n                                        <Tooltip title=\"Reject\">\r\n                                            <IconButton\r\n                                                edge=\"end\"\r\n                                                color=\"error\"\r\n                                                onClick={() => handleReject(request.id!)}\r\n                                                disabled={actionLoading === request.id}\r\n                                            >\r\n                                                <CancelIcon />\r\n                                            </IconButton>\r\n                                        </Tooltip>\r\n                                        <Tooltip title=\"Approve\">\r\n                                            <IconButton\r\n                                                edge=\"end\"\r\n                                                color=\"success\"\r\n                                                onClick={() => handleApprove(request.id!)}\r\n                                                disabled={actionLoading === request.id}\r\n                                            >\r\n                                                {actionLoading === request.id ? <CircularProgress size={24} /> : <CheckCircleIcon />}\r\n                                            </IconButton>\r\n                                        </Tooltip>\r\n                                    </Box>\r\n                                }\r\n                            >\r\n                                <ListItemAvatar>\r\n                                    <Avatar>\r\n                                        <PersonIcon />\r\n                                    </Avatar>\r\n                                </ListItemAvatar>\r\n                                <ListItemText\r\n                                    primary={request.userName || 'Unknown User'}\r\n                                    secondary={\r\n                                        <React.Fragment>\r\n                                            <Typography component=\"span\" variant=\"body2\" color=\"text.primary\">\r\n                                                {request.userEmail}\r\n                                            </Typography>\r\n                                            {\" ΓÇö \"}{request.type === 'manual' ? 'Free Request' : 'Paid'}\r\n                                        </React.Fragment>\r\n                                    }\r\n                                />\r\n                            </ListItem>\r\n                        </React.Fragment>\r\n                    ))}\r\n                </List>\r\n            )}\r\n        </Paper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\admin\\UserAvatarWithStatus.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\admin\\UserTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Chip' is defined but never used.","line":17,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'StarIcon' is defined but never used.","line":24,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * User Table Component\r\n * Admin table for managing users with actions\r\n */\r\n\r\n'use client';\r\n\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableContainer,\r\n    TableHead,\r\n    TableRow,\r\n    Paper,\r\n    IconButton,\r\n    Chip,\r\n    Avatar,\r\n    Box,\r\n    Typography,\r\n} from '@mui/material';\r\nimport EditIcon from '@mui/icons-material/Edit';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport StarIcon from '@mui/icons-material/Star';\r\nimport TierBadge from '@/components/subscription/TierBadge';\r\nimport { UserTier } from '@/types/user';\r\n\r\ninterface User {\r\n    id: string;\r\n    email: string;\r\n    displayName?: string;\r\n    photoURL?: string;\r\n    tier: UserTier;\r\n    createdAt: Date;\r\n}\r\n\r\ninterface UserTableProps {\r\n    users: User[];\r\n    onEdit?: (userId: string) => void;\r\n    onDelete?: (userId: string) => void;\r\n}\r\n\r\nexport default function UserTable({ users, onEdit, onDelete }: UserTableProps) {\r\n    return (\r\n        <TableContainer component={Paper}>\r\n            <Table>\r\n                <TableHead>\r\n                    <TableRow>\r\n                        <TableCell>User</TableCell>\r\n                        <TableCell>Email</TableCell>\r\n                        <TableCell>Tier</TableCell>\r\n                        <TableCell>Joined</TableCell>\r\n                        <TableCell align=\"right\">Actions</TableCell>\r\n                    </TableRow>\r\n                </TableHead>\r\n                <TableBody>\r\n                    {users.map((user) => (\r\n                        <TableRow key={user.id} hover>\r\n                            <TableCell>\r\n                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                                    <Avatar src={user.photoURL || '/icons/icon-192x192.png'} sx={{ width: 32, height: 32 }}>\r\n                                        {user.displayName?.[0] || user.email[0].toUpperCase()}\r\n                                    </Avatar>\r\n                                    <Typography variant=\"body2\">{user.displayName || 'No name'}</Typography>\r\n                                </Box>\r\n                            </TableCell>\r\n                            <TableCell>\r\n                                <Typography variant=\"body2\">{user.email}</Typography>\r\n                            </TableCell>\r\n                            <TableCell>\r\n                                <TierBadge tier={user.tier} size=\"small\" />\r\n                            </TableCell>\r\n                            <TableCell>\r\n                                <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                    {user.createdAt.toLocaleDateString()}\r\n                                </Typography>\r\n                            </TableCell>\r\n                            <TableCell align=\"right\">\r\n                                {onEdit && (\r\n                                    <IconButton size=\"small\" onClick={() => onEdit(user.id)}>\r\n                                        <EditIcon fontSize=\"small\" />\r\n                                    </IconButton>\r\n                                )}\r\n                                {onDelete && (\r\n                                    <IconButton size=\"small\" color=\"error\" onClick={() => onDelete(user.id)}>\r\n                                        <DeleteIcon fontSize=\"small\" />\r\n                                    </IconButton>\r\n                                )}\r\n                            </TableCell>\r\n                        </TableRow>\r\n                    ))}\r\n                </TableBody>\r\n            </Table>\r\n        </TableContainer>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\admin\\settings\\AISettingsTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1252,1255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1252,1255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1651,1654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1651,1654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2074,2077],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2074,2077],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2225,2228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2225,2228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2548,2551],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2548,2551],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'availableOpenRouterModels' is defined but never used.","line":111,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":111,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fetchOpenRouterModels' is defined but never used.","line":112,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":112,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toggleOpenRouterModel' is defined but never used.","line":113,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":113,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5569,5572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5569,5572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7638,7641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7638,7641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":192,"column":113,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[8531,8575],"text":"Google&apos;s multimodal AI for chat and analysis"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[8531,8575],"text":"Google&lsquo;s multimodal AI for chat and analysis"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[8531,8575],"text":"Google&#39;s multimodal AI for chat and analysis"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[8531,8575],"text":"Google&rsquo;s multimodal AI for chat and analysis"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":211,"column":108,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[9663,9767],"text":"These keys are used when Free/Plus tier users don&apos;t provide their own keys. Test each one before saving!"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[9663,9767],"text":"These keys are used when Free/Plus tier users don&lsquo;t provide their own keys. Test each one before saving!"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[9663,9767],"text":"These keys are used when Free/Plus tier users don&#39;t provide their own keys. Test each one before saving!"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[9663,9767],"text":"These keys are used when Free/Plus tier users don&rsquo;t provide their own keys. Test each one before saving!"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":226,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10744,10747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10744,10747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":262,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":262,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13039,13042],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13039,13042],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":298,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15334,15337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15334,15337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":334,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17637,17640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17637,17640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":370,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":370,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19972,19975],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19972,19975],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":405,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":405,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22103,22106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22103,22106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":440,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":440,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24198,24201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24198,24201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":496,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":496,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27228,27231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27228,27231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":505,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":505,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27760,27763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27760,27763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":541,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":541,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30635,30638],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30635,30638],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":588,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":588,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33291,33294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33291,33294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":625,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":625,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35377,35380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35377,35380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":634,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":634,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35909,35912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35909,35912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":22,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport {\r\n    Box,\r\n    Paper,\r\n    Typography,\r\n    // Grid, // Removing from main import\r\n    Card,\r\n    CardHeader,\r\n    CardContent,\r\n    TextField,\r\n    Button,\r\n    CircularProgress,\r\n    Alert,\r\n    InputAdornment,\r\n    IconButton,\r\n    Switch\r\n} from '@mui/material';\r\nimport Grid from '@mui/material/GridLegacy'; // Using GridLegacy for v5 compatibility\r\nimport BuildIcon from '@mui/icons-material/Build';\r\nimport CloudQueueIcon from '@mui/icons-material/CloudQueue';\r\nimport SmartToyIcon from '@mui/icons-material/SmartToy';\r\nimport SettingsSuggestIcon from '@mui/icons-material/SettingsSuggest';\r\nimport SaveIcon from '@mui/icons-material/Save';\r\nimport Visibility from '@mui/icons-material/Visibility';\r\nimport VisibilityOff from '@mui/icons-material/VisibilityOff';\r\n\r\ninterface AISettingsTabProps {\r\n    secureKeys: Record<string, string>;\r\n    setSecureKeys: React.Dispatch<React.SetStateAction<Record<string, string>>>;\r\n    handleTestAndSave?: (provider: string, apiKey: string, modelId: string) => Promise<void>;\r\n    handleSaveSecureKeys?: () => Promise<void>;\r\n    savingSecure: boolean;\r\n    freeApiKeys: Record<string, string>;\r\n    setFreeApiKeys: React.Dispatch<React.SetStateAction<any>>;\r\n    handleSaveFreeKeys: () => Promise<void>;\r\n    savingFreeKeys: boolean;\r\n    showKeys: Record<string, boolean>;\r\n    toggleShow: (key: string) => void;\r\n    ollamaConfig: {\r\n        ollamaUrl: string;\r\n        ollamaFallbackUrl: string;\r\n        defaultOllamaModel: string;\r\n        ollamaModels: Record<string, boolean>;\r\n    };\r\n    setOllamaConfig: React.Dispatch<React.SetStateAction<any>>;\r\n    handleSaveOllama: () => Promise<void>;\r\n    savingOllama: boolean;\r\n    availableModels: string[];\r\n    fetchOllamaModels: (url: string) => Promise<void>;\r\n    toggleModel: (modelName: string) => void;\r\n    models: {\r\n        gemini?: string;\r\n        groq?: string;\r\n        openai?: string;\r\n        deepseek?: string;\r\n        openrouter?: string;\r\n    };\r\n    setModels: React.Dispatch<React.SetStateAction<any>>;\r\n    // DeepSeek\r\n    deepseekConfig?: {\r\n        deepseekBaseUrl: string;\r\n    };\r\n    setDeepSeekConfig?: React.Dispatch<React.SetStateAction<any>>;\r\n    handleSaveDeepSeek?: () => Promise<void>;\r\n    savingDeepSeek?: boolean;\r\n    // OpenRouter\r\n    openrouterConfig?: {\r\n        openrouterApiKey: string;\r\n        openrouterModel: string;\r\n        openrouterModels?: Record<string, boolean>;\r\n    };\r\n    setOpenRouterConfig?: React.Dispatch<React.SetStateAction<any>>;\r\n    handleSaveOpenRouter?: () => Promise<void>;\r\n    savingOpenRouter?: boolean;\r\n    availableOpenRouterModels?: string[];\r\n    fetchOpenRouterModels?: () => Promise<void>;\r\n    toggleOpenRouterModel?: (modelId: string) => void;\r\n}\r\n\r\nexport default function AISettingsTab({\r\n    secureKeys,\r\n    setSecureKeys,\r\n    handleSaveSecureKeys,\r\n    handleTestAndSave,\r\n    savingSecure,\r\n    freeApiKeys,\r\n    setFreeApiKeys,\r\n    handleSaveFreeKeys,\r\n    savingFreeKeys,\r\n    showKeys,\r\n    toggleShow,\r\n    ollamaConfig,\r\n    setOllamaConfig,\r\n    handleSaveOllama,\r\n    savingOllama,\r\n    availableModels,\r\n    fetchOllamaModels,\r\n    toggleModel,\r\n    models,\r\n    setModels,\r\n    deepseekConfig,\r\n    setDeepSeekConfig,\r\n    handleSaveDeepSeek,\r\n    savingDeepSeek,\r\n    openrouterConfig,\r\n    setOpenRouterConfig,\r\n    handleSaveOpenRouter,\r\n    savingOpenRouter,\r\n    availableOpenRouterModels,\r\n    fetchOpenRouterModels,\r\n    toggleOpenRouterModel\r\n}: AISettingsTabProps) {\r\n    return (\r\n        <Box>\r\n            {/* --- SECURE KEYS (SERVER SIDE) --- */}\r\n            <Paper sx={{ mb: 4, borderRadius: 2, overflow: 'hidden', border: '1px solid #e0e0e0' }}>\r\n                <Box sx={{ p: 2, bgcolor: '#f5f5f5', borderBottom: '1px solid #e0e0e0', display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                    <Typography variant=\"h6\" color=\"success.main\" sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                        <BuildIcon /> Secure AI Keys & Models\r\n                    </Typography>\r\n                    <Typography variant=\"caption\" sx={{ ml: 'auto', bgcolor: '#e8f5e9', color: 'success.dark', px: 1, py: 0.5, borderRadius: 1 }}>Server-Side Vault</Typography>\r\n                </Box>\r\n                <Box sx={{ p: 3 }}>\r\n                    <Alert severity=\"info\" sx={{ mb: 3 }}>Keys here are never exposed to the client. Used for production-critical LLMs.</Alert>\r\n\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 2 }}>\r\n                        <Typography variant=\"subtitle2\" sx={{ fontWeight: 'bold' }}>Groq Configuration</Typography>\r\n                        <Typography variant=\"caption\" sx={{ bgcolor: '#f5f5f5', px: 1, py: 0.5, borderRadius: 1, color: 'text.secondary' }}>Used for: AI Chat (Pro/Ultimate users)</Typography>\r\n                    </Box>\r\n                    <Box sx={{ display: 'flex', gap: 2, mb: 1 }}>\r\n                        <TextField\r\n                            label=\"Groq API Key (Secure)\"\r\n                            type=\"password\"\r\n                            value={secureKeys.groq}\r\n                            onChange={(e) => setSecureKeys(prev => ({ ...prev, groq: e.target.value }))}\r\n                            fullWidth\r\n                            size=\"small\"\r\n                        />\r\n                        <TextField\r\n                            label=\"Model ID\"\r\n                            value={models.groq || ''}\r\n                            onChange={(e) => setModels((prev: any) => ({ ...prev, groq: e.target.value }))}\r\n                            sx={{ width: '40%' }}\r\n                            size=\"small\"\r\n                            placeholder=\"llama-3.3-70b-versatile\"\r\n                        />\r\n                        <Button\r\n                            variant=\"outlined\"\r\n                            size=\"small\"\r\n                            onClick={() => handleTestAndSave && handleTestAndSave('groq', secureKeys.groq, models.groq || 'llama-3.3-70b-versatile')}\r\n                            disabled={!secureKeys.groq || savingSecure}\r\n                            sx={{ minWidth: '100px', whiteSpace: 'nowrap' }}\r\n                        >\r\n                            Test & Save\r\n                        </Button>\r\n                    </Box>\r\n                    <Typography variant=\"caption\" color=\"text.secondary\" sx={{ display: 'block', mb: 3 }}>Fast and powerful LLM for chat conversations</Typography>\r\n\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 2 }}>\r\n                        <Typography variant=\"subtitle2\" sx={{ fontWeight: 'bold' }}>Gemini Configuration</Typography>\r\n                        <Typography variant=\"caption\" sx={{ bgcolor: '#f5f5f5', px: 1, py: 0.5, borderRadius: 1, color: 'text.secondary' }}>Used for: AI Chat (Pro/Ultimate users)</Typography>\r\n                    </Box>\r\n                    <Box sx={{ display: 'flex', gap: 2, mb: 1 }}>\r\n                        <TextField\r\n                            label=\"Gemini API Key (Secure)\"\r\n                            type=\"password\"\r\n                            value={secureKeys.gemini}\r\n                            onChange={(e) => setSecureKeys(prev => ({ ...prev, gemini: e.target.value }))}\r\n                            fullWidth\r\n                            size=\"small\"\r\n                        />\r\n                        <TextField\r\n                            label=\"Model ID\"\r\n                            value={models.gemini || ''}\r\n                            onChange={(e) => setModels((prev: any) => ({ ...prev, gemini: e.target.value }))}\r\n                            sx={{ width: '40%' }}\r\n                            size=\"small\"\r\n                            placeholder=\"gemini-1.5-flash\"\r\n                        />\r\n                        <Button\r\n                            variant=\"outlined\"\r\n                            size=\"small\"\r\n                            onClick={() => handleTestAndSave && handleTestAndSave('gemini', secureKeys.gemini, models.gemini || 'gemini-1.5-flash')}\r\n                            disabled={!secureKeys.gemini || savingSecure}\r\n                            sx={{ minWidth: '100px', whiteSpace: 'nowrap' }}\r\n                        >\r\n                            Test & Save\r\n                        </Button>\r\n                    </Box>\r\n                    <Typography variant=\"caption\" color=\"text.secondary\" sx={{ display: 'block', mb: 3 }}>Google's multimodal AI for chat and analysis</Typography>\r\n\r\n                    <Box sx={{ display: 'flex', justifyContent: 'flex-end', mt: 1 }}>\r\n                        <Button variant=\"contained\" color=\"success\" onClick={handleSaveSecureKeys} disabled={savingSecure} startIcon={savingSecure ? <CircularProgress size={16} /> : <SaveIcon />}>\r\n                            {savingSecure ? 'Securing...' : 'Update Vault & Models'}\r\n                        </Button>\r\n                    </Box>\r\n                </Box>\r\n            </Paper>\r\n\r\n            {/* --- FREE API KEYS CARD --- */}\r\n            <Card sx={{ mb: 4, borderRadius: 2, border: '1px solid #bbdefb' }}>\r\n                <CardHeader\r\n                    title=\"Legacy & Free API Keys\"\r\n                    subheader=\"Public collection for client-side Swarm Logic - Free/Plus users use these\"\r\n                    avatar={<CloudQueueIcon color=\"primary\" />}\r\n                    sx={{ bgcolor: '#e3f2fd', borderBottom: '1px solid #bbdefb' }}\r\n                />\r\n                <CardContent sx={{ p: 3 }}>\r\n                    <Alert severity=\"info\" sx={{ mb: 3 }}>These keys are used when Free/Plus tier users don't provide their own keys. Test each one before saving!</Alert>\r\n\r\n                    {/* Gemini Key */}\r\n                    <Box sx={{ mb: 3 }}>\r\n                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>\r\n                            <Typography variant=\"subtitle2\" sx={{ fontWeight: 'bold' }}>Gemini</Typography>\r\n                            <Typography variant=\"caption\" sx={{ bgcolor: '#f5f5f5', px: 1, py: 0.5, borderRadius: 1, color: 'text.secondary' }}>Food Scanning, AI Chat</Typography>\r\n                        </Box>\r\n                        <Box sx={{ display: 'flex', gap: 2 }}>\r\n                            <TextField\r\n                                label=\"Gemini API Key\"\r\n                                fullWidth\r\n                                size=\"small\"\r\n                                type={showKeys.gemini ? 'text' : 'password'}\r\n                                value={freeApiKeys.gemini as string}\r\n                                onChange={(e) => setFreeApiKeys((prev: any) => ({ ...prev, gemini: e.target.value }))}\r\n                                InputProps={{\r\n                                    endAdornment: (\r\n                                        <InputAdornment position=\"end\">\r\n                                            <IconButton onClick={() => toggleShow('gemini')} edge=\"end\" size=\"small\">\r\n                                                {showKeys.gemini ? <VisibilityOff fontSize=\"small\" /> : <Visibility fontSize=\"small\" />}\r\n                                            </IconButton>\r\n                                        </InputAdornment>\r\n                                    ),\r\n                                }}\r\n                            />\r\n                            <Button\r\n                                variant=\"outlined\"\r\n                                size=\"small\"\r\n                                onClick={() => handleTestAndSave && handleTestAndSave('gemini', freeApiKeys.gemini as string, models.gemini || 'gemini-1.5-flash')}\r\n                                disabled={!freeApiKeys.gemini || savingFreeKeys}\r\n                                sx={{ minWidth: '120px', whiteSpace: 'nowrap' }}\r\n                            >\r\n                                Test & Save\r\n                            </Button>\r\n                        </Box>\r\n                    </Box>\r\n\r\n                    {/* Groq Key */}\r\n                    <Box sx={{ mb: 3 }}>\r\n                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>\r\n                            <Typography variant=\"subtitle2\" sx={{ fontWeight: 'bold' }}>Groq</Typography>\r\n                            <Typography variant=\"caption\" sx={{ bgcolor: '#f5f5f5', px: 1, py: 0.5, borderRadius: 1, color: 'text.secondary' }}>AI Chat Fallback</Typography>\r\n                        </Box>\r\n                        <Box sx={{ display: 'flex', gap: 2 }}>\r\n                            <TextField\r\n                                label=\"Groq API Key\"\r\n                                fullWidth\r\n                                size=\"small\"\r\n                                type={showKeys.groq ? 'text' : 'password'}\r\n                                value={freeApiKeys.groq as string}\r\n                                onChange={(e) => setFreeApiKeys((prev: any) => ({ ...prev, groq: e.target.value }))}\r\n                                InputProps={{\r\n                                    endAdornment: (\r\n                                        <InputAdornment position=\"end\">\r\n                                            <IconButton onClick={() => toggleShow('groq')} edge=\"end\" size=\"small\">\r\n                                                {showKeys.groq ? <VisibilityOff fontSize=\"small\" /> : <Visibility fontSize=\"small\" />}\r\n                                            </IconButton>\r\n                                        </InputAdornment>\r\n                                    ),\r\n                                }}\r\n                            />\r\n                            <Button\r\n                                variant=\"outlined\"\r\n                                size=\"small\"\r\n                                onClick={() => handleTestAndSave && handleTestAndSave('groq', freeApiKeys.groq as string, models.groq || 'llama-3.1-8b-instant')}\r\n                                disabled={!freeApiKeys.groq || savingFreeKeys}\r\n                                sx={{ minWidth: '120px', whiteSpace: 'nowrap' }}\r\n                            >\r\n                                Test & Save\r\n                            </Button>\r\n                        </Box>\r\n                    </Box>\r\n\r\n                    {/* OpenAI Key */}\r\n                    <Box sx={{ mb: 3 }}>\r\n                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>\r\n                            <Typography variant=\"subtitle2\" sx={{ fontWeight: 'bold' }}>OpenAI</Typography>\r\n                            <Typography variant=\"caption\" sx={{ bgcolor: '#f5f5f5', px: 1, py: 0.5, borderRadius: 1, color: 'text.secondary' }}>Premium Features</Typography>\r\n                        </Box>\r\n                        <Box sx={{ display: 'flex', gap: 2 }}>\r\n                            <TextField\r\n                                label=\"OpenAI API Key\"\r\n                                fullWidth\r\n                                size=\"small\"\r\n                                type={showKeys.openai ? 'text' : 'password'}\r\n                                value={freeApiKeys.openai as string}\r\n                                onChange={(e) => setFreeApiKeys((prev: any) => ({ ...prev, openai: e.target.value }))}\r\n                                InputProps={{\r\n                                    endAdornment: (\r\n                                        <InputAdornment position=\"end\">\r\n                                            <IconButton onClick={() => toggleShow('openai')} edge=\"end\" size=\"small\">\r\n                                                {showKeys.openai ? <VisibilityOff fontSize=\"small\" /> : <Visibility fontSize=\"small\" />}\r\n                                            </IconButton>\r\n                                        </InputAdornment>\r\n                                    ),\r\n                                }}\r\n                            />\r\n                            <Button\r\n                                variant=\"outlined\"\r\n                                size=\"small\"\r\n                                onClick={() => handleTestAndSave && handleTestAndSave('openai', freeApiKeys.openai as string, models.openai || 'gpt-3.5-turbo')}\r\n                                disabled={!freeApiKeys.openai || savingFreeKeys}\r\n                                sx={{ minWidth: '120px', whiteSpace: 'nowrap' }}\r\n                            >\r\n                                Test & Save\r\n                            </Button>\r\n                        </Box>\r\n                    </Box>\r\n\r\n                    {/* DeepSeek Key */}\r\n                    <Box sx={{ mb: 3 }}>\r\n                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>\r\n                            <Typography variant=\"subtitle2\" sx={{ fontWeight: 'bold' }}>DeepSeek</Typography>\r\n                            <Typography variant=\"caption\" sx={{ bgcolor: '#f5f5f5', px: 1, py: 0.5, borderRadius: 1, color: 'text.secondary' }}>AI Chat</Typography>\r\n                        </Box>\r\n                        <Box sx={{ display: 'flex', gap: 2 }}>\r\n                            <TextField\r\n                                label=\"DeepSeek API Key\"\r\n                                fullWidth\r\n                                size=\"small\"\r\n                                type={showKeys.deepseek ? 'text' : 'password'}\r\n                                value={freeApiKeys.deepseek as string}\r\n                                onChange={(e) => setFreeApiKeys((prev: any) => ({ ...prev, deepseek: e.target.value }))}\r\n                                InputProps={{\r\n                                    endAdornment: (\r\n                                        <InputAdornment position=\"end\">\r\n                                            <IconButton onClick={() => toggleShow('deepseek')} edge=\"end\" size=\"small\">\r\n                                                {showKeys.deepseek ? <VisibilityOff fontSize=\"small\" /> : <Visibility fontSize=\"small\" />}\r\n                                            </IconButton>\r\n                                        </InputAdornment>\r\n                                    ),\r\n                                }}\r\n                            />\r\n                            <Button\r\n                                variant=\"outlined\"\r\n                                size=\"small\"\r\n                                onClick={() => handleTestAndSave && handleTestAndSave('deepseek', freeApiKeys.deepseek as string, models.deepseek || 'deepseek-chat')}\r\n                                disabled={!freeApiKeys.deepseek || savingFreeKeys}\r\n                                sx={{ minWidth: '120px', whiteSpace: 'nowrap' }}\r\n                            >\r\n                                Test & Save\r\n                            </Button>\r\n                        </Box>\r\n                    </Box>\r\n\r\n                    {/* Cerebras Key */}\r\n                    <Box sx={{ mb: 3 }}>\r\n                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>\r\n                            <Typography variant=\"subtitle2\" sx={{ fontWeight: 'bold' }}>Cerebras</Typography>\r\n                            <Typography variant=\"caption\" sx={{ bgcolor: '#f5f5f5', px: 1, py: 0.5, borderRadius: 1, color: 'text.secondary' }}>Fast Inference (Optional)</Typography>\r\n                        </Box>\r\n                        <Box sx={{ display: 'flex', gap: 2 }}>\r\n                            <TextField\r\n                                label=\"Cerebras API Key\"\r\n                                fullWidth\r\n                                size=\"small\"\r\n                                type={showKeys.cerebras ? 'text' : 'password'}\r\n                                value={freeApiKeys.cerebras as string}\r\n                                onChange={(e) => setFreeApiKeys((prev: any) => ({ ...prev, cerebras: e.target.value }))}\r\n                                InputProps={{\r\n                                    endAdornment: (\r\n                                        <InputAdornment position=\"end\">\r\n                                            <IconButton onClick={() => toggleShow('cerebras')} edge=\"end\" size=\"small\">\r\n                                                {showKeys.cerebras ? <VisibilityOff fontSize=\"small\" /> : <Visibility fontSize=\"small\" />}\r\n                                            </IconButton>\r\n                                        </InputAdornment>\r\n                                    ),\r\n                                }}\r\n                            />\r\n                            <Button\r\n                                variant=\"outlined\"\r\n                                size=\"small\"\r\n                                disabled\r\n                                sx={{ minWidth: '120px', whiteSpace: 'nowrap' }}\r\n                            >\r\n                                Save Only\r\n                            </Button>\r\n                        </Box>\r\n                    </Box>\r\n\r\n                    {/* Sambanova Key */}\r\n                    <Box sx={{ mb: 3 }}>\r\n                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>\r\n                            <Typography variant=\"subtitle2\" sx={{ fontWeight: 'bold' }}>Sambanova</Typography>\r\n                            <Typography variant=\"caption\" sx={{ bgcolor: '#f5f5f5', px: 1, py: 0.5, borderRadius: 1, color: 'text.secondary' }}>Specialized Tasks (Optional)</Typography>\r\n                        </Box>\r\n                        <Box sx={{ display: 'flex', gap: 2 }}>\r\n                            <TextField\r\n                                label=\"Sambanova API Key\"\r\n                                fullWidth\r\n                                size=\"small\"\r\n                                type={showKeys.sambanova ? 'text' : 'password'}\r\n                                value={freeApiKeys.sambanova as string}\r\n                                onChange={(e) => setFreeApiKeys((prev: any) => ({ ...prev, sambanova: e.target.value }))}\r\n                                InputProps={{\r\n                                    endAdornment: (\r\n                                        <InputAdornment position=\"end\">\r\n                                            <IconButton onClick={() => toggleShow('sambanova')} edge=\"end\" size=\"small\">\r\n                                                {showKeys.sambanova ? <VisibilityOff fontSize=\"small\" /> : <Visibility fontSize=\"small\" />}\r\n                                            </IconButton>\r\n                                        </InputAdornment>\r\n                                    ),\r\n                                }}\r\n                            />\r\n                            <Button\r\n                                variant=\"outlined\"\r\n                                size=\"small\"\r\n                                disabled\r\n                                sx={{ minWidth: '120px', whiteSpace: 'nowrap' }}\r\n                            >\r\n                                Save Only\r\n                            </Button>\r\n                        </Box>\r\n                    </Box>\r\n\r\n                    {/* SerpAPI Key */}\r\n                    <Box>\r\n                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>\r\n                            <Typography variant=\"subtitle2\" sx={{ fontWeight: 'bold' }}>SerpAPI</Typography>\r\n                            <Typography variant=\"caption\" sx={{ bgcolor: '#f5f5f5', px: 1, py: 0.5, borderRadius: 1, color: 'text.secondary' }}>Web Search Results</Typography>\r\n                        </Box>\r\n                        <Box sx={{ display: 'flex', gap: 2 }}>\r\n                            <TextField\r\n                                label=\"SerpAPI Key\"\r\n                                fullWidth\r\n                                size=\"small\"\r\n                                type={showKeys.serpapi ? 'text' : 'password'}\r\n                                value={freeApiKeys.serpapi as string}\r\n                                onChange={(e) => setFreeApiKeys((prev: any) => ({ ...prev, serpapi: e.target.value }))}\r\n                                InputProps={{\r\n                                    endAdornment: (\r\n                                        <InputAdornment position=\"end\">\r\n                                            <IconButton onClick={() => toggleShow('serpapi')} edge=\"end\" size=\"small\">\r\n                                                {showKeys.serpapi ? <VisibilityOff fontSize=\"small\" /> : <Visibility fontSize=\"small\" />}\r\n                                            </IconButton>\r\n                                        </InputAdornment>\r\n                                    ),\r\n                                }}\r\n                            />\r\n                            <Button\r\n                                variant=\"outlined\"\r\n                                size=\"small\"\r\n                                disabled\r\n                                sx={{ minWidth: '120px', whiteSpace: 'nowrap' }}\r\n                            >\r\n                                Save Only\r\n                            </Button>\r\n                        </Box>\r\n                    </Box>\r\n\r\n                    <Box sx={{ display: 'flex', justifyContent: 'flex-end', mt: 3 }}>\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            onClick={handleSaveFreeKeys}\r\n                            disabled={savingFreeKeys}\r\n                            startIcon={savingFreeKeys ? <CircularProgress size={16} color=\"inherit\" /> : <SaveIcon />}\r\n                        >\r\n                            Save All Free Keys\r\n                        </Button>\r\n                    </Box>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* --- OLLAMA CARD --- */}\r\n            <Card sx={{ mb: 4, borderRadius: 2, border: '1px solid #e1bee7' }}>\r\n                <CardHeader\r\n                    title=\"Ollama AI Models\"\r\n                    subheader=\"Self-hosted LLM Inference Management (Free Forever)\"\r\n                    avatar={<SmartToyIcon color=\"secondary\" />}\r\n                    sx={{ bgcolor: '#f3e5f5', borderBottom: '1px solid #e1bee7' }}\r\n                    action={\r\n                        <Button startIcon={<SettingsSuggestIcon />} onClick={() => fetchOllamaModels(ollamaConfig.ollamaUrl)}>\r\n                            Refresh Models\r\n                        </Button>\r\n                    }\r\n                />\r\n                <CardContent sx={{ p: 3 }}>\r\n                    <Alert severity=\"success\" sx={{ mb: 2 }}>Γ£à Self-hosted = No API costs! Used for AI Chat when selected by users.</Alert>\r\n                    <Grid container spacing={2} sx={{ mb: 3 }}>\r\n                        <Grid item xs={12} md={6}>\r\n                            <TextField\r\n                                label=\"Primary Ollama URL\"\r\n                                fullWidth\r\n                                value={ollamaConfig.ollamaUrl}\r\n                                onChange={(e) => setOllamaConfig((prev: any) => ({ ...prev, ollamaUrl: e.target.value }))}\r\n                                placeholder=\"http://primary-server:11434\"\r\n                            />\r\n                        </Grid>\r\n                        <Grid item xs={12} md={6}>\r\n                            <TextField\r\n                                label=\"Fallback Ollama URL\"\r\n                                fullWidth\r\n                                value={ollamaConfig.ollamaFallbackUrl}\r\n                                onChange={(e) => setOllamaConfig((prev: any) => ({ ...prev, ollamaFallbackUrl: e.target.value }))}\r\n                                placeholder=\"http://backup-server:11434\"\r\n                            />\r\n                        </Grid>\r\n                    </Grid>\r\n\r\n                    <Typography variant=\"subtitle2\" sx={{ mb: 2, fontWeight: 'bold', color: 'text.secondary' }}>\r\n                        DETECTED MODELS ({availableModels.length})\r\n                    </Typography>\r\n\r\n                    {availableModels.length > 0 ? (\r\n                        <Grid container spacing={2} sx={{ mb: 3 }}>\r\n                            {availableModels.map((model) => (\r\n                                <Grid item xs={12} key={model}>\r\n                                    <Paper variant=\"outlined\" sx={{ p: 2, display: 'flex', alignItems: 'center', justifyContent: 'space-between', bgcolor: ollamaConfig.defaultOllamaModel === model ? 'rgba(156, 39, 176, 0.04)' : 'transparent', borderColor: ollamaConfig.defaultOllamaModel === model ? 'secondary.main' : 'divider' }}>\r\n                                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\r\n                                            <Box>\r\n                                                <Typography variant=\"body2\" fontWeight=\"bold\">\r\n                                                    {model}\r\n                                                </Typography>\r\n                                                <Typography variant=\"caption\" color={ollamaConfig.ollamaModels?.[model] ? 'success.main' : 'text.secondary'}>\r\n                                                    {ollamaConfig.ollamaModels?.[model] ? 'Enabled' : 'Disabled'}\r\n                                                </Typography>\r\n                                            </Box>\r\n                                            {ollamaConfig.defaultOllamaModel === model && (\r\n                                                <Box sx={{ bgcolor: 'secondary.main', color: 'white', px: 1, py: 0.2, borderRadius: 1, fontSize: '0.65rem', fontWeight: 'bold' }}>\r\n                                                    DEFAULT\r\n                                                </Box>\r\n                                            )}\r\n                                        </Box>\r\n                                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                                            <Button\r\n                                                size=\"small\"\r\n                                                variant={ollamaConfig.defaultOllamaModel === model ? \"contained\" : \"outlined\"}\r\n                                                color=\"secondary\"\r\n                                                disabled={!ollamaConfig.ollamaModels?.[model]}\r\n                                                onClick={() => setOllamaConfig((prev: any) => ({ ...prev, defaultOllamaModel: model }))}\r\n                                                sx={{ fontSize: '0.7rem' }}\r\n                                            >\r\n                                                {ollamaConfig.defaultOllamaModel === model ? \"Main\" : \"Set Main\"}\r\n                                            </Button>\r\n                                            <Switch\r\n                                                checked={!!ollamaConfig.ollamaModels?.[model]}\r\n                                                onChange={() => toggleModel(model)}\r\n                                                color=\"success\"\r\n                                            />\r\n                                        </Box>\r\n                                    </Paper>\r\n                                </Grid>\r\n                            ))}\r\n                        </Grid>\r\n                    ) : (\r\n                        <Alert severity=\"warning\" sx={{ mb: 3 }}>No models detected. Ensure Ollama is running and accessible.</Alert>\r\n                    )}\r\n\r\n                    <Box sx={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            color=\"secondary\"\r\n                            onClick={handleSaveOllama}\r\n                            disabled={savingOllama}\r\n                            startIcon={savingOllama ? <CircularProgress size={16} color=\"inherit\" /> : <SaveIcon />}\r\n                        >\r\n                            Save Model Config\r\n                        </Button>\r\n                    </Box>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* --- DEEPSEEK CARD --- */}\r\n            <Card sx={{ mb: 4, borderRadius: 2, border: '1px solid #42a5f5' }}>\r\n                <CardHeader\r\n                    title=\"DeepSeek AI\"\r\n                    subheader=\"High-performance Open/Self-hosted Model - Used for AI Chat\"\r\n                    avatar={<SmartToyIcon sx={{ color: '#42a5f5' }} />}\r\n                    sx={{ bgcolor: '#e3f2fd', borderBottom: '1px solid #42a5f5' }}\r\n                />\r\n                <CardContent sx={{ p: 3 }}>\r\n                    <Alert severity=\"info\" sx={{ mb: 2 }}>Configure your DeepSeek API or point to your self-hosted Ollama instance with DeepSeek models.</Alert>\r\n                    <TextField\r\n                        label=\"DeepSeek Base URL\"\r\n                        fullWidth\r\n                        value={deepseekConfig?.deepseekBaseUrl || ''}\r\n                        onChange={(e) => setDeepSeekConfig && setDeepSeekConfig((prev: any) => ({ ...prev, deepseekBaseUrl: e.target.value }))}\r\n                        placeholder=\"https://api.deepseek.com or http://your-vm:11434\"\r\n                        helperText=\"Use 'https://api.deepseek.com' for official API, or your local Ollama URL for self-hosted.\"\r\n                        sx={{ mb: 2 }}\r\n                    />\r\n                    <Box sx={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            onClick={handleSaveDeepSeek}\r\n                            disabled={savingDeepSeek}\r\n                            startIcon={savingDeepSeek ? <CircularProgress size={16} color=\"inherit\" /> : <SaveIcon />}\r\n                            sx={{\r\n                                bgcolor: '#42a5f5',\r\n                                '&:hover': { bgcolor: '#1e88e5' }\r\n                            }}\r\n                        >\r\n                            Save DeepSeek Config\r\n                        </Button>\r\n                    </Box>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* --- OPENROUTER CARD --- */}\r\n            <Card sx={{ mb: 4, borderRadius: 2, border: '1px solid #ff6b6b' }}>\r\n                <CardHeader\r\n                    title=\"OpenRouter API\"\r\n                    subheader=\"Access 100+ AI Models via Single API - Used for AI Chat\"\r\n                    avatar={<CloudQueueIcon sx={{ color: '#ff6b6b' }} />}\r\n                    sx={{ bgcolor: '#ffe5e5', borderBottom: '1px solid #ff6b6b' }}\r\n                />\r\n                <CardContent sx={{ p: 3 }}>\r\n                    <Alert severity=\"info\" sx={{ mb: 2 }}>≡ƒîÉ Free models available! Users can select OpenRouter in AI Chat.</Alert>\r\n                    <TextField\r\n                        label=\"OpenRouter API Key\"\r\n                        fullWidth\r\n                        type=\"password\"\r\n                        value={openrouterConfig?.openrouterApiKey || ''}\r\n                        onChange={(e) => setOpenRouterConfig && setOpenRouterConfig((prev: any) => ({ ...prev, openrouterApiKey: e.target.value }))}\r\n                        placeholder=\"sk-or-v1-...\"\r\n                        helperText=\"Get your free API key from openrouter.ai\"\r\n                        sx={{ mb: 2 }}\r\n                    />\r\n                    <TextField\r\n                        label=\"Default Model\"\r\n                        fullWidth\r\n                        value={openrouterConfig?.openrouterModel || ''}\r\n                        onChange={(e) => setOpenRouterConfig && setOpenRouterConfig((prev: any) => ({ ...prev, openrouterModel: e.target.value }))}\r\n                        placeholder=\"meta-llama/llama-3.1-8b-instruct:free\"\r\n                        helperText=\"Free models: meta-llama/llama-3.1-8b-instruct:free, google/gemma-2-9b-it:free\"\r\n                        sx={{ mb: 2 }}\r\n                    />\r\n                    <Box sx={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            onClick={handleSaveOpenRouter}\r\n                            disabled={savingOpenRouter}\r\n                            startIcon={savingOpenRouter ? <CircularProgress size={16} color=\"inherit\" /> : <SaveIcon />}\r\n                            sx={{\r\n                                bgcolor: '#ff6b6b',\r\n                                '&:hover': { bgcolor: '#ff5252' }\r\n                            }}\r\n                        >\r\n                            Save OpenRouter Config\r\n                        </Button>\r\n                    </Box>\r\n                </CardContent>\r\n            </Card>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\admin\\settings\\DateTimeSplitter.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\admin\\settings\\DateTimeSplitter.tsx:24:21\n  22 |                     // YYYY-MM-DD\n  23 |                     const isoLocal = new Date(d.getTime() - (d.getTimezoneOffset() * 60000)).toISOString();\n> 24 |                     setDatePart(isoLocal.slice(0, 10));\n     |                     ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  25 |                     setTimePart(isoLocal.slice(11, 16));\n  26 |                 }\n  27 |             } catch (e) {","line":24,"column":21,"nodeType":null,"endLine":24,"endColumn":32}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { Box, TextField, Typography } from '@mui/material';\r\n\r\ninterface DateTimeSplitterProps {\r\n    label: string; // e.g. \"Theme Start\"\r\n    value: string; // ISO UTC String\r\n    onChange: (isoString: string) => void;\r\n    helperText?: string;\r\n}\r\n\r\nexport default function DateTimeSplitter({ label, value, onChange, helperText }: DateTimeSplitterProps) {\r\n    // Local state for inputs\r\n    const [datePart, setDatePart] = useState('');\r\n    const [timePart, setTimePart] = useState('');\r\n\r\n    useEffect(() => {\r\n        if (value) {\r\n            try {\r\n                // Convert UTC ISO to Local for editing inputs\r\n                const d = new Date(value);\r\n                if (!isNaN(d.getTime())) {\r\n                    // YYYY-MM-DD\r\n                    const isoLocal = new Date(d.getTime() - (d.getTimezoneOffset() * 60000)).toISOString();\r\n                    setDatePart(isoLocal.slice(0, 10));\r\n                    setTimePart(isoLocal.slice(11, 16));\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Invalid date parse\", e);\r\n            }\r\n        }\r\n    }, [value]);\r\n\r\n    const handleUpdate = (d: string, t: string) => {\r\n        if (d && t) {\r\n            // Combine Local Date + Time -> UTC ISO\r\n            const localDate = new Date(`${d}T${t}:00`);\r\n            onChange(localDate.toISOString());\r\n        }\r\n        if (d) setDatePart(d);\r\n        if (t) setTimePart(t);\r\n    };\r\n\r\n    return (\r\n        <Box>\r\n            <Box sx={{ display: 'flex', gap: 1 }}>\r\n                <TextField\r\n                    type=\"date\"\r\n                    // Label logic simplified\r\n                    label={`${label} Date`}\r\n                    fullWidth\r\n                    value={datePart}\r\n                    onChange={(e) => handleUpdate(e.target.value, timePart)}\r\n                    InputLabelProps={{ shrink: true }}\r\n                />\r\n                <TextField\r\n                    type=\"time\"\r\n                    label=\"Time\"\r\n                    fullWidth\r\n                    value={timePart}\r\n                    onChange={(e) => handleUpdate(datePart, e.target.value)}\r\n                    InputLabelProps={{ shrink: true }}\r\n                />\r\n            </Box>\r\n            {helperText && (\r\n                <Typography variant=\"caption\" color=\"text.secondary\" sx={{ mt: 0.5, display: 'block', ml: 1 }}>\r\n                    {helperText}\r\n                </Typography>\r\n            )}\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\admin\\settings\\EventSettingsTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MenuItem' is defined but never used.","line":18,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'saving' is defined but never used.","line":69,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":11},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5452,5455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5452,5455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleGlobalUpdate' is assigned a value but never used.","line":165,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":165,"endColumn":29},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":344,"column":45,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[15358,15405],"text":"\r\n                                            &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[15358,15405],"text":"\r\n                                            &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[15358,15405],"text":"\r\n                                            &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[15358,15405],"text":"\r\n                                            &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":344,"column":71,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[15430,15473],"text":"&quot;\r\n                                        "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[15430,15473],"text":"&ldquo;\r\n                                        "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[15430,15473],"text":"&#34;\r\n                                        "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[15430,15473],"text":"&rdquo;\r\n                                        "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":435,"column":108,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[20162,20337],"text":"\r\n                                    Note: Background effects (Phase A) are now controlled globally via the &quot;Global Atmosphere Control\" tab.\r\n                                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[20162,20337],"text":"\r\n                                    Note: Background effects (Phase A) are now controlled globally via the &ldquo;Global Atmosphere Control\" tab.\r\n                                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[20162,20337],"text":"\r\n                                    Note: Background effects (Phase A) are now controlled globally via the &#34;Global Atmosphere Control\" tab.\r\n                                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[20162,20337],"text":"\r\n                                    Note: Background effects (Phase A) are now controlled globally via the &rdquo;Global Atmosphere Control\" tab.\r\n                                "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":435,"column":134,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[20162,20337],"text":"\r\n                                    Note: Background effects (Phase A) are now controlled globally via the \"Global Atmosphere Control&quot; tab.\r\n                                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[20162,20337],"text":"\r\n                                    Note: Background effects (Phase A) are now controlled globally via the \"Global Atmosphere Control&ldquo; tab.\r\n                                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[20162,20337],"text":"\r\n                                    Note: Background effects (Phase A) are now controlled globally via the \"Global Atmosphere Control&#34; tab.\r\n                                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[20162,20337],"text":"\r\n                                    Note: Background effects (Phase A) are now controlled globally via the \"Global Atmosphere Control&rdquo; tab.\r\n                                "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport {\r\n    Box,\r\n    Paper,\r\n    Typography,\r\n    Switch,\r\n    FormControlLabel,\r\n    TextField,\r\n    Button,\r\n    Divider,\r\n    IconButton,\r\n    Chip,\r\n    Card,\r\n    CardContent,\r\n    CardActions,\r\n    Stack,\r\n    Tooltip,\r\n    MenuItem\r\n} from '@mui/material';\r\nimport Grid from '@mui/material/GridLegacy';\r\nimport { EventManagerConfig, ExtendedSystemSettings } from '@/types/system';\r\nimport DateTimeSplitter from '@/components/admin/settings/DateTimeSplitter';\r\nimport AddCircleOutlineIcon from '@mui/icons-material/AddCircleOutline';\r\nimport EditIcon from '@mui/icons-material/Edit';\r\nimport DeleteOutlineIcon from '@mui/icons-material/DeleteOutline';\r\nimport ArrowBackIosNewIcon from '@mui/icons-material/ArrowBackIosNew';\r\nimport EventIcon from '@mui/icons-material/Event';\r\nimport AutoAwesomeIcon from '@mui/icons-material/AutoAwesome';\r\nimport MessageIcon from '@mui/icons-material/Message';\r\nimport PaletteIcon from '@mui/icons-material/Palette';\r\nimport ImageSearchIcon from '@mui/icons-material/ImageSearch';\r\nimport MusicNoteIcon from '@mui/icons-material/MusicNote';\r\nimport CloudUploadIcon from '@mui/icons-material/CloudUpload';\r\nimport DeleteForeverIcon from '@mui/icons-material/DeleteForever';\r\nimport CircularProgress from '@mui/material/CircularProgress';\r\n\r\nimport TuneIcon from '@mui/icons-material/Tune';\r\n\r\ninterface EventSettingsTabProps {\r\n    settings: ExtendedSystemSettings;\r\n    onUpdateSettings: (newSettings: ExtendedSystemSettings) => void;\r\n    saving: boolean;\r\n}\r\n\r\n// TEMPLATE for new events (Phase A removed)\r\nconst DEFAULT_EVENT_TEMPLATE: EventManagerConfig = {\r\n    event_id: 'New_Event',\r\n    is_active_global: true,\r\n    // [REMOVED] general_theme_start/end\r\n    celebration_music_start: new Date(Date.now() + 3600000).toISOString(),\r\n    celebration_climax_start: new Date(Date.now() + 3900000).toISOString(),\r\n    celebration_music_end: new Date(Date.now() + 7200000).toISOString(),\r\n    countdown_seconds: 10,\r\n    celebration_message: 'HAPPY HOLIDAYS',\r\n    special_message: '',\r\n    special_message_color: '#ffffff',\r\n    special_message_image_url: '',\r\n    climax_message_start: '',\r\n    climax_message_end: '',\r\n    special_message_start: '',\r\n    special_message_end: '',\r\n    music_file_url: '',\r\n    climax_effect: 'fireworks'\r\n};\r\n\r\nexport default function EventSettingsTab({\r\n    settings,\r\n    onUpdateSettings,\r\n    saving\r\n}: EventSettingsTabProps) {\r\n\r\n    const [view, setView] = useState<'LIST' | 'EDITOR'>('LIST');\r\n    const [editingIndex, setEditingIndex] = useState<number>(-1);\r\n    const [editorState, setEditorState] = useState<EventManagerConfig>(DEFAULT_EVENT_TEMPLATE);\r\n    const [uploading, setUploading] = useState(false);\r\n\r\n    const schedule: EventManagerConfig[] = settings?.eventSchedule || [];\r\n\r\n    // --- ACTIONS ---\r\n\r\n    const handleCreateNew = () => {\r\n        setEditorState({ ...DEFAULT_EVENT_TEMPLATE, event_id: `Event_${new Date().getFullYear()}` });\r\n        setEditingIndex(-1);\r\n        setView('EDITOR');\r\n    };\r\n\r\n    const handleEdit = (index: number) => {\r\n        setEditorState({ ...schedule[index] });\r\n        setEditingIndex(index);\r\n        setView('EDITOR');\r\n    };\r\n\r\n    const handleDelete = async (index: number) => {\r\n        if (!confirm('Are you sure you want to delete this event? This will also delete any associated music file.')) return;\r\n\r\n        const eventToDelete = schedule[index];\r\n        if (eventToDelete.music_file_url && eventToDelete.music_file_url.includes('cloud.appwrite.io')) {\r\n            try {\r\n                const urlObj = new URL(eventToDelete.music_file_url);\r\n                const pathParts = urlObj.pathname.split('/');\r\n                const bucketId = pathParts[3];\r\n                const fileId = pathParts[5];\r\n\r\n                if (bucketId && fileId) {\r\n                    await fetch('/api/admin/delete-file', {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({ bucketId, fileId })\r\n                    });\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Failed to cleanup file\", e);\r\n            }\r\n        }\r\n\r\n        const newSchedule = [...schedule];\r\n        newSchedule.splice(index, 1);\r\n        onUpdateSettings({ ...settings, eventSchedule: newSchedule });\r\n    };\r\n\r\n    const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>, targetField: 'music_file_url' | 'special_message_image_url') => {\r\n        if (!e.target.files || e.target.files.length === 0) return;\r\n\r\n        const file = e.target.files[0];\r\n        const formData = new FormData();\r\n        formData.append('file', file);\r\n\r\n        setUploading(true);\r\n        try {\r\n            const res = await fetch('/api/admin/upload', {\r\n                method: 'POST',\r\n                body: formData\r\n            });\r\n            const data = await res.json();\r\n\r\n            if (data.success && data.url) {\r\n                handleEditorChange(targetField, data.url);\r\n            } else {\r\n                alert('Upload Failed: ' + (data.error || 'Unknown Error'));\r\n            }\r\n        } catch (err) {\r\n            console.error(err);\r\n            alert('Upload Error');\r\n        } finally {\r\n            setUploading(false);\r\n        }\r\n    };\r\n\r\n    const handleEditorChange = (field: keyof EventManagerConfig, value: any) => {\r\n        setEditorState(prev => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    const handleSaveEditor = () => {\r\n        const newSchedule = [...schedule];\r\n        if (editingIndex === -1) {\r\n            newSchedule.push(editorState);\r\n        } else {\r\n            newSchedule[editingIndex] = editorState;\r\n        }\r\n        onUpdateSettings({ ...settings, eventSchedule: newSchedule });\r\n        setView('LIST');\r\n    };\r\n\r\n    // Update Global Atmosphere Settings\r\n    const handleGlobalUpdate = <K extends keyof ExtendedSystemSettings>(key: K, value: ExtendedSystemSettings[K]) => {\r\n        onUpdateSettings({\r\n            ...settings,\r\n            [key]: value\r\n        });\r\n    };\r\n\r\n    const handleGlobalEffectChange = (effectKey: 'snow' | 'rain' | 'leaves' | 'confetti' | 'christmas', value: boolean) => {\r\n        // Ensure globalEffects exists, default to all false if undefined\r\n        const currentEffects = settings.globalEffects || { snow: false, rain: false, leaves: false, confetti: false, christmas: false };\r\n\r\n        onUpdateSettings({\r\n            ...settings,\r\n            globalEffects: {\r\n                ...currentEffects,\r\n                [effectKey]: value\r\n            }\r\n        });\r\n    };\r\n\r\n    const fmtDate = (iso: string) => {\r\n        if (!iso) return 'N/A';\r\n        return new Date(iso).toLocaleDateString(undefined, { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });\r\n    };\r\n\r\n    // --- RENDER ---\r\n\r\n    if (view === 'LIST') {\r\n        return (\r\n            <Box>\r\n                {/* ----------------- GLOBAL ATMOSPHERE CONTROL ----------------- */}\r\n                <Card variant=\"outlined\" sx={{ mb: 4, borderColor: 'primary.main', borderWidth: 1 }}>\r\n                    <CardContent>\r\n                        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\r\n                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5 }}>\r\n                                <TuneIcon color=\"primary\" fontSize=\"large\" />\r\n                                <Box>\r\n                                    <Typography variant=\"h6\" fontWeight=\"bold\">Global Atmosphere Control</Typography>\r\n                                    <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                        Toggle multiple effects simultaneously. These run independently of scheduled events.\r\n                                    </Typography>\r\n                                </Box>\r\n                            </Box>\r\n                        </Box>\r\n\r\n                        <Grid container spacing={3}>\r\n                            {/* Snow Switch */}\r\n                            <Grid item xs={6} md={3}>\r\n                                <FormControlLabel\r\n                                    control={\r\n                                        <Switch\r\n                                            checked={settings.globalEffects?.snow || false}\r\n                                            onChange={(e) => handleGlobalEffectChange('snow', e.target.checked)}\r\n                                            color=\"primary\"\r\n                                        />\r\n                                    }\r\n                                    label=\"Γ¥ä∩╕Å Snow\"\r\n                                />\r\n                            </Grid>\r\n                            {/* Rain Switch */}\r\n                            <Grid item xs={6} md={3}>\r\n                                <FormControlLabel\r\n                                    control={\r\n                                        <Switch\r\n                                            checked={settings.globalEffects?.rain || false}\r\n                                            onChange={(e) => handleGlobalEffectChange('rain', e.target.checked)}\r\n                                            color=\"primary\"\r\n                                        />\r\n                                    }\r\n                                    label=\"≡ƒîº∩╕Å Rain\"\r\n                                />\r\n                            </Grid>\r\n                            {/* Leaves Switch */}\r\n                            <Grid item xs={6} md={3}>\r\n                                <FormControlLabel\r\n                                    control={\r\n                                        <Switch\r\n                                            checked={settings.globalEffects?.leaves || false}\r\n                                            onChange={(e) => handleGlobalEffectChange('leaves', e.target.checked)}\r\n                                            color=\"primary\"\r\n                                        />\r\n                                    }\r\n                                    label=\"≡ƒìé Leaves\"\r\n                                />\r\n                            </Grid>\r\n                            <Grid item xs={6} md={3}>\r\n                                <FormControlLabel\r\n                                    control={\r\n                                        <Switch\r\n                                            checked={settings.globalEffects?.confetti || false}\r\n                                            onChange={(e) => handleGlobalEffectChange('confetti', e.target.checked)}\r\n                                            color=\"secondary\"\r\n                                        />\r\n                                    }\r\n                                    label=\"≡ƒÄè Confetti\"\r\n                                />\r\n                            </Grid>\r\n                            {/* Christmas Switch */}\r\n                            <Grid item xs={6} md={3}>\r\n                                <FormControlLabel\r\n                                    control={\r\n                                        <Switch\r\n                                            checked={settings.globalEffects?.christmas || false}\r\n                                            onChange={(e) => handleGlobalEffectChange('christmas', e.target.checked)}\r\n                                            color=\"error\"\r\n                                        />\r\n                                    }\r\n                                    label=\"≡ƒÄä Christmas\"\r\n                                />\r\n                            </Grid>\r\n                        </Grid>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Divider sx={{ mb: 4 }} />\r\n\r\n                {/* ----------------- SCHEDULED EVENTS HEADER ----------------- */}\r\n                <Box sx={{\r\n                    display: 'flex',\r\n                    justifyContent: 'space-between',\r\n                    alignItems: 'center',\r\n                    mb: 4,\r\n                }}>\r\n                    <Box>\r\n                        <Typography variant=\"h5\" fontWeight=\"bold\" color=\"text.primary\">\r\n                            Event Schedule\r\n                        </Typography>\r\n                        <Typography variant=\"body2\" color=\"text.secondary\">\r\n                            Scheduled celebrations (New Year Countdown, Music, Popups).\r\n                        </Typography>\r\n                    </Box>\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        startIcon={<AddCircleOutlineIcon />}\r\n                        onClick={handleCreateNew}\r\n                    >\r\n                        New Event\r\n                    </Button>\r\n                </Box>\r\n\r\n                {/* Grid of Cards */}\r\n                {schedule.length === 0 ? (\r\n                    <Box sx={{\r\n                        p: 8,\r\n                        textAlign: 'center',\r\n                        borderRadius: 4,\r\n                        bgcolor: 'background.paper',\r\n                        border: 1,\r\n                        borderColor: 'divider'\r\n                    }}>\r\n                        <EventIcon sx={{ fontSize: 60, mb: 2, opacity: 0.5, color: 'text.secondary' }} />\r\n                        <Typography color=\"text.secondary\">No scheduled events. Create one to get started!</Typography>\r\n                    </Box>\r\n                ) : (\r\n                    <Grid container spacing={3}>\r\n                        {schedule.map((evt, idx) => (\r\n                            <Grid item xs={12} md={6} lg={4} key={evt.event_id || idx}>\r\n                                <Card variant=\"outlined\" sx={{ height: '100%' }}>\r\n                                    <CardContent>\r\n                                        <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 2 }}>\r\n                                            <Chip\r\n                                                label={evt.is_active_global ? \"ACTIVE\" : \"INACTIVE\"}\r\n                                                size=\"small\"\r\n                                                color={evt.is_active_global ? \"success\" : \"default\"}\r\n                                            />\r\n                                            {/* Phase A Removed, just show Climax info */}\r\n                                            <Chip\r\n                                                icon={<AutoAwesomeIcon sx={{ fontSize: 16 }} />}\r\n                                                label={evt.climax_effect === 'none' ? 'No Climax' : evt.climax_effect}\r\n                                                size=\"small\"\r\n                                                variant=\"outlined\"\r\n                                            />\r\n                                        </Box>\r\n\r\n                                        <Typography variant=\"h6\" fontWeight=\"bold\" sx={{ mb: 1, color: 'text.primary' }}>\r\n                                            {evt.event_id}\r\n                                        </Typography>\r\n\r\n                                        <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 2, minHeight: 40, fontStyle: 'italic' }}>\r\n                                            \"{evt.celebration_message}\"\r\n                                        </Typography>\r\n\r\n                                        <Divider sx={{ mb: 2 }} />\r\n\r\n                                        <Stack spacing={1}>\r\n                                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, fontSize: '0.85rem' }}>\r\n                                                <Typography variant=\"caption\" sx={{ fontWeight: 'bold', width: 60, color: 'text.primary' }}>START</Typography>\r\n                                                {fmtDate(evt.celebration_music_start)}\r\n                                            </Box>\r\n                                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, fontSize: '0.85rem' }}>\r\n                                                <Typography variant=\"caption\" sx={{ fontWeight: 'bold', width: 60, color: 'text.primary' }}>END</Typography>\r\n                                                {fmtDate(evt.celebration_music_end)}\r\n                                            </Box>\r\n                                        </Stack>\r\n                                    </CardContent>\r\n\r\n                                    <CardActions sx={{ p: 2, pt: 0, justifyContent: 'flex-end' }}>\r\n                                        <Tooltip title=\"Delete Event\">\r\n                                            <IconButton onClick={() => handleDelete(idx)} color=\"error\" size=\"small\">\r\n                                                <DeleteOutlineIcon />\r\n                                            </IconButton>\r\n                                        </Tooltip>\r\n                                        <Button\r\n                                            variant=\"outlined\"\r\n                                            size=\"small\"\r\n                                            startIcon={<EditIcon />}\r\n                                            onClick={() => handleEdit(idx)}\r\n                                        >\r\n                                            Edit\r\n                                        </Button>\r\n                                    </CardActions>\r\n                                </Card>\r\n                            </Grid>\r\n                        ))}\r\n                    </Grid>\r\n                )}\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    // --- EDITOR VIEW (STANDARD UI) ---\r\n    return (\r\n        <Box>\r\n            <Button\r\n                startIcon={<ArrowBackIosNewIcon />}\r\n                onClick={() => setView('LIST')}\r\n                sx={{ mb: 3 }}\r\n            >\r\n                Back to Schedule\r\n            </Button>\r\n\r\n            <Paper sx={{ p: 4, mb: 3 }} variant=\"outlined\">\r\n                {/* Header */}\r\n                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', mb: 4 }}>\r\n                    <Box>\r\n                        <Typography variant=\"overline\" color=\"primary\" fontWeight=\"bold\">\r\n                            CONFIGURATION\r\n                        </Typography>\r\n                        <Typography variant=\"h4\" fontWeight=\"bold\" color=\"text.primary\">\r\n                            {editingIndex === -1 ? 'New Event Setup' : editorState.event_id}\r\n                        </Typography>\r\n                    </Box>\r\n                    <FormControlLabel\r\n                        control={\r\n                            <Switch\r\n                                checked={editorState.is_active_global}\r\n                                onChange={(e) => handleEditorChange('is_active_global', e.target.checked)}\r\n                                color=\"success\"\r\n                            />\r\n                        }\r\n                        label={<Typography fontWeight=\"bold\">{editorState.is_active_global ? \"ACTIVE\" : \"INACTIVE\"}</Typography>}\r\n                    />\r\n                </Box>\r\n\r\n                <Grid container spacing={4}>\r\n                    <Grid item xs={12}>\r\n                        <TextField\r\n                            fullWidth\r\n                            label=\"Event Identifier\"\r\n                            value={editorState.event_id}\r\n                            onChange={(e) => handleEditorChange('event_id', e.target.value)}\r\n                            helperText=\"Internal unique name (e.g. 'NYE_2025')\"\r\n                        />\r\n                    </Grid>\r\n\r\n                    {/* PHASE A REMOVED (Theme & Ambience) - Now handled globally */}\r\n                    <Grid item xs={12}>\r\n                        <Card variant=\"outlined\" sx={{ bgcolor: 'action.hover' }}>\r\n                            <CardContent>\r\n                                <Typography variant=\"body2\" color=\"text.secondary\" fontStyle=\"italic\">\r\n                                    Note: Background effects (Phase A) are now controlled globally via the \"Global Atmosphere Control\" tab.\r\n                                </Typography>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </Grid>\r\n\r\n                    {/* PHASE B CARD - The Celebration */}\r\n                    <Grid item xs={12}>\r\n                        <Card variant=\"outlined\">\r\n                            <CardContent>\r\n                                <Typography variant=\"h6\" sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1, color: 'text.primary' }}>\r\n                                    <EventIcon color=\"secondary\" /> The Celebration Event\r\n                                </Typography>\r\n                                <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 3 }}>\r\n                                    The main event moment. Fireworks, countdowns, and music.\r\n                                </Typography>\r\n\r\n                                <Grid container spacing={3}>\r\n                                    <Grid item xs={12} md={4}>\r\n                                        <TextField\r\n                                            select\r\n                                            fullWidth\r\n                                            label=\"Climax Effect\"\r\n                                            value={editorState.climax_effect || 'fireworks'}\r\n                                            onChange={(e) => handleEditorChange('climax_effect', e.target.value)}\r\n                                            SelectProps={{ native: true }}\r\n                                        >\r\n                                            <option value=\"fireworks\">≡ƒÄå Fireworks</option>\r\n                                            <option value=\"confetti\">≡ƒÄè Confetti</option>\r\n                                            <option value=\"both\">≡ƒÄå + ≡ƒÄè Both</option>\r\n                                            <option value=\"none\">≡ƒÜ½ None</option>\r\n                                        </TextField>\r\n                                    </Grid>\r\n\r\n                                    <Grid item xs={12} md={6}>\r\n                                        <TextField\r\n                                            fullWidth\r\n                                            label=\"Climax Message (Big Text)\"\r\n                                            value={editorState.celebration_message}\r\n                                            onChange={(e) => handleEditorChange('celebration_message', e.target.value)}\r\n                                            placeholder=\"e.g. HAPPY NEW YEAR!\"\r\n                                        />\r\n                                    </Grid>\r\n                                    <Grid item xs={12} md={3}>\r\n                                        <DateTimeSplitter\r\n                                            label=\"Msg Start\"\r\n                                            value={editorState.climax_message_start || ''}\r\n                                            onChange={(val) => handleEditorChange('climax_message_start', val)}\r\n                                        />\r\n                                    </Grid>\r\n                                    <Grid item xs={12} md={3}>\r\n                                        <DateTimeSplitter\r\n                                            label=\"Msg End\"\r\n                                            value={editorState.climax_message_end || ''}\r\n                                            onChange={(val) => handleEditorChange('climax_message_end', val)}\r\n                                        />\r\n                                    </Grid>\r\n\r\n                                    <Grid item xs={12} md={4}>\r\n                                        <TextField\r\n                                            fullWidth\r\n                                            type=\"number\"\r\n                                            label=\"Countdown (s)\"\r\n                                            value={editorState.countdown_seconds}\r\n                                            onChange={(e) => handleEditorChange('countdown_seconds', parseInt(e.target.value) || 10)}\r\n                                        />\r\n                                    </Grid>\r\n\r\n                                    <Grid item xs={12} md={4}>\r\n                                        <DateTimeSplitter\r\n                                            label=\"Music Start (Fade In)\"\r\n                                            value={editorState.celebration_music_start}\r\n                                            onChange={(val) => handleEditorChange('celebration_music_start', val)}\r\n                                        />\r\n                                    </Grid>\r\n                                    <Grid item xs={12} md={4}>\r\n                                        <DateTimeSplitter\r\n                                            label=\"All Effects Start (Climax)\"\r\n                                            value={editorState.celebration_climax_start || editorState.celebration_music_start}\r\n                                            onChange={(val) => handleEditorChange('celebration_climax_start', val)}\r\n                                        />\r\n                                    </Grid>\r\n                                    <Grid item xs={12} md={4}>\r\n                                        <DateTimeSplitter\r\n                                            label=\"Event Stop (Fade Out)\"\r\n                                            value={editorState.celebration_music_end}\r\n                                            onChange={(val) => handleEditorChange('celebration_music_end', val)}\r\n                                        />\r\n                                    </Grid>\r\n\r\n                                    <Grid item xs={12}>\r\n                                        <Divider sx={{ my: 2 }}>Special Message Configuration</Divider>\r\n                                        <Box sx={{ p: 2, bgcolor: 'background.default', borderRadius: 2, border: 1, borderColor: 'divider' }}>\r\n                                            <Typography variant=\"subtitle1\" sx={{ mb: 2, display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                                                <MessageIcon fontSize=\"small\" /> Special Message\r\n                                            </Typography>\r\n\r\n                                            <Grid container spacing={3}>\r\n                                                <Grid item xs={12} md={4}>\r\n                                                    <DateTimeSplitter\r\n                                                        label=\"Msg Start\"\r\n                                                        value={editorState.special_message_start || ''}\r\n                                                        onChange={(val) => handleEditorChange('special_message_start', val)}\r\n                                                    />\r\n                                                </Grid>\r\n                                                <Grid item xs={12} md={4}>\r\n                                                    <DateTimeSplitter\r\n                                                        label=\"Msg End\"\r\n                                                        value={editorState.special_message_end || ''}\r\n                                                        onChange={(val) => handleEditorChange('special_message_end', val)}\r\n                                                    />\r\n                                                </Grid>\r\n                                                <Grid item xs={12} md={6}>\r\n                                                    <TextField\r\n                                                        fullWidth\r\n                                                        multiline\r\n                                                        rows={4}\r\n                                                        label=\"Message Text (Thank You Note)\"\r\n                                                        value={editorState.special_message || ''}\r\n                                                        onChange={(e) => handleEditorChange('special_message', e.target.value)}\r\n                                                        placeholder=\"Use this space for a detailed message...\"\r\n                                                    />\r\n                                                </Grid>\r\n                                                <Grid item xs={12} md={6}>\r\n                                                    <Stack spacing={3}>\r\n                                                        <Box sx={{ display: 'flex', gap: 2, alignItems: 'center' }}>\r\n                                                            <PaletteIcon color=\"action\" />\r\n                                                            <TextField\r\n                                                                fullWidth\r\n                                                                type=\"color\"\r\n                                                                label=\"Text Color\"\r\n                                                                value={editorState.special_message_color || '#ffffff'}\r\n                                                                onChange={(e) => handleEditorChange('special_message_color', e.target.value)}\r\n                                                            />\r\n                                                        </Box>\r\n                                                        <Box sx={{ display: 'flex', gap: 2, alignItems: 'center' }}>\r\n                                                            <ImageSearchIcon color=\"action\" />\r\n                                                            <TextField\r\n                                                                fullWidth\r\n                                                                label=\"Message Image URL\"\r\n                                                                value={editorState.special_message_image_url || ''}\r\n                                                                onChange={(e) => handleEditorChange('special_message_image_url', e.target.value)}\r\n                                                                disabled={uploading}\r\n                                                                InputProps={{\r\n                                                                    endAdornment: (\r\n                                                                        <Button\r\n                                                                            component=\"label\"\r\n                                                                            variant=\"contained\"\r\n                                                                            size=\"small\"\r\n                                                                            disabled={uploading}\r\n                                                                            startIcon={uploading ? <CircularProgress size={16} /> : <CloudUploadIcon />}\r\n                                                                        >\r\n                                                                            Upload\r\n                                                                            <input\r\n                                                                                type=\"file\"\r\n                                                                                hidden\r\n                                                                                accept=\"image/*\"\r\n                                                                                onChange={(e) => handleFileUpload(e, 'special_message_image_url')}\r\n                                                                            />\r\n                                                                        </Button>\r\n                                                                    )\r\n                                                                }}\r\n                                                            />\r\n                                                        </Box>\r\n                                                    </Stack>\r\n                                                </Grid>\r\n                                            </Grid>\r\n                                        </Box>\r\n                                    </Grid>\r\n                                </Grid>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </Grid>\r\n\r\n                    {/* MUSIC SECTION */}\r\n                    <Grid item xs={12}>\r\n                        <Card variant=\"outlined\">\r\n                            <CardContent>\r\n                                <Box sx={{ display: 'flex', gap: 2, alignItems: 'center', mb: 2 }}>\r\n                                    <MusicNoteIcon color=\"primary\" />\r\n                                    <Typography variant=\"h6\">Background Music</Typography>\r\n                                </Box>\r\n\r\n                                <Grid container spacing={2} alignItems=\"center\">\r\n                                    <Grid item xs={12} md={8}>\r\n                                        <TextField\r\n                                            fullWidth\r\n                                            label=\"Music URL\"\r\n                                            value={editorState.music_file_url}\r\n                                            onChange={(e) => handleEditorChange('music_file_url', e.target.value)}\r\n                                            placeholder=\"https://...\"\r\n                                            disabled={uploading}\r\n                                        />\r\n                                    </Grid>\r\n                                    <Grid item xs={12} md={4} sx={{ display: 'flex', gap: 1 }}>\r\n                                        <Button\r\n                                            component=\"label\"\r\n                                            variant=\"contained\"\r\n                                            startIcon={uploading ? <CircularProgress size={20} color=\"inherit\" /> : <CloudUploadIcon />}\r\n                                            disabled={uploading}\r\n                                            sx={{ flex: 1 }}\r\n                                        >\r\n                                            {uploading ? 'Uploading...' : 'Upload File'}\r\n                                            <input\r\n                                                type=\"file\"\r\n                                                hidden\r\n                                                accept=\"audio/*\"\r\n                                                onChange={(e) => handleFileUpload(e, 'music_file_url')}\r\n                                            />\r\n                                        </Button>\r\n\r\n                                        {editorState.music_file_url && (\r\n                                            <Tooltip title=\"Clear/Remove Music\">\r\n                                                <IconButton color=\"error\" onClick={() => handleEditorChange('music_file_url', '')}>\r\n                                                    <DeleteForeverIcon />\r\n                                                </IconButton>\r\n                                            </Tooltip>\r\n                                        )}\r\n                                    </Grid>\r\n                                </Grid>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </Grid>\r\n                </Grid>\r\n\r\n                {/* Footer Actions */}\r\n                <Box sx={{ display: 'flex', justifyContent: 'flex-end', mt: 6, gap: 2 }}>\r\n                    <Button\r\n                        size=\"large\"\r\n                        variant=\"outlined\"\r\n                        onClick={() => setEditorState({ ...DEFAULT_EVENT_TEMPLATE, event_id: 'Auto_' + Date.now() })}\r\n                    >\r\n                        Load Preset\r\n                    </Button>\r\n                    <Button\r\n                        size=\"large\"\r\n                        variant=\"contained\"\r\n                        onClick={handleSaveEditor}\r\n                        sx={{ px: 5, fontWeight: 'bold' }}\r\n                    >\r\n                        Save Configuration\r\n                    </Button>\r\n                </Box>\r\n            </Paper>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\admin\\settings\\GeneralSettingsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\admin\\settings\\SystemSettingsTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1010,1013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1010,1013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2586,2589],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2586,2589],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3115,3118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3115,3118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport {\r\n    Box,\r\n    Card,\r\n    CardHeader,\r\n    CardContent,\r\n    TextField,\r\n    Button,\r\n    CircularProgress,\r\n    Typography\r\n} from '@mui/material';\r\nimport SearchIcon from '@mui/icons-material/Search';\r\nimport CloudQueueIcon from '@mui/icons-material/CloudQueue';\r\nimport SaveIcon from '@mui/icons-material/Save';\r\nimport ComputerIcon from '@mui/icons-material/Computer';\r\nimport AttachMoneyIcon from '@mui/icons-material/AttachMoney';\r\n\r\ninterface SystemSettingsTabProps {\r\n    searxngConfig: { searxngUrl: string };\r\n    setSearxngConfig: React.Dispatch<React.SetStateAction<{ searxngUrl: string }>>;\r\n    handleSaveSearxng: () => Promise<void>;\r\n    savingSearxng: boolean;\r\n    handleRunBackup: () => Promise<void>;\r\n    runningBackup: boolean;\r\n    // GitHub Models (PC Builder)\r\n    githubModelsConfig: {\r\n        githubModelsToken: string;\r\n        githubModelsModel: string;\r\n    };\r\n    setGithubModelsConfig: React.Dispatch<React.SetStateAction<any>>;\r\n    handleSaveGithubModels: () => Promise<void>;\r\n    savingGithubModels: boolean;\r\n    // PC Consultation Price\r\n    pcConsultationPrice: number;\r\n    setPcConsultationPrice: React.Dispatch<React.SetStateAction<number>>;\r\n    handleSavePcPrice: () => Promise<void>;\r\n    savingPcPrice: boolean;\r\n}\r\n\r\nexport default function SystemSettingsTab({\r\n    searxngConfig,\r\n    setSearxngConfig,\r\n    handleSaveSearxng,\r\n    savingSearxng,\r\n    handleRunBackup,\r\n    runningBackup,\r\n    githubModelsConfig,\r\n    setGithubModelsConfig,\r\n    handleSaveGithubModels,\r\n    savingGithubModels,\r\n    pcConsultationPrice,\r\n    setPcConsultationPrice,\r\n    handleSavePcPrice,\r\n    savingPcPrice\r\n}: SystemSettingsTabProps) {\r\n    return (\r\n        <Box>\r\n            {/* --- GITHUB MODELS (PC BUILDER) CARD --- */}\r\n            <Card sx={{ mb: 4, borderRadius: 2, border: '1px solid #c8b6ff' }}>\r\n                <CardHeader\r\n                    title=\"GitHub Models API (PC Builder)\"\r\n                    subheader=\"AI for PC build recommendations\"\r\n                    avatar={<ComputerIcon sx={{ color: '#6C63FF' }} />}\r\n                    sx={{ bgcolor: '#f3f0ff', borderBottom: '1px solid #c8b6ff' }}\r\n                />\r\n                <CardContent sx={{ p: 3 }}>\r\n                    <TextField\r\n                        label=\"GitHub Personal Access Token\"\r\n                        fullWidth\r\n                        type=\"password\"\r\n                        value={githubModelsConfig.githubModelsToken}\r\n                        onChange={(e) => setGithubModelsConfig((prev: any) => ({ ...prev, githubModelsToken: e.target.value }))}\r\n                        placeholder=\"github_pat_11...\"\r\n                        helperText=\"Create a token at github.com/settings/tokens with 'models' scope\"\r\n                        sx={{ mb: 2 }}\r\n                    />\r\n                    <TextField\r\n                        label=\"Model\"\r\n                        fullWidth\r\n                        value={githubModelsConfig.githubModelsModel}\r\n                        onChange={(e) => setGithubModelsConfig((prev: any) => ({ ...prev, githubModelsModel: e.target.value }))}\r\n                        placeholder=\"gpt-4o\"\r\n                        helperText=\"Model ID from GitHub Models catalog\"\r\n                        sx={{ mb: 2 }}\r\n                    />\r\n                    <Box sx={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            onClick={handleSaveGithubModels}\r\n                            disabled={savingGithubModels}\r\n                            startIcon={savingGithubModels ? <CircularProgress size={16} color=\"inherit\" /> : <SaveIcon />}\r\n                            sx={{\r\n                                background: 'linear-gradient(45deg, #6C63FF 30%, #00F0FF 90%)',\r\n                                '&:hover': { opacity: 0.9 }\r\n                            }}\r\n                        >\r\n                            Save PC Builder Config\r\n                        </Button>\r\n                    </Box>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* --- PC BUILDER CONSULTATION PRICE --- */}\r\n            <Card sx={{ mb: 4, borderRadius: 2, border: '1px solid #ffd700' }}>\r\n                <CardHeader\r\n                    title=\"PC Consultation Service\"\r\n                    subheader=\"Pricing configuration\"\r\n                    avatar={<AttachMoneyIcon sx={{ color: '#ffd700' }} />}\r\n                    sx={{ bgcolor: '#fffde7', borderBottom: '1px solid #ffd700' }}\r\n                />\r\n                <CardContent sx={{ p: 3 }}>\r\n                    <TextField\r\n                        label=\"Consultation Price (USD Cents)\"\r\n                        fullWidth\r\n                        type=\"number\"\r\n                        value={pcConsultationPrice}\r\n                        onChange={(e) => setPcConsultationPrice(Number(e.target.value))}\r\n                        placeholder=\"2000\"\r\n                        helperText=\"2000 = $20.00\"\r\n                        sx={{ mb: 2 }}\r\n                    />\r\n                    <Box sx={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            onClick={handleSavePcPrice}\r\n                            disabled={savingPcPrice}\r\n                            startIcon={savingPcPrice ? <CircularProgress size={16} color=\"inherit\" /> : <SaveIcon />}\r\n                            sx={{\r\n                                background: 'linear-gradient(45deg, #FFD700 30%, #FF8C00 90%)',\r\n                                color: 'white'\r\n                            }}\r\n                        >\r\n                            Save Price\r\n                        </Button>\r\n                    </Box>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* --- SEARXNG CARD --- */}\r\n            <Card sx={{ mb: 4, borderRadius: 2, border: '1px solid #c8e6c9' }}>\r\n                <CardHeader\r\n                    title=\"SearXNG Search Engine\"\r\n                    subheader=\"Self-hosted unlimited web search\"\r\n                    avatar={<SearchIcon color=\"success\" />}\r\n                    sx={{ bgcolor: '#e8f5e9', borderBottom: '1px solid #c8e6c9' }}\r\n                />\r\n                <CardContent sx={{ p: 3 }}>\r\n                    <TextField\r\n                        label=\"SearXNG Instance URL\"\r\n                        fullWidth\r\n                        value={searxngConfig.searxngUrl}\r\n                        onChange={(e) => setSearxngConfig(prev => ({ ...prev, searxngUrl: e.target.value }))}\r\n                        placeholder=\"http://your-server:8080\"\r\n                        helperText=\"Ensure JSON format is enabled in settings.yml\"\r\n                        sx={{ mb: 2 }}\r\n                    />\r\n                    <Box sx={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            color=\"success\"\r\n                            onClick={handleSaveSearxng}\r\n                            disabled={savingSearxng}\r\n                            startIcon={savingSearxng ? <CircularProgress size={16} color=\"inherit\" /> : <SaveIcon />}\r\n                        >\r\n                            Save Internal Search\r\n                        </Button>\r\n                    </Box>\r\n                </CardContent>\r\n            </Card >\r\n\r\n            {/* Backup Card - Oracle VM MySQL */}\r\n            < Card sx={{ mb: 3, border: '1px solid', borderColor: 'error.main', borderRadius: 3 }}>\r\n                <CardHeader\r\n                    title=\"≡ƒöä Database Backup\"\r\n                    titleTypographyProps={{ fontWeight: 'bold', color: 'error.main' }}\r\n                    subheader=\"Backup Firebase data to Oracle VM (MySQL)\"\r\n                />\r\n                <CardContent>\r\n                    <Box sx={{ mb: 2, p: 2, bgcolor: 'background.default', borderRadius: 2 }}>\r\n                        <Typography variant=\"body2\" color=\"text.secondary\">\r\n                            <strong>Target:</strong> Oracle VM (129.151.245.242)\r\n                        </Typography>\r\n                        <Typography variant=\"body2\" color=\"text.secondary\">\r\n                            <strong>Database:</strong> truthlens_backup (MariaDB)\r\n                        </Typography>\r\n                        <Typography variant=\"body2\" color=\"text.secondary\">\r\n                            <strong>Schedule:</strong> Weekly (manual trigger available)\r\n                        </Typography>\r\n                    </Box>\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        color=\"error\"\r\n                        onClick={handleRunBackup}\r\n                        disabled={runningBackup}\r\n                        startIcon={runningBackup ? <CircularProgress size={16} color=\"inherit\" /> : <CloudQueueIcon />}\r\n                        fullWidth\r\n                    >\r\n                        {runningBackup ? 'Running Backup...' : 'Run Backup Now'}\r\n                    </Button>\r\n                </CardContent>\r\n            </Card >\r\n        </Box >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\ads\\AdBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\ads\\InterstitialAd.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\ads\\InterstitialAd.tsx:21:13\n  19 |     useEffect(() => {\n  20 |         if (open) {\n> 21 |             setCountdown(5);\n     |             ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  22 |             setCanSkip(false);\n  23 |\n  24 |             const timer = setInterval(() => {","line":21,"column":13,"nodeType":null,"endLine":21,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Dialog, DialogContent, Box, Typography, Button, LinearProgress, IconButton } from '@mui/material';\r\nimport CloseIcon from '@mui/icons-material/Close';\r\n\r\ninterface InterstitialAdProps {\r\n    open: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\n/**\r\n * Interstitial Ad - Full screen ad shown every 5 scans for Free users\r\n */\r\nconst InterstitialAd: React.FC<InterstitialAdProps> = ({ open, onClose }) => {\r\n    const [countdown, setCountdown] = useState(5);\r\n    const [canSkip, setCanSkip] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (open) {\r\n            setCountdown(5);\r\n            setCanSkip(false);\r\n\r\n            const timer = setInterval(() => {\r\n                setCountdown((prev) => {\r\n                    if (prev <= 1) {\r\n                        setCanSkip(true);\r\n                        clearInterval(timer);\r\n                        return 0;\r\n                    }\r\n                    return prev - 1;\r\n                });\r\n            }, 1000);\r\n\r\n            return () => clearInterval(timer);\r\n        }\r\n    }, [open]);\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={canSkip ? onClose : undefined}\r\n            maxWidth=\"md\"\r\n            fullWidth\r\n            PaperProps={{\r\n                sx: {\r\n                    backgroundColor: '#1a1a1a',\r\n                    minHeight: 400,\r\n                }\r\n            }}\r\n        >\r\n            <DialogContent sx={{ position: 'relative', textAlign: 'center', py: 4 }}>\r\n                {canSkip && (\r\n                    <IconButton\r\n                        onClick={onClose}\r\n                        sx={{\r\n                            position: 'absolute',\r\n                            top: 8,\r\n                            right: 8,\r\n                            color: 'white',\r\n                            backgroundColor: 'rgba(255,255,255,0.2)',\r\n                            '&:hover': { backgroundColor: 'rgba(255,255,255,0.3)' }\r\n                        }}\r\n                    >\r\n                        <CloseIcon />\r\n                    </IconButton>\r\n                )}\r\n\r\n                <Typography variant=\"overline\" color=\"text.secondary\" sx={{ mb: 2, display: 'block' }}>\r\n                    Advertisement\r\n                </Typography>\r\n\r\n                {/* Placeholder Ad Content */}\r\n                <Box\r\n                    sx={{\r\n                        backgroundColor: '#2a2a2a',\r\n                        border: '2px dashed #555',\r\n                        borderRadius: 2,\r\n                        p: 6,\r\n                        mb: 3,\r\n                        minHeight: 250,\r\n                        display: 'flex',\r\n                        flexDirection: 'column',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                    }}\r\n                >\r\n                    <Typography variant=\"h5\" color=\"text.secondary\" gutterBottom>\r\n                        [Full Screen Ad]\r\n                    </Typography>\r\n                    <Typography variant=\"body2\" color=\"text.disabled\">\r\n                        300x250 or video ad space\r\n                    </Typography>\r\n                </Box>\r\n\r\n                {!canSkip ? (\r\n                    <Box sx={{ mb: 2 }}>\r\n                        <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>\r\n                            You can skip this ad in {countdown} seconds\r\n                        </Typography>\r\n                        <LinearProgress\r\n                            variant=\"determinate\"\r\n                            value={((5 - countdown) / 5) * 100}\r\n                            sx={{ mt: 1, height: 6, borderRadius: 3 }}\r\n                        />\r\n                    </Box>\r\n                ) : (\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        color=\"secondary\"\r\n                        onClick={onClose}\r\n                        size=\"large\"\r\n                    >\r\n                        Continue\r\n                    </Button>\r\n                )}\r\n\r\n                <Typography variant=\"caption\" color=\"text.disabled\" sx={{ mt: 2, display: 'block' }}>\r\n                    Upgrade to Pro to remove all ads\r\n                </Typography>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n};\r\n\r\nexport default InterstitialAd;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\animation\\ExamplePage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\animation\\PageTransition.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[870,873],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[870,873],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Page Transition Component\r\n * Wraps pages with smooth enter/exit animations\r\n */\r\n\r\n'use client';\r\n\r\nimport { motion } from 'framer-motion';\r\nimport { ReactNode } from 'react';\r\n\r\ninterface PageTransitionProps {\r\n    children: ReactNode;\r\n    className?: string;\r\n}\r\n\r\nconst pageVariants = {\r\n    initial: {\r\n        opacity: 0,\r\n        y: 20,\r\n    },\r\n    animate: {\r\n        opacity: 1,\r\n        y: 0,\r\n    },\r\n    exit: {\r\n        opacity: 0,\r\n        y: -20,\r\n    },\r\n};\r\n\r\nconst pageTransition = {\r\n    type: 'tween',\r\n    ease: 'easeOut',\r\n    duration: 0.3,\r\n};\r\n\r\nexport default function PageTransition({ children, className }: PageTransitionProps) {\r\n    return (\r\n        <motion.div\r\n            initial=\"initial\"\r\n            animate=\"animate\"\r\n            exit=\"exit\"\r\n            variants={pageVariants}\r\n            transition={pageTransition as any}\r\n            className={className}\r\n        >\r\n            {children}\r\n        </motion.div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\animation\\ScrollReveal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\animation\\StaggerList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\chat\\ChatErrorCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WifiOffIcon' is defined but never used.","line":9,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AIChatErrorCode' is defined but never used.","line":13,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AIProvider' is defined but never used.","line":13,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":50},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":179,"column":43,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[7427,7524],"text":"\r\n                                    Click &quot;Add API Key\" below\r\n                                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[7427,7524],"text":"\r\n                                    Click &ldquo;Add API Key\" below\r\n                                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[7427,7524],"text":"\r\n                                    Click &#34;Add API Key\" below\r\n                                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[7427,7524],"text":"\r\n                                    Click &rdquo;Add API Key\" below\r\n                                "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":179,"column":55,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[7427,7524],"text":"\r\n                                    Click \"Add API Key&quot; below\r\n                                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[7427,7524],"text":"\r\n                                    Click \"Add API Key&ldquo; below\r\n                                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[7427,7524],"text":"\r\n                                    Click \"Add API Key&#34; below\r\n                                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[7427,7524],"text":"\r\n                                    Click \"Add API Key&rdquo; below\r\n                                "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":207,"column":57,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[9261,9359],"text":"\r\n                                    Using wrong provider&apos;s key\r\n                                "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[9261,9359],"text":"\r\n                                    Using wrong provider&lsquo;s key\r\n                                "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[9261,9359],"text":"\r\n                                    Using wrong provider&#39;s key\r\n                                "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[9261,9359],"text":"\r\n                                    Using wrong provider&rsquo;s key\r\n                                "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport { Box, Typography, Button, Paper } from '@mui/material';\r\nimport { motion } from 'framer-motion';\r\nimport KeyIcon from '@mui/icons-material/Key';\r\nimport ErrorOutlineIcon from '@mui/icons-material/ErrorOutline';\r\nimport TimerIcon from '@mui/icons-material/Timer';\r\nimport WifiOffIcon from '@mui/icons-material/WifiOff';\r\nimport SettingsIcon from '@mui/icons-material/Settings';\r\nimport RefreshIcon from '@mui/icons-material/Refresh';\r\nimport WarningAmberIcon from '@mui/icons-material/WarningAmber';\r\nimport { AIChatError, AIChatErrorCode, AIProvider, AI_PROVIDERS } from '@/types/aiChat';\r\n\r\ninterface ChatErrorCardProps {\r\n    error: AIChatError;\r\n    onOpenSettings?: () => void;\r\n    onRetry?: () => void;\r\n    onDismiss?: () => void;\r\n}\r\n\r\ninterface ErrorConfig {\r\n    icon: React.ReactNode;\r\n    title: string;\r\n    description: string;\r\n    bgColor: string;\r\n    borderColor: string;\r\n    iconBgColor: string;\r\n    primaryAction?: {\r\n        label: string;\r\n        onClick: () => void;\r\n        icon: React.ReactNode;\r\n    };\r\n    secondaryAction?: {\r\n        label: string;\r\n        onClick: () => void;\r\n    };\r\n}\r\n\r\nexport default function ChatErrorCard({ error, onOpenSettings, onRetry, onDismiss }: ChatErrorCardProps) {\r\n    const getErrorConfig = (): ErrorConfig => {\r\n        const providerName = error.provider ? AI_PROVIDERS[error.provider].name : 'API';\r\n\r\n        switch (error.code) {\r\n            case 'MISSING_KEY':\r\n                return {\r\n                    icon: <KeyIcon sx={{ fontSize: 28, color: '#F59E0B' }} />,\r\n                    title: 'API Key Required',\r\n                    description: `You need to add your ${providerName} API key to use AI Chat. It's free to get one!`,\r\n                    bgColor: 'rgba(245, 158, 11, 0.08)',\r\n                    borderColor: 'rgba(245, 158, 11, 0.3)',\r\n                    iconBgColor: 'rgba(245, 158, 11, 0.15)',\r\n                    primaryAction: onOpenSettings ? {\r\n                        label: 'Add API Key',\r\n                        onClick: onOpenSettings,\r\n                        icon: <SettingsIcon sx={{ fontSize: 18 }} />\r\n                    } : undefined\r\n                };\r\n\r\n            case 'INVALID_KEY':\r\n                return {\r\n                    icon: <WarningAmberIcon sx={{ fontSize: 28, color: '#EF4444' }} />,\r\n                    title: 'Invalid API Key',\r\n                    description: `Your ${providerName} API key is invalid or expired. Please check and update it.`,\r\n                    bgColor: 'rgba(239, 68, 68, 0.08)',\r\n                    borderColor: 'rgba(239, 68, 68, 0.3)',\r\n                    iconBgColor: 'rgba(239, 68, 68, 0.15)',\r\n                    primaryAction: onOpenSettings ? {\r\n                        label: 'Update Key',\r\n                        onClick: onOpenSettings,\r\n                        icon: <KeyIcon sx={{ fontSize: 18 }} />\r\n                    } : undefined\r\n                };\r\n\r\n            case 'RATE_LIMIT':\r\n                return {\r\n                    icon: <TimerIcon sx={{ fontSize: 28, color: '#8B5CF6' }} />,\r\n                    title: 'Too Many Requests',\r\n                    description: 'You\\'ve sent too many messages. Please wait a moment before trying again.',\r\n                    bgColor: 'rgba(139, 92, 246, 0.08)',\r\n                    borderColor: 'rgba(139, 92, 246, 0.3)',\r\n                    iconBgColor: 'rgba(139, 92, 246, 0.15)',\r\n                    primaryAction: onRetry ? {\r\n                        label: 'Try Again',\r\n                        onClick: onRetry,\r\n                        icon: <RefreshIcon sx={{ fontSize: 18 }} />\r\n                    } : undefined\r\n                };\r\n\r\n            case 'API_ERROR':\r\n            default:\r\n                return {\r\n                    icon: <ErrorOutlineIcon sx={{ fontSize: 28, color: '#6366F1' }} />,\r\n                    title: error.code === 'API_ERROR' ? 'AI Service Error' : 'Something Went Wrong',\r\n                    description: error.message || 'There was an issue connecting to the AI. Please try again.',\r\n                    bgColor: 'rgba(99, 102, 241, 0.08)',\r\n                    borderColor: 'rgba(99, 102, 241, 0.3)',\r\n                    iconBgColor: 'rgba(99, 102, 241, 0.15)',\r\n                    primaryAction: onRetry ? {\r\n                        label: 'Try Again',\r\n                        onClick: onRetry,\r\n                        icon: <RefreshIcon sx={{ fontSize: 18 }} />\r\n                    } : undefined\r\n                };\r\n        }\r\n    };\r\n\r\n    const config = getErrorConfig();\r\n\r\n    return (\r\n        <Paper\r\n            component={motion.div}\r\n            initial={{ opacity: 0, y: 10, scale: 0.98 }}\r\n            animate={{ opacity: 1, y: 0, scale: 1 }}\r\n            exit={{ opacity: 0, y: -10, scale: 0.98 }}\r\n            transition={{ duration: 0.3 }}\r\n            elevation={0}\r\n            sx={{\r\n                p: 3,\r\n                mb: 2,\r\n                borderRadius: 4,\r\n                bgcolor: config.bgColor,\r\n                border: '1px solid',\r\n                borderColor: config.borderColor,\r\n                overflow: 'hidden'\r\n            }}\r\n        >\r\n            <Box sx={{ display: 'flex', gap: 2.5, alignItems: 'flex-start' }}>\r\n                {/* Icon Container */}\r\n                <Box\r\n                    component={motion.div}\r\n                    animate={{\r\n                        scale: [1, 1.05, 1],\r\n                    }}\r\n                    transition={{\r\n                        duration: 2,\r\n                        repeat: Infinity,\r\n                        ease: 'easeInOut'\r\n                    }}\r\n                    sx={{\r\n                        width: 52,\r\n                        height: 52,\r\n                        borderRadius: 3,\r\n                        bgcolor: config.iconBgColor,\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        flexShrink: 0\r\n                    }}\r\n                >\r\n                    {config.icon}\r\n                </Box>\r\n\r\n                {/* Content */}\r\n                <Box sx={{ flex: 1, minWidth: 0 }}>\r\n                    <Typography\r\n                        variant=\"subtitle1\"\r\n                        fontWeight=\"bold\"\r\n                        sx={{ mb: 0.5, color: 'text.primary' }}\r\n                    >\r\n                        {config.title}\r\n                    </Typography>\r\n                    <Typography\r\n                        variant=\"body2\"\r\n                        color=\"text.secondary\"\r\n                        sx={{ mb: 2, lineHeight: 1.5 }}\r\n                    >\r\n                        {config.description}\r\n                    </Typography>\r\n\r\n                    {/* How to Fix - Step by step */}\r\n                    {error.code === 'MISSING_KEY' && (\r\n                        <Box sx={{ mb: 2, pl: 2, borderLeft: '2px solid', borderColor: 'warning.main' }}>\r\n                            <Typography variant=\"caption\" color=\"text.secondary\" fontWeight=\"medium\">\r\n                                How to get your free API key:\r\n                            </Typography>\r\n                            <Box component=\"ol\" sx={{ m: 0, pl: 2, mt: 0.5 }}>\r\n                                <Typography component=\"li\" variant=\"caption\" color=\"text.secondary\">\r\n                                    Click \"Add API Key\" below\r\n                                </Typography>\r\n                                <Typography component=\"li\" variant=\"caption\" color=\"text.secondary\">\r\n                                    Choose Groq or Gemini provider\r\n                                </Typography>\r\n                                <Typography component=\"li\" variant=\"caption\" color=\"text.secondary\">\r\n                                    Get your free key from their website\r\n                                </Typography>\r\n                                <Typography component=\"li\" variant=\"caption\" color=\"text.secondary\">\r\n                                    Paste it and save!\r\n                                </Typography>\r\n                            </Box>\r\n                        </Box>\r\n                    )}\r\n\r\n                    {error.code === 'INVALID_KEY' && (\r\n                        <Box sx={{ mb: 2, pl: 2, borderLeft: '2px solid', borderColor: 'error.main' }}>\r\n                            <Typography variant=\"caption\" color=\"text.secondary\" fontWeight=\"medium\">\r\n                                Common reasons for invalid keys:\r\n                            </Typography>\r\n                            <Box component=\"ul\" sx={{ m: 0, pl: 2, mt: 0.5 }}>\r\n                                <Typography component=\"li\" variant=\"caption\" color=\"text.secondary\">\r\n                                    Key has expired or been revoked\r\n                                </Typography>\r\n                                <Typography component=\"li\" variant=\"caption\" color=\"text.secondary\">\r\n                                    Typo when copying the key\r\n                                </Typography>\r\n                                <Typography component=\"li\" variant=\"caption\" color=\"text.secondary\">\r\n                                    Using wrong provider's key\r\n                                </Typography>\r\n                            </Box>\r\n                        </Box>\r\n                    )}\r\n\r\n                    {/* Actions */}\r\n                    <Box sx={{ display: 'flex', gap: 1.5, flexWrap: 'wrap' }}>\r\n                        {config.primaryAction && (\r\n                            <Button\r\n                                variant=\"contained\"\r\n                                size=\"small\"\r\n                                startIcon={config.primaryAction.icon}\r\n                                onClick={config.primaryAction.onClick}\r\n                                sx={{\r\n                                    borderRadius: 2,\r\n                                    textTransform: 'none',\r\n                                    fontWeight: 600,\r\n                                    px: 2.5,\r\n                                    py: 1,\r\n                                    boxShadow: 'none',\r\n                                    '&:hover': {\r\n                                        boxShadow: '0 4px 12px rgba(0,0,0,0.15)'\r\n                                    }\r\n                                }}\r\n                            >\r\n                                {config.primaryAction.label}\r\n                            </Button>\r\n                        )}\r\n                        {onDismiss && (\r\n                            <Button\r\n                                variant=\"text\"\r\n                                size=\"small\"\r\n                                onClick={onDismiss}\r\n                                sx={{\r\n                                    borderRadius: 2,\r\n                                    textTransform: 'none',\r\n                                    color: 'text.secondary'\r\n                                }}\r\n                            >\r\n                                Dismiss\r\n                            </Button>\r\n                        )}\r\n                    </Box>\r\n                </Box>\r\n            </Box>\r\n        </Paper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\compare\\AddToCompareButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zoom' is defined but never used.","line":4,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { IconButton, Tooltip, Zoom, Snackbar, Alert } from '@mui/material';\r\nimport CompareArrowsIcon from '@mui/icons-material/CompareArrows';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport { useCompare } from '@/context/CompareContext';\r\nimport { ProductData } from '@/services/productService';\r\n\r\ninterface AddToCompareButtonProps {\r\n    product: ProductData;\r\n}\r\n\r\nexport default function AddToCompareButton({ product }: AddToCompareButtonProps) {\r\n    const { addToCompare, removeFromCompare, isInComparison, selectedProducts } = useCompare();\r\n    const isSelected = isInComparison(product.id);\r\n    const isFull = selectedProducts.length >= 3;\r\n\r\n    const [snackbar, setSnackbar] = useState<{ open: boolean; message: string; severity: 'success' | 'warning' }>({\r\n        open: false,\r\n        message: '',\r\n        severity: 'success'\r\n    });\r\n\r\n    const handleClick = (e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n        if (isSelected) {\r\n            removeFromCompare(product.id);\r\n            setSnackbar({ open: true, message: 'Removed from comparison', severity: 'success' });\r\n        } else {\r\n            if (isFull) {\r\n                setSnackbar({ open: true, message: 'Maximum 3 products can be compared', severity: 'warning' });\r\n                return;\r\n            }\r\n            addToCompare(product);\r\n            setSnackbar({ open: true, message: 'Added to comparison', severity: 'success' });\r\n        }\r\n    };\r\n\r\n    const handleCloseSnackbar = () => {\r\n        setSnackbar({ ...snackbar, open: false });\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <Tooltip title={isSelected ? \"Remove from comparison\" : isFull ? \"Comparison list full (max 3)\" : \"Compare\"}>\r\n                <IconButton\r\n                    onClick={handleClick}\r\n                    color={isSelected ? \"success\" : \"default\"}\r\n                    sx={{\r\n                        bgcolor: isSelected ? 'rgba(76, 175, 80, 0.1)' : 'rgba(255, 255, 255, 0.1)',\r\n                        '&:hover': {\r\n                            bgcolor: isSelected ? 'rgba(76, 175, 80, 0.2)' : 'rgba(255, 255, 255, 0.2)',\r\n                        }\r\n                    }}\r\n                    disabled={!isSelected && isFull}\r\n                >\r\n                    {isSelected ? <CheckCircleIcon /> : <CompareArrowsIcon />}\r\n                </IconButton>\r\n            </Tooltip>\r\n\r\n            <Snackbar\r\n                open={snackbar.open}\r\n                autoHideDuration={2000}\r\n                onClose={handleCloseSnackbar}\r\n                anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\r\n            >\r\n                <Alert\r\n                    onClose={handleCloseSnackbar}\r\n                    severity={snackbar.severity}\r\n                    variant=\"filled\"\r\n                    sx={{ width: '100%' }}\r\n                >\r\n                    {snackbar.message}\r\n                </Alert>\r\n            </Snackbar>\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\compare\\CompareFloatingBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useWindowSize' is defined but never used.","line":9,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IconButton' is defined but never used.","line":10,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FIREWORKS_LOTTIE_URL' is assigned a value but never used.","line":13,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1434,1437],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1434,1437],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":73,"column":75,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":76},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Date.now` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:163:17\n  161 |\n  162 |     // Derived Render State (Frame Perfect)\n> 163 |     const now = Date.now() + timeOffset;\n      |                 ^^^^^^^^^^ Cannot call impure function\n  164 |\n  165 |     // Explicit Independent Time Windows\n  166 |     // const themeStart = new Date(config.general_theme_start).getTime();","line":163,"column":17,"nodeType":null,"endLine":163,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":415,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":415,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i' is defined but never used.","line":415,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":415,"endColumn":65},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:416:23\n  414 |     // Generate flakes with depth properties (size, blur, speed)\n  415 |     const flakes = useMemo(() => new Array(75).fill(0).map((_, i) => {\n> 416 |         const depth = Math.random(); // 0 = far, 1 = near\n      |                       ^^^^^^^^^^^^^ Cannot call impure function\n  417 |         return {\n  418 |             left: Math.random() * 100 + '%',\n  419 |             animationDelay: -Math.random() * 10 + 's',","line":416,"column":23,"nodeType":null,"endLine":416,"endColumn":36},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:418:19\n  416 |         const depth = Math.random(); // 0 = far, 1 = near\n  417 |         return {\n> 418 |             left: Math.random() * 100 + '%',\n      |                   ^^^^^^^^^^^^^ Cannot call impure function\n  419 |             animationDelay: -Math.random() * 10 + 's',\n  420 |             animationDuration: (Math.random() * 5 + 5) + 's', // 5-10s\n  421 |             size: (Math.random() * 5 + 3) + 'px',","line":418,"column":19,"nodeType":null,"endLine":418,"endColumn":32},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:419:30\n  417 |         return {\n  418 |             left: Math.random() * 100 + '%',\n> 419 |             animationDelay: -Math.random() * 10 + 's',\n      |                              ^^^^^^^^^^^^^ Cannot call impure function\n  420 |             animationDuration: (Math.random() * 5 + 5) + 's', // 5-10s\n  421 |             size: (Math.random() * 5 + 3) + 'px',\n  422 |             blur: (1 - depth) * 2 + 'px', // Far items are blurrier","line":419,"column":30,"nodeType":null,"endLine":419,"endColumn":43},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:420:33\n  418 |             left: Math.random() * 100 + '%',\n  419 |             animationDelay: -Math.random() * 10 + 's',\n> 420 |             animationDuration: (Math.random() * 5 + 5) + 's', // 5-10s\n      |                                 ^^^^^^^^^^^^^ Cannot call impure function\n  421 |             size: (Math.random() * 5 + 3) + 'px',\n  422 |             blur: (1 - depth) * 2 + 'px', // Far items are blurrier\n  423 |             opacity: (0.3 + depth * 0.7), // Near items are brighter","line":420,"column":33,"nodeType":null,"endLine":420,"endColumn":46},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:421:20\n  419 |             animationDelay: -Math.random() * 10 + 's',\n  420 |             animationDuration: (Math.random() * 5 + 5) + 's', // 5-10s\n> 421 |             size: (Math.random() * 5 + 3) + 'px',\n      |                    ^^^^^^^^^^^^^ Cannot call impure function\n  422 |             blur: (1 - depth) * 2 + 'px', // Far items are blurrier\n  423 |             opacity: (0.3 + depth * 0.7), // Near items are brighter\n  424 |         };","line":421,"column":20,"nodeType":null,"endLine":421,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":466,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":466,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i' is defined but never used.","line":466,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":466,"endColumn":65},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:467:15\n  465 |     // Multi-layer rain for parallax depth\n  466 |     const drops = useMemo(() => new Array(120).fill(0).map((_, i) => ({\n> 467 |         left: Math.random() * 100 + '%',\n      |               ^^^^^^^^^^^^^ Cannot call impure function\n  468 |         animationDelay: -Math.random() * 2 + 's',\n  469 |         animationDuration: (0.5 + Math.random() * 0.5) + 's', // Fast! 0.5-1s\n  470 |         opacity: 0.2 + Math.random() * 0.3,","line":467,"column":15,"nodeType":null,"endLine":467,"endColumn":28},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:468:26\n  466 |     const drops = useMemo(() => new Array(120).fill(0).map((_, i) => ({\n  467 |         left: Math.random() * 100 + '%',\n> 468 |         animationDelay: -Math.random() * 2 + 's',\n      |                          ^^^^^^^^^^^^^ Cannot call impure function\n  469 |         animationDuration: (0.5 + Math.random() * 0.5) + 's', // Fast! 0.5-1s\n  470 |         opacity: 0.2 + Math.random() * 0.3,\n  471 |         height: (10 + Math.random() * 15) + 'px'","line":468,"column":26,"nodeType":null,"endLine":468,"endColumn":39},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:469:35\n  467 |         left: Math.random() * 100 + '%',\n  468 |         animationDelay: -Math.random() * 2 + 's',\n> 469 |         animationDuration: (0.5 + Math.random() * 0.5) + 's', // Fast! 0.5-1s\n      |                                   ^^^^^^^^^^^^^ Cannot call impure function\n  470 |         opacity: 0.2 + Math.random() * 0.3,\n  471 |         height: (10 + Math.random() * 15) + 'px'\n  472 |     })), []);","line":469,"column":35,"nodeType":null,"endLine":469,"endColumn":48},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:470:24\n  468 |         animationDelay: -Math.random() * 2 + 's',\n  469 |         animationDuration: (0.5 + Math.random() * 0.5) + 's', // Fast! 0.5-1s\n> 470 |         opacity: 0.2 + Math.random() * 0.3,\n      |                        ^^^^^^^^^^^^^ Cannot call impure function\n  471 |         height: (10 + Math.random() * 15) + 'px'\n  472 |     })), []);\n  473 |","line":470,"column":24,"nodeType":null,"endLine":470,"endColumn":37},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:471:23\n  469 |         animationDuration: (0.5 + Math.random() * 0.5) + 's', // Fast! 0.5-1s\n  470 |         opacity: 0.2 + Math.random() * 0.3,\n> 471 |         height: (10 + Math.random() * 15) + 'px'\n      |                       ^^^^^^^^^^^^^ Cannot call impure function\n  472 |     })), []);\n  473 |\n  474 |     return (","line":471,"column":23,"nodeType":null,"endLine":471,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":507,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":507,"endColumn":65},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i' is defined but never used.","line":507,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":507,"endColumn":68},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:508:15\n  506 |     // Physics: Floating, drifting, soft swaying (feathery) instead of heavy tumbling\n  507 |     const particles = useMemo(() => new Array(40).fill(0).map((_, i) => ({\n> 508 |         left: Math.random() * 100 + '%',\n      |               ^^^^^^^^^^^^^ Cannot call impure function\n  509 |         animationDelay: -Math.random() * 10 + 's',\n  510 |         animationDuration: (10 + Math.random() * 8) + 's', // Slower, graceful fall\n  511 |         size: (15 + Math.random() * 15) + 'px',","line":508,"column":15,"nodeType":null,"endLine":508,"endColumn":28},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:509:26\n  507 |     const particles = useMemo(() => new Array(40).fill(0).map((_, i) => ({\n  508 |         left: Math.random() * 100 + '%',\n> 509 |         animationDelay: -Math.random() * 10 + 's',\n      |                          ^^^^^^^^^^^^^ Cannot call impure function\n  510 |         animationDuration: (10 + Math.random() * 8) + 's', // Slower, graceful fall\n  511 |         size: (15 + Math.random() * 15) + 'px',\n  512 |         type: Math.random() > 0.4 ? '≡ƒî╕' : '≡ƒìâ', // Mostly flowers, some fresh leaves","line":509,"column":26,"nodeType":null,"endLine":509,"endColumn":39},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:510:34\n  508 |         left: Math.random() * 100 + '%',\n  509 |         animationDelay: -Math.random() * 10 + 's',\n> 510 |         animationDuration: (10 + Math.random() * 8) + 's', // Slower, graceful fall\n      |                                  ^^^^^^^^^^^^^ Cannot call impure function\n  511 |         size: (15 + Math.random() * 15) + 'px',\n  512 |         type: Math.random() > 0.4 ? '≡ƒî╕' : '≡ƒìâ', // Mostly flowers, some fresh leaves\n  513 |         rotationAxis: Math.random() > 0.5 ? 'X' : 'Y', // Random spin axis","line":510,"column":34,"nodeType":null,"endLine":510,"endColumn":47},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:511:21\n  509 |         animationDelay: -Math.random() * 10 + 's',\n  510 |         animationDuration: (10 + Math.random() * 8) + 's', // Slower, graceful fall\n> 511 |         size: (15 + Math.random() * 15) + 'px',\n      |                     ^^^^^^^^^^^^^ Cannot call impure function\n  512 |         type: Math.random() > 0.4 ? '≡ƒî╕' : '≡ƒìâ', // Mostly flowers, some fresh leaves\n  513 |         rotationAxis: Math.random() > 0.5 ? 'X' : 'Y', // Random spin axis\n  514 |         swayDuration: (3 + Math.random() * 3) + 's'","line":511,"column":21,"nodeType":null,"endLine":511,"endColumn":34},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:512:15\n  510 |         animationDuration: (10 + Math.random() * 8) + 's', // Slower, graceful fall\n  511 |         size: (15 + Math.random() * 15) + 'px',\n> 512 |         type: Math.random() > 0.4 ? '≡ƒî╕' : '≡ƒìâ', // Mostly flowers, some fresh leaves\n      |               ^^^^^^^^^^^^^ Cannot call impure function\n  513 |         rotationAxis: Math.random() > 0.5 ? 'X' : 'Y', // Random spin axis\n  514 |         swayDuration: (3 + Math.random() * 3) + 's'\n  515 |     })), []);","line":512,"column":15,"nodeType":null,"endLine":512,"endColumn":28},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:513:23\n  511 |         size: (15 + Math.random() * 15) + 'px',\n  512 |         type: Math.random() > 0.4 ? '≡ƒî╕' : '≡ƒìâ', // Mostly flowers, some fresh leaves\n> 513 |         rotationAxis: Math.random() > 0.5 ? 'X' : 'Y', // Random spin axis\n      |                       ^^^^^^^^^^^^^ Cannot call impure function\n  514 |         swayDuration: (3 + Math.random() * 3) + 's'\n  515 |     })), []);\n  516 |","line":513,"column":23,"nodeType":null,"endLine":513,"endColumn":36},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:514:28\n  512 |         type: Math.random() > 0.4 ? '≡ƒî╕' : '≡ƒìâ', // Mostly flowers, some fresh leaves\n  513 |         rotationAxis: Math.random() > 0.5 ? 'X' : 'Y', // Random spin axis\n> 514 |         swayDuration: (3 + Math.random() * 3) + 's'\n      |                            ^^^^^^^^^^^^^ Cannot call impure function\n  515 |     })), []);\n  516 |\n  517 |     return (","line":514,"column":28,"nodeType":null,"endLine":514,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":561,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":561,"endColumn":65},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i' is defined but never used.","line":561,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":561,"endColumn":68},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:563:39\n  561 |     const particles = useMemo(() => new Array(50).fill(0).map((_, i) => {\n  562 |         const types = ['≡ƒÄä', '≡ƒÄà', '≡ƒÄü', 'Γ¡É', '≡ƒªî', '≡ƒöö', '≡ƒì¬'];\n> 563 |         const type = types[Math.floor(Math.random() * types.length)];\n      |                                       ^^^^^^^^^^^^^ Cannot call impure function\n  564 |         return {\n  565 |             left: Math.random() * 100 + '%',\n  566 |             animationDelay: -Math.random() * 15 + 's',","line":563,"column":39,"nodeType":null,"endLine":563,"endColumn":52},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:565:19\n  563 |         const type = types[Math.floor(Math.random() * types.length)];\n  564 |         return {\n> 565 |             left: Math.random() * 100 + '%',\n      |                   ^^^^^^^^^^^^^ Cannot call impure function\n  566 |             animationDelay: -Math.random() * 15 + 's',\n  567 |             animationDuration: (6 + Math.random() * 8) + 's',\n  568 |             size: (20 + Math.random() * 20) + 'px',","line":565,"column":19,"nodeType":null,"endLine":565,"endColumn":32},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:566:30\n  564 |         return {\n  565 |             left: Math.random() * 100 + '%',\n> 566 |             animationDelay: -Math.random() * 15 + 's',\n      |                              ^^^^^^^^^^^^^ Cannot call impure function\n  567 |             animationDuration: (6 + Math.random() * 8) + 's',\n  568 |             size: (20 + Math.random() * 20) + 'px',\n  569 |             type,","line":566,"column":30,"nodeType":null,"endLine":566,"endColumn":43},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:567:37\n  565 |             left: Math.random() * 100 + '%',\n  566 |             animationDelay: -Math.random() * 15 + 's',\n> 567 |             animationDuration: (6 + Math.random() * 8) + 's',\n      |                                     ^^^^^^^^^^^^^ Cannot call impure function\n  568 |             size: (20 + Math.random() * 20) + 'px',\n  569 |             type,\n  570 |             rotationDir: Math.random() > 0.5 ? 1 : -1,","line":567,"column":37,"nodeType":null,"endLine":567,"endColumn":50},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:568:25\n  566 |             animationDelay: -Math.random() * 15 + 's',\n  567 |             animationDuration: (6 + Math.random() * 8) + 's',\n> 568 |             size: (20 + Math.random() * 20) + 'px',\n      |                         ^^^^^^^^^^^^^ Cannot call impure function\n  569 |             type,\n  570 |             rotationDir: Math.random() > 0.5 ? 1 : -1,\n  571 |             swayDuration: (3 + Math.random() * 4) + 's'","line":568,"column":25,"nodeType":null,"endLine":568,"endColumn":38},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:570:26\n  568 |             size: (20 + Math.random() * 20) + 'px',\n  569 |             type,\n> 570 |             rotationDir: Math.random() > 0.5 ? 1 : -1,\n      |                          ^^^^^^^^^^^^^ Cannot call impure function\n  571 |             swayDuration: (3 + Math.random() * 4) + 's'\n  572 |         };\n  573 |     }), []);","line":570,"column":26,"nodeType":null,"endLine":570,"endColumn":39},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\events\\SeasonalEventManager.tsx:571:32\n  569 |             type,\n  570 |             rotationDir: Math.random() > 0.5 ? 1 : -1,\n> 571 |             swayDuration: (3 + Math.random() * 4) + 's'\n      |                                ^^^^^^^^^^^^^ Cannot call impure function\n  572 |         };\n  573 |     }), []);\n  574 |","line":571,"column":32,"nodeType":null,"endLine":571,"endColumn":45}],"suppressedMessages":[],"errorCount":26,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState, useRef, useMemo } from 'react';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { fetchEventConfigFromApi } from '@/services/systemService';\r\nimport { EventManagerConfig } from '@/types/system';\r\nimport Lottie from 'lottie-react';\r\nimport Confetti from 'react-confetti';\r\nimport useWindowSize from '@/hooks/useWindowSize';\r\nimport { Box, Typography, Button, IconButton } from '@mui/material';\r\n\r\n// Placeholder for verified Fireworks Lottie JSON URL\r\nconst FIREWORKS_LOTTIE_URL = \"https://lottie.host/88af9b8a-1317-4860-9118-4903e670ca10/valid-fireworks.json\";\r\n\r\n// Time Sync Constants\r\nconst SYNC_INTERVAL = 1000 * 60 * 10; // 10 minutes\r\nconst TICK_RATE = 1000; // 1 second update loop\r\n\r\ntype EventState = 'IDLE' | 'THEME_ACTIVE' | 'CELEBRATION' | 'LOCKED';\r\n\r\nexport default function SeasonalEventManager() {\r\n    const { user, loading } = useAuth();\r\n    // [CHANGE] Update default state\r\n    const [globalEffects, setGlobalEffects] = useState({ snow: false, rain: false, leaves: false, confetti: false, christmas: false });\r\n    const [config, setConfig] = useState<EventManagerConfig | null>(null);\r\n    const [timeOffset, setTimeOffset] = useState<number>(0);\r\n    const [currentState, setCurrentState] = useState<EventState>('IDLE');\r\n    const [countdown, setCountdown] = useState<number | null>(null);\r\n    const [fireworksData, setFireworksData] = useState<any>(null);\r\n    const audioRef = useRef<HTMLAudioElement | null>(null);\r\n\r\n    // Window size for confetti\r\n    const [windowSize, setWindowSize] = useState({ width: 0, height: 0 });\r\n\r\n    useEffect(() => {\r\n        if (typeof window !== 'undefined') {\r\n            setWindowSize({ width: window.innerWidth, height: window.innerHeight });\r\n            window.addEventListener('resize', () => setWindowSize({ width: window.innerWidth, height: window.innerHeight }));\r\n        }\r\n    }, []);\r\n\r\n    // 1. Initial Sync & Config Fetch\r\n    useEffect(() => {\r\n        const init = async () => {\r\n            const result = await fetchEventConfigFromApi();\r\n            if (result) {\r\n                if (result.config) setConfig(result.config);\r\n\r\n                // [NEW] Capture Global Settings\r\n                if (result.globalEffects) {\r\n                    setGlobalEffects(result.globalEffects);\r\n                }\r\n\r\n                // Keep existing offset logic\r\n                if (result.server_time) {\r\n                    const serverTimeMs = new Date(result.server_time).getTime() + result.latency;\r\n                    const localTimeMs = Date.now();\r\n                    const offset = serverTimeMs - localTimeMs;\r\n                    setTimeOffset(offset);\r\n                }\r\n            }\r\n        };\r\n        init();\r\n        const interval = setInterval(init, SYNC_INTERVAL);\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    // Load Lottie Data\r\n    useEffect(() => {\r\n        const effect = config?.climax_effect || 'fireworks';\r\n        if (effect === 'fireworks' || effect === 'both') {\r\n            fetch('https://lottie.host/embed/88af9b8a-1317-4860-9118-4903e670ca10/valid-fireworks.json')\r\n                .then(r => r.json()).then(d => setFireworksData(d)).catch(e => console.log('No fireworks lottie found'));\r\n        }\r\n    }, [config?.climax_effect]);\r\n\r\n\r\n    // 2. Main Logic Loop\r\n    useEffect(() => {\r\n        const isAnyGlobalActive = Object.values(globalEffects).some(Boolean);\r\n        if (!config && !isAnyGlobalActive) return;\r\n\r\n        const loop = setInterval(() => {\r\n            const now = Date.now() + timeOffset; // Current Server Time\r\n\r\n            if (!config) {\r\n                setCurrentState(isAnyGlobalActive ? 'THEME_ACTIVE' : 'IDLE');\r\n                return;\r\n            }\r\n\r\n            // --- TIME WINDOW CHECKS --- (Only if config exists)\r\n\r\n            const musicStart = new Date(config.celebration_music_start).getTime();\r\n            const musicEnd = new Date(config.celebration_music_end).getTime();\r\n\r\n            const fireStart = config.celebration_climax_start\r\n                ? new Date(config.celebration_climax_start).getTime()\r\n                : musicStart + (10 * 60 * 1000);\r\n\r\n            // Check Lock\r\n            const lockedEventId = localStorage.getItem('truthlens_event_completed');\r\n            const isLocked = lockedEventId === config.event_id;\r\n\r\n            // --- INDEPENDENT LOGIC BRANCHES ---\r\n\r\n            // 1. Music Logic (Looping) - Only plays during Phase B 'Music' window\r\n            const shouldPlayMusic = !isLocked && (now >= musicStart && now < musicEnd) && config.is_active_global;\r\n\r\n            if (audioRef.current && config.music_file_url) {\r\n                if (shouldPlayMusic) {\r\n                    if (audioRef.current.paused) {\r\n                        audioRef.current.loop = true;\r\n                        audioRef.current.play().catch(e => console.error(\"Autoplay prevented\", e));\r\n                    }\r\n                } else {\r\n                    if (!audioRef.current.paused) {\r\n                        audioRef.current.pause();\r\n                    }\r\n                }\r\n            }\r\n\r\n            // 2. Countdown Logic\r\n            const secondsUntilFire = (fireStart - now) / 1000;\r\n            let currentCount = null;\r\n            const isFireActive = !isLocked && (now >= fireStart && now < musicEnd) && config.is_active_global;\r\n\r\n            if (!isLocked && config.is_active_global && secondsUntilFire > 0 && secondsUntilFire <= config.countdown_seconds) {\r\n                currentCount = Math.ceil(secondsUntilFire);\r\n            } else if (!isLocked && config.is_active_global && secondsUntilFire <= 0 && isFireActive) {\r\n                currentCount = 0;\r\n            }\r\n\r\n            // --- STATE UPDATES ---\r\n\r\n            // Priority: Celebration > Global Theme > Idle\r\n            if (isFireActive || currentCount !== null) {\r\n                setCurrentState('CELEBRATION');\r\n            } else if (isAnyGlobalActive) {\r\n                setCurrentState('THEME_ACTIVE');\r\n            } else {\r\n                setCurrentState('IDLE');\r\n            }\r\n\r\n            setCountdown(currentCount);\r\n\r\n        }, TICK_RATE);\r\n\r\n        return () => clearInterval(loop);\r\n    }, [config, timeOffset, user, fireworksData, globalEffects]);\r\n\r\n\r\n    // RENDERERS\r\n\r\n    // Critical Change: Allow render if global theme is active OR event is active\r\n    const isGlobalActive = Object.values(globalEffects).some(Boolean);\r\n    const isEventActive = config && config.is_active_global;\r\n\r\n    if (loading || (!isGlobalActive && !isEventActive) || currentState === 'IDLE') {\r\n        return null;\r\n    }\r\n\r\n    // Derived Render State (Frame Perfect)\r\n    const now = Date.now() + timeOffset;\r\n\r\n    // Explicit Independent Time Windows\r\n    // const themeStart = new Date(config.general_theme_start).getTime();\r\n    // const themeEnd = new Date(config.general_theme_end).getTime();\r\n    // [CHANGE] manual toggle is always \"Active\" in terms of window\r\n    const isThemeActive = isGlobalActive;\r\n\r\n    // Celebration Vars\r\n    const musicEnd = config ? new Date(config.celebration_music_end).getTime() : 0;\r\n    const fireStart = (config && config.celebration_climax_start) ? new Date(config.celebration_climax_start).getTime() : 0;\r\n\r\n    // Check lock again for render\r\n    const lockedEventId = typeof window !== 'undefined' ? localStorage.getItem('truthlens_event_completed') : null;\r\n    const isLocked = config ? (lockedEventId === config.event_id) : false;\r\n\r\n    // Active means: inside window AND not locked AND event active\r\n    const isFireActive = config && isEventActive && !isLocked && (now >= fireStart && now < musicEnd);\r\n\r\n    // --- Message Visibility Logic ---\r\n    let showClimaxMessage = false;\r\n    let showSpecialMessage = false;\r\n\r\n    if (config && isEventActive) {\r\n        // 1. Climax Message (Big Text)\r\n        if (config.climax_message_start && config.climax_message_end) {\r\n            const start = new Date(config.climax_message_start).getTime();\r\n            const end = new Date(config.climax_message_end).getTime();\r\n            showClimaxMessage = (now >= start && now < end);\r\n        } else {\r\n            showClimaxMessage = (now >= fireStart && now < musicEnd);\r\n        }\r\n\r\n        // 2. Special Message (Secondary/Thank You)\r\n        if (config.special_message) {\r\n            if (config.special_message_start && config.special_message_end) {\r\n                const start = new Date(config.special_message_start).getTime();\r\n                const end = new Date(config.special_message_end).getTime();\r\n                showSpecialMessage = (now >= start && now < end);\r\n            } else {\r\n                showSpecialMessage = showClimaxMessage;\r\n            }\r\n        }\r\n    }\r\n\r\n    // Global Overlay Visibility\r\n    // Must be unlocked AND at least one message is active AND user is logged in\r\n    const showOverlay = !isLocked && (showClimaxMessage || showSpecialMessage) && !!user;\r\n\r\n    // Render Logic using specific fields\r\n    // [CHANGE] Use global theme if enabled\r\n    const climaxEffect = config?.climax_effect || 'fireworks';\r\n\r\n    const firstName = user?.displayName ? user.displayName.split(' ')[0] : (user?.email?.split('@')[0] || 'Friend');\r\n\r\n    return (\r\n        <Box sx={{\r\n            position: 'fixed',\r\n            top: 0,\r\n            left: 0,\r\n            width: '100vw',\r\n            height: '100vh',\r\n            pointerEvents: 'none',\r\n            zIndex: 9999,\r\n            overflow: 'hidden'\r\n        }}>\r\n            {/* AUDIO */}\r\n            {config && config.music_file_url && (\r\n                <audio ref={audioRef} src={config.music_file_url} preload=\"auto\" loop={true} />\r\n            )}\r\n\r\n            {/* THEME: SNOW / RAIN / LEAVES (Phase A) */}\r\n            {/* [CHANGE] Render if themeActive AND effect is valid */}\r\n            {isThemeActive && globalEffects.snow && (\r\n                <SnowEffect />\r\n            )}\r\n            {isThemeActive && globalEffects.rain && (\r\n                <RainEffect />\r\n            )}\r\n            {isThemeActive && globalEffects.leaves && (\r\n                <LeavesEffect />\r\n            )}\r\n            {isThemeActive && globalEffects.confetti && (\r\n                <Confetti width={windowSize.width} height={windowSize.height} recycle={true} numberOfPieces={200} />\r\n            )}\r\n            {isThemeActive && globalEffects.christmas && (\r\n                <ChristmasEffect />\r\n            )}\r\n\r\n            {/* CLIMAX: CONFETTI (Phase B) */}\r\n            {(isFireActive && (climaxEffect === 'confetti' || climaxEffect === 'both')) && (\r\n                <Confetti width={windowSize.width} height={windowSize.height} />\r\n            )}\r\n\r\n            {/* CLIMAX: FIREWORKS (Phase B) */}\r\n            {(isFireActive && (climaxEffect === 'fireworks' || climaxEffect === 'both')) && fireworksData && (\r\n                <Box sx={{ position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', width: '80%', height: '80%' }}>\r\n                    <Lottie animationData={fireworksData} loop={true} />\r\n                </Box>\r\n            )}\r\n\r\n            {/* COUNTDOWN / MESSAGE OVERLAY */}\r\n            <Box sx={{\r\n                position: 'absolute',\r\n                top: '20%',\r\n                left: 0,\r\n                width: '100%',\r\n                textAlign: 'center',\r\n                pointerEvents: 'auto'\r\n            }}>\r\n                {/* Countdown */}\r\n                {countdown !== null && countdown > 0 && (\r\n                    <Typography variant=\"h1\" sx={{\r\n                        color: 'white',\r\n                        fontWeight: 'bold',\r\n                        fontSize: '6rem',\r\n                        textShadow: '0 0 20px rgba(0,0,0,0.5)',\r\n                        animation: 'pulse 1s infinite'\r\n                    }}>\r\n                        {countdown}\r\n                    </Typography>\r\n                )}\r\n\r\n                {/* Message Overlay */}\r\n                {showOverlay && (\r\n                    <Box sx={{\r\n                        background: 'rgba(0, 0, 0, 0.75)',\r\n                        display: 'inline-flex',\r\n                        flexDirection: 'column',\r\n                        alignItems: 'center',\r\n                        maxWidth: '90%',\r\n                        p: 6,\r\n                        borderRadius: 4,\r\n                        backdropFilter: 'blur(12px)',\r\n                        border: '1px solid rgba(255,255,255,0.15)',\r\n                        boxShadow: '0 8px 32px rgba(0,0,0,0.5)'\r\n                    }}>\r\n                        <Typography variant=\"h3\" sx={{\r\n                            color: '#fff',\r\n                            fontWeight: '700',\r\n                            mb: 1,\r\n                            textShadow: '0 2px 4px rgba(0,0,0,0.5)'\r\n                        }}>\r\n                            {firstName}\r\n                        </Typography>\r\n\r\n                        {/* 1. Climax Message */}\r\n                        {showClimaxMessage && config?.celebration_message && (\r\n                            <Typography variant=\"h2\" sx={{\r\n                                background: 'linear-gradient(45deg, #FFD700, #FDB931)',\r\n                                backgroundClip: 'text',\r\n                                WebkitBackgroundClip: 'text',\r\n                                color: 'transparent',\r\n                                fontWeight: '900',\r\n                                mb: 4,\r\n                                textTransform: 'uppercase',\r\n                                textAlign: 'center',\r\n                                lineHeight: 1.1\r\n                            }}>\r\n                                {config.celebration_message}\r\n                            </Typography>\r\n                        )}\r\n\r\n                        {/* 2. Special Message */}\r\n                        {showSpecialMessage && config?.special_message && (\r\n                            <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', mb: 3 }}>\r\n                                {config?.special_message_image_url && (\r\n                                    <Box\r\n                                        component=\"img\"\r\n                                        src={config.special_message_image_url}\r\n                                        alt=\"Special Event\"\r\n                                        sx={{\r\n                                            maxWidth: '200px',\r\n                                            maxHeight: '150px',\r\n                                            borderRadius: 2,\r\n                                            mb: 2,\r\n                                            boxShadow: '0 4px 15px rgba(0,0,0,0.5)',\r\n                                            border: '2px solid rgba(255,255,255,0.2)'\r\n                                        }}\r\n                                    />\r\n                                )}\r\n                                <Typography variant=\"h5\" sx={{\r\n                                    color: config?.special_message_color || 'rgba(255,255,255,0.9)',\r\n                                    fontWeight: '500',\r\n                                    textAlign: 'center',\r\n                                    maxWidth: '800px',\r\n                                    whiteSpace: 'pre-wrap', // Preserve newlines\r\n                                    textShadow: '0 2px 4px rgba(0,0,0,0.8)'\r\n                                }}>\r\n                                    {config.special_message}\r\n                                </Typography>\r\n                            </Box>\r\n                        )}\r\n\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            color=\"primary\"\r\n                            size=\"large\"\r\n                            onClick={() => {\r\n                                if (config?.event_id) {\r\n                                    localStorage.setItem('truthlens_event_completed', config.event_id);\r\n                                    setCurrentState('LOCKED');\r\n                                }\r\n                            }}\r\n                            sx={{ minWidth: 150, borderRadius: 3 }}\r\n                        >\r\n                            Dismiss\r\n                        </Button>\r\n                    </Box>\r\n                )}\r\n            </Box>\r\n\r\n            <style jsx global>{`\r\n                @keyframes pulse {\r\n                    0% { transform: scale(1); opacity: 1; }\r\n                    50% { transform: scale(1.1); opacity: 0.8; }\r\n                    100% { transform: scale(1); opacity: 1; }\r\n                }\r\n                .snowflake {\r\n                    color: #fff;\r\n                    font-size: 1em;\r\n                    font-family: Arial;\r\n                    text-shadow: 0 0 1px #000;\r\n                    position: fixed;\r\n                    top: -10%;\r\n                    z-index: 9999;\r\n                    user-select: none;\r\n                    cursor: default;\r\n                    animation-name: snowflakes-fall, snowflakes-shake;\r\n                    animation-duration: 10s, 3s;\r\n                    animation-timing-function: linear, ease-in-out;\r\n                    animation-iteration-count: infinite, infinite;\r\n                    animation-play-state: running, running;\r\n                }\r\n                @keyframes snowflakes-fall {\r\n                    0% { top: -10%; }\r\n                    100% { top: 100%; }\r\n                }\r\n                @keyframes snowflakes-shake {\r\n                    0% { transform: translateX(0px); }\r\n                    50% { transform: translateX(80px); }\r\n                    100% { transform: translateX(0px); }\r\n                }\r\n            `}</style>\r\n        </Box>\r\n    );\r\n}\r\n\r\n// --- \"PRO\" HIGH-END EFFECTS ---\r\n\r\nfunction SnowEffect() {\r\n    // Generate flakes with depth properties (size, blur, speed)\r\n    const flakes = useMemo(() => new Array(75).fill(0).map((_, i) => {\r\n        const depth = Math.random(); // 0 = far, 1 = near\r\n        return {\r\n            left: Math.random() * 100 + '%',\r\n            animationDelay: -Math.random() * 10 + 's',\r\n            animationDuration: (Math.random() * 5 + 5) + 's', // 5-10s\r\n            size: (Math.random() * 5 + 3) + 'px',\r\n            blur: (1 - depth) * 2 + 'px', // Far items are blurrier\r\n            opacity: (0.3 + depth * 0.7), // Near items are brighter\r\n        };\r\n    }), []);\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <style jsx global>{`\r\n                .snowflake {\r\n                    position: fixed;\r\n                    top: -20px;\r\n                    background: white;\r\n                    border-radius: 50%;\r\n                    pointer-events: none;\r\n                    z-index: 9999;\r\n                    animation: snow-fall linear infinite, snow-sway ease-in-out infinite alternate;\r\n                }\r\n                @keyframes snow-fall {\r\n                    0% { transform: translateY(-20px); }\r\n                    100% { transform: translateY(105vh); }\r\n                }\r\n                @keyframes snow-sway {\r\n                    0% { transform: translateX(-15px); }\r\n                    100% { transform: translateX(15px); }\r\n                }\r\n            `}</style>\r\n            {flakes.map((flake, i) => (\r\n                <div key={i} className=\"snowflake\" style={{\r\n                    left: flake.left,\r\n                    width: flake.size,\r\n                    height: flake.size,\r\n                    filter: `blur(${flake.blur})`,\r\n                    opacity: flake.opacity,\r\n                    animationDuration: `${flake.animationDuration}, ${parseFloat(flake.animationDuration) / 2}s`,\r\n                    animationDelay: flake.animationDelay,\r\n                    boxShadow: '0 0 5px rgba(255,255,255,0.8)' // Glow\r\n                }} />\r\n            ))}\r\n        </React.Fragment>\r\n    )\r\n}\r\n\r\nfunction RainEffect() {\r\n    // Multi-layer rain for parallax depth\r\n    const drops = useMemo(() => new Array(120).fill(0).map((_, i) => ({\r\n        left: Math.random() * 100 + '%',\r\n        animationDelay: -Math.random() * 2 + 's',\r\n        animationDuration: (0.5 + Math.random() * 0.5) + 's', // Fast! 0.5-1s\r\n        opacity: 0.2 + Math.random() * 0.3,\r\n        height: (10 + Math.random() * 15) + 'px'\r\n    })), []);\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <style jsx global>{`\r\n                .raindrop {\r\n                    position: fixed;\r\n                    background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(174, 194, 224, 0.8));\r\n                    width: 1.5px;\r\n                    top: -50px;\r\n                    pointer-events: none;\r\n                    z-index: 9999;\r\n                    animation: rain-fall linear infinite;\r\n                }\r\n                @keyframes rain-fall {\r\n                    0% { transform: translateY(-50px) translateX(0px); }\r\n                    100% { transform: translateY(110vh) translateX(-20px); } /* Slight wind slant */\r\n                }\r\n            `}</style>\r\n            {drops.map((drop, i) => (\r\n                <div key={i} className=\"raindrop\" style={{\r\n                    left: drop.left,\r\n                    height: drop.height,\r\n                    opacity: drop.opacity,\r\n                    animationDuration: drop.animationDuration,\r\n                    animationDelay: drop.animationDelay\r\n                }} />\r\n            ))}\r\n        </React.Fragment>\r\n    )\r\n}\r\n\r\nfunction LeavesEffect() {\r\n    // \"Spring Atmosphere\" - Gentle Sakura & Fresh Leaves\r\n    // Physics: Floating, drifting, soft swaying (feathery) instead of heavy tumbling\r\n    const particles = useMemo(() => new Array(40).fill(0).map((_, i) => ({\r\n        left: Math.random() * 100 + '%',\r\n        animationDelay: -Math.random() * 10 + 's',\r\n        animationDuration: (10 + Math.random() * 8) + 's', // Slower, graceful fall\r\n        size: (15 + Math.random() * 15) + 'px',\r\n        type: Math.random() > 0.4 ? '≡ƒî╕' : '≡ƒìâ', // Mostly flowers, some fresh leaves\r\n        rotationAxis: Math.random() > 0.5 ? 'X' : 'Y', // Random spin axis\r\n        swayDuration: (3 + Math.random() * 3) + 's'\r\n    })), []);\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <style jsx global>{`\r\n                .spring-particle {\r\n                    position: fixed;\r\n                    top: -10%;\r\n                    pointer-events: none;\r\n                    z-index: 9999;\r\n                    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); /* Soft shadow */\r\n                    animation-timing-function: linear, ease-in-out;\r\n                    animation-iteration-count: infinite, infinite;\r\n                    animation-name: spring-fall, spring-sway;\r\n                }\r\n                @keyframes spring-fall {\r\n                    0% { top: -10%; opacity: 0; }\r\n                    10% { opacity: 1; }\r\n                    90% { opacity: 1; }\r\n                    100% { top: 110%; opacity: 0; }\r\n                }\r\n                @keyframes spring-sway {\r\n                    0% { transform: translateX(0) rotate3d(1, 1, 1, 0deg); }\r\n                    25% { transform: translateX(30px) rotate3d(1, 1, 1, 45deg); }\r\n                    50% { transform: translateX(0) rotate3d(1, 1, 1, 90deg); }\r\n                    75% { transform: translateX(-30px) rotate3d(1, 1, 1, 135deg); }\r\n                    100% { transform: translateX(0) rotate3d(1, 1, 1, 180deg); }\r\n                }\r\n            `}</style>\r\n            {particles.map((p, i) => (\r\n                <div key={i} className=\"spring-particle\" style={{\r\n                    left: p.left,\r\n                    fontSize: p.size,\r\n                    animationDuration: `${p.animationDuration}, ${p.swayDuration}`,\r\n                    animationDelay: p.animationDelay\r\n                }}>\r\n                    {p.type}\r\n                </div>\r\n            ))}\r\n        </React.Fragment>\r\n    )\r\n}\r\n\r\nfunction ChristmasEffect() {\r\n    // \"Polar Express\" Atmosphere\r\n    // Rich mix of icons: Trees, Santa, Gifts, Stars, Bells\r\n    const particles = useMemo(() => new Array(50).fill(0).map((_, i) => {\r\n        const types = ['≡ƒÄä', '≡ƒÄà', '≡ƒÄü', 'Γ¡É', '≡ƒªî', '≡ƒöö', '≡ƒì¬'];\r\n        const type = types[Math.floor(Math.random() * types.length)];\r\n        return {\r\n            left: Math.random() * 100 + '%',\r\n            animationDelay: -Math.random() * 15 + 's',\r\n            animationDuration: (6 + Math.random() * 8) + 's',\r\n            size: (20 + Math.random() * 20) + 'px',\r\n            type,\r\n            rotationDir: Math.random() > 0.5 ? 1 : -1,\r\n            swayDuration: (3 + Math.random() * 4) + 's'\r\n        };\r\n    }), []);\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <style jsx global>{`\r\n                .christmas-item {\r\n                    position: fixed;\r\n                    top: -50px;\r\n                    pointer-events: none;\r\n                    z-index: 9999;\r\n                    filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5)); /* Golden Glow */\r\n                    animation-timing-function: linear, ease-in-out;\r\n                    animation-iteration-count: infinite, infinite;\r\n                    animation-name: xmas-fall, xmas-sway;\r\n                }\r\n                @keyframes xmas-fall {\r\n                    0% { top: -10%; opacity: 0; }\r\n                    10% { opacity: 1; }\r\n                    100% { top: 110%; opacity: 0; }\r\n                }\r\n                @keyframes xmas-sway {\r\n                    0% { transform: translateX(0) rotate(0deg); }\r\n                    100% { transform: translateX(20px) rotate(20deg); } /* Gentle wobble */\r\n                }\r\n            `}</style>\r\n            {particles.map((p, i) => (\r\n                <div key={i} className=\"christmas-item\" style={{\r\n                    left: p.left,\r\n                    fontSize: p.size,\r\n                    animationDuration: `${p.animationDuration}, ${p.swayDuration}`,\r\n                    animationDelay: p.animationDelay\r\n                }}>\r\n                    {p.type}\r\n                </div>\r\n            ))}\r\n        </React.Fragment>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\features\\ARProductVisualizer.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":77,"column":17,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[2850,2869],"text":"\r\n                &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[2850,2869],"text":"\r\n                &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[2850,2869],"text":"\r\n                &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[2850,2869],"text":"\r\n                &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":77,"column":47,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[2898,2913],"text":"&quot;\r\n            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[2898,2913],"text":"&ldquo;\r\n            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[2898,2913],"text":"&#34;\r\n            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[2898,2913],"text":"&rdquo;\r\n            "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport { Box, Typography, Paper, CircularProgress } from '@mui/material';\r\nimport { keyframes } from '@mui/system';\r\nimport { ARProductDetails } from '@/services/aiService';\r\n\r\nconst rotate = keyframes`\r\n  from { transform: rotateY(0deg) rotateX(10deg); }\r\n  to { transform: rotateY(360deg) rotateX(10deg); }\r\n`;\r\n\r\ninterface ARVisualizerProps {\r\n    data: ARProductDetails | null;\r\n    loading: boolean;\r\n    imageUrl?: string;\r\n}\r\n\r\nexport default function ARProductVisualizer({ data, loading, imageUrl }: ARVisualizerProps) {\r\n    if (loading) {\r\n        return (\r\n            <Box sx={{ height: 300, display: 'flex', alignItems: 'center', justifyContent: 'center', flexDirection: 'column' }}>\r\n                <CircularProgress color=\"secondary\" />\r\n                <Typography variant=\"caption\" sx={{ mt: 2 }}>AI is estimating physical dimensions...</Typography>\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    if (!data) return null;\r\n\r\n    // --- GEOMETRY MATH ---\r\n    // Normalize dimensions for display (scale down to fit 200px box)\r\n    const maxDim = Math.max(data.dimensions.height, data.dimensions.width, data.dimensions.length);\r\n    const scale = 150 / maxDim;\r\n\r\n    const h = data.dimensions.height * scale;\r\n    const w = data.dimensions.width * scale;\r\n    const d = data.dimensions.length * scale;\r\n\r\n    const color = data.color || '#ccc';\r\n\r\n    // Cylinder parameters\r\n    const cylinderSegments = 24; // Smoother circle\r\n    const r = w / 2; // Radius\r\n\r\n    // Width of each panel to close the gap perfectly: 2 * r * tan(PI/segments)\r\n    // We add a tiny buffer (+1px) to prevent sub-pixel gaps between panels\r\n    const segmentWidth = 2 * r * Math.tan(Math.PI / cylinderSegments) + 1;\r\n\r\n    // Texture styles for Box\r\n    const textureStyle = imageUrl ? {\r\n        backgroundImage: `url(${imageUrl})`,\r\n        backgroundSize: 'cover',\r\n        backgroundPosition: 'center',\r\n        backgroundRepeat: 'no-repeat'\r\n    } : { backgroundColor: color };\r\n\r\n    return (\r\n        <Paper elevation={0} sx={{\r\n            p: 2,\r\n            height: 350,\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            bgcolor: 'transparent',\r\n            position: 'relative',\r\n            perspective: '1000px',\r\n            overflow: 'hidden'\r\n        }}>\r\n            <Typography variant=\"subtitle2\" color=\"secondary\" sx={{ position: 'absolute', top: 10, left: 10 }}>\r\n                AI Spatial Model\r\n            </Typography>\r\n\r\n            <Typography variant=\"caption\" sx={{ position: 'absolute', bottom: 10, right: 10, textAlign: 'right', zIndex: 10 }}>\r\n                Est. Size: {data.dimensions.length}x{data.dimensions.width}x{data.dimensions.height} {data.dimensions.unit}<br />\r\n                \"{data.estimatedRealWorldSize}\"\r\n            </Typography>\r\n\r\n            {/* 3D Scene */}\r\n            <Box sx={{\r\n                width: 200,\r\n                height: 200,\r\n                position: 'relative',\r\n                transformStyle: 'preserve-3d',\r\n                animation: `${rotate} 12s infinite linear`\r\n            }}>\r\n                {/* Primitive Shapes based on AI detection */}\r\n                {data.shape === 'cylinder' || data.shape === 'bottle' ? (\r\n                    // --- HIGH QUALITY TEXTURED CYLINDER ---\r\n                    <Box sx={{ position: 'relative', width: '100%', height: '100%', transformStyle: 'preserve-3d', transform: `translateY(${(200 - h) / 2}px)` }}>\r\n                        {/* Generate Panels */}\r\n                        {Array.from({ length: cylinderSegments }).map((_, i) => {\r\n                            const deg = (360 / cylinderSegments) * i;\r\n                            return (\r\n                                <Box key={i} sx={{\r\n                                    position: 'absolute',\r\n                                    left: '50%', // Center the panel origin\r\n                                    top: 0,\r\n                                    width: segmentWidth,\r\n                                    height: h,\r\n                                    marginLeft: `${-segmentWidth / 2}px`, // Center pivot to rotate correctly\r\n\r\n                                    // Texture Mapping\r\n                                    backgroundImage: imageUrl ? `url(${imageUrl})` : undefined,\r\n                                    backgroundColor: imageUrl ? 'white' : color,\r\n\r\n                                    // Stretch texture across all segments. \r\n                                    // Total width = segmentWidth * segments.\r\n                                    backgroundSize: `${segmentWidth * cylinderSegments}px ${h}px`,\r\n\r\n                                    // Shift position for this segment\r\n                                    backgroundPosition: `${-i * (segmentWidth - 1)}px center`, // -1 to account for overlap buffer\r\n\r\n                                    opacity: 1,\r\n                                    // Rotate and push out by Radius\r\n                                    transform: `rotateY(${deg}deg) translateZ(${r}px)`,\r\n                                    backfaceVisibility: 'hidden',\r\n\r\n                                    // Lighting simulation\r\n                                    '&::after': {\r\n                                        content: '\"\"',\r\n                                        position: 'absolute',\r\n                                        top: 0, bottom: 0, left: 0, right: 0,\r\n                                        // Dynamic lighting gradient based on rotation angle (simulated)\r\n                                        background: `linear-gradient(90deg, rgba(0,0,0,${Math.abs(Math.sin((deg) / 180 * Math.PI)) * 0.3}), rgba(255,255,255,${Math.abs(Math.cos((deg) / 180 * Math.PI)) * 0.1}))`,\r\n                                        pointerEvents: 'none'\r\n                                    }\r\n                                }} />\r\n                            );\r\n                        })}\r\n\r\n                        {/* Cylinder Cap (Top) - Simple Circle */}\r\n                        <Box sx={{\r\n                            position: 'absolute',\r\n                            left: '50%',\r\n                            top: 0,\r\n                            width: w,\r\n                            height: w, // Circular\r\n                            marginLeft: `${-w / 2}px`,\r\n                            borderRadius: '50%',\r\n                            backgroundColor: '#e0e0e0', // Generic cap color\r\n                            // Map top part of image if possible, or just standard cap color\r\n                            backgroundImage: imageUrl ? `radial-gradient(circle, ${color} 30%, #333 100%)` : undefined,\r\n                            transform: `translateX(-50%) rotateX(90deg) translateZ(${h / 2}px)`\r\n                        }} />\r\n\r\n                        {/* Cylinder Base (Bottom) */}\r\n                        <Box sx={{\r\n                            position: 'absolute',\r\n                            left: '50%',\r\n                            marginLeft: `${-w / 2}px`,\r\n                            width: w,\r\n                            height: w,\r\n                            borderRadius: '50%',\r\n                            backgroundColor: color,\r\n                            filter: 'brightness(50%)',\r\n                            transform: `translateX(-50%) rotateX(-90deg) translateZ(${h / 2}px)`\r\n                        }} />\r\n                    </Box>\r\n                ) : (\r\n                    // --- TEXTURED BOX ---\r\n                    // Center the box logic better\r\n                    <Box sx={{ position: 'relative', width: w, height: h, margin: 'auto', transformStyle: 'preserve-3d', transform: `translateY(${(200 - h) / 2}px)` }}>\r\n                        {/* Front */}\r\n                        <Box sx={{ position: 'absolute', width: w, height: h, ...textureStyle, transform: `translateZ(${d / 2}px)` }} />\r\n                        {/* Back */}\r\n                        <Box sx={{ position: 'absolute', width: w, height: h, ...textureStyle, transform: `rotateY(180deg) translateZ(${d / 2}px)` }} />\r\n                        {/* Right */}\r\n                        <Box sx={{ position: 'absolute', width: d, height: h, bgcolor: color, filter: 'brightness(80%)', transform: `rotateY(90deg) translateZ(${w / 2}px)` }} />\r\n                        {/* Left */}\r\n                        <Box sx={{ position: 'absolute', width: d, height: h, bgcolor: color, filter: 'brightness(80%)', transform: `rotateY(-90deg) translateZ(${w / 2}px)` }} />\r\n                        {/* Top */}\r\n                        <Box sx={{ position: 'absolute', width: w, height: d, bgcolor: '#f5f5f5', transform: `rotateX(90deg) translateZ(${d / 2}px)` }} />\r\n                        {/* Bottom */}\r\n                        <Box sx={{ position: 'absolute', width: w, height: d, bgcolor: '#ddd', transform: `rotateX(-90deg) translateZ(${h - d / 2}px)` }} />\r\n                    </Box>\r\n                )}\r\n            </Box>\r\n        </Paper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\features\\AiPreferenceOnboarding.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`addMessage` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\features\\AiPreferenceOnboarding.tsx:63:13\n  61 |             const userName = user?.displayName?.split(' ')[0] || 'there';\n  62 |             const initialQuestion = t('ai_intro_greeting', { name: userName });\n> 63 |             addMessage(initialQuestion, 'ai');\n     |             ^^^^^^^^^^ `addMessage` accessed before it is declared\n  64 |         }\n  65 |     }, [open, user, t]);\n  66 |\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\features\\AiPreferenceOnboarding.tsx:72:5\n  70 |     }, [messages, loading]);\n  71 |\n> 72 |     const addMessage = (text: string, sender: 'ai' | 'user') => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 73 |         setMessages(prev => [...prev, { id: Date.now(), text, sender }]);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 74 |     };\n     | ^^^^^^^ `addMessage` is declared here\n  75 |\n  76 |     const handleSend = async () => {\n  77 |         if (!input.trim() && STEPS[currentStep].type !== 'open') return;","line":63,"column":13,"nodeType":null,"endLine":63,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'messages.length'. Either include it or remove the dependency array.","line":65,"column":8,"nodeType":"ArrayExpression","endLine":65,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [open, user, t, messages.length]","fix":{"range":[2922,2937],"text":"[open, user, t, messages.length]"}}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":108,"column":17,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":108,"endColumn":30,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[4481,4494],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7015,7018],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7015,7018],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n    Dialog, DialogContent, Button, Typography, Box,\r\n    TextField, LinearProgress, Avatar, IconButton, Paper, Slide\r\n} from '@mui/material';\r\nimport SmartToyIcon from '@mui/icons-material/SmartToy';\r\nimport SendIcon from '@mui/icons-material/Send';\r\nimport CloseIcon from '@mui/icons-material/Close';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { extractDietaryEntities } from '@/services/aiService';\r\nimport { updateDietaryPreferences } from '@/services/subscriptionService';\r\nimport { DietaryPreferences } from '@/types/user';\r\nimport { doc, setDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { db } from '@/lib/firebase';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\ninterface Message {\r\n    id: number;\r\n    text: string;\r\n    sender: 'ai' | 'user';\r\n}\r\n\r\ninterface AiPreferenceOnboardingProps {\r\n    open: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport default function AiPreferenceOnboarding({ open, onClose }: AiPreferenceOnboardingProps) {\r\n    const { user, refreshProfile } = useAuth();\r\n    const { t } = useTranslation();\r\n    const [messages, setMessages] = useState<Message[]>([]);\r\n    const [currentStep, setCurrentStep] = useState(0);\r\n    const [input, setInput] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const [tempPreferences, setTempPreferences] = useState<Partial<DietaryPreferences>>({\r\n        allergens: [],\r\n        avoidIngredients: [],\r\n        healthGoals: []\r\n    });\r\n\r\n    const STEPS = [\r\n        { id: 1, type: 'open', question: \"\" }, // Placeholder, set dynamically\r\n        { id: 2, type: 'yesno', key: 'isKeto', question: t('ai_q_keto') },\r\n        { id: 3, type: 'yesno', key: 'isVegan', question: t('ai_q_vegan') },\r\n        { id: 4, type: 'yesno', key: 'isDiabetic', question: t('ai_q_diabetic') },\r\n        { id: 5, type: 'yesno', key: 'lowSodium', question: t('ai_q_low_sodium') },\r\n        { id: 6, type: 'yesno', key: 'glutenFree', question: t('ai_q_gluten_free') },\r\n        { id: 7, type: 'options', key: 'goals', question: t('ai_q_goals'), options: [t('ai_opt_weight_loss'), t('ai_opt_muscle'), t('ai_opt_maintenance'), t('ai_opt_energy')] },\r\n        { id: 8, type: 'yesno', key: 'organic', question: t('ai_q_organic') },\r\n        { id: 9, type: 'yesno', key: 'palmOil', question: t('ai_q_palm_oil') },\r\n        { id: 10, type: 'text', question: t('ai_q_anything_else') }\r\n    ];\r\n\r\n    const messagesEndRef = useRef<null | HTMLDivElement>(null);\r\n\r\n    // Initial Greeting\r\n    useEffect(() => {\r\n        if (open && messages.length === 0) {\r\n            const userName = user?.displayName?.split(' ')[0] || 'there';\r\n            const initialQuestion = t('ai_intro_greeting', { name: userName });\r\n            addMessage(initialQuestion, 'ai');\r\n        }\r\n    }, [open, user, t]);\r\n\r\n    // Auto-scroll\r\n    useEffect(() => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n    }, [messages, loading]);\r\n\r\n    const addMessage = (text: string, sender: 'ai' | 'user') => {\r\n        setMessages(prev => [...prev, { id: Date.now(), text, sender }]);\r\n    };\r\n\r\n    const handleSend = async () => {\r\n        if (!input.trim() && STEPS[currentStep].type !== 'open') return;\r\n\r\n        const userText = input;\r\n        addMessage(userText, 'user');\r\n        setInput('');\r\n        setLoading(true);\r\n\r\n        await processStep(currentStep, userText);\r\n        setLoading(false);\r\n    };\r\n\r\n    const handleOptionClick = async (option: string) => {\r\n        addMessage(option, 'user');\r\n        setLoading(true);\r\n        await processStep(currentStep, option);\r\n        setLoading(false);\r\n    };\r\n\r\n    const processStep = async (stepIndex: number, answer: string) => {\r\n        const step = STEPS[stepIndex];\r\n\r\n        // 1. Logic for Specific Steps\r\n        if (step.id === 1) {\r\n            const extraction = await extractDietaryEntities(answer);\r\n            setTempPreferences(prev => ({\r\n                ...prev,\r\n                allergens: [...(prev.allergens || []), ...extraction.allergens],\r\n                avoidIngredients: [...(prev.avoidIngredients || []), ...extraction.avoidIngredients],\r\n            }));\r\n        } else if (step.type === 'yesno') {\r\n            if (step.key && ['isKeto', 'isVegan', 'isDiabetic', 'lowSodium', 'glutenFree'].includes(step.key)) {\r\n                // @ts-ignore\r\n                setTempPreferences(prev => ({ ...prev, [step.key]: [t('yes'), 'Yes'].includes(answer) }));\r\n            }\r\n            if ([t('yes'), 'Yes'].includes(answer) && step.key === 'palmOil') {\r\n                setTempPreferences(prev => ({ ...prev, avoidIngredients: [...(prev.avoidIngredients || []), \"Palm Oil\"] }));\r\n            }\r\n        } else if (step.id === 7) {\r\n            setTempPreferences(prev => ({ ...prev, healthGoals: [...(prev.healthGoals || []), answer] }));\r\n        }\r\n\r\n        // 2. Move to Next Step\r\n        const nextStep = stepIndex + 1;\r\n        if (nextStep < STEPS.length) {\r\n            setTimeout(() => {\r\n                setCurrentStep(nextStep);\r\n                addMessage(STEPS[nextStep].question, 'ai');\r\n            }, 800); // Slightly longer delay for \"thinking\" feel\r\n        } else {\r\n            await finishOnboarding();\r\n        }\r\n    };\r\n\r\n    const finishOnboarding = async () => {\r\n        addMessage(t('ai_finish_msg'), 'ai');\r\n\r\n        if (user) {\r\n            try {\r\n                await updateDietaryPreferences(user.uid, tempPreferences as DietaryPreferences);\r\n                await setDoc(doc(db, 'users', user.uid, 'pro_features', 'preferences_ai_suggestion'), {\r\n                    ...tempPreferences,\r\n                    chatHistory: messages.map(m => ({ sender: m.sender, text: m.text })),\r\n                    completedAt: serverTimestamp()\r\n                });\r\n\r\n                await refreshProfile();\r\n                setTimeout(() => {\r\n                    onClose();\r\n                    setMessages([]);\r\n                    setCurrentStep(0);\r\n                }, 2000);\r\n            } catch (e) {\r\n                console.error(\"Error saving preferences:\", e);\r\n                addMessage(\"Oops, something went wrong saving your data.\", 'ai');\r\n            }\r\n        }\r\n    };\r\n\r\n    const progress = ((currentStep + 1) / STEPS.length) * 100;\r\n\r\n    return (\r\n        <Dialog\r\n            open={open}\r\n            onClose={onClose}\r\n            maxWidth=\"sm\"\r\n            fullWidth\r\n            PaperProps={{\r\n                sx: {\r\n                    borderRadius: 5,\r\n                    height: '650px',\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    overflow: 'hidden',\r\n                    boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.25)'\r\n                }\r\n            }}\r\n            TransitionComponent={Slide}\r\n            TransitionProps={{ direction: 'up' } as any}\r\n        >\r\n            {/* Header */}\r\n            <Box sx={{\r\n                p: 3,\r\n                background: 'linear-gradient(135deg, #00C853 0%, #009624 100%)',\r\n                color: 'white',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                gap: 2,\r\n                boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)'\r\n            }}>\r\n                <Avatar sx={{ bgcolor: 'white', color: '#00C853', width: 48, height: 48 }}>\r\n                    <SmartToyIcon fontSize=\"large\" />\r\n                </Avatar>\r\n                <Box sx={{ flex: 1 }}>\r\n                    <Typography variant=\"h6\" fontWeight=\"800\" sx={{ letterSpacing: 0.5 }}>\r\n                        NutriGrade AI\r\n                    </Typography>\r\n                    <Typography variant=\"caption\" sx={{ opacity: 0.9, fontSize: '0.85rem' }}>\r\n                        Smart Diet Consultant\r\n                    </Typography>\r\n                </Box>\r\n                <IconButton onClick={onClose} sx={{ color: 'white', '&:hover': { bgcolor: 'rgba(255,255,255,0.1)' } }}>\r\n                    <CloseIcon />\r\n                </IconButton>\r\n            </Box>\r\n\r\n            <LinearProgress\r\n                variant=\"determinate\"\r\n                value={progress}\r\n                sx={{\r\n                    height: 4,\r\n                    bgcolor: 'rgba(0, 200, 83, 0.1)',\r\n                    '& .MuiLinearProgress-bar': { bgcolor: '#00C853' }\r\n                }}\r\n            />\r\n\r\n            {/* Chat Area */}\r\n            <DialogContent sx={{\r\n                flex: 1,\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                gap: 2,\r\n                p: 3,\r\n                bgcolor: '#F3F4F6',\r\n                overflowY: 'auto'\r\n            }}>\r\n                <AnimatePresence initial={false}>\r\n                    {messages.map((msg) => (\r\n                        <motion.div\r\n                            key={msg.id}\r\n                            initial={{ opacity: 0, y: 10, scale: 0.95 }}\r\n                            animate={{ opacity: 1, y: 0, scale: 1 }}\r\n                            transition={{ duration: 0.3 }}\r\n                            style={{\r\n                                display: 'flex',\r\n                                justifyContent: msg.sender === 'user' ? 'flex-end' : 'flex-start',\r\n                                marginBottom: 12\r\n                            }}\r\n                        >\r\n                            <Box sx={{ display: 'flex', gap: 1, flexDirection: msg.sender === 'user' ? 'row-reverse' : 'row', maxWidth: '85%' }}>\r\n                                {msg.sender === 'ai' && (\r\n                                    <Avatar sx={{ width: 32, height: 32, bgcolor: '#00C853', mt: 0.5 }}>\r\n                                        <SmartToyIcon sx={{ fontSize: 18 }} />\r\n                                    </Avatar>\r\n                                )}\r\n                                <Paper\r\n                                    elevation={msg.sender === 'user' ? 4 : 1}\r\n                                    sx={{\r\n                                        p: 2,\r\n                                        borderRadius: 3,\r\n                                        bgcolor: msg.sender === 'user' ? '#00C853' : 'white',\r\n                                        color: msg.sender === 'user' ? 'white' : 'text.primary',\r\n                                        borderTopLeftRadius: msg.sender === 'ai' ? 4 : 20,\r\n                                        borderTopRightRadius: msg.sender === 'user' ? 4 : 20,\r\n                                        boxShadow: msg.sender === 'user'\r\n                                            ? '0 4px 6px -1px rgba(0, 200, 83, 0.3)'\r\n                                            : '0 2px 4px -1px rgba(0, 0, 0, 0.05)',\r\n                                        position: 'relative'\r\n                                    }}\r\n                                >\r\n                                    <Typography variant=\"body1\" sx={{ lineHeight: 1.6 }}>{msg.text}</Typography>\r\n                                </Paper>\r\n                            </Box>\r\n                        </motion.div>\r\n                    ))}\r\n                </AnimatePresence>\r\n\r\n                {loading && (\r\n                    <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }}>\r\n                        <Box sx={{ display: 'flex', gap: 1, alignItems: 'center', ml: 1 }}>\r\n                            <Avatar sx={{ width: 32, height: 32, bgcolor: '#00C853' }}>\r\n                                <SmartToyIcon sx={{ fontSize: 18 }} />\r\n                            </Avatar>\r\n                            <Paper sx={{ p: 2, borderRadius: 3, bgcolor: 'white', borderTopLeftRadius: 4 }}>\r\n                                <Box sx={{ display: 'flex', gap: 1 }}>\r\n                                    {[0, 1, 2].map(i => (\r\n                                        <Box\r\n                                            key={i}\r\n                                            component={motion.div}\r\n                                            animate={{ y: [0, -5, 0] }}\r\n                                            transition={{ duration: 0.6, repeat: Infinity, delay: i * 0.2 }}\r\n                                            sx={{ width: 8, height: 8, bgcolor: '#00C853', borderRadius: '50%' }}\r\n                                        />\r\n                                    ))}\r\n                                </Box>\r\n                            </Paper>\r\n                        </Box>\r\n                    </motion.div>\r\n                )}\r\n                <div ref={messagesEndRef} />\r\n            </DialogContent>\r\n\r\n            {/* Input Area */}\r\n            <Box sx={{ p: 3, bgcolor: 'white', borderTop: '1px solid #E5E7EB' }}>\r\n                {/* Contextual Inputs */}\r\n                {STEPS[currentStep]?.type === 'yesno' && !loading && (\r\n                    <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }}>\r\n                        <Box sx={{ display: 'flex', gap: 2, mb: 2, justifyContent: 'center' }}>\r\n                            <Button\r\n                                variant=\"outlined\"\r\n                                onClick={() => handleOptionClick(t('yes'))}\r\n                                sx={{\r\n                                    borderColor: '#00C853',\r\n                                    color: '#00C853',\r\n                                    borderRadius: 3,\r\n                                    px: 4,\r\n                                    '&:hover': { bgcolor: '#E8F5E9', borderColor: '#00C853' }\r\n                                }}\r\n                            >\r\n                                {t('yes')}\r\n                            </Button>\r\n                            <Button\r\n                                variant=\"outlined\"\r\n                                onClick={() => handleOptionClick(t('no'))}\r\n                                sx={{\r\n                                    borderColor: '#EF4444',\r\n                                    color: '#EF4444',\r\n                                    borderRadius: 3,\r\n                                    px: 4,\r\n                                    '&:hover': { bgcolor: '#FEF2F2', borderColor: '#EF4444' }\r\n                                }}\r\n                            >\r\n                                {t('no')}\r\n                            </Button>\r\n                        </Box>\r\n                    </motion.div>\r\n                )}\r\n\r\n                {STEPS[currentStep]?.type === 'options' && !loading && (\r\n                    <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }}>\r\n                        <Box sx={{ display: 'flex', gap: 1, mb: 2, flexWrap: 'wrap', justifyContent: 'center' }}>\r\n                            {STEPS[currentStep].options?.map(opt => (\r\n                                <Button\r\n                                    key={opt}\r\n                                    variant=\"outlined\"\r\n                                    onClick={() => handleOptionClick(opt)}\r\n                                    sx={{\r\n                                        borderColor: '#00C853',\r\n                                        color: '#00C853',\r\n                                        borderRadius: 5,\r\n                                        '&:hover': { bgcolor: '#00C853', color: 'white' }\r\n                                    }}\r\n                                >\r\n                                    {opt}\r\n                                </Button>\r\n                            ))}\r\n                        </Box>\r\n                    </motion.div>\r\n                )}\r\n\r\n                <Box sx={{ display: 'flex', gap: 1.5 }}>\r\n                    <TextField\r\n                        fullWidth\r\n                        placeholder={t('type_your_answer')}\r\n                        value={input}\r\n                        onChange={(e) => setInput(e.target.value)}\r\n                        onKeyPress={(e) => e.key === 'Enter' && handleSend()}\r\n                        disabled={loading || STEPS[currentStep]?.type === 'yesno' || STEPS[currentStep]?.type === 'options'}\r\n                        size=\"small\"\r\n                        sx={{\r\n                            '& .MuiOutlinedInput-root': {\r\n                                borderRadius: 3,\r\n                                '&.Mui-focused fieldset': { borderColor: '#00C853' }\r\n                            }\r\n                        }}\r\n                    />\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        onClick={handleSend}\r\n                        disabled={loading}\r\n                        sx={{\r\n                            bgcolor: '#00C853',\r\n                            borderRadius: 2,\r\n                            minWidth: 50,\r\n                            boxShadow: '0 4px 6px -1px rgba(0, 200, 83, 0.4)',\r\n                            '&:hover': { bgcolor: '#009624' }\r\n                        }}\r\n                    >\r\n                        <SendIcon />\r\n                    </Button>\r\n                </Box>\r\n            </Box>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\features\\GradeDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\features\\ProAnalysisView.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'StarIcon' is defined but never used.","line":18,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":51,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":74,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":74,"endColumn":23},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":272,"column":37,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[14419,14458],"text":"\r\n                                    &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[14419,14458],"text":"\r\n                                    &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[14419,14458],"text":"\r\n                                    &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[14419,14458],"text":"\r\n                                    &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":272,"column":76,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[14496,14531],"text":"&quot;\r\n                                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[14496,14531],"text":"&ldquo;\r\n                                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[14496,14531],"text":"&#34;\r\n                                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[14496,14531],"text":"&rdquo;\r\n                                "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":280,"column":39,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[14772,14891],"text":"\r\n                                Click &quot;Analyze Now\" to generate a comprehensive report.\r\n                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[14772,14891],"text":"\r\n                                Click &ldquo;Analyze Now\" to generate a comprehensive report.\r\n                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[14772,14891],"text":"\r\n                                Click &#34;Analyze Now\" to generate a comprehensive report.\r\n                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[14772,14891],"text":"\r\n                                Click &rdquo;Analyze Now\" to generate a comprehensive report.\r\n                            "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":280,"column":51,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[14772,14891],"text":"\r\n                                Click \"Analyze Now&quot; to generate a comprehensive report.\r\n                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[14772,14891],"text":"\r\n                                Click \"Analyze Now&ldquo; to generate a comprehensive report.\r\n                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[14772,14891],"text":"\r\n                                Click \"Analyze Now&#34; to generate a comprehensive report.\r\n                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[14772,14891],"text":"\r\n                                Click \"Analyze Now&rdquo; to generate a comprehensive report.\r\n                            "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport {\r\n    Box, Typography, Button, Paper, Collapse, CircularProgress,\r\n    Divider, Chip, Avatar, useTheme, Grid, LinearProgress, Alert\r\n} from '@mui/material';\r\nimport AutoAwesomeIcon from '@mui/icons-material/AutoAwesome';\r\nimport SmartToyIcon from '@mui/icons-material/SmartToy';\r\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\r\nimport ExpandLessIcon from '@mui/icons-material/ExpandLess';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport CancelIcon from '@mui/icons-material/Cancel';\r\nimport TrendingUpIcon from '@mui/icons-material/TrendingUp';\r\nimport GavelIcon from '@mui/icons-material/Gavel';\r\nimport ThumbUpIcon from '@mui/icons-material/ThumbUp';\r\nimport ThumbDownIcon from '@mui/icons-material/ThumbDown';\r\nimport StarIcon from '@mui/icons-material/Star';\r\nimport { analyzeProductProMode } from '@/services/aiService';\r\nimport { useAuth } from '@/context/AuthContext';\r\n\r\ninterface ProAnalysisViewProps {\r\n    productName: string;\r\n    productBrand?: string;\r\n}\r\n\r\ninterface AnalysisData {\r\n    marketStatus: string;\r\n    brandReputation: string;\r\n    grading: {\r\n        quality: { score: number; reason: string };\r\n        value: { score: number; reason: string };\r\n        satisfaction: { score: number; reason: string };\r\n        totalScore: number;\r\n        letterGrade: string;\r\n    };\r\n    analysis: {\r\n        overview: string;\r\n        strengths: string[];\r\n        weaknesses: string[];\r\n        valueAssessment: string;\r\n        reviewsSummary: string;\r\n    };\r\n    verdict: {\r\n        decision: 'RECOMMEND' | 'DO NOT RECOMMEND' | 'CONSIDER ALTERNATIVES';\r\n        reasoning: string;\r\n    };\r\n}\r\n\r\nexport default function ProAnalysisView({ productName, productBrand }: ProAnalysisViewProps) {\r\n    const { user, isPro, dietaryPreferences } = useAuth();\r\n    const theme = useTheme();\r\n    const [analysisData, setAnalysisData] = useState<AnalysisData | null>(null);\r\n    const [rawError, setRawError] = useState<string | null>(null);\r\n    const [loading, setLoading] = useState(false);\r\n    const [expanded, setExpanded] = useState(false);\r\n\r\n    const handleAnalyze = async () => {\r\n        if (!isPro) return;\r\n\r\n        setLoading(true);\r\n        setExpanded(true);\r\n        setRawError(null);\r\n        try {\r\n            const userProfileForAI = {\r\n                dietaryPreferences,\r\n                subscription: 'PRO_TIER_ELITE'\r\n            };\r\n            const resultString = await analyzeProductProMode(`${productName} ${productBrand || ''}`, userProfileForAI);\r\n\r\n            try {\r\n                const parsed = JSON.parse(resultString);\r\n                setAnalysisData(parsed);\r\n            } catch (e) {\r\n                console.error(\"JSON Parse Error\", resultString);\r\n                setRawError(\"AI returned unstructured data. Please try again.\");\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error(\"Analysis Failed\", error);\r\n            setRawError(\"Connection failed. Please check your internet or API keys.\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const getScoreColor = (score: number) => {\r\n        if (score >= 80) return theme.palette.success.main;\r\n        if (score >= 60) return theme.palette.warning.main;\r\n        return theme.palette.error.main;\r\n    };\r\n\r\n    const renderScoreCard = (label: string, data: { score: number; reason: string }) => (\r\n        <Paper elevation={0} sx={{ p: 2, bgcolor: 'background.default', borderRadius: 2, border: '1px solid', borderColor: 'divider', height: '100%' }}>\r\n            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 1 }}>\r\n                <Typography variant=\"subtitle2\" color=\"text.secondary\">{label}</Typography>\r\n                <Typography variant=\"h6\" fontWeight=\"bold\" color={getScoreColor(data.score)}>{data.score}/100</Typography>\r\n            </Box>\r\n            <LinearProgress variant=\"determinate\" value={data.score} sx={{ height: 6, borderRadius: 3, mb: 1, bgcolor: 'action.hover', '& .MuiLinearProgress-bar': { bgcolor: getScoreColor(data.score) } }} />\r\n            <Typography variant=\"caption\" color=\"text.secondary\" sx={{ display: '-webkit-box', WebkitLineClamp: 2, WebkitBoxOrient: 'vertical', overflow: 'hidden' }}>\r\n                {data.reason}\r\n            </Typography>\r\n        </Paper>\r\n    );\r\n\r\n    if (!isPro) return null;\r\n\r\n    return (\r\n        <Paper\r\n            elevation={3}\r\n            sx={{\r\n                mt: 4,\r\n                borderRadius: 4,\r\n                overflow: 'hidden',\r\n                background: `linear-gradient(135deg, ${theme.palette.background.paper} 0%, #f8f9fa 100%)`,\r\n                border: '1px solid #e0e0e0'\r\n            }}\r\n        >\r\n            {/* Header / Trigger */}\r\n            <Box\r\n                onClick={!loading ? () => setExpanded(!expanded) : undefined}\r\n                sx={{\r\n                    p: 3,\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'space-between',\r\n                    cursor: 'pointer',\r\n                    '&:hover': { bgcolor: 'rgba(0,0,0,0.02)' }\r\n                }}\r\n            >\r\n                <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\r\n                    <Avatar sx={{ bgcolor: 'secondary.main', width: 48, height: 48 }}>\r\n                        <SmartToyIcon />\r\n                    </Avatar>\r\n                    <Box>\r\n                        <Typography variant=\"h6\" fontWeight=\"bold\" sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                            Antigravity AI\r\n                            <Chip label=\"PRO\" size=\"small\" color=\"secondary\" sx={{ fontWeight: 'bold' }} />\r\n                        </Typography>\r\n                        <Typography variant=\"body2\" color=\"text.secondary\">Deep Market Research & Expert Grading</Typography>\r\n                    </Box>\r\n                </Box>\r\n\r\n                {!analysisData && !loading && !rawError && (\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        color=\"secondary\"\r\n                        startIcon={<AutoAwesomeIcon />}\r\n                        onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            handleAnalyze();\r\n                        }}\r\n                        sx={{ borderRadius: 3, textTransform: 'none', fontWeight: 'bold' }}\r\n                    >\r\n                        Analyze Now\r\n                    </Button>\r\n                )}\r\n\r\n                {(analysisData || loading || rawError) && (\r\n                    <Box>\r\n                        {expanded ? <ExpandLessIcon color=\"action\" /> : <ExpandMoreIcon color=\"action\" />}\r\n                    </Box>\r\n                )}\r\n            </Box>\r\n\r\n            {/* Content Area */}\r\n            <Collapse in={expanded}>\r\n                <Divider />\r\n                <Box sx={{ p: 4, minHeight: 200 }}>\r\n                    {loading ? (\r\n                        <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', py: 6, gap: 2 }}>\r\n                            <CircularProgress color=\"secondary\" size={40} />\r\n                            <Typography variant=\"body1\" fontWeight=\"medium\" sx={{ animation: 'pulse 1.5s infinite' }}>\r\n                                Consulting industry experts & analyzing market data...\r\n                            </Typography>\r\n                        </Box>\r\n                    ) : rawError ? (\r\n                        <Alert severity=\"error\" sx={{ borderRadius: 2 }}>{rawError}</Alert>\r\n                    ) : analysisData ? (\r\n                        <Box sx={{ animation: 'fadeIn 0.5s ease-in' }}>\r\n\r\n                            {/* Verdict Banner */}\r\n                            <Paper\r\n                                sx={{\r\n                                    p: 3,\r\n                                    mb: 4,\r\n                                    borderRadius: 3,\r\n                                    bgcolor: analysisData.verdict.decision === 'RECOMMEND' ? '#f0fdf4' : analysisData.verdict.decision === 'DO NOT RECOMMEND' ? '#fef2f2' : '#fffbeb',\r\n                                    border: '1px solid',\r\n                                    borderColor: analysisData.verdict.decision === 'RECOMMEND' ? 'success.light' : analysisData.verdict.decision === 'DO NOT RECOMMEND' ? 'error.light' : 'warning.light',\r\n                                    display: 'flex',\r\n                                    flexDirection: { xs: 'column', md: 'row' },\r\n                                    alignItems: 'center',\r\n                                    gap: 3\r\n                                }}\r\n                            >\r\n                                <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', minWidth: 120 }}>\r\n                                    <Chip\r\n                                        label={analysisData.grading.letterGrade}\r\n                                        sx={{\r\n                                            fontSize: '2.5rem',\r\n                                            height: 64,\r\n                                            width: 64,\r\n                                            borderRadius: '50%',\r\n                                            bgcolor: 'white',\r\n                                            color: getScoreColor(analysisData.grading.totalScore),\r\n                                            fontWeight: '900',\r\n                                            mb: 1,\r\n                                            boxShadow: 2\r\n                                        }}\r\n                                    />\r\n                                    <Typography variant=\"caption\" fontWeight=\"bold\" color=\"text.secondary\">OVERALL</Typography>\r\n                                </Box>\r\n                                <Box sx={{ flex: 1 }}>\r\n                                    <Typography variant=\"h5\" fontWeight=\"900\"\r\n                                        color={analysisData.verdict.decision === 'RECOMMEND' ? 'success.dark' : analysisData.verdict.decision === 'DO NOT RECOMMEND' ? 'error.dark' : 'warning.dark'}\r\n                                        sx={{ mb: 1, textTransform: 'uppercase' }}\r\n                                    >\r\n                                        {analysisData.verdict.decision}\r\n                                    </Typography>\r\n                                    <Typography variant=\"body1\">\r\n                                        {analysisData.verdict.reasoning}\r\n                                    </Typography>\r\n                                </Box>\r\n                            </Paper>\r\n\r\n                            <Grid container spacing={3} sx={{ mb: 4 }}>\r\n                                <Grid size={{ xs: 12, md: 4 }}>{renderScoreCard('Quality & Build', analysisData.grading.quality)}</Grid>\r\n                                <Grid size={{ xs: 12, md: 4 }}>{renderScoreCard('Value for Money', analysisData.grading.value)}</Grid>\r\n                                <Grid size={{ xs: 12, md: 4 }}>{renderScoreCard('User Satisfaction', analysisData.grading.satisfaction)}</Grid>\r\n                            </Grid>\r\n\r\n                            <Box sx={{ mb: 4 }}>\r\n                                <Typography variant=\"h6\" fontWeight=\"bold\" sx={{ mb: 2, display: 'flex', alignItems: 'center', gap: 1 }}><TrendingUpIcon color=\"primary\" /> Market Context</Typography>\r\n                                <Typography variant=\"body2\" sx={{ mb: 1 }}><b>Status:</b> {analysisData.marketStatus}</Typography>\r\n                                <Typography variant=\"body2\"><b>Brand Reputation:</b> {analysisData.brandReputation}</Typography>\r\n                            </Box>\r\n\r\n                            <Grid container spacing={4}>\r\n                                <Grid size={{ xs: 12, md: 6 }}>\r\n                                    <Typography variant=\"h6\" fontWeight=\"bold\" color=\"success.main\" sx={{ mb: 2, display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                                        <ThumbUpIcon fontSize=\"small\" /> Key Strengths\r\n                                    </Typography>\r\n                                    {analysisData.analysis.strengths.map((point, i) => (\r\n                                        <Box key={i} sx={{ display: 'flex', gap: 1.5, mb: 1.5 }}>\r\n                                            <CheckCircleIcon color=\"success\" fontSize=\"small\" sx={{ mt: 0.3 }} />\r\n                                            <Typography variant=\"body2\">{point}</Typography>\r\n                                        </Box>\r\n                                    ))}\r\n                                </Grid>\r\n                                <Grid size={{ xs: 12, md: 6 }}>\r\n                                    <Typography variant=\"h6\" fontWeight=\"bold\" color=\"error.main\" sx={{ mb: 2, display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                                        <ThumbDownIcon fontSize=\"small\" /> Potential Drawbacks\r\n                                    </Typography>\r\n                                    {analysisData.analysis.weaknesses.map((point, i) => (\r\n                                        <Box key={i} sx={{ display: 'flex', gap: 1.5, mb: 1.5 }}>\r\n                                            <CancelIcon color=\"error\" fontSize=\"small\" sx={{ mt: 0.3 }} />\r\n                                            <Typography variant=\"body2\">{point}</Typography>\r\n                                        </Box>\r\n                                    ))}\r\n                                </Grid>\r\n                            </Grid>\r\n\r\n                            <Divider sx={{ my: 4 }} />\r\n\r\n                            <Box>\r\n                                <Typography variant=\"h6\" fontWeight=\"bold\" sx={{ mb: 2, display: 'flex', alignItems: 'center', gap: 1 }}><GavelIcon /> Final Summary</Typography>\r\n                                <Typography variant=\"body1\" paragraph>\r\n                                    {analysisData.analysis.overview}\r\n                                </Typography>\r\n                                <Typography variant=\"body1\" sx={{ fontStyle: 'italic', color: 'text.secondary', bgcolor: 'action.hover', p: 2, borderRadius: 2 }}>\r\n                                    \"{analysisData.analysis.reviewsSummary}\"\r\n                                </Typography>\r\n                            </Box>\r\n\r\n                        </Box>\r\n                    ) : (\r\n                        <Box sx={{ p: 2, textAlign: 'center' }}>\r\n                            <Typography color=\"text.secondary\">\r\n                                Click \"Analyze Now\" to generate a comprehensive report.\r\n                            </Typography>\r\n                        </Box>\r\n                    )}\r\n                </Box>\r\n            </Collapse>\r\n        </Paper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\features\\ProductCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\features\\RecommendationCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'InfoIcon' is defined but never used.","line":7,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AddToCompareButton' is defined but never used.","line":9,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'description' is defined but never used.","line":23,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":40},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":105,"column":25,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[4125,4152],"text":"\r\n                        &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[4125,4152],"text":"\r\n                        &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[4125,4152],"text":"\r\n                        &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[4125,4152],"text":"\r\n                        &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":105,"column":34,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[4160,4183],"text":"&quot;\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[4160,4183],"text":"&ldquo;\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[4160,4183],"text":"&#34;\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[4160,4183],"text":"&rdquo;\r\n                    "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport { Card, CardMedia, CardContent, Typography, Chip, Box, Button, CardActions, Tooltip } from '@mui/material';\r\nimport AutoAwesomeIcon from '@mui/icons-material/AutoAwesome';\r\nimport VerifiedIcon from '@mui/icons-material/Verified';\r\nimport InfoIcon from '@mui/icons-material/Info';\r\nimport { useRouter } from 'next/navigation';\r\nimport AddToCompareButton from '@/components/compare/AddToCompareButton';\r\n\r\ninterface RecommendationCardProps {\r\n    id: string;\r\n    name: string;\r\n    brand: string;\r\n    image: string;\r\n    description: string;\r\n    grade: string;\r\n    reason: string;\r\n    source: 'off' | 'external' | 'ai';\r\n}\r\n\r\nconst RecommendationCard: React.FC<RecommendationCardProps> = ({\r\n    id, name, brand, image, description, grade, reason, source\r\n}) => {\r\n    const router = useRouter();\r\n\r\n    const getGradeColor = (g: string) => {\r\n        const gradeUpper = g?.toUpperCase() || '?';\r\n        if (gradeUpper === 'A' || gradeUpper === 'B') return 'success';\r\n        if (gradeUpper === 'C') return 'warning';\r\n        return 'error';\r\n    };\r\n\r\n    return (\r\n        <Card sx={{\r\n            height: '100%',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            position: 'relative',\r\n            borderRadius: 3,\r\n            border: '1px solid rgba(255, 255, 255, 0.1)',\r\n            background: 'linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.01) 100%)',\r\n            backdropFilter: 'blur(10px)',\r\n            transition: 'transform 0.2s ease-in-out, box-shadow 0.2s',\r\n            '&:hover': {\r\n                transform: 'translateY(-4px)',\r\n                boxShadow: '0 8px 24px rgba(0,0,0,0.2)'\r\n            }\r\n        }}>\r\n            {/* Grade Badge */}\r\n            <Chip\r\n                label={`Grade ${grade?.toUpperCase() || '?'}`}\r\n                color={getGradeColor(grade)}\r\n                size=\"small\"\r\n                sx={{ position: 'absolute', top: 12, right: 12, fontWeight: 'bold', zIndex: 1 }}\r\n            />\r\n\r\n            {/* AI / Source Badge */}\r\n            <Box sx={{ position: 'absolute', top: 12, left: 12, zIndex: 1, display: 'flex', gap: 1 }}>\r\n                {source === 'off' && (\r\n                    <Tooltip title=\"Verified Data from Open Food Facts\">\r\n                        <Chip icon={<VerifiedIcon sx={{ fontSize: 14 }} />} label=\"Verified\" size=\"small\" color=\"info\" sx={{ height: 24 }} />\r\n                    </Tooltip>\r\n                )}\r\n                <Tooltip title={reason}>\r\n                    <Chip\r\n                        icon={<AutoAwesomeIcon sx={{ fontSize: 14 }} />}\r\n                        label=\"AI Pick\"\r\n                        size=\"small\"\r\n                        sx={{\r\n                            height: 24,\r\n                            background: 'linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)',\r\n                            color: 'white',\r\n                            border: 0\r\n                        }}\r\n                    />\r\n                </Tooltip>\r\n            </Box>\r\n\r\n            <CardMedia\r\n                component=\"img\"\r\n                height=\"200\"\r\n                image={image || \"https://placehold.co/400x300?text=No+Image\"}\r\n                alt={name}\r\n                sx={{ objectFit: 'cover' }}\r\n            />\r\n\r\n            <CardContent sx={{ flexGrow: 1, pb: 1 }}>\r\n                <Typography variant=\"overline\" color=\"text.secondary\" sx={{ lineHeight: 1 }}>\r\n                    {brand}\r\n                </Typography>\r\n                <Typography gutterBottom variant=\"h6\" component=\"div\" fontWeight=\"bold\" sx={{ lineHeight: 1.2, mb: 1 }}>\r\n                    {name}\r\n                </Typography>\r\n\r\n                {/* AI Reason Section */}\r\n                <Box sx={{\r\n                    mt: 1.5,\r\n                    p: 1.5,\r\n                    borderRadius: 2,\r\n                    bgcolor: 'rgba(255, 255, 255, 0.05)',\r\n                    borderLeft: '3px solid #FF8E53'\r\n                }}>\r\n                    <Typography variant=\"caption\" color=\"text.secondary\" fontStyle=\"italic\">\r\n                        \"{reason}\"\r\n                    </Typography>\r\n                </Box>\r\n            </CardContent>\r\n\r\n            <CardActions sx={{ p: 2, pt: 0 }}>\r\n                {id.startsWith('ext-') ? (\r\n                    <Button disabled fullWidth variant=\"outlined\" size=\"small\">External Data</Button>\r\n                ) : (\r\n                    <Button\r\n                        size=\"small\"\r\n                        variant=\"contained\"\r\n                        fullWidth\r\n                        sx={{ borderRadius: 2, textTransform: 'none' }}\r\n                        onClick={() => router.push(`/product/${id}`)}\r\n                    >\r\n                        View Details\r\n                    </Button>\r\n                )}\r\n            </CardActions>\r\n        </Card>\r\n    );\r\n};\r\n\r\nexport default RecommendationCard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\features\\RecommendationPairCard.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\features\\RecommendationPairCard.tsx:27:9\n  25 |\n  26 |     useEffect(() => {\n> 27 |         setImgSrc(item.image);\n     |         ^^^^^^^^^ Avoid calling setState() directly within an effect\n  28 |         setImgError(false);\n  29 |     }, [item.image]);\n  30 |","line":27,"column":9,"nodeType":null,"endLine":27,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Box, Typography, Card, Chip } from '@mui/material';\r\nimport CloseIcon from '@mui/icons-material/Close';\r\nimport CheckIcon from '@mui/icons-material/Check';\r\nimport ArrowForwardIosIcon from '@mui/icons-material/ArrowForwardIos';\r\nimport ImageNotSupportedIcon from '@mui/icons-material/ImageNotSupported';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Recommendation } from '@/services/recommendationService';\r\nimport { motion } from 'framer-motion';\r\n\r\ninterface RecommendationPairCardProps {\r\n    rejected: Recommendation;\r\n    recommended: Recommendation;\r\n}\r\n\r\nconst ProductMiniCard = ({ item, type, onClick }: { item: Recommendation, type: 'rejected' | 'recommended', onClick: () => void }) => {\r\n    const isRejected = type === 'rejected';\r\n    const mainColor = isRejected ? '#d32f2f' : '#2e7d32'; // Red vs Green\r\n\r\n    // Manage image state to handle load errors\r\n    const [imgError, setImgError] = useState(false);\r\n    const [imgSrc, setImgSrc] = useState(item.image);\r\n\r\n    useEffect(() => {\r\n        setImgSrc(item.image);\r\n        setImgError(false);\r\n    }, [item.image]);\r\n\r\n    const handleClick = (e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n        if (item.id && (item.id.startsWith('rec-') || item.id.startsWith('rej-'))) {\r\n            window.location.href = `/search?q=${encodeURIComponent(item.name)}`;\r\n        } else {\r\n            onClick();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <motion.div\r\n            whileHover={{\r\n                y: -8,\r\n                transition: { type: \"spring\", stiffness: 300, damping: 20 }\r\n            }}\r\n            whileTap={{ scale: 0.98 }}\r\n            style={{ width: '100%', display: 'flex', flex: 1 }}\r\n        >\r\n            <Box\r\n                onClick={handleClick}\r\n                sx={{\r\n                    flex: 1,\r\n                    p: 3,\r\n                    minHeight: 280,\r\n                    borderRadius: 5,\r\n                    background: isRejected\r\n                        ? 'linear-gradient(180deg, rgba(211, 47, 47, 0.03) 0%, rgba(211, 47, 47, 0.08) 100%)'\r\n                        : 'linear-gradient(180deg, rgba(46, 125, 50, 0.03) 0%, rgba(46, 125, 50, 0.08) 100%)',\r\n                    backdropFilter: 'blur(10px)',\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'space-between',\r\n                    position: 'relative',\r\n                    cursor: 'pointer',\r\n                    border: '1px solid',\r\n                    borderColor: isRejected ? 'rgba(211, 47, 47, 0.08)' : 'rgba(46, 125, 50, 0.08)',\r\n                    transition: 'box-shadow 0.3s ease, border-color 0.3s ease',\r\n                    boxShadow: '0 4px 20px rgba(0,0,0,0.02)',\r\n                    '&:hover': {\r\n                        borderColor: isRejected ? 'rgba(211, 47, 47, 0.3)' : 'rgba(46, 125, 50, 0.3)',\r\n                        boxShadow: `0 15px 35px ${isRejected ? 'rgba(211, 47, 47, 0.15)' : 'rgba(46, 125, 50, 0.15)'}`\r\n                    }\r\n                }}\r\n            >\r\n                {/* Status Icon Badge */}\r\n                <Box sx={{\r\n                    position: 'absolute',\r\n                    top: 12,\r\n                    left: 12,\r\n                    width: 32,\r\n                    height: 32,\r\n                    borderRadius: '50%',\r\n                    background: isRejected\r\n                        ? 'linear-gradient(135deg, #ef5350 0%, #d32f2f 100%)'\r\n                        : 'linear-gradient(135deg, #66bb6a 0%, #2e7d32 100%)',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    color: 'white',\r\n                    boxShadow: '0 4px 10px rgba(0,0,0,0.2)',\r\n                    zIndex: 1\r\n                }}>\r\n                    {isRejected ? <CloseIcon fontSize=\"small\" /> : <CheckIcon fontSize=\"small\" />}\r\n                </Box>\r\n\r\n                {/* Product Image Area */}\r\n                <Box sx={{\r\n                    width: '100%',\r\n                    height: 120,\r\n                    mb: 2,\r\n                    mt: 2,\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    position: 'relative'\r\n                }}>\r\n                    {!imgError && imgSrc ? (\r\n                        <Box\r\n                            component={motion.img}\r\n                            initial={{ scale: 0.9, opacity: 0.8 }}\r\n                            animate={{ scale: 1, opacity: 1 }}\r\n                            transition={{ duration: 0.5 }}\r\n                            src={imgSrc}\r\n                            alt={item.name}\r\n                            onError={() => setImgError(true)}\r\n                            sx={{\r\n                                maxWidth: '100%',\r\n                                maxHeight: '100%',\r\n                                objectFit: 'contain',\r\n                                filter: isRejected ? 'grayscale(0.1) contrast(1.1)' : 'none',\r\n                                dropShadow: '0 8px 16px rgba(0,0,0,0.1)'\r\n                            }}\r\n                        />\r\n                    ) : (\r\n                        <Box sx={{\r\n                            width: 80,\r\n                            height: 80,\r\n                            borderRadius: '50%',\r\n                            bgcolor: isRejected ? 'rgba(211, 47, 47, 0.05)' : 'rgba(46, 125, 50, 0.05)',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            justifyContent: 'center',\r\n                            border: '1px dashed',\r\n                            borderColor: isRejected ? 'rgba(211, 47, 47, 0.2)' : 'rgba(46, 125, 50, 0.2)'\r\n                        }}>\r\n                            <ImageNotSupportedIcon sx={{ fontSize: 24, opacity: 0.5, color: isRejected ? '#d32f2f' : '#2e7d32' }} />\r\n                        </Box>\r\n                    )}\r\n                </Box>\r\n\r\n                {/* Content Container */}\r\n                <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', width: '100%', flex: 1 }}>\r\n                    <Typography\r\n                        variant=\"subtitle1\"\r\n                        align=\"center\"\r\n                        fontWeight=\"700\"\r\n                        sx={{\r\n                            fontSize: '0.95rem',\r\n                            lineHeight: 1.3,\r\n                            mb: 0.5,\r\n                            display: '-webkit-box',\r\n                            WebkitLineClamp: 2,\r\n                            WebkitBoxOrient: 'vertical',\r\n                            overflow: 'hidden',\r\n                            height: 40,\r\n                            color: 'text.primary'\r\n                        }}\r\n                    >\r\n                        {item.name}\r\n                    </Typography>\r\n\r\n                    <Typography variant=\"caption\" color=\"text.secondary\" sx={{ mb: 2, fontSize: '0.75rem', opacity: 0.8 }}>\r\n                        {item.brand}\r\n                    </Typography>\r\n\r\n                    <Chip\r\n                        label={isRejected ? 'Bad Choice' : 'Excellent Choice'}\r\n                        size=\"small\"\r\n                        sx={{\r\n                            mt: 'auto',\r\n                            height: 28,\r\n                            fontWeight: 700,\r\n                            fontSize: '0.75rem',\r\n                            bgcolor: isRejected ? 'rgba(211, 47, 47, 0.08)' : 'rgba(46, 125, 50, 0.08)',\r\n                            color: mainColor,\r\n                            border: '1px solid',\r\n                            borderColor: isRejected ? 'rgba(211, 47, 47, 0.15)' : 'rgba(46, 125, 50, 0.15)',\r\n                            '& .MuiChip-label': { px: 2 }\r\n                        }}\r\n                    />\r\n                </Box>\r\n            </Box>\r\n        </motion.div>\r\n    );\r\n};\r\n\r\nexport default function RecommendationPairCard({ rejected, recommended }: RecommendationPairCardProps) {\r\n    const router = useRouter();\r\n\r\n    return (\r\n        <Card sx={{\r\n            display: 'flex',\r\n            borderRadius: 5,\r\n            overflow: 'visible',\r\n            boxShadow: 'none',\r\n            bgcolor: 'transparent',\r\n            position: 'relative',\r\n            mb: 3\r\n        }}>\r\n            <Box sx={{ display: 'flex', flex: 1, position: 'relative', gap: 2 }}>\r\n                {/* Rejected Column */}\r\n                <ProductMiniCard\r\n                    item={rejected}\r\n                    type=\"rejected\"\r\n                    onClick={() => router.push(`/product/${rejected.id}`)}\r\n                />\r\n\r\n                {/* Visual Separator / Arrow - Animated */}\r\n                <Box sx={{\r\n                    position: 'absolute',\r\n                    top: '50%',\r\n                    left: '50%',\r\n                    transform: 'translate(-50%, -50%)',\r\n                    zIndex: 10,\r\n                    pointerEvents: 'none' // Click through to cards\r\n                }}>\r\n                    <motion.div\r\n                        animate={{\r\n                            boxShadow: [\"0 4px 12px rgba(0,0,0,0.2)\", \"0 4px 20px rgba(255, 142, 83, 0.4)\", \"0 4px 12px rgba(0,0,0,0.2)\"],\r\n                            scale: [1, 1.1, 1]\r\n                        }}\r\n                        transition={{\r\n                            repeat: Infinity,\r\n                            duration: 2,\r\n                            ease: \"easeInOut\"\r\n                        }}\r\n                        style={{\r\n                            width: 40,\r\n                            height: 40,\r\n                            borderRadius: '50%',\r\n                            background: 'linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%)',\r\n                            border: '2px solid rgba(255,255,255,0.1)',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            justifyContent: 'center',\r\n                            color: 'white',\r\n                        }}\r\n                    >\r\n                        <ArrowForwardIosIcon sx={{ fontSize: 16, ml: 0.5, opacity: 0.9 }} />\r\n                    </motion.div>\r\n                </Box>\r\n\r\n                {/* Recommended Column */}\r\n                <ProductMiniCard\r\n                    item={recommended}\r\n                    type=\"recommended\"\r\n                    onClick={() => router.push(`/product/${recommended.id}`)}\r\n                />\r\n            </Box>\r\n        </Card>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\features\\TechScoreDisplay.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tooltip' is defined but never used.","line":4,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":52}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport { Box, Typography, CircularProgress, Tooltip } from '@mui/material';\r\nimport { motion } from 'framer-motion';\r\n\r\ninterface TechScoreDisplayProps {\r\n    score: number;\r\n    loading?: boolean;\r\n}\r\n\r\nexport default function TechScoreDisplay({ score, loading = false }: TechScoreDisplayProps) {\r\n    // Color Logic based on score\r\n    const getColor = (s: number) => {\r\n        if (s >= 90) return '#10B981'; // Emerald (Excellent)\r\n        if (s >= 80) return '#34D399'; // Green (Very Good)\r\n        if (s >= 70) return '#60A5FA'; // Blue (Good)\r\n        if (s >= 50) return '#FBBF24'; // Amber (Average)\r\n        return '#EF4444'; // Red (Poor)\r\n    };\r\n\r\n    const color = getColor(score);\r\n\r\n    return (\r\n        <Box sx={{ position: 'relative', display: 'inline-flex', flexDirection: 'column', alignItems: 'center' }}>\r\n            <Box sx={{ position: 'relative' }}>\r\n                {/* Background Track */}\r\n                <CircularProgress\r\n                    variant=\"determinate\"\r\n                    value={100}\r\n                    size={80}\r\n                    thickness={4}\r\n                    sx={{ color: (theme) => theme.palette.grey[200] }}\r\n                />\r\n\r\n                {/* Animated Progress */}\r\n                <Box sx={{ position: 'absolute', top: 0, left: 0 }}>\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        transition={{ duration: 0.5 }}\r\n                    >\r\n                        <CircularProgress\r\n                            variant={loading ? \"indeterminate\" : \"determinate\"}\r\n                            value={loading ? undefined : score}\r\n                            size={80}\r\n                            thickness={4}\r\n                            sx={{\r\n                                color: color,\r\n                                strokeLinecap: 'round',\r\n                                filter: `drop-shadow(0 0 6px ${color})`\r\n                            }}\r\n                        />\r\n                    </motion.div>\r\n                </Box>\r\n\r\n                {/* Center Text */}\r\n                <Box\r\n                    sx={{\r\n                        top: 0,\r\n                        left: 0,\r\n                        bottom: 0,\r\n                        right: 0,\r\n                        position: 'absolute',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                    }}\r\n                >\r\n                    <Typography\r\n                        variant=\"h5\"\r\n                        component=\"div\"\r\n                        fontWeight=\"900\"\r\n                        color=\"text.primary\"\r\n                    >\r\n                        {loading ? '...' : score}\r\n                    </Typography>\r\n                </Box>\r\n            </Box>\r\n\r\n            <Typography variant=\"caption\" sx={{ mt: 1, fontWeight: 'bold', color: color, textTransform: 'uppercase', letterSpacing: 1 }}>\r\n                Antigravity Score\r\n            </Typography>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\features\\support\\ChatWindow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\layout\\ChatButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\layout\\Footer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":6,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RecommendIcon' is defined but never used.","line":9,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'QrCodeScannerIcon' is defined but never used.","line":10,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'HistoryIcon' is defined but never used.","line":11,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SearchIcon' is defined but never used.","line":12,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'HomeIcon' is defined but never used.","line":13,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'motion' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'pathname' is assigned a value but never used.","line":17,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport React from 'react';\r\nimport Box from '@mui/material/Box';\r\nimport Typography from '@mui/material/Typography';\r\nimport Container from '@mui/material/Container';\r\nimport Link from 'next/link';\r\nimport { usePathname } from 'next/navigation';\r\nimport { Button } from '@mui/material';\r\nimport RecommendIcon from '@mui/icons-material/Recommend';\r\nimport QrCodeScannerIcon from '@mui/icons-material/QrCodeScanner';\r\nimport HistoryIcon from '@mui/icons-material/History';\r\nimport SearchIcon from '@mui/icons-material/Search';\r\nimport HomeIcon from '@mui/icons-material/Home';\r\nimport { motion } from 'framer-motion';\r\n\r\nconst Footer = () => {\r\n    const pathname = usePathname();\r\n\r\n    return (\r\n        <Box\r\n            component=\"footer\"\r\n            sx={{\r\n                py: { xs: 2.5, md: 3 },\r\n                px: { xs: 2, md: 3 },\r\n                mt: 'auto',\r\n                backgroundColor: 'background.paper',\r\n                borderTop: '1px solid',\r\n                borderColor: 'divider',\r\n                // Ensure footer doesn't overlap with mobile navigation\r\n                pb: { xs: 2, md: 3 },\r\n                // Improve visibility\r\n                boxShadow: '0 -1px 3px rgba(0,0,0,0.05)',\r\n            }}\r\n        >\r\n            <Container maxWidth=\"lg\">\r\n                <Box\r\n                    sx={{\r\n                        display: 'flex',\r\n                        flexDirection: { xs: 'column', md: 'row' },\r\n                        justifyContent: { xs: 'center', md: 'space-between' },\r\n                        alignItems: 'center',\r\n                        gap: { xs: 1, md: 2 }\r\n                    }}\r\n                >\r\n                    <Typography\r\n                        variant=\"body2\"\r\n                        color=\"text.secondary\"\r\n                        textAlign={{ xs: 'center', md: 'left' }}\r\n                        sx={{\r\n                            fontSize: { xs: '0.75rem', md: '0.875rem' },\r\n                            opacity: { xs: 0.7, md: 0.8 }\r\n                        }}\r\n                    >\r\n                        ┬⌐ {new Date().getFullYear()} TruthLens. All rights reserved.\r\n                    </Typography>\r\n\r\n                    {/* Navigation links - REMOVED as per user request */}\r\n                    <Box sx={{ display: 'none' }} />\r\n                </Box>\r\n            </Container>\r\n        </Box>\r\n    );\r\n};\r\n\r\nexport default Footer;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\layout\\MobileBottomNav.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'HomeIcon' is defined but never used.","line":6,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnimatePresence' is defined but never used.","line":14,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Paper, BottomNavigation, BottomNavigationAction, Box, Fab } from '@mui/material';\r\nimport HomeIcon from '@mui/icons-material/Home';\r\nimport SearchIcon from '@mui/icons-material/Search';\r\nimport HistoryIcon from '@mui/icons-material/History';\r\nimport QrCodeScannerIcon from '@mui/icons-material/QrCodeScanner';\r\nimport RecommendIcon from '@mui/icons-material/Recommend';\r\nimport PersonIcon from '@mui/icons-material/Person';\r\nimport { useRouter, usePathname } from 'next/navigation';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\nexport default function MobileBottomNav() {\r\n    const router = useRouter();\r\n    const pathname = usePathname();\r\n    const { user } = useAuth();\r\n    const [value, setValue] = useState(pathname);\r\n\r\n    useEffect(() => {\r\n        setValue(pathname);\r\n    }, [pathname]);\r\n\r\n    if (!user) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <React.Fragment>\r\n            {/* FAB for Scan - Floating Center */}\r\n            <Box\r\n                sx={{\r\n                    position: 'fixed',\r\n                    bottom: 30,\r\n                    left: '50%',\r\n                    transform: 'translateX(-50%)',\r\n                    zIndex: 1002,\r\n                    display: { xs: 'block', md: 'none' }\r\n                }}\r\n            >\r\n                <Fab\r\n                    color=\"primary\"\r\n                    aria-label=\"scan\"\r\n                    onClick={() => router.push('/scan')}\r\n                    sx={{\r\n                        width: 64,\r\n                        height: 64,\r\n                        background: 'linear-gradient(135deg, #6C63FF 0%, #00F0FF 100%)',\r\n                        boxShadow: '0 8px 32px rgba(108, 99, 255, 0.4)',\r\n                        '&:hover': {\r\n                            transform: 'scale(1.05)',\r\n                        },\r\n                        transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',\r\n                    }}\r\n                >\r\n                    <QrCodeScannerIcon sx={{ fontSize: 32 }} />\r\n                </Fab>\r\n            </Box>\r\n\r\n            <Box\r\n                component={motion.div}\r\n                initial={{ y: 100 }}\r\n                animate={{ y: 0 }}\r\n                transition={{ type: 'spring', damping: 20, stiffness: 300 }}\r\n                sx={{\r\n                    display: { xs: 'block', md: 'none' },\r\n                    position: 'fixed',\r\n                    bottom: 16,\r\n                    left: 16,\r\n                    right: 16,\r\n                    zIndex: 1000\r\n                }}\r\n            >\r\n                <Paper\r\n                    elevation={0}\r\n                    sx={{\r\n                        borderRadius: 4,\r\n                        overflow: 'hidden',\r\n                        background: 'rgba(20, 20, 20, 0.85)',\r\n                        backdropFilter: 'blur(20px)',\r\n                        border: '1px solid rgba(255, 255, 255, 0.08)',\r\n                        boxShadow: '0 10px 40px rgba(0,0,0,0.5)',\r\n                    }}\r\n                >\r\n                    <BottomNavigation\r\n                        showLabels={false}\r\n                        value={value}\r\n                        onChange={(event, newValue) => {\r\n                            if (newValue !== '/scan') { // Scan handled by FAB\r\n                                setValue(newValue);\r\n                                router.push(newValue);\r\n                            }\r\n                        }}\r\n                        sx={{\r\n                            bgcolor: 'transparent',\r\n                            height: 65,\r\n                            '& .MuiBottomNavigationAction-root': {\r\n                                color: 'rgba(255,255,255,0.4)',\r\n                                padding: '6px 0',\r\n                                minWidth: 'auto',\r\n                                '&.Mui-selected': {\r\n                                    color: 'secondary.main',\r\n                                },\r\n                            },\r\n                        }}\r\n                    >\r\n                        <BottomNavigationAction label=\"Search\" value=\"/search\" icon={<SearchIcon />} />\r\n                        <BottomNavigationAction label=\"History\" value=\"/history\" icon={<HistoryIcon />} />\r\n                        <BottomNavigationAction label=\"Scan\" value=\"/scan\" sx={{ opacity: 0, pointerEvents: 'none' }} /> {/* Spacer for FAB */}\r\n                        <BottomNavigationAction label=\"Picks\" value=\"/recommendations\" icon={<RecommendIcon />} />\r\n                        <BottomNavigationAction label=\"Profile\" value=\"/profile\" icon={<PersonIcon />} />\r\n                    </BottomNavigation>\r\n                </Paper>\r\n            </Box>\r\n        </React.Fragment>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\layout\\Navbar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Chip' is defined but never used.","line":8,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isPro' is assigned a value but never used.","line":46,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport React, { useState } from 'react';\r\nimport AppBar from '@mui/material/AppBar';\r\nimport Toolbar from '@mui/material/Toolbar';\r\nimport Typography from '@mui/material/Typography';\r\nimport Button from '@mui/material/Button';\r\nimport Box from '@mui/material/Box';\r\nimport Chip from '@mui/material/Chip';\r\nimport AdminPanelSettingsIcon from '@mui/icons-material/AdminPanelSettings';\r\nimport Link from 'next/link';\r\nimport { usePathname, useRouter } from 'next/navigation';\r\nimport { motion } from 'framer-motion';\r\nimport StarIcon from '@mui/icons-material/Star';\r\nimport SearchIcon from '@mui/icons-material/Search';\r\nimport HistoryIcon from '@mui/icons-material/History';\r\nimport RecommendIcon from '@mui/icons-material/Recommend';\r\nimport PersonIcon from '@mui/icons-material/Person';\r\nimport NotificationsIcon from '@mui/icons-material/Notifications';\r\nimport Badge from '@mui/material/Badge';\r\nimport IconButton from '@mui/material/IconButton';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { listenForUnreadForUser } from '@/services/supportService';\r\n\r\nimport { useEffect } from 'react';\r\nimport ThemeToggle from '@/components/theme/ThemeToggle';\r\nimport ThemeCustomizer from '@/components/theme/ThemeCustomizer';\r\nimport TierBadge from '@/components/subscription/TierBadge';\r\n\r\nconst userPages = [\r\n    { name: 'Search', path: '/search', icon: SearchIcon },\r\n    { name: 'History', path: '/history', icon: HistoryIcon },\r\n    { name: 'Recommendations', path: '/recommendations', icon: RecommendIcon },\r\n    { name: 'Profile', path: '/profile', icon: PersonIcon },\r\n];\r\n\r\nconst adminPages = [\r\n    { name: 'Admin Dashboard', path: '/admin', icon: AdminPanelSettingsIcon },\r\n    { name: 'Profile', path: '/profile', icon: PersonIcon },\r\n];\r\n\r\nimport UserNotificationsMenu from './UserNotificationsMenu';\r\n\r\nconst Navbar = () => {\r\n    const pathname = usePathname();\r\n    const router = useRouter();\r\n    const { isPro, isFree, user, tier } = useAuth();\r\n    const [customizerOpen, setCustomizerOpen] = useState(false);\r\n    const [unreadCount, setUnreadCount] = useState(0);\r\n    const [notificationAnchor, setNotificationAnchor] = useState<null | HTMLElement>(null);\r\n\r\n    useEffect(() => {\r\n        if (!user) return;\r\n\r\n        // Listen for support messages\r\n        const unsubscribeSupport = listenForUnreadForUser(user.uid, (supportCount) => {\r\n            // Also fetch notifications count (simplest way is to fetch once, or set interval, or REAL TIME listener if added)\r\n            // For now, let's just use supportCount + 0, but ideally we want `getUserNotifications` count.\r\n            // Let's do a quick fetch of notifications to add to the badge count.\r\n            // Or better, make `UserNotificationsMenu` fetch on mount, but Navbar needs the count always.\r\n            // We'll update this simply to load basic notifications count.\r\n\r\n            // TODO: Add realtime listener for notifications collection too if heavy traffic.\r\n            // For now, we will just use the support count or if user opens menu it updates.\r\n            // BETTER: Let's fetch the unread count from notifications collection here too.\r\n            import('@/services/accessRequestService').then(({ getUserNotifications }) => {\r\n                getUserNotifications(user.uid).then(notifs => {\r\n                    const notifCount = notifs.filter(n => !n.read).length;\r\n                    setUnreadCount(supportCount + notifCount);\r\n                });\r\n            });\r\n        });\r\n        return () => unsubscribeSupport();\r\n    }, [user, notificationAnchor]); // Re-fetch when menu closes/opens in case read status changed\r\n\r\n    // Determine if user is admin based on role\r\n    // Note: 'user' object from context should have 'role' property if fetching full profile\r\n    // If usage of 'user' here is from Firebase Auth User object, it might not have 'role' directly on top level\r\n    // unless mapped. Let's assume 'user' here is the UserContext object which usually mixes both or we check the profile.\r\n    // Looking at useAuth usage elsewhere, 'user' is often User | null. \r\n    // Types might need verification. \r\n    // In `app/profile/page.tsx`: const { user, userProfile ... } = useAuth();\r\n    // In `services/subscriptionService.ts`: `UserProfile` has `role`.\r\n    // Let's assume `user` from `useAuth` might be just Firebase User. \r\n    // We should use `userProfile` if available or check `user['role']` if we extended it.\r\n    // Let's use `userProfile` from `useAuth` if available.\r\n    // Checking `Navbar` again... it destructures `{ isPro, isFree, user, tier }`.\r\n    // I should check if `userProfile` is available from `useAuth`.\r\n    // If not, I might need to rely on `user.email` (bad) or assume `user` has custom claims? \r\n    // Let's check `context/AuthContext.tsx`.\r\n\r\n    // Assuming for now I can get `userProfile` or checking if `tier === 'admin'`? No, tier is 'free'|'plus'...\r\n    // Let's look at `AuthContext`.\r\n\r\n    // TEMPORARY ASSUMPTION: I need to check `AuthContext` to be sure.\r\n    // But I will proceed with rendering logic assuming I can access `isAdmin`.\r\n    // I will use `userProfile?.role === 'admin'` if `userProfile` is there.\r\n    // If `Navbar` doesn't have `userProfile`, I'll add it to destructuring.\r\n\r\n    const { userProfile } = useAuth();\r\n    const isAdmin = userProfile?.role === 'admin';\r\n\r\n    const pages = isAdmin ? adminPages : userPages;\r\n\r\n    return (\r\n        <AppBar position=\"sticky\" sx={{ bgcolor: 'rgba(0,0,0,0.8)', backdropFilter: 'blur(10px)' }}>\r\n            <Toolbar>\r\n                <Typography variant=\"h6\" component=\"div\" sx={{ flexGrow: 1, fontWeight: 'bold', background: 'linear-gradient(45deg, #6C63FF, #00F0FF)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}>\r\n                    TruthLens\r\n                </Typography>\r\n                <Box sx={{ display: { xs: 'none', md: 'flex' }, gap: 2, alignItems: 'center' }}>\r\n                    {user && (\r\n                        <>\r\n                            {pages.map((page) => {\r\n                                const Icon = page.icon;\r\n                                return (\r\n                                    <Link key={page.name} href={page.path} passHref style={{ textDecoration: 'none' }}>\r\n                                        <Button\r\n                                            component={motion.button}\r\n                                            whileHover={{ scale: 1.05 }}\r\n                                            whileTap={{ scale: 0.95 }}\r\n                                            startIcon={<Icon />}\r\n                                            sx={{\r\n                                                color: pathname.startsWith(page.path) && page.path !== '/profile' ? 'secondary.main' : (pathname === page.path ? 'secondary.main' : 'text.primary'),\r\n                                                // Handle /admin matching /admin/dashboard\r\n                                                fontWeight: pathname.startsWith(page.path) && page.path !== '/profile' ? 'bold' : 'normal',\r\n                                            }}\r\n                                        >\r\n                                            {page.name}\r\n                                        </Button>\r\n                                    </Link>\r\n                                );\r\n                            })}\r\n\r\n                            {/* Upgrade Button - Hide for Admin */}\r\n                            {!isAdmin && isFree && (\r\n                                <Button\r\n                                    variant=\"contained\"\r\n                                    color=\"warning\"\r\n                                    size=\"small\"\r\n                                    startIcon={<StarIcon />}\r\n                                    onClick={() => router.push('/upgrade')}\r\n                                    sx={{\r\n                                        fontWeight: 'bold',\r\n                                        background: 'linear-gradient(45deg, #FFD700 30%, #FF8C00 90%)',\r\n                                        boxShadow: '0 3px 5px 2px rgba(255, 105, 135, .3)',\r\n                                    }}\r\n                                >\r\n                                    Upgrade\r\n                                </Button>\r\n                            )}\r\n\r\n                            {/* Tier Badge - Hide for Admin since they see 'Admin' dashboard? Or keep it? \r\n                                User asked \"futures only for users\". Tier badge is kind of a user feature status.\r\n                                Let's hide it for Admin to be cleaner.\r\n                            */}\r\n                            {!isAdmin && !isFree && (\r\n                                <TierBadge tier={tier} size=\"small\" />\r\n                            )}\r\n\r\n                            {/* Theme Toggle */}\r\n                            <ThemeToggle onOpenCustomizer={() => setCustomizerOpen(true)} />\r\n\r\n\r\n\r\n                            {/* Notification Icon */}\r\n                            <IconButton\r\n                                color=\"inherit\"\r\n                                onClick={(e) => setNotificationAnchor(e.currentTarget)}\r\n                                sx={{ ml: 1 }}\r\n                            >\r\n                                <Badge badgeContent={unreadCount} color=\"error\">\r\n                                    <NotificationsIcon />\r\n                                </Badge>\r\n                            </IconButton>\r\n\r\n                            <UserNotificationsMenu\r\n                                anchorEl={notificationAnchor}\r\n                                open={Boolean(notificationAnchor)}\r\n                                onClose={() => setNotificationAnchor(null)}\r\n                            />\r\n                        </>\r\n                    )}\r\n                </Box>\r\n            </Toolbar>\r\n\r\n            {/* Theme Customizer Drawer */}\r\n            <ThemeCustomizer\r\n                open={customizerOpen}\r\n                onClose={() => setCustomizerOpen(false)}\r\n            />\r\n        </AppBar>\r\n    );\r\n};\r\n\r\nexport default Navbar;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\layout\\UserNotificationsMenu.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MenuItem' is defined but never used.","line":2,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":24},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadNotifications` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\layout\\UserNotificationsMenu.tsx:51:13\n  49 |     useEffect(() => {\n  50 |         if (open && user) {\n> 51 |             loadNotifications();\n     |             ^^^^^^^^^^^^^^^^^ `loadNotifications` accessed before it is declared\n  52 |         }\n  53 |     }, [open, user]);\n  54 |\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\layout\\UserNotificationsMenu.tsx:55:5\n  53 |     }, [open, user]);\n  54 |\n> 55 |     const loadNotifications = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 56 |         if (!user) return;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 57 |         try {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 58 |             const data = await getUserNotifications(user.uid);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 59 |             setNotifications(data);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 60 |         } catch (err) {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 61 |             console.error('Error loading notifications:', err);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 62 |         }\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 63 |     };\n     | ^^^^^^^ `loadNotifications` is declared here\n  64 |\n  65 |     const handleItemClick = async (notif: UserNotification) => {\n  66 |         if (!notif.read && user) {","line":51,"column":13,"nodeType":null,"endLine":51,"endColumn":30},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadNotifications'. Either include it or remove the dependency array.","line":53,"column":8,"nodeType":"ArrayExpression","endLine":53,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [loadNotifications, open, user]","fix":{"range":[2085,2097],"text":"[loadNotifications, open, user]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Menu, MenuItem, ListItemText, Typography, Box, Badge, Divider, List, ListItemAvatar, Avatar, ListItemButton } from '@mui/material';\r\nimport { useRouter } from 'next/navigation';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport CancelIcon from '@mui/icons-material/Cancel';\r\nimport WarningIcon from '@mui/icons-material/Warning';\r\nimport MessageIcon from '@mui/icons-material/Message';\r\nimport NotificationsIcon from '@mui/icons-material/Notifications';\r\nimport CircleIcon from '@mui/icons-material/Circle';\r\nimport AccessTimeIcon from '@mui/icons-material/AccessTime';\r\nimport { getUserNotifications, markNotificationRead } from '@/services/accessRequestService';\r\nimport { UserNotification } from '@/types/accessRequest';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { Timestamp } from 'firebase/firestore';\r\n\r\n// Helper for relative time\r\nconst getTimeAgo = (date: Date) => {\r\n    const seconds = Math.floor((new Date().getTime() - date.getTime()) / 1000);\r\n\r\n    let interval = seconds / 31536000;\r\n    if (interval > 1) return Math.floor(interval) + \"y ago\";\r\n\r\n    interval = seconds / 2592000;\r\n    if (interval > 1) return Math.floor(interval) + \"mo ago\";\r\n\r\n    interval = seconds / 86400;\r\n    if (interval > 1) return Math.floor(interval) + \"d ago\";\r\n\r\n    interval = seconds / 3600;\r\n    if (interval > 1) return Math.floor(interval) + \"h ago\";\r\n\r\n    interval = seconds / 60;\r\n    if (interval > 1) return Math.floor(interval) + \"m ago\";\r\n\r\n    return Math.floor(seconds) + \"s ago\";\r\n};\r\n\r\ninterface UserNotificationsMenuProps {\r\n    anchorEl: null | HTMLElement;\r\n    open: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport default function UserNotificationsMenu({ anchorEl, open, onClose }: UserNotificationsMenuProps) {\r\n    const { user } = useAuth();\r\n    const router = useRouter();\r\n    const [notifications, setNotifications] = useState<UserNotification[]>([]);\r\n\r\n    useEffect(() => {\r\n        if (open && user) {\r\n            loadNotifications();\r\n        }\r\n    }, [open, user]);\r\n\r\n    const loadNotifications = async () => {\r\n        if (!user) return;\r\n        try {\r\n            const data = await getUserNotifications(user.uid);\r\n            setNotifications(data);\r\n        } catch (err) {\r\n            console.error('Error loading notifications:', err);\r\n        }\r\n    };\r\n\r\n    const handleItemClick = async (notif: UserNotification) => {\r\n        if (!notif.read && user) {\r\n            await markNotificationRead(user.uid, notif.id);\r\n            // Optimistic update\r\n            setNotifications(prev => prev.map(n => n.id === notif.id ? { ...n, read: true } : n));\r\n        }\r\n\r\n        // Navigate if applicable (could link to profile or support)\r\n        // For now, most link to /profile where full history is shown, or remain on page.\r\n        // Let's close and maybe navigate to profile/notifications if they want to see more details?\r\n        // Or just close.\r\n        onClose();\r\n    };\r\n\r\n    const getIcon = (type: UserNotification['type']) => {\r\n        switch (type) {\r\n            case 'access_approved': return <CheckCircleIcon />;\r\n            case 'access_denied': return <CancelIcon />;\r\n            case 'access_expiring': return <WarningIcon />;\r\n            case 'support_message': return <MessageIcon />;\r\n            default: return <NotificationsIcon />;\r\n        }\r\n    };\r\n\r\n    const getColor = (type: UserNotification['type']) => {\r\n        switch (type) {\r\n            case 'access_approved': return 'success.main';\r\n            case 'access_denied': return 'error.main';\r\n            case 'access_expiring': return 'warning.main';\r\n            case 'support_message': return 'info.main';\r\n            default: return 'primary.main';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Menu\r\n            anchorEl={anchorEl}\r\n            open={open}\r\n            onClose={onClose}\r\n            PaperProps={{\r\n                elevation: 0,\r\n                sx: {\r\n                    overflow: 'visible',\r\n                    filter: 'drop-shadow(0px 2px 8px rgba(0,0,0,0.32))',\r\n                    mt: 1.5,\r\n                    width: 360,\r\n                    maxHeight: 500,\r\n                    borderRadius: 3,\r\n                    bgcolor: '#1E1E1E', // Dark mode background\r\n                    color: 'white',\r\n                    border: '1px solid rgba(255,255,255,0.1)',\r\n                },\r\n            }}\r\n            transformOrigin={{ horizontal: 'right', vertical: 'top' }}\r\n            anchorOrigin={{ horizontal: 'right', vertical: 'bottom' }}\r\n        >\r\n            <Box sx={{ p: 2, pb: 1, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                <Typography variant=\"h6\" fontWeight=\"bold\">Notifications</Typography>\r\n                {notifications.filter(n => !n.read).length > 0 && (\r\n                    <Badge badgeContent={notifications.filter(n => !n.read).length} color=\"error\" max={99} />\r\n                )}\r\n            </Box>\r\n            <Divider sx={{ borderColor: 'rgba(255,255,255,0.1)' }} />\r\n\r\n            <List sx={{ p: 0 }}>\r\n                {notifications.length === 0 ? (\r\n                    <Box sx={{ p: 4, textAlign: 'center', opacity: 0.6 }}>\r\n                        <AccessTimeIcon sx={{ fontSize: 40, mb: 1, opacity: 0.5 }} />\r\n                        <Typography variant=\"body2\">No notifications yet</Typography>\r\n                    </Box>\r\n                ) : (\r\n                    notifications.map((notif) => (\r\n                        <ListItemButton\r\n                            key={notif.id}\r\n                            onClick={() => handleItemClick(notif)}\r\n                            alignItems=\"flex-start\"\r\n                            sx={{\r\n                                py: 2,\r\n                                borderBottom: '1px solid rgba(255,255,255,0.05)',\r\n                                bgcolor: notif.read ? 'transparent' : 'rgba(255,255,255,0.02)',\r\n                                '&:hover': { bgcolor: 'rgba(255,255,255,0.05)' }\r\n                            }}\r\n                        >\r\n                            <ListItemAvatar>\r\n                                <Avatar sx={{\r\n                                    bgcolor: getColor(notif.type),\r\n                                    color: 'white'\r\n                                }}>\r\n                                    {getIcon(notif.type)}\r\n                                </Avatar>\r\n                            </ListItemAvatar>\r\n                            <ListItemText\r\n                                primary={\r\n                                    <Box sx={{ display: 'flex', justifyContent: 'space-between' }}>\r\n                                        <Typography variant=\"subtitle2\" component=\"span\" fontWeight={notif.read ? 'normal' : 'bold'}>\r\n                                            {notif.title}\r\n                                        </Typography>\r\n                                        <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                            {getTimeAgo(notif.createdAt instanceof Timestamp ? notif.createdAt.toDate() : new Date(notif.createdAt))}\r\n                                        </Typography>\r\n                                    </Box>\r\n                                }\r\n                                secondary={\r\n                                    <React.Fragment>\r\n                                        <Typography\r\n                                            sx={{ display: 'block', mt: 0.5 }}\r\n                                            component=\"span\"\r\n                                            variant=\"body2\"\r\n                                            color={notif.read ? \"text.secondary\" : \"text.primary\"}\r\n                                            noWrap\r\n                                        >\r\n                                            {notif.message}\r\n                                        </Typography>\r\n                                        {!notif.read && (\r\n                                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 0.5, mt: 0.5 }}>\r\n                                                <CircleIcon sx={{ fontSize: 8, color: '#2196F3' }} />\r\n                                                <Typography variant=\"caption\" color=\"#2196F3\" fontWeight=\"bold\">New</Typography>\r\n                                            </Box>\r\n                                        )}\r\n                                    </React.Fragment>\r\n                                }\r\n                            />\r\n                        </ListItemButton>\r\n                    ))\r\n                )}\r\n            </List>\r\n\r\n            {notifications.length > 0 && (\r\n                <Box sx={{ p: 1, borderTop: '1px solid rgba(255,255,255,0.1)', textAlign: 'center' }}>\r\n                    <Typography variant=\"caption\" color=\"primary\" sx={{ cursor: 'pointer' }} onClick={() => router.push('/profile')}>\r\n                        View all in Profile\r\n                    </Typography>\r\n                </Box>\r\n            )}\r\n        </Menu>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\pc-builder\\BuildGeneratingView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\pc-builder\\consultation\\ConsultationForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1591,1594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1591,1594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2721,2724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2721,2724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport {\r\n    Box,\r\n    Paper,\r\n    Typography,\r\n    TextField,\r\n    Button,\r\n    Grid,\r\n    CircularProgress,\r\n    Alert,\r\n    MenuItem,\r\n    Chip,\r\n    InputAdornment\r\n} from '@mui/material';\r\nimport SaveIcon from '@mui/icons-material/Save';\r\nimport { doc, setDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { db } from '@/lib/firebase';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { PCBuildFormData } from '@/types/pcBuilder';\r\n\r\ninterface ConsultationFormProps {\r\n    existingData?: PCBuildFormData;\r\n    onSuccess: () => void;\r\n}\r\n\r\nconst COUNTRIES = ['USA', 'UK', 'Canada', 'Germany', 'France', 'Australia', 'Other'];\r\nconst USAGE_TYPES = ['Gaming', 'Workstation', 'Streaming', 'Programming', 'Video Editing', '3D Rendering', 'General Home Use'];\r\nconst RESOLUTIONS = ['1080p (FHD)', '1440p (2K)', '4K (UHD)', 'Ultrawide'];\r\n\r\nexport default function ConsultationForm({ existingData, onSuccess }: ConsultationFormProps) {\r\n    const { user } = useAuth();\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const [formData, setFormData] = useState<PCBuildFormData>(existingData || {\r\n        budget: 1500,\r\n        currency: 'USD',\r\n        country: 'USA',\r\n        usage: 'Gaming',\r\n        preferences: '',\r\n        monitors: 1,\r\n        resolution: '1440p (2K)',\r\n        peripherals: []\r\n    });\r\n\r\n    const [peripheralInput, setPeripheralInput] = useState('');\r\n\r\n    const handleChange = (field: keyof PCBuildFormData, value: any) => {\r\n        setFormData(prev => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    const handleAddPeripheral = () => {\r\n        if (peripheralInput.trim()) {\r\n            setFormData(prev => ({\r\n                ...prev,\r\n                peripherals: [...prev.peripherals, peripheralInput.trim()]\r\n            }));\r\n            setPeripheralInput('');\r\n        }\r\n    };\r\n\r\n    const removePeripheral = (idx: number) => {\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            peripherals: prev.peripherals.filter((_, i) => i !== idx)\r\n        }));\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!user) return;\r\n\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const ref = doc(db, 'pc_build_requests', user.uid);\r\n            // Updating the document created by Stripe webhook/verification\r\n            await setDoc(ref, {\r\n                formData,\r\n                status: 'submitted',\r\n                updatedAt: serverTimestamp()\r\n            }, { merge: true });\r\n\r\n            onSuccess();\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            setError('Failed to submit form. Please try again.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Paper elevation={0} sx={{ p: 4, borderRadius: 4, border: '1px solid', borderColor: 'divider' }}>\r\n            <Typography variant=\"h5\" fontWeight=\"bold\" gutterBottom>\r\n                PC Requirement Details\r\n            </Typography>\r\n            <Typography color=\"text.secondary\" sx={{ mb: 4 }}>\r\n                Please provide as much detail as possible so we can build the perfect rig for you.\r\n            </Typography>\r\n\r\n            <form onSubmit={handleSubmit}>\r\n                <Grid container spacing={3}>\r\n                    <Grid size={{ xs: 12, sm: 6 }}>\r\n                        <TextField\r\n                            fullWidth\r\n                            label=\"Budget\"\r\n                            type=\"number\"\r\n                            value={formData.budget}\r\n                            onChange={(e) => handleChange('budget', Number(e.target.value))}\r\n                            InputProps={{\r\n                                startAdornment: <InputAdornment position=\"start\">{formData.currency === 'USD' ? '$' : 'Γé¼'}</InputAdornment>,\r\n                            }}\r\n                        />\r\n                    </Grid>\r\n                    <Grid size={{ xs: 12, sm: 6 }}>\r\n                        <TextField\r\n                            fullWidth\r\n                            select\r\n                            label=\"Country\"\r\n                            value={formData.country}\r\n                            onChange={(e) => handleChange('country', e.target.value)}\r\n                        >\r\n                            {COUNTRIES.map(c => <MenuItem key={c} value={c}>{c}</MenuItem>)}\r\n                        </TextField>\r\n                    </Grid>\r\n\r\n                    <Grid size={{ xs: 12 }}>\r\n                        <TextField\r\n                            fullWidth\r\n                            select\r\n                            label=\"Primary Usage\"\r\n                            value={formData.usage}\r\n                            onChange={(e) => handleChange('usage', e.target.value)}\r\n                        >\r\n                            {USAGE_TYPES.map(u => <MenuItem key={u} value={u}>{u}</MenuItem>)}\r\n                        </TextField>\r\n                    </Grid>\r\n\r\n                    <Grid size={{ xs: 12, sm: 6 }}>\r\n                        <TextField\r\n                            fullWidth\r\n                            type=\"number\"\r\n                            label=\"Number of Monitors\"\r\n                            value={formData.monitors}\r\n                            onChange={(e) => handleChange('monitors', Number(e.target.value))}\r\n                        />\r\n                    </Grid>\r\n                    <Grid size={{ xs: 12, sm: 6 }}>\r\n                        <TextField\r\n                            fullWidth\r\n                            select\r\n                            label=\"Target Resolution\"\r\n                            value={formData.resolution}\r\n                            onChange={(e) => handleChange('resolution', e.target.value)}\r\n                        >\r\n                            {RESOLUTIONS.map(r => <MenuItem key={r} value={r}>{r}</MenuItem>)}\r\n                        </TextField>\r\n                    </Grid>\r\n\r\n                    <Grid size={{ xs: 12 }}>\r\n                        <Typography variant=\"subtitle2\" gutterBottom>Peripherals Needed</Typography>\r\n                        <Box sx={{ display: 'flex', gap: 1, mb: 1, flexWrap: 'wrap' }}>\r\n                            {formData.peripherals.map((p, i) => (\r\n                                <Chip key={i} label={p} onDelete={() => removePeripheral(i)} />\r\n                            ))}\r\n                        </Box>\r\n                        <Box sx={{ display: 'flex', gap: 1 }}>\r\n                            <TextField\r\n                                size=\"small\"\r\n                                fullWidth\r\n                                placeholder=\"e.g., Gaming Mouse, Mechanical Keyboard\"\r\n                                value={peripheralInput}\r\n                                onChange={(e) => setPeripheralInput(e.target.value)}\r\n                            />\r\n                            <Button variant=\"outlined\" onClick={handleAddPeripheral}>Add</Button>\r\n                        </Box>\r\n                    </Grid>\r\n\r\n                    <Grid size={{ xs: 12 }}>\r\n                        <TextField\r\n                            fullWidth\r\n                            multiline\r\n                            rows={4}\r\n                            label=\"Additional Preferences\"\r\n                            placeholder=\"Any specific brands, colors (e.g. White build), size constraints, or specific games you play?\"\r\n                            value={formData.preferences}\r\n                            onChange={(e) => handleChange('preferences', e.target.value)}\r\n                        />\r\n                    </Grid>\r\n\r\n                    {error && (\r\n                        <Grid size={{ xs: 12 }}>\r\n                            <Alert severity=\"error\">{error}</Alert>\r\n                        </Grid>\r\n                    )}\r\n\r\n                    <Grid size={{ xs: 12 }}>\r\n                        <Button\r\n                            type=\"submit\"\r\n                            variant=\"contained\"\r\n                            size=\"large\"\r\n                            fullWidth\r\n                            disabled={loading}\r\n                            startIcon={loading ? <CircularProgress size={20} color=\"inherit\" /> : <SaveIcon />}\r\n                            sx={{\r\n                                py: 1.5,\r\n                                fontSize: '1.1rem',\r\n                                background: 'linear-gradient(45deg, #6C63FF 30%, #00F0FF 90%)',\r\n                            }}\r\n                        >\r\n                            {loading ? 'Submitting...' : 'Submit Request'}\r\n                        </Button>\r\n                    </Grid>\r\n                </Grid>\r\n            </form>\r\n        </Paper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\pc-builder\\consultation\\ConsultationIntro.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1569,1572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1569,1572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n    Box,\r\n    Paper,\r\n    Typography,\r\n    Button,\r\n    List,\r\n    ListItem,\r\n    ListItemIcon,\r\n    ListItemText,\r\n    CircularProgress,\r\n    Alert,\r\n    Chip\r\n} from '@mui/material';\r\nimport CheckCircleOutlineIcon from '@mui/icons-material/CheckCircleOutline';\r\nimport VerifiedIcon from '@mui/icons-material/Verified';\r\nimport PaymentIcon from '@mui/icons-material/Payment';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { createConsultationCheckout } from '@/app/actions/stripe';\r\nimport { getSystemSettings } from '@/services/systemService';\r\n\r\nexport default function ConsultationIntro() {\r\n    const { user } = useAuth();\r\n    const [loading, setLoading] = useState(false);\r\n    const [price, setPrice] = useState<number>(2000); // Default 2000 cents\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        getSystemSettings().then(settings => {\r\n            if (settings.pcConsultationPrice) {\r\n                setPrice(settings.pcConsultationPrice);\r\n            }\r\n        });\r\n    }, []);\r\n\r\n    const handlePay = async () => {\r\n        if (!user || !user.email) return;\r\n        setLoading(true);\r\n        setError(null);\r\n        try {\r\n            const result = await createConsultationCheckout(user.uid, user.email);\r\n            if (result.url) {\r\n                window.location.href = result.url;\r\n            } else {\r\n                throw new Error('No checkout URL returned');\r\n            }\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            setError(err.message || 'Payment initiation failed');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const formattedPrice = (price / 100).toLocaleString('en-US', {\r\n        style: 'currency',\r\n        currency: 'USD'\r\n    });\r\n\r\n    return (\r\n        <Paper\r\n            elevation={0}\r\n            sx={{\r\n                p: 4,\r\n                borderRadius: 4,\r\n                border: '1px solid',\r\n                borderColor: 'divider',\r\n                background: 'linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(59, 130, 246, 0.05) 100%)',\r\n                textAlign: 'center',\r\n                maxWidth: 600,\r\n                mx: 'auto'\r\n            }}\r\n        >\r\n            <VerifiedIcon sx={{ fontSize: 60, color: '#10B981', mb: 2 }} />\r\n            <Typography variant=\"h5\" fontWeight=\"bold\" gutterBottom>\r\n                Expert PC Build Consultation\r\n            </Typography>\r\n            <Typography color=\"text.secondary\" sx={{ mb: 3 }}>\r\n                Get a custom, hand-picked PC configuration designed specifically for your needs by our hardware experts.\r\n            </Typography>\r\n\r\n            <List sx={{ textAlign: 'left', mb: 4, bgcolor: 'background.paper', borderRadius: 2, p: 2 }}>\r\n                {[\r\n                    'Personalized parts selection based on your budget and goals',\r\n                    'Compatibility verification and bottleneck checks',\r\n                    'Local availability and pricing optimization',\r\n                    'Direct video guides and assembly tips included'\r\n                ].map((text, i) => (\r\n                    <ListItem key={i} disablePadding sx={{ mb: 1.5 }}>\r\n                        <ListItemIcon sx={{ minWidth: 36, color: '#10B981' }}>\r\n                            <CheckCircleOutlineIcon />\r\n                        </ListItemIcon>\r\n                        <ListItemText primary={text} />\r\n                    </ListItem>\r\n                ))}\r\n            </List>\r\n\r\n            <Box sx={{ mb: 4, display: 'flex', justifyContent: 'center', gap: 1 }}>\r\n                <Chip label={`Service Fee: ${formattedPrice}`} color=\"primary\" variant=\"outlined\" sx={{ fontWeight: 'bold' }} />\r\n            </Box>\r\n\r\n            {error && (\r\n                <Alert severity=\"error\" sx={{ mb: 3 }}>\r\n                    {error}\r\n                </Alert>\r\n            )}\r\n\r\n            <Button\r\n                variant=\"contained\"\r\n                size=\"large\"\r\n                fullWidth\r\n                startIcon={loading ? <CircularProgress size={20} color=\"inherit\" /> : <PaymentIcon />}\r\n                onClick={handlePay}\r\n                disabled={loading}\r\n                sx={{\r\n                    py: 2,\r\n                    fontSize: '1.2rem',\r\n                    fontWeight: 'bold',\r\n                    background: 'linear-gradient(45deg, #10B981 30%, #3B82F6 90%)',\r\n                    boxShadow: '0 4px 14px 0 rgba(16, 185, 129, 0.39)',\r\n                }}\r\n            >\r\n                {loading ? 'Processing...' : `Agree & Pay ${formattedPrice}`}\r\n            </Button>\r\n            <Typography variant=\"caption\" color=\"text.secondary\" sx={{ display: 'block', mt: 2 }}>\r\n                Secure payment via Stripe. Fully refundable if we cannot meet your request.\r\n            </Typography>\r\n        </Paper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\pc-builder\\consultation\\ConsultationStatus.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Divider' is defined but never used.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":10,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":11},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":76,"column":27,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2647,2700],"text":"\r\n                    Expert&apos;s Note\r\n                "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2647,2700],"text":"\r\n                    Expert&lsquo;s Note\r\n                "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2647,2700],"text":"\r\n                    Expert&#39;s Note\r\n                "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2647,2700],"text":"\r\n                    Expert&rsquo;s Note\r\n                "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport {\r\n    Box,\r\n    Paper,\r\n    Typography,\r\n    Chip,\r\n    Divider,\r\n    Button,\r\n    List,\r\n    ListItem,\r\n    ListItemIcon,\r\n    ListItemText,\r\n    Link,\r\n    Alert\r\n} from '@mui/material';\r\nimport PendingIcon from '@mui/icons-material/Pending';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport YouTubeIcon from '@mui/icons-material/YouTube';\r\nimport LinkIcon from '@mui/icons-material/Link';\r\nimport HardwareIcon from '@mui/icons-material/Memory';\r\nimport { PCBuildRequest } from '@/types/pcBuilder';\r\n\r\ninterface ConsultationStatusProps {\r\n    request: PCBuildRequest;\r\n}\r\n\r\nexport default function ConsultationStatus({ request }: ConsultationStatusProps) {\r\n    const isCompleted = request.status === 'completed' && request.adminResponse;\r\n\r\n    if (!isCompleted) {\r\n        return (\r\n            <Paper\r\n                elevation={0}\r\n                sx={{\r\n                    p: 5,\r\n                    textAlign: 'center',\r\n                    borderRadius: 4,\r\n                    border: '1px solid',\r\n                    borderColor: 'divider',\r\n                    bgcolor: 'background.paper',\r\n                }}\r\n            >\r\n                <PendingIcon sx={{ fontSize: 60, color: 'warning.main', mb: 2 }} />\r\n                <Typography variant=\"h5\" fontWeight=\"bold\" gutterBottom>\r\n                    Request Submitted\r\n                </Typography>\r\n                <Typography color=\"text.secondary\" sx={{ mb: 3, maxWidth: 500, mx: 'auto' }}>\r\n                    An admin is reviewing your request. You will receive your custom PC build configuration here soon.\r\n                </Typography>\r\n                <Chip\r\n                    label=\"Status: Pending Review\"\r\n                    color=\"warning\"\r\n                    variant=\"outlined\"\r\n                    sx={{ fontWeight: 'bold' }}\r\n                />\r\n            </Paper>\r\n        );\r\n    }\r\n\r\n    const { components, adminNotes, youtubeLink, purchaseLinks } = request.adminResponse!;\r\n\r\n    return (\r\n        <Box>\r\n            <Alert severity=\"success\" icon={<CheckCircleIcon fontSize=\"inherit\" />} sx={{ mb: 4, borderRadius: 2 }}>\r\n                <Typography variant=\"subtitle1\" fontWeight=\"bold\">\r\n                    Your Expert Build is Ready!\r\n                </Typography>\r\n                Review the components and advice below.\r\n            </Alert>\r\n\r\n            {/* Admin Note */}\r\n            <Paper elevation={0} sx={{ p: 3, mb: 3, borderRadius: 3, border: '1px solid', borderColor: 'divider' }}>\r\n                <Typography variant=\"h6\" fontWeight=\"bold\" gutterBottom>\r\n                    Expert's Note\r\n                </Typography>\r\n                <Typography variant=\"body1\" sx={{ whiteSpace: 'pre-line', color: 'text.secondary' }}>\r\n                    {adminNotes}\r\n                </Typography>\r\n            </Paper>\r\n\r\n            {/* Components List */}\r\n            <Paper elevation={0} sx={{ p: 0, mb: 3, borderRadius: 3, border: '1px solid', borderColor: 'divider', overflow: 'hidden' }}>\r\n                <Box sx={{ p: 2, bgcolor: 'action.hover', borderBottom: '1px solid', borderColor: 'divider' }}>\r\n                    <Typography variant=\"h6\" fontWeight=\"bold\">\r\n                        Component List\r\n                    </Typography>\r\n                </Box>\r\n                <List disablePadding>\r\n                    {components.map((comp, i) => (\r\n                        <ListItem key={i} divider={i < components.length - 1} sx={{ p: 2 }}>\r\n                            <ListItemIcon>\r\n                                <HardwareIcon color=\"primary\" />\r\n                            </ListItemIcon>\r\n                            <ListItemText\r\n                                primary={\r\n                                    <Box component=\"span\" sx={{ fontWeight: 'bold' }}>\r\n                                        {comp.brand} {comp.name}\r\n                                    </Box>\r\n                                }\r\n                                secondary={\r\n                                    <Box component=\"span\" sx={{ display: 'block', mt: 0.5 }}>\r\n                                        <Typography variant=\"caption\" component=\"span\" sx={{ bgcolor: 'action.selected', px: 1, py: 0.5, borderRadius: 1, mr: 1 }}>\r\n                                            {comp.type.toUpperCase()}\r\n                                        </Typography>\r\n                                        {Object.entries(comp.specifications).map(([k, v]) => (\r\n                                            <Typography key={k} variant=\"caption\" color=\"text.secondary\" sx={{ mr: 1 }}>\r\n                                                {k}: {v}\r\n                                            </Typography>\r\n                                        ))}\r\n                                    </Box>\r\n                                }\r\n                            />\r\n                            {comp.price && (\r\n                                <Typography variant=\"subtitle1\" fontWeight=\"bold\">\r\n                                    ${comp.price.toLocaleString()}\r\n                                </Typography>\r\n                            )}\r\n                        </ListItem>\r\n                    ))}\r\n                </List>\r\n            </Paper>\r\n\r\n            {/* Resources & Videos */}\r\n            <Box sx={{ display: 'flex', gap: 3, flexWrap: 'wrap' }}>\r\n                {youtubeLink && (\r\n                    <Paper elevation={0} sx={{ flex: 1, p: 3, borderRadius: 3, border: '1px solid', borderColor: 'divider' }}>\r\n                        <Typography variant=\"h6\" fontWeight=\"bold\" gutterBottom sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                            <YouTubeIcon color=\"error\" /> Recommended Video\r\n                        </Typography>\r\n                        <List dense>\r\n                            <ListItem>\r\n                                <Link href={youtubeLink} target=\"_blank\" rel=\"noopener\" sx={{ wordBreak: 'break-all' }}>\r\n                                    {youtubeLink}\r\n                                </Link>\r\n                            </ListItem>\r\n                        </List>\r\n                    </Paper>\r\n                )}\r\n\r\n                {purchaseLinks && purchaseLinks.length > 0 && (\r\n                    <Paper elevation={0} sx={{ flex: 1, p: 3, borderRadius: 3, border: '1px solid', borderColor: 'divider' }}>\r\n                        <Typography variant=\"h6\" fontWeight=\"bold\" gutterBottom sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                            <LinkIcon color=\"primary\" /> Useful Links\r\n                        </Typography>\r\n                        <List dense>\r\n                            {purchaseLinks.map((link, i) => (\r\n                                <ListItem key={i}>\r\n                                    <Link href={link} target=\"_blank\" rel=\"noopener\" sx={{ wordBreak: 'break-all' }}>\r\n                                        {link}\r\n                                    </Link>\r\n                                </ListItem>\r\n                            ))}\r\n                        </List>\r\n                    </Paper>\r\n                )}\r\n            </Box>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\product\\AITruthDetector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\profile\\LocationSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\profile\\NotificationsSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Alert' is defined but never used.","line":6,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":63},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\profile\\NotificationsSection.tsx:39:9\n  37 |\n  38 |     useEffect(() => {\n> 39 |         loadNotifications();\n     |         ^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  40 |     }, [user]);\n  41 |\n  42 |     const handleMarkRead = async (notifId: string) => {","line":39,"column":9,"nodeType":null,"endLine":39,"endColumn":26},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadNotifications'. Either include it or remove the dependency array.","line":40,"column":8,"nodeType":"ArrayExpression","endLine":40,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadNotifications, user]","fix":{"range":[1623,1629],"text":"[loadNotifications, user]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n    Box, Typography, Paper, List, ListItem, ListItemText, ListItemIcon,\r\n    IconButton, Badge, Chip, CircularProgress, Collapse, Alert\r\n} from '@mui/material';\r\nimport NotificationsIcon from '@mui/icons-material/Notifications';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport CancelIcon from '@mui/icons-material/Cancel';\r\nimport WarningIcon from '@mui/icons-material/Warning';\r\nimport MessageIcon from '@mui/icons-material/Message';\r\nimport MarkEmailReadIcon from '@mui/icons-material/MarkEmailRead';\r\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\r\nimport ExpandLessIcon from '@mui/icons-material/ExpandLess';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { getUserNotifications, markNotificationRead } from '@/services/accessRequestService';\r\nimport { UserNotification } from '@/types/accessRequest';\r\n\r\nexport default function NotificationsSection() {\r\n    const { user } = useAuth();\r\n    const [notifications, setNotifications] = useState<UserNotification[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [expanded, setExpanded] = useState(true);\r\n\r\n    const loadNotifications = async () => {\r\n        if (!user) return;\r\n        setLoading(true);\r\n        try {\r\n            const data = await getUserNotifications(user.uid);\r\n            setNotifications(data);\r\n        } catch (err) {\r\n            console.error('Error loading notifications:', err);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadNotifications();\r\n    }, [user]);\r\n\r\n    const handleMarkRead = async (notifId: string) => {\r\n        if (!user) return;\r\n        await markNotificationRead(user.uid, notifId);\r\n        setNotifications(prev =>\r\n            prev.map(n => n.id === notifId ? { ...n, read: true } : n)\r\n        );\r\n    };\r\n\r\n    const unreadCount = notifications.filter(n => !n.read).length;\r\n\r\n    const getIcon = (type: UserNotification['type']) => {\r\n        switch (type) {\r\n            case 'access_approved': return <CheckCircleIcon color=\"success\" />;\r\n            case 'access_denied': return <CancelIcon color=\"error\" />;\r\n            case 'access_expiring': return <WarningIcon color=\"warning\" />;\r\n            case 'support_message': return <MessageIcon color=\"info\" />;\r\n            default: return <NotificationsIcon />;\r\n        }\r\n    };\r\n\r\n    const getColor = (type: UserNotification['type']) => {\r\n        switch (type) {\r\n            case 'access_approved': return 'success.light';\r\n            case 'access_denied': return 'error.light';\r\n            case 'access_expiring': return 'warning.light';\r\n            default: return 'info.light';\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <Paper sx={{ p: 3, mb: 3 }}>\r\n                <Box sx={{ display: 'flex', justifyContent: 'center' }}>\r\n                    <CircularProgress size={24} />\r\n                </Box>\r\n            </Paper>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Paper sx={{ mb: 3, overflow: 'hidden' }}>\r\n            <Box\r\n                sx={{\r\n                    p: 2,\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'space-between',\r\n                    bgcolor: 'background.default',\r\n                    cursor: 'pointer'\r\n                }}\r\n                onClick={() => setExpanded(!expanded)}\r\n            >\r\n                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                    <Badge badgeContent={unreadCount} color=\"error\">\r\n                        <NotificationsIcon />\r\n                    </Badge>\r\n                    <Typography variant=\"subtitle1\" fontWeight=\"bold\">\r\n                        Notifications\r\n                    </Typography>\r\n                </Box>\r\n                <IconButton size=\"small\">\r\n                    {expanded ? <ExpandLessIcon /> : <ExpandMoreIcon />}\r\n                </IconButton>\r\n            </Box>\r\n\r\n            <Collapse in={expanded}>\r\n                {notifications.length === 0 ? (\r\n                    <Box sx={{ p: 3, textAlign: 'center' }}>\r\n                        <Typography color=\"text.secondary\">No notifications yet</Typography>\r\n                    </Box>\r\n                ) : (\r\n                    <List disablePadding>\r\n                        {notifications.map((notif) => (\r\n                            <ListItem\r\n                                key={notif.id}\r\n                                sx={{\r\n                                    bgcolor: notif.read ? 'transparent' : 'action.hover',\r\n                                    borderLeft: `4px solid`,\r\n                                    borderLeftColor: getColor(notif.type)\r\n                                }}\r\n                                secondaryAction={\r\n                                    !notif.read && (\r\n                                        <IconButton\r\n                                            size=\"small\"\r\n                                            onClick={() => handleMarkRead(notif.id)}\r\n                                            title=\"Mark as read\"\r\n                                        >\r\n                                            <MarkEmailReadIcon fontSize=\"small\" />\r\n                                        </IconButton>\r\n                                    )\r\n                                }\r\n                            >\r\n                                <ListItemIcon sx={{ minWidth: 40 }}>\r\n                                    {getIcon(notif.type)}\r\n                                </ListItemIcon>\r\n                                <ListItemText\r\n                                    primary={\r\n                                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                                            <Typography variant=\"body2\" fontWeight={notif.read ? 'normal' : 'bold'}>\r\n                                                {notif.title}\r\n                                            </Typography>\r\n                                            {notif.metadata?.tier && (\r\n                                                <Chip\r\n                                                    label={notif.metadata.tier.toUpperCase()}\r\n                                                    size=\"small\"\r\n                                                    color=\"primary\"\r\n                                                />\r\n                                            )}\r\n                                        </Box>\r\n                                    }\r\n                                    secondary={\r\n                                        <Box>\r\n                                            <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                                {notif.message}\r\n                                            </Typography>\r\n                                            <Typography variant=\"caption\" display=\"block\" color=\"text.disabled\">\r\n                                                {new Date(notif.createdAt).toLocaleDateString()}\r\n                                            </Typography>\r\n                                        </Box>\r\n                                    }\r\n                                />\r\n                            </ListItem>\r\n                        ))}\r\n                    </List>\r\n                )}\r\n            </Collapse>\r\n        </Paper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\providers\\I18nProvider.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":9,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userProfile' is assigned a value but never used.","line":9,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i18n' is assigned a value but never used.","line":10,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { ReactNode, useEffect } from 'react';\r\nimport '@/lib/i18n'; // Import to ensure side-effects run\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nexport function I18nProvider({ children }: { children: ReactNode }) {\r\n    const { user, userProfile } = useAuth();\r\n    const { i18n } = useTranslation();\r\n\r\n    useEffect(() => {\r\n        // Fallback or initialization logic if needed, but removing specific user profile sync\r\n        // Assuming default i18n initialization is enough\r\n    }, []);\r\n\r\n    return <>{children}</>;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\pwa\\InstallPrompt.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Download' is defined but never used.","line":5,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[323,326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[323,326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\pwa\\InstallPrompt.tsx:19:9\n  17 |         const isIosDevice = /iphone|ipad|ipod/.test(userAgent) ||\n  18 |             (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1); // iPadOS 13+\n> 19 |         setIsIOS(isIosDevice);\n     |         ^^^^^^^^ Avoid calling setState() directly within an effect\n  20 |\n  21 |         // Check Persistence (1 Week Cooldown)\n  22 |         const checkPersistence = () => {","line":19,"column":9,"nodeType":null,"endLine":19,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1618,1621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1618,1621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2465,2468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2465,2468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":113,"column":29,"nodeType":"JSXOpeningElement","endLine":117,"endColumn":31}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { X, Download } from 'lucide-react';\r\nimport { usePathname } from 'next/navigation';\r\n\r\nexport default function InstallPrompt() {\r\n    const [deferredPrompt, setDeferredPrompt] = useState<any>(null);\r\n    const [isVisible, setIsVisible] = useState(false);\r\n    const [isIOS, setIsIOS] = useState(false);\r\n    const pathname = usePathname();\r\n\r\n    useEffect(() => {\r\n        // Robust iOS/iPadOS detection\r\n        const userAgent = window.navigator.userAgent.toLowerCase();\r\n        const isIosDevice = /iphone|ipad|ipod/.test(userAgent) ||\r\n            (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1); // iPadOS 13+\r\n        setIsIOS(isIosDevice);\r\n\r\n        // Check Persistence (1 Week Cooldown)\r\n        const checkPersistence = () => {\r\n            const isInstalled = localStorage.getItem('pwa_installed') === 'true';\r\n            if (isInstalled) return false;\r\n\r\n            const dismissedAt = localStorage.getItem('pwa_dismissed_at');\r\n            if (dismissedAt) {\r\n                const diff = Date.now() - parseInt(dismissedAt, 10);\r\n                const ONE_WEEK = 7 * 24 * 60 * 60 * 1000;\r\n                if (diff < ONE_WEEK) {\r\n                    return false; // Still in cooldown\r\n                }\r\n            }\r\n            return true;\r\n        };\r\n\r\n        const shouldShow = checkPersistence();\r\n        if (!shouldShow) return;\r\n\r\n        // Capture the event (Android/Desktop Chrome)\r\n        const handleBeforeInstallPrompt = (e: any) => {\r\n            e.preventDefault();\r\n            setDeferredPrompt(e);\r\n\r\n            // Check if already installed\r\n            const isInstalled = window.matchMedia('(display-mode: standalone)').matches;\r\n            if (!isInstalled) {\r\n                // Show prompt after a delay\r\n                setTimeout(() => setIsVisible(true), 3000);\r\n            }\r\n        };\r\n\r\n        const handleAppInstalled = () => {\r\n            localStorage.setItem('pwa_installed', 'true');\r\n            setIsVisible(false);\r\n        };\r\n\r\n        window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n        window.addEventListener('appinstalled', handleAppInstalled);\r\n\r\n        // iOS Logic\r\n        if (isIosDevice) {\r\n            // Check if installed (standalone mode)\r\n            const isInstalled = (window.navigator as any).standalone === true;\r\n            if (!isInstalled && shouldShow) {\r\n                setTimeout(() => setIsVisible(true), 3000);\r\n            }\r\n        }\r\n\r\n        return () => {\r\n            window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n            window.removeEventListener('appinstalled', handleAppInstalled);\r\n        };\r\n    }, []);\r\n\r\n    const handleInstallClick = async () => {\r\n        if (!deferredPrompt) return;\r\n\r\n        deferredPrompt.prompt();\r\n        const { outcome } = await deferredPrompt.userChoice;\r\n\r\n        if (outcome === 'accepted') {\r\n            setDeferredPrompt(null);\r\n            setIsVisible(false);\r\n            localStorage.setItem('pwa_installed', 'true');\r\n        }\r\n    };\r\n\r\n    const handleDismiss = () => {\r\n        setIsVisible(false);\r\n        // Save dismissal time\r\n        localStorage.setItem('pwa_dismissed_at', Date.now().toString());\r\n    };\r\n\r\n    if (!isVisible || pathname === '/install-guide') return null;\r\n\r\n    return (\r\n        <AnimatePresence>\r\n            {isVisible && (\r\n                <motion.div\r\n                    initial={{ y: 200, opacity: 0 }}\r\n                    animate={{ y: 0, opacity: 1 }}\r\n                    exit={{ y: 200, opacity: 0 }}\r\n                    transition={{ type: 'spring', damping: 25, stiffness: 300 }}\r\n                    className=\"fixed bottom-0 left-0 right-0 z-[99999] p-4 flex justify-center pointer-events-none\"\r\n                >\r\n                    <div className=\"bg-[#121212] border border-white/10 rounded-2xl p-4 shadow-[0_8px_32px_rgba(0,0,0,0.8)] flex items-start gap-4 backdrop-blur-xl w-full max-w-md pointer-events-auto relative overflow-hidden\">\r\n                        {/* Background Gradient Mesh */}\r\n                        <div className=\"absolute top-0 right-0 w-32 h-32 bg-cyan-500/10 blur-[50px] rounded-full pointer-events-none\" />\r\n                        <div className=\"absolute bottom-0 left-0 w-32 h-32 bg-purple-500/10 blur-[50px] rounded-full pointer-events-none\" />\r\n\r\n                        <div className=\"shrink-0 relative z-10\">\r\n                            <img\r\n                                src=\"/icons/icon-192x192.png\"\r\n                                alt=\"App Icon\"\r\n                                className=\"w-12 h-12 rounded-xl shadow-lg\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"flex-1 min-w-0 pt-1 relative z-10\">\r\n                            <h3 className=\"font-bold text-white text-base\">Install TruthLens</h3>\r\n                            <p className=\"text-sm text-gray-400 mt-0.5 leading-snug\">\r\n                                {isIOS\r\n                                    ? \"Install specifically for iOS/iPad for the best experience.\"\r\n                                    : \"Add to your home screen for instant access.\"}\r\n                            </p>\r\n\r\n                            {isIOS ? (\r\n                                <>\r\n                                    <div className=\"mt-3 flex gap-2\">\r\n                                        <button\r\n                                            onClick={() => window.location.href = '/install-guide'}\r\n                                            className=\"flex-1 bg-white/10 hover:bg-white/20 text-white text-xs font-medium py-2 px-3 rounded-lg transition-colors border border-white/10\"\r\n                                        >\r\n                                            View Guide with Pictures\r\n                                        </button>\r\n                                    </div>\r\n                                    <div className=\"mt-3 text-sm text-gray-300 bg-white/5 p-2 rounded-lg border border-white/5\">\r\n                                        <div className=\"flex items-center gap-2 mb-1\">\r\n                                            1. Tap the <span className='mx-1 inline-flex items-center justify-center bg-white/10 w-6 h-6 rounded'><ShareIcon className=\"w-3 h-3\" /></span> button in your browser/toolbar\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            2. Select <span className='font-bold text-white'>Add to Home Screen</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </>\r\n                            ) : (\r\n                                <button\r\n                                    onClick={handleInstallClick}\r\n                                    className=\"mt-3 w-full bg-gradient-to-r from-[#6C63FF] to-[#00F0FF] text-white text-sm font-bold px-4 py-2.5 rounded-lg hover:shadow-[0_0_20px_rgba(0,240,255,0.3)] active:scale-95 transition-all shadow-md\"\r\n                                >\r\n                                    Install App\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={handleDismiss}\r\n                            className=\"p-2 -mr-2 -mt-2 text-gray-500 hover:text-white transition-colors relative z-10\"\r\n                        >\r\n                            <X className=\"w-5 h-5\" />\r\n                        </button>\r\n                    </div>\r\n                </motion.div>\r\n            )}\r\n        </AnimatePresence>\r\n    );\r\n}\r\n\r\n// Simple Share Icon for iOS instructions\r\nconst ShareIcon = ({ className }: { className?: string }) => (\r\n    <svg\r\n        viewBox=\"0 0 24 24\"\r\n        fill=\"none\"\r\n        stroke=\"currentColor\"\r\n        strokeWidth=\"2\"\r\n        strokeLinecap=\"round\"\r\n        strokeLinejoin=\"round\"\r\n        className={className}\r\n    >\r\n        <path d=\"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8\" />\r\n        <polyline points=\"16 6 12 2 8 6\" />\r\n        <line x1=\"12\" y1=\"2\" x2=\"12\" y2=\"15\" />\r\n    </svg>\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\scanner\\Html5QrcodePlugin.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[478,481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[478,481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hasPermission' is assigned a value but never used.","line":25,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":25},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":78,"column":21,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":78,"endColumn":34,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[2644,2657],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'errorMessage' is defined but never used.","line":85,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3122,3125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3122,3125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\scanner\\Html5QrcodePlugin.tsx:100:9\n   98 |\n   99 |     useEffect(() => {\n> 100 |         log(\"Mounting...\");\n      |         ^^^ Avoid calling setState() directly within an effect\n  101 |         const html5QrCode = new Html5Qrcode(qrcodeRegionId);\n  102 |         scannerRef.current = html5QrCode;\n  103 |","line":100,"column":9,"nodeType":null,"endLine":100,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'startScanner'. Either include it or remove the dependency array.","line":119,"column":8,"nodeType":"ArrayExpression","endLine":119,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [startScanner]","fix":{"range":[4017,4019],"text":"[startScanner]"}}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { Html5Qrcode, Html5QrcodeSupportedFormats } from \"html5-qrcode\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { Box, Typography, Button } from \"@mui/material\";\r\n\r\nconst qrcodeRegionId = \"html5qr-code-full-region\";\r\n\r\ninterface Html5QrcodePluginProps {\r\n    fps?: number;\r\n    qrbox?: number;\r\n    aspectRatio?: number;\r\n    disableFlip?: boolean;\r\n    verbose?: boolean;\r\n    qrCodeSuccessCallback: (decodedText: string, decodedResult: any) => void;\r\n    qrCodeErrorCallback?: (errorMessage: string) => void;\r\n}\r\n\r\nexport default function Html5QrcodePlugin(props: Html5QrcodePluginProps) {\r\n\r\n    // State\r\n    const scannerRef = useRef<Html5Qrcode | null>(null);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [debugLog, setDebugLog] = useState<string[]>([]); // New Debug Log\r\n    const [hasPermission, setHasPermission] = useState(false);\r\n\r\n    const log = (msg: string) => {\r\n        console.log(`[Scanner] ${msg}`);\r\n        setDebugLog(prev => [msg, ...prev].slice(0, 5)); // Keep last 5 logs\r\n    };\r\n\r\n    // Configuration\r\n    const config = {\r\n        fps: props.fps || 15,\r\n        qrbox: {\r\n            width: Math.min(typeof window !== 'undefined' ? window.innerWidth * 0.8 : 300, 350),\r\n            height: 200\r\n        },\r\n        disableFlip: props.disableFlip || false,\r\n        // DISABLED experimental feature to rule out \"Black Screen\" bug on some Androids\r\n        // experimentalFeatures: {\r\n        //    useBarCodeDetectorIfSupported: true\r\n        // },\r\n        formatsToSupport: [\r\n            Html5QrcodeSupportedFormats.EAN_13,\r\n            Html5QrcodeSupportedFormats.EAN_8,\r\n            Html5QrcodeSupportedFormats.UPC_A,\r\n            Html5QrcodeSupportedFormats.UPC_E,\r\n            Html5QrcodeSupportedFormats.CODE_128,\r\n            Html5QrcodeSupportedFormats.CODE_39,\r\n            Html5QrcodeSupportedFormats.QR_CODE\r\n        ]\r\n    };\r\n\r\n    const startScanner = async () => {\r\n        if (!scannerRef.current) {\r\n            log(\"Scanner ref is null\");\r\n            return;\r\n        }\r\n\r\n        log(\"Starting scanner...\");\r\n\r\n        // Check for HTTPS\r\n        if (typeof window !== \"undefined\" && !window.isSecureContext) {\r\n            const msg = \"HTTPS Required. Camera blocked on HTTP.\";\r\n            setError(msg);\r\n            log(msg);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setError(null);\r\n            log(\"Requesting cameras...\");\r\n            // Use environment camera\r\n            await scannerRef.current.start(\r\n                {\r\n                    facingMode: \"environment\",\r\n                    // @ts-ignore\r\n                    focusMode: \"continuous\"\r\n                },\r\n                config,\r\n                (decodedText, decodedResult) => {\r\n                    props.qrCodeSuccessCallback(decodedText, decodedResult);\r\n                },\r\n                (errorMessage) => {\r\n                    // ignore frame errors\r\n                }\r\n            );\r\n            log(\"Camera started successfully\");\r\n            setHasPermission(true);\r\n        } catch (err: any) {\r\n            console.error(\"Error starting camera:\", err);\r\n            const errMsg = err?.message || \"Unknown Error\";\r\n            log(`Start failed: ${errMsg}`);\r\n            setError(`Camera Error: ${errMsg}`);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        log(\"Mounting...\");\r\n        const html5QrCode = new Html5Qrcode(qrcodeRegionId);\r\n        scannerRef.current = html5QrCode;\r\n\r\n        const timer = setTimeout(() => {\r\n            startScanner();\r\n        }, 500);\r\n\r\n        return () => {\r\n            log(\"Unmounting...\");\r\n            clearTimeout(timer);\r\n            if (html5QrCode.isScanning) {\r\n                html5QrCode.stop().then(() => {\r\n                    html5QrCode.clear();\r\n                }).catch(err => console.error(\"Error stopping scanner\", err));\r\n            } else {\r\n                html5QrCode.clear();\r\n            }\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <Box\r\n            id={qrcodeRegionId}\r\n            sx={{\r\n                width: '100%',\r\n                height: '100%',\r\n                position: 'relative',\r\n                bgcolor: 'black',\r\n                '& video': {\r\n                    objectFit: 'cover',\r\n                    height: '100% !important',\r\n                    width: '100% !important',\r\n                    borderRadius: '0 !important'\r\n                }\r\n            }}\r\n        >\r\n            {/* Debug Overlay - Temporary for troubleshooting */}\r\n            <Box sx={{\r\n                position: 'absolute',\r\n                top: 0,\r\n                left: 0,\r\n                width: '100%',\r\n                bgcolor: 'rgba(0,0,0,0.5)',\r\n                color: '#0f0',\r\n                fontSize: '10px',\r\n                fontFamily: 'monospace',\r\n                p: 1,\r\n                zIndex: 9999,\r\n                pointerEvents: 'none'\r\n            }}>\r\n                {debugLog.map((l, i) => <div key={i}>{l}</div>)}\r\n            </Box>\r\n\r\n            {error && (\r\n                <Box sx={{\r\n                    position: 'absolute',\r\n                    top: '50%',\r\n                    left: '50%',\r\n                    transform: 'translate(-50%, -50%)',\r\n                    textAlign: 'center',\r\n                    color: 'white',\r\n                    width: '80%',\r\n                    zIndex: 20\r\n                }}>\r\n                    <Typography color=\"error\" variant=\"h6\" gutterBottom>\r\n                        {error}\r\n                    </Typography>\r\n\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        onClick={startScanner}\r\n                        sx={{ mt: 2 }}\r\n                    >\r\n                        Force Start Camera\r\n                    </Button>\r\n                </Box>\r\n            )}\r\n        </Box>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\scanner\\ScanBarcode.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Scan' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Upload' is defined but never used.","line":4,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":4,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":58},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnimatePresence' is defined but never used.","line":5,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":33},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`stopCamera` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\scanner\\ScanBarcode.tsx:27:13\n  25 |     useEffect(() => {\n  26 |         return () => {\n> 27 |             stopCamera();\n     |             ^^^^^^^^^^ `stopCamera` accessed before it is declared\n  28 |         };\n  29 |     }, []);\n  30 |\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\scanner\\ScanBarcode.tsx:60:5\n  58 |     }, [onError]);\n  59 |\n> 60 |     const stopCamera = useCallback(() => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 61 |         if (streamRef.current) {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 62 |             streamRef.current.getTracks().forEach(track => track.stop());\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 63 |             streamRef.current = null;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 64 |         }\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 65 |         setIsScanning(false);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 66 |     }, []);\n     | ^^^^^^^^^^^^ `stopCamera` is declared here\n  67 |\n  68 |     const handleSuccess = (code: string) => {\n  69 |         if (typeof navigator !== 'undefined' && navigator.vibrate) {","line":27,"column":13,"nodeType":null,"endLine":27,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'stopCamera'. Either include it or remove the dependency array.","line":29,"column":8,"nodeType":"ArrayExpression","endLine":29,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [stopCamera]","fix":{"range":[906,908],"text":"[stopCamera]"}}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`startCamera` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\scanner\\ScanBarcode.tsx:32:24\n  30 |\n  31 |     useEffect(() => {\n> 32 |         if (autoStart) startCamera();\n     |                        ^^^^^^^^^^^ `startCamera` accessed before it is declared\n  33 |     }, [autoStart]);\n  34 |\n  35 |     const startCamera = useCallback(async () => {\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\scanner\\ScanBarcode.tsx:35:5\n  33 |     }, [autoStart]);\n  34 |\n> 35 |     const startCamera = useCallback(async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 36 |         setError(null);\n     | ^^^^^^^^^^^^^^^^^^^^^^^\n> 37 |         setIsScanning(true);\n     ΓÇª\n     | ^^^^^^^^^^^^^^^^^^^^^^^\n> 57 |         }\n     | ^^^^^^^^^^^^^^^^^^^^^^^\n> 58 |     }, [onError]);\n     | ^^^^^^^^^^^^^^^^^^^ `startCamera` is declared here\n  59 |\n  60 |     const stopCamera = useCallback(() => {\n  61 |         if (streamRef.current) {","line":32,"column":24,"nodeType":null,"endLine":32,"endColumn":35},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'startCamera'. Either include it or remove the dependency array.","line":33,"column":8,"nodeType":"ArrayExpression","endLine":33,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [autoStart, startCamera]","fix":{"range":[983,994],"text":"[autoStart, startCamera]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleSuccess' is assigned a value but never used.","line":68,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":24}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { Scan, Upload, Camera, Zap, Image as ImageIcon, X } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\ninterface ScanBarcodeProps {\r\n    onResult: (result: string) => void;\r\n    onError?: (error: Error) => void;\r\n    autoStart?: boolean;\r\n}\r\n\r\nconst ScanBarcode: React.FC<ScanBarcodeProps> = ({\r\n    onResult,\r\n    onError,\r\n    autoStart = true,\r\n}) => {\r\n    const [isScanning, setIsScanning] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const videoRef = useRef<HTMLVideoElement>(null);\r\n    const streamRef = useRef<MediaStream | null>(null);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    // Initialize Camera (Native)\r\n    useEffect(() => {\r\n        return () => {\r\n            stopCamera();\r\n        };\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (autoStart) startCamera();\r\n    }, [autoStart]);\r\n\r\n    const startCamera = useCallback(async () => {\r\n        setError(null);\r\n        setIsScanning(true);\r\n\r\n        try {\r\n            // Request Camera Access (Environment facing if available)\r\n            const stream = await navigator.mediaDevices.getUserMedia({\r\n                video: { facingMode: 'environment' }\r\n            });\r\n\r\n            streamRef.current = stream;\r\n\r\n            if (videoRef.current) {\r\n                videoRef.current.srcObject = stream;\r\n                videoRef.current.play();\r\n            }\r\n\r\n        } catch (err) {\r\n            console.error(\"Camera failed:\", err);\r\n            setError(\"Camera access failed. Switch to photo mode.\");\r\n            setIsScanning(false);\r\n            if (onError) onError(err instanceof Error ? err : new Error(String(err)));\r\n        }\r\n    }, [onError]);\r\n\r\n    const stopCamera = useCallback(() => {\r\n        if (streamRef.current) {\r\n            streamRef.current.getTracks().forEach(track => track.stop());\r\n            streamRef.current = null;\r\n        }\r\n        setIsScanning(false);\r\n    }, []);\r\n\r\n    const handleSuccess = (code: string) => {\r\n        if (typeof navigator !== 'undefined' && navigator.vibrate) {\r\n            navigator.vibrate(200);\r\n        }\r\n        onResult(code);\r\n        stopCamera();\r\n    };\r\n\r\n    // Placeholder for File Upload (Logic removed as requested)\r\n    const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = event.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        // Visual feedback only\r\n        if (typeof navigator !== 'undefined' && navigator.vibrate) {\r\n            navigator.vibrate(50);\r\n        }\r\n        console.log(\"Image selected:\", file.name);\r\n\r\n        // FUTURE: Implement decoding here\r\n        // onResult(\"mock-result\"); \r\n\r\n        if (fileInputRef.current) fileInputRef.current.value = '';\r\n    };\r\n\r\n    return (\r\n        <div className=\"relative w-full h-full flex flex-col items-center justify-center bg-black overflow-hidden\">\r\n\r\n            {/* Background Ambience */}\r\n            <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-indigo-900/20 via-black to-black z-0\" />\r\n\r\n            {/* Main Scanner Window */}\r\n            <div className=\"relative z-10 w-full max-w-lg aspect-[3/4] sm:aspect-[9/16] max-h-[80vh] bg-black/50 rounded-3xl overflow-hidden border border-white/10 shadow-2xl backdrop-blur-sm\">\r\n\r\n                {/* Hidden Fallback Input */}\r\n                <input\r\n                    type=\"file\"\r\n                    accept=\"image/*\"\r\n                    capture=\"environment\"\r\n                    className=\"hidden\"\r\n                    ref={fileInputRef}\r\n                    onChange={handleFileUpload}\r\n                />\r\n\r\n                {/* Camera View */}\r\n                <video\r\n                    ref={videoRef}\r\n                    className={`w-full h-full object-cover transition-opacity duration-500 ${isScanning ? 'opacity-100' : 'opacity-0'}`}\r\n                    playsInline\r\n                    muted\r\n                    autoPlay\r\n                />\r\n\r\n                {/* AI Overlay / HUD */}\r\n                {isScanning && !error && (\r\n                    <div className=\"absolute inset-0 pointer-events-none\">\r\n                        {/* Corner Brackets */}\r\n                        <div className=\"absolute top-8 left-8 w-16 h-16 border-t-2 border-l-2 border-cyan-500 rounded-tl-lg opacity-80\" />\r\n                        <div className=\"absolute top-8 right-8 w-16 h-16 border-t-2 border-r-2 border-cyan-500 rounded-tr-lg opacity-80\" />\r\n                        <div className=\"absolute bottom-8 left-8 w-16 h-16 border-b-2 border-l-2 border-cyan-500 rounded-bl-lg opacity-80\" />\r\n                        <div className=\"absolute bottom-8 right-8 w-16 h-16 border-b-2 border-r-2 border-cyan-500 rounded-br-lg opacity-80\" />\r\n\r\n                        {/* Scanning Laser */}\r\n                        <motion.div\r\n                            animate={{ top: ['10%', '90%', '10%'] }}\r\n                            transition={{ duration: 3, ease: \"linear\", repeat: Infinity }}\r\n                            className=\"absolute left-4 right-4 h-0.5 bg-gradient-to-r from-transparent via-cyan-400 to-transparent shadow-[0_0_15px_rgba(34,211,238,0.8)]\"\r\n                        />\r\n\r\n                        {/* Grid Effect */}\r\n                        <div className=\"absolute inset-0 bg-[linear-gradient(rgba(0,255,255,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(0,255,255,0.03)_1px,transparent_1px)] bg-[size:40px_40px]\" />\r\n\r\n                        {/* Status Text */}\r\n                        <div className=\"absolute top-12 left-0 right-0 text-center\">\r\n                            <motion.div\r\n                                initial={{ opacity: 0 }}\r\n                                animate={{ opacity: 1 }}\r\n                                className=\"inline-flex items-center px-3 py-1 rounded-full bg-cyan-500/10 border border-cyan-500/20 backdrop-blur-md\"\r\n                            >\r\n                                <Zap className=\"w-3 h-3 text-cyan-400 mr-2 animate-pulse\" />\r\n                                <span className=\"text-xs font-medium text-cyan-300 tracking-wider\">AI VISION ACTIVE</span>\r\n                            </motion.div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Error / Fallback State (AI Theme) */}\r\n                {!isScanning || error ? (\r\n                    <div className=\"absolute inset-0 flex flex-col items-center justify-center p-8 text-center bg-gray-950/90 backdrop-blur-md z-20\">\r\n                        <div className=\"w-16 h-16 mb-6 rounded-2xl bg-gradient-to-br from-indigo-500/20 to-purple-500/20 flex items-center justify-center border border-white/10 ring-1 ring-white/5\">\r\n                            {error ? <Zap className=\"w-8 h-8 text-red-400\" /> : <Camera className=\"w-8 h-8 text-cyan-400\" />}\r\n                        </div>\r\n\r\n                        <h3 className=\"text-xl font-bold text-white mb-2 tracking-tight\">\r\n                            {error ? \"Vision Stream Offline\" : \"Scanner Standby\"}\r\n                        </h3>\r\n                        <p className=\"text-sm text-gray-400 mb-8 max-w-[200px]\">\r\n                            {error ? \"Unable to access camera feed. Engage manual override.\" : \"Initialize scanning sequence.\"}\r\n                        </p>\r\n\r\n                        <div className=\"space-y-3 w-full max-w-xs\">\r\n                            <button\r\n                                onClick={startCamera}\r\n                                className=\"w-full py-3.5 px-6 rounded-xl bg-white text-black font-semibold hover:bg-gray-100 transition-all flex items-center justify-center gap-2 group\"\r\n                            >\r\n                                <Camera className=\"w-4 h-4 text-black\" />\r\n                                <span>Initialize Camera</span>\r\n                            </button>\r\n\r\n                            <button\r\n                                onClick={() => fileInputRef.current?.click()}\r\n                                className=\"w-full py-3.5 px-6 rounded-xl bg-white/5 text-white font-medium border border-white/10 hover:bg-white/10 transition-all flex items-center justify-center gap-2\"\r\n                            >\r\n                                <ImageIcon className=\"w-4 h-4 text-gray-400\" />\r\n                                <span>Manual Image Analysis</span>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                ) : null}\r\n            </div>\r\n\r\n            {/* Manual File Upload Trigger (Floating Action, visible during scan) */}\r\n            {isScanning && !error && (\r\n                <button\r\n                    onClick={() => fileInputRef.current?.click()}\r\n                    className=\"absolute bottom-8 right-8 p-4 rounded-full bg-white/10 backdrop-blur-md border border-white/20 text-white hover:bg-white/20 transition-all z-20\"\r\n                    aria-label=\"Upload Image\"\r\n                >\r\n                    <ImageIcon className=\"w-6 h-6\" />\r\n                </button>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ScanBarcode;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\scanner\\ScanningOverlay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\search\\ImageProductSearcher.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Upload' is defined but never used.","line":5,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[909,912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[909,912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useRef, useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Camera, Upload, Loader2, AlertCircle } from 'lucide-react';\r\nimport { useAuth } from '@/context/AuthContext';\r\n\r\nexport default function ImageProductSearcher() {\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const [isProcessing, setIsProcessing] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const router = useRouter();\r\n    const { user } = useAuth();\r\n\r\n    const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        setIsProcessing(true);\r\n        setError(null);\r\n\r\n        try {\r\n            // Updated: Direct Visual Search (No local barcode decoding)\r\n            await performVisualSearch(file);\r\n\r\n        } catch (err: any) {\r\n            console.error('Search failed:', err);\r\n            setError(err.message || 'Failed to process image. Please try again.');\r\n            setIsProcessing(false);\r\n        }\r\n    };\r\n\r\n    const performVisualSearch = async (file: File) => {\r\n        const formData = new FormData();\r\n        formData.append('image', file);\r\n\r\n        // Get ID token for secure backend access\r\n        const token = user ? await user.getIdToken() : '';\r\n\r\n        const response = await fetch('/api/search-by-image', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Authorization': `Bearer ${token}`\r\n            },\r\n            body: formData\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        if (!response.ok) {\r\n            // Handle eligibility error specifically\r\n            if (response.status === 403) {\r\n                throw new Error('Premium feature. Please upgrade to use Visual Search.');\r\n            }\r\n            throw new Error(data.error || 'Visual search server error');\r\n        }\r\n\r\n        // Logic based on backend response\r\n        if (data.productId) {\r\n            router.push(`/products/${data.productId}`);\r\n        } else if (data.query) {\r\n            // Redirect to text search if no direct product found\r\n            router.push(`/search?q=${encodeURIComponent(data.query)}`);\r\n        } else {\r\n            throw new Error('No results found for this image.');\r\n        }\r\n    };\r\n\r\n    const triggerFileInput = () => {\r\n        fileInputRef.current?.click();\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-full\">\r\n            <input\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                capture=\"environment\"\r\n                ref={fileInputRef}\r\n                onChange={handleImageUpload}\r\n                className=\"hidden\"\r\n            />\r\n\r\n            <button\r\n                onClick={triggerFileInput}\r\n                disabled={isProcessing}\r\n                className={`w-full flex items-center justify-center gap-2 p-4 rounded-xl border-2 border-dashed transition-all ${isProcessing\r\n                    ? 'bg-gray-50 border-gray-300 cursor-wait'\r\n                    : 'bg-white hover:bg-gray-50 border-emerald-500/50 hover:border-emerald-500 text-emerald-700 dark:bg-zinc-900 dark:border-zinc-700 dark:hover:border-emerald-500/50 dark:text-emerald-400'\r\n                    }`}\r\n            >\r\n                {isProcessing ? (\r\n                    <>\r\n                        <Loader2 className=\"w-6 h-6 animate-spin text-emerald-600\" />\r\n                        <span className=\"font-medium text-gray-600 dark:text-gray-400\">Analyzing Image...</span>\r\n                    </>\r\n                ) : (\r\n                    <>\r\n                        <Camera className=\"w-6 h-6\" />\r\n                        <span className=\"font-medium\">Tap to Scan or Search by Photo</span>\r\n                    </>\r\n                )}\r\n            </button>\r\n\r\n            {error && (\r\n                <div className=\"mt-3 p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg text-sm flex items-center gap-2\">\r\n                    <AlertCircle className=\"w-4 h-4 shrink-0\" />\r\n                    {error}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\search\\QuickActionHistory.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Search' is defined but never used.","line":6,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[452,455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[452,455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { db } from '@/lib/firebase';\r\nimport { collection, query, where, orderBy, limit, getDocs } from 'firebase/firestore';\r\nimport { Clock, Search, Barcode, Image as ImageIcon, ExternalLink } from 'lucide-react';\r\nimport Link from 'next/link';\r\n\r\ninterface SearchHistoryItem {\r\n    id: string;\r\n    userId: string;\r\n    timestamp: any; // Firestore Timestamp\r\n    searchType: 'Barcode_Scan' | 'Visual_Search';\r\n    searchQuery?: string;\r\n    productId?: string;\r\n    imageUrl?: string; // Optional, if we store the image URL or thumbnail\r\n}\r\n\r\nexport default function QuickActionHistory() {\r\n    const { user } = useAuth();\r\n    const [history, setHistory] = useState<SearchHistoryItem[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (!user) return;\r\n\r\n        const fetchHistory = async () => {\r\n            try {\r\n                const historyRef = collection(db, 'search_history');\r\n                const q = query(\r\n                    historyRef,\r\n                    where(\"userId\", \"==\", user.uid),\r\n                    orderBy(\"timestamp\", \"desc\"),\r\n                    limit(10)\r\n                );\r\n\r\n                const querySnapshot = await getDocs(q);\r\n                const items: SearchHistoryItem[] = [];\r\n                querySnapshot.forEach((doc) => {\r\n                    items.push({ id: doc.id, ...doc.data() } as SearchHistoryItem);\r\n                });\r\n                setHistory(items);\r\n            } catch (error) {\r\n                console.error(\"Error fetching search history:\", error);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchHistory();\r\n    }, [user]);\r\n\r\n    if (!user) return null;\r\n\r\n    if (loading) {\r\n        return <div className=\"p-4 text-center text-gray-500 animate-pulse\">Loading history...</div>;\r\n    }\r\n\r\n    if (history.length === 0) {\r\n        return (\r\n            <div className=\"p-6 text-center text-gray-400 bg-gray-50 dark:bg-zinc-800/50 rounded-xl\">\r\n                <Clock className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\r\n                <p className=\"text-sm\">No recent search history</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"bg-white dark:bg-zinc-900 rounded-xl border border-gray-200 dark:border-zinc-800 p-4\">\r\n            <h3 className=\"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2\">\r\n                <Clock className=\"w-4 h-4\" />\r\n                Recent Searches\r\n            </h3>\r\n            <div className=\"space-y-2\">\r\n                {history.map((item) => (\r\n                    <div key={item.id} className=\"flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-zinc-800 rounded-lg transition-colors group\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"p-2 bg-gray-100 dark:bg-zinc-800 rounded-full text-gray-500 dark:text-gray-400\">\r\n                                {item.searchType === 'Barcode_Scan' ? <Barcode className=\"w-4 h-4\" /> : <ImageIcon className=\"w-4 h-4\" />}\r\n                            </div>\r\n                            <div className=\"flex flex-col\">\r\n                                <span className=\"text-sm font-medium text-gray-900 dark:text-gray-200 truncate max-w-[150px] sm:max-w-[200px]\">\r\n                                    {item.searchQuery || item.productId || 'Unknown Item'}\r\n                                </span>\r\n                                <span className=\"text-xs text-gray-500\">\r\n                                    {item.timestamp?.toDate ? item.timestamp.toDate().toLocaleDateString() : 'Just now'}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                        {item.productId && (\r\n                            <Link\r\n                                href={`/product/${item.productId}`}\r\n                                className=\"opacity-0 group-hover:opacity-100 p-1.5 text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:hover:bg-blue-900/20 rounded-md transition-all\"\r\n                                title=\"View Product\"\r\n                            >\r\n                                <ExternalLink className=\"w-4 h-4\" />\r\n                            </Link>\r\n                        )}\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\search\\QuickActionSearchButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\settings\\AIChatSettings.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'InputLabel' is defined but never used.","line":11,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSettings'. Either include it or remove the dependency array.","line":41,"column":8,"nodeType":"ArrayExpression","endLine":41,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadSettings, user]","fix":{"range":[1376,1382],"text":"[loadSettings, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n    Box,\r\n    Typography,\r\n    Paper,\r\n    Select,\r\n    MenuItem,\r\n    FormControl,\r\n    InputLabel,\r\n    CircularProgress,\r\n    Chip,\r\n    Alert\r\n} from '@mui/material';\r\nimport SmartToyIcon from '@mui/icons-material/SmartToy';\r\nimport TranslateIcon from '@mui/icons-material/Translate';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport { motion } from 'framer-motion';\r\nimport { AIProvider, AILanguage, AI_PROVIDERS, AI_LANGUAGES } from '@/types/aiChat';\r\nimport { getUserApiKeys, savePreferredProvider, savePreferredLanguage } from '@/services/aiChatService';\r\nimport { useAuth } from '@/context/AuthContext';\r\n\r\ninterface AIChatSettingsProps {\r\n    onSettingsChanged?: () => void;\r\n}\r\n\r\nexport default function AIChatSettings({ onSettingsChanged }: AIChatSettingsProps) {\r\n    const { user } = useAuth();\r\n\r\n    const [selectedProvider, setSelectedProvider] = useState<AIProvider>('groq');\r\n    const [selectedLanguage, setSelectedLanguage] = useState<AILanguage>('en');\r\n    const [loading, setLoading] = useState(true);\r\n    const [saving, setSaving] = useState(false);\r\n    const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (user) {\r\n            loadSettings();\r\n        }\r\n    }, [user]);\r\n\r\n    const loadSettings = async () => {\r\n        if (!user) return;\r\n        try {\r\n            const keys = await getUserApiKeys(user.uid);\r\n            if (keys.preferredProvider) setSelectedProvider(keys.preferredProvider);\r\n            if (keys.preferredLanguage) setSelectedLanguage(keys.preferredLanguage);\r\n        } catch (error) {\r\n            console.error('Failed to load AI settings:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleProviderChange = async (provider: AIProvider) => {\r\n        if (!user) return;\r\n        setSelectedProvider(provider);\r\n        setSaving(true);\r\n        setMessage(null);\r\n        try {\r\n            await savePreferredProvider(user.uid, provider);\r\n            setMessage({ type: 'success', text: `AI model set to ${AI_PROVIDERS[provider].name}` });\r\n            onSettingsChanged?.();\r\n            setTimeout(() => setMessage(null), 3000);\r\n        } catch (error) {\r\n            console.error('Failed to save provider:', error);\r\n            setMessage({ type: 'error', text: 'Failed to save. Please try again.' });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleLanguageChange = async (language: AILanguage) => {\r\n        if (!user) return;\r\n        setSelectedLanguage(language);\r\n        setSaving(true);\r\n        setMessage(null);\r\n        try {\r\n            await savePreferredLanguage(user.uid, language);\r\n            setMessage({ type: 'success', text: `AI will now respond in ${AI_LANGUAGES[language].name}` });\r\n            onSettingsChanged?.();\r\n            setTimeout(() => setMessage(null), 3000);\r\n        } catch (error) {\r\n            console.error('Failed to save language:', error);\r\n            setMessage({ type: 'error', text: 'Failed to save. Please try again.' });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <Box sx={{ display: 'flex', justifyContent: 'center', py: 4 }}>\r\n                <CircularProgress size={32} />\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Paper\r\n            component={motion.div}\r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            sx={{ p: 4, borderRadius: 4 }}\r\n        >\r\n            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5, mb: 3 }}>\r\n                <SmartToyIcon color=\"primary\" sx={{ fontSize: 28 }} />\r\n                <Typography variant=\"h6\" fontWeight=\"bold\">\r\n                    AI Chat Settings\r\n                </Typography>\r\n            </Box>\r\n\r\n            <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 4 }}>\r\n                Customize how the AI assistant responds to you.\r\n            </Typography>\r\n\r\n            {/* AI Model Selection */}\r\n            <Box sx={{ mb: 4 }}>\r\n                <Typography variant=\"subtitle2\" fontWeight=\"bold\" sx={{ mb: 1.5, display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                    ΓÜí AI Model\r\n                </Typography>\r\n                <FormControl fullWidth>\r\n                    <Select\r\n                        value={selectedProvider}\r\n                        onChange={(e) => handleProviderChange(e.target.value as AIProvider)}\r\n                        disabled={saving}\r\n                        sx={{ borderRadius: 2 }}\r\n                    >\r\n                        {(Object.keys(AI_PROVIDERS) as AIProvider[]).map((provider) => (\r\n                            <MenuItem key={provider} value={provider}>\r\n                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5 }}>\r\n                                    <span>{AI_PROVIDERS[provider].icon}</span>\r\n                                    <span>{AI_PROVIDERS[provider].name}</span>\r\n                                    {selectedProvider === provider && (\r\n                                        <Chip\r\n                                            label=\"Selected\"\r\n                                            size=\"small\"\r\n                                            color=\"primary\"\r\n                                            sx={{ ml: 'auto', height: 20, fontSize: '0.7rem' }}\r\n                                        />\r\n                                    )}\r\n                                </Box>\r\n                            </MenuItem>\r\n                        ))}\r\n                    </Select>\r\n                </FormControl>\r\n            </Box>\r\n\r\n            {/* Language Selection */}\r\n            <Box sx={{ mb: 3 }}>\r\n                <Typography variant=\"subtitle2\" fontWeight=\"bold\" sx={{ mb: 1.5, display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                    <TranslateIcon sx={{ fontSize: 18 }} /> Response Language\r\n                </Typography>\r\n                <FormControl fullWidth>\r\n                    <Select\r\n                        value={selectedLanguage}\r\n                        onChange={(e) => handleLanguageChange(e.target.value as AILanguage)}\r\n                        disabled={saving}\r\n                        sx={{ borderRadius: 2 }}\r\n                    >\r\n                        {(Object.keys(AI_LANGUAGES) as AILanguage[]).map((lang) => (\r\n                            <MenuItem key={lang} value={lang}>\r\n                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5 }}>\r\n                                    <span style={{ fontSize: 20 }}>{AI_LANGUAGES[lang].flag}</span>\r\n                                    <span>{AI_LANGUAGES[lang].name}</span>\r\n                                    <Typography variant=\"caption\" color=\"text.secondary\" sx={{ ml: 0.5 }}>\r\n                                        ({AI_LANGUAGES[lang].nativeName})\r\n                                    </Typography>\r\n                                </Box>\r\n                            </MenuItem>\r\n                        ))}\r\n                    </Select>\r\n                </FormControl>\r\n            </Box>\r\n\r\n            {/* Status Message */}\r\n            {message && (\r\n                <Alert\r\n                    severity={message.type}\r\n                    icon={message.type === 'success' ? <CheckCircleIcon /> : undefined}\r\n                    sx={{ mt: 2 }}\r\n                >\r\n                    {message.text}\r\n                </Alert>\r\n            )}\r\n\r\n            {saving && (\r\n                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mt: 2 }}>\r\n                    <CircularProgress size={16} />\r\n                    <Typography variant=\"caption\" color=\"text.secondary\">Saving...</Typography>\r\n                </Box>\r\n            )}\r\n        </Paper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\settings\\ApiKeyManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SmartToyIcon' is defined but never used.","line":35,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TranslateIcon' is defined but never used.","line":36,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'compact' is assigned a value but never used.","line":54,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tier' is assigned a value but never used.","line":57,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadUserKeys'. Either include it or remove the dependency array.","line":97,"column":8,"nodeType":"ArrayExpression","endLine":97,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [user, showManager, loadUserKeys]","fix":{"range":[3202,3221],"text":"[user, showManager, loadUserKeys]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4657,4660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4657,4660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n    Box,\r\n    Typography,\r\n    TextField,\r\n    Button,\r\n    Alert,\r\n    InputAdornment,\r\n    IconButton,\r\n    ToggleButton,\r\n    ToggleButtonGroup,\r\n    Paper,\r\n    Collapse,\r\n    CircularProgress,\r\n    Dialog,\r\n    DialogTitle,\r\n    DialogContent,\r\n    DialogContentText,\r\n    DialogActions,\r\n    Chip,\r\n    Select,\r\n    MenuItem,\r\n    FormControl,\r\n    InputLabel\r\n} from '@mui/material';\r\nimport Visibility from '@mui/icons-material/Visibility';\r\nimport VisibilityOff from '@mui/icons-material/VisibilityOff';\r\nimport SaveIcon from '@mui/icons-material/Save';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport KeyIcon from '@mui/icons-material/Key';\r\nimport WarningIcon from '@mui/icons-material/Warning';\r\nimport SmartToyIcon from '@mui/icons-material/SmartToy';\r\nimport TranslateIcon from '@mui/icons-material/Translate';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { AIProvider, AI_PROVIDERS, AILanguage, AI_LANGUAGES } from '@/types/aiChat';\r\nimport { getUserApiKeys, saveUserApiKey, savePreferredProvider, deleteUserApiKey, savePreferredLanguage } from '@/services/aiChatService';\r\nimport { useAuth } from '@/context/AuthContext';\r\n\r\ninterface ApiKeyManagerProps {\r\n    onKeysSaved?: () => void;\r\n    onKeysDeleted?: () => void;\r\n    onSettingsChanged?: () => void;\r\n    compact?: boolean;\r\n    allowCustomConfig?: boolean;\r\n}\r\n\r\nexport default function ApiKeyManager({\r\n    onKeysSaved,\r\n    onKeysDeleted,\r\n    onSettingsChanged,\r\n    compact = false,\r\n    allowCustomConfig = false\r\n}: ApiKeyManagerProps) {\r\n    const { user, tier, isFree, isPlus, isPro } = useAuth();\r\n    const [selectedProvider, setSelectedProvider] = useState<AIProvider>('groq');\r\n    const [selectedLanguage, setSelectedLanguage] = useState<AILanguage>('en');\r\n    const [apiKeys, setApiKeys] = useState<Record<AIProvider, string>>({\r\n        groq: '',\r\n        gemini: '',\r\n        ollama: '',\r\n        deepseek: '',\r\n        openrouter: ''\r\n    });\r\n    const [originalKeys, setOriginalKeys] = useState<Record<AIProvider, string>>({\r\n        groq: '',\r\n        gemini: '',\r\n        ollama: '',\r\n        deepseek: '',\r\n        openrouter: ''\r\n    });\r\n    const [showKey, setShowKey] = useState<Record<AIProvider, boolean>>({\r\n        groq: false,\r\n        gemini: false,\r\n        ollama: false,\r\n        deepseek: false,\r\n        openrouter: false\r\n    });\r\n    const [loading, setLoading] = useState(true);\r\n    const [saving, setSaving] = useState(false);\r\n    const [deleting, setDeleting] = useState(false);\r\n    const [message, setMessage] = useState<{ type: 'success' | 'error' | 'warning'; text: string } | null>(null);\r\n    const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\r\n    const [providerToDelete, setProviderToDelete] = useState<AIProvider | null>(null);\r\n\r\n    // Show for everyone so Pro users can switch providers\r\n    const showManager = true;\r\n\r\n    useEffect(() => {\r\n        if (user && showManager) {\r\n            loadUserKeys();\r\n        } else {\r\n            setLoading(false);\r\n        }\r\n    }, [user, showManager]);\r\n\r\n    const loadUserKeys = async () => {\r\n        if (!user) return;\r\n        try {\r\n            const keys = await getUserApiKeys(user.uid);\r\n            const loadedKeys = {\r\n                groq: keys.groq || '',\r\n                gemini: keys.gemini || '',\r\n                ollama: '', // Self-hosted\r\n                deepseek: keys.deepseek || '',\r\n                openrouter: keys.openrouter || ''\r\n            };\r\n            setApiKeys(loadedKeys);\r\n            setOriginalKeys(loadedKeys);\r\n            if (keys.preferredProvider) {\r\n                setSelectedProvider(keys.preferredProvider);\r\n            }\r\n            if (keys.preferredLanguage) {\r\n                setSelectedLanguage(keys.preferredLanguage);\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to load API keys:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n    const handleProviderChange = async (_: React.MouseEvent<HTMLElement>, newProvider: AIProvider | null) => {\r\n        if (newProvider && user) {\r\n            setSelectedProvider(newProvider);\r\n            try {\r\n                await savePreferredProvider(user.uid, newProvider);\r\n                onSettingsChanged?.(); // Notify parent\r\n            } catch (error) {\r\n                console.error('Failed to save preferred provider:', error);\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleLanguageChange = async (event: any) => {\r\n        const lang = event.target.value as AILanguage;\r\n        setSelectedLanguage(lang);\r\n        if (user) {\r\n            try {\r\n                await savePreferredLanguage(user.uid, lang);\r\n                onSettingsChanged?.(); // Notify parent\r\n            } catch (error) {\r\n                console.error('Failed to save preferred language:', error);\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleSave = async (provider: AIProvider) => {\r\n        if (!user) return;\r\n\r\n        setSaving(true);\r\n        setMessage(null);\r\n\r\n        try {\r\n            // New: Test the key first if it's a user-provided key\r\n            // (Pro users don't need this check here as they don't input keys, \r\n            // but if for some reason they do, we verify it anyway)\r\n            if (needsOwnKey || apiKeys[provider]) {\r\n                // If we have a key input, validate it\r\n                // Note: 'ollama' doesn't use a key, but we handle it gracefully\r\n                if (provider !== 'ollama' && apiKeys[provider]) {\r\n                    const isValid = await import('@/services/aiChatService').then(m => m.testApiKey(provider, apiKeys[provider]));\r\n                    if (!isValid) {\r\n                        setMessage({ type: 'error', text: `Invalid API Key for ${AI_PROVIDERS[provider].name}. Please check and try again.` });\r\n                        setSaving(false);\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n\r\n            await saveUserApiKey(user.uid, provider, apiKeys[provider]);\r\n            setOriginalKeys(prev => ({ ...prev, [provider]: apiKeys[provider] }));\r\n            setMessage({ type: 'success', text: `${AI_PROVIDERS[provider].name} API key verified and saved!` });\r\n            onKeysSaved?.();\r\n        } catch (error) {\r\n            console.error('Failed to save API key:', error);\r\n            setMessage({ type: 'error', text: 'Failed to save API key. Please try again.' });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const openDeleteDialog = (provider: AIProvider) => {\r\n        setProviderToDelete(provider);\r\n        setDeleteDialogOpen(true);\r\n    };\r\n\r\n    const handleDelete = async () => {\r\n        if (!user || !providerToDelete) return;\r\n\r\n        setDeleting(true);\r\n        setMessage(null);\r\n\r\n        try {\r\n            await deleteUserApiKey(user.uid, providerToDelete);\r\n            setApiKeys(prev => ({ ...prev, [providerToDelete]: '' }));\r\n            setOriginalKeys(prev => ({ ...prev, [providerToDelete]: '' }));\r\n            setMessage({\r\n                type: 'warning',\r\n                text: `${AI_PROVIDERS[providerToDelete].name} API key deleted successfully.`\r\n            });\r\n            onKeysDeleted?.();\r\n        } catch (error) {\r\n            console.error('Failed to delete API key:', error);\r\n            setMessage({ type: 'error', text: 'Failed to delete API key. Please try again.' });\r\n        } finally {\r\n            setDeleting(false);\r\n            setDeleteDialogOpen(false);\r\n            setProviderToDelete(null);\r\n        }\r\n    };\r\n\r\n    // Check if key has been modified\r\n    const hasKeyChanged = (provider: AIProvider) => {\r\n        return apiKeys[provider] !== originalKeys[provider];\r\n    };\r\n\r\n    // Check if key exists in Firebase\r\n    const hasExistingKey = (provider: AIProvider) => {\r\n        return !!originalKeys[provider];\r\n    };\r\n\r\n    // Determine if user needs to provide their own key based on tier or override\r\n    const needsOwnKey = (\r\n        allowCustomConfig ||\r\n        (!isPro && selectedProvider !== 'ollama')\r\n    );\r\n\r\n    // If Pro/Ultimate and NOT overriding, use platform key\r\n    const isUsingPlatformKey = !needsOwnKey && selectedProvider !== 'ollama';\r\n\r\n    if (loading) {\r\n        return (\r\n            <Box sx={{ display: 'flex', justifyContent: 'center', py: 4 }}>\r\n                <CircularProgress size={32} />\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Box\r\n            component={motion.div}\r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            transition={{ duration: 0.3 }}\r\n        >\r\n            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 2 }}>\r\n                <KeyIcon color=\"primary\" />\r\n                <Typography variant=\"h6\" fontWeight=\"bold\">\r\n                    AI Provider Settings\r\n                </Typography>\r\n            </Box>\r\n\r\n            <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 3 }}>\r\n                Select your preferred AI provider.\r\n                {!isPro ? (\r\n                    <>\r\n                        {' '}You can use Azure AI for free, or add your own key for other providers.\r\n                        <Typography component=\"span\" color=\"warning.main\" fontWeight=\"medium\" sx={{ display: 'block', mt: 0.5 }}>\r\n                            Upgrade to Pro for unlimited access without your own key!\r\n                        </Typography>\r\n                    </>\r\n                ) : (\r\n                    \" You have full access to all providers included in your plan.\"\r\n                )}\r\n            </Typography>\r\n\r\n            {/* Language Selection */}\r\n            <Box sx={{ mb: 3 }}>\r\n                <FormControl fullWidth size=\"small\">\r\n                    <InputLabel>Response Language</InputLabel>\r\n                    <Select\r\n                        value={selectedLanguage}\r\n                        label=\"Response Language\"\r\n                        onChange={handleLanguageChange}\r\n                        disabled={saving}\r\n                    >\r\n                        {(Object.keys(AI_LANGUAGES) as AILanguage[]).map((lang) => (\r\n                            <MenuItem key={lang} value={lang}>\r\n                                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                                    <span style={{ fontSize: 18 }}>{AI_LANGUAGES[lang].flag}</span>\r\n                                    <span>{AI_LANGUAGES[lang].name}</span>\r\n                                </Box>\r\n                            </MenuItem>\r\n                        ))}\r\n                    </Select>\r\n                </FormControl>\r\n            </Box>\r\n\r\n            {/* Provider Selection with Status */}\r\n            <Box sx={{ mb: 3 }}>\r\n                <Typography variant=\"subtitle2\" color=\"text.secondary\" sx={{ mb: 1.5 }}>\r\n                    Select Provider\r\n                </Typography>\r\n                <ToggleButtonGroup\r\n                    value={selectedProvider}\r\n                    exclusive\r\n                    onChange={handleProviderChange}\r\n                    fullWidth\r\n                    sx={{\r\n                        display: 'grid',\r\n                        gridTemplateColumns: { xs: '1fr 1fr', sm: 'repeat(4, 1fr)' }, // Grid layout to fit 4 items\r\n                        gap: 1,\r\n                        '& .MuiToggleButton-root': {\r\n                            border: '1px solid rgba(0, 0, 0, 0.12) !important', // Force border\r\n                            py: 1.5,\r\n                            borderRadius: '8px !important', // Force rounded corners\r\n                            textTransform: 'none',\r\n                            fontWeight: 600,\r\n                            '&.Mui-selected': {\r\n                                bgcolor: 'primary.main',\r\n                                color: 'white',\r\n                                '&:hover': {\r\n                                    bgcolor: 'primary.dark'\r\n                                }\r\n                            }\r\n                        }\r\n                    }}\r\n                >\r\n                    {(Object.keys(AI_PROVIDERS) as AIProvider[]).map((provider) => (\r\n                        <ToggleButton key={provider} value={provider}>\r\n                            <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 0.5 }}>\r\n                                <span style={{ fontSize: '1.2rem' }}>{AI_PROVIDERS[provider].icon}</span>\r\n                                <span style={{ fontSize: '0.8rem', whiteSpace: 'nowrap' }}>{AI_PROVIDERS[provider].name.split(' ')[0]}</span>\r\n                                {(hasExistingKey(provider) && (isFree || isPlus) && provider !== 'ollama') && (\r\n                                    <Box\r\n                                        sx={{\r\n                                            width: 6,\r\n                                            height: 6,\r\n                                            borderRadius: '50%',\r\n                                            bgcolor: 'success.main',\r\n                                            position: 'absolute',\r\n                                            top: 6,\r\n                                            right: 6\r\n                                        }}\r\n                                    />\r\n                                )}\r\n                            </Box>\r\n                        </ToggleButton>\r\n                    ))}\r\n                </ToggleButtonGroup>\r\n            </Box>\r\n\r\n            {/* API Key Input for Selected Provider */}\r\n            <AnimatePresence mode=\"wait\">\r\n                <Paper\r\n                    component={motion.div}\r\n                    key={selectedProvider}\r\n                    initial={{ opacity: 0, x: 20 }}\r\n                    animate={{ opacity: 1, x: 0 }}\r\n                    exit={{ opacity: 0, x: -20 }}\r\n                    transition={{ duration: 0.2 }}\r\n                    elevation={0}\r\n                    sx={{\r\n                        p: 3,\r\n                        borderRadius: 3,\r\n                        bgcolor: 'background.paper',\r\n                        border: '1px solid',\r\n                        borderColor: hasExistingKey(selectedProvider) || isUsingPlatformKey || selectedProvider === 'ollama' ? 'success.main' : 'divider'\r\n                    }}\r\n                >\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 2 }}>\r\n                        <span style={{ fontSize: 24 }}>{AI_PROVIDERS[selectedProvider].icon}</span>\r\n                        <Typography variant=\"subtitle1\" fontWeight=\"bold\">\r\n                            {AI_PROVIDERS[selectedProvider].name}\r\n                        </Typography>\r\n                        {(hasExistingKey(selectedProvider) || isUsingPlatformKey || selectedProvider === 'ollama') && (\r\n                            <Chip\r\n                                icon={<CheckCircleIcon sx={{ fontSize: 16 }} />}\r\n                                label={isUsingPlatformKey ? \"Included in Plan\" : selectedProvider === 'ollama' ? \"Free Access\" : \"Configured\"}\r\n                                size=\"small\"\r\n                                color=\"success\"\r\n                                variant=\"outlined\"\r\n                                sx={{ ml: 'auto' }}\r\n                            />\r\n                        )}\r\n                    </Box>\r\n\r\n                    {/* Show Key Input ONLY if user needs to provide their own key */}\r\n                    {needsOwnKey ? (\r\n                        <>\r\n                            <TextField\r\n                                fullWidth\r\n                                type={showKey[selectedProvider] ? 'text' : 'password'}\r\n                                placeholder={hasExistingKey(selectedProvider)\r\n                                    ? 'Enter new key to update or leave empty to keep current'\r\n                                    : `Enter your ${AI_PROVIDERS[selectedProvider].name} API key`\r\n                                }\r\n                                value={apiKeys[selectedProvider]}\r\n                                onChange={(e) => setApiKeys(prev => ({ ...prev, [selectedProvider]: e.target.value }))}\r\n                                InputProps={{\r\n                                    endAdornment: (\r\n                                        <InputAdornment position=\"end\">\r\n                                            <IconButton\r\n                                                onClick={() => setShowKey(prev => ({ ...prev, [selectedProvider]: !prev[selectedProvider] }))}\r\n                                                edge=\"end\"\r\n                                            >\r\n                                                {showKey[selectedProvider] ? <VisibilityOff /> : <Visibility />}\r\n                                            </IconButton>\r\n                                        </InputAdornment>\r\n                                    )\r\n                                }}\r\n                                sx={{ mb: 2 }}\r\n                            />\r\n\r\n                            <Box sx={{ display: 'flex', gap: 2, alignItems: 'center', flexWrap: 'wrap' }}>\r\n                                <Button\r\n                                    variant=\"contained\"\r\n                                    startIcon={saving ? <CircularProgress size={18} color=\"inherit\" /> : <SaveIcon />}\r\n                                    onClick={() => handleSave(selectedProvider)}\r\n                                    disabled={saving || !apiKeys[selectedProvider] || !hasKeyChanged(selectedProvider)}\r\n                                    sx={{ minWidth: 120 }}\r\n                                >\r\n                                    {saving ? 'Testing & Saving...' : hasExistingKey(selectedProvider) ? 'Update Key' : 'Save Key'}\r\n                                </Button>\r\n\r\n                                {hasExistingKey(selectedProvider) && (\r\n                                    <Button\r\n                                        variant=\"outlined\"\r\n                                        color=\"error\"\r\n                                        startIcon={<DeleteIcon />}\r\n                                        onClick={() => openDeleteDialog(selectedProvider)}\r\n                                        disabled={deleting}\r\n                                        sx={{ minWidth: 120 }}\r\n                                    >\r\n                                        Delete Key\r\n                                    </Button>\r\n                                )}\r\n\r\n                                <Typography variant=\"caption\" color=\"text.secondary\" sx={{ ml: 'auto' }}>\r\n                                    Get your API key from{' '}\r\n                                    <a\r\n                                        href={selectedProvider === 'groq' ? 'https://console.groq.com/keys' : selectedProvider === 'deepseek' ? 'https://platform.deepseek.com/' : 'https://aistudio.google.com/app/apikey'}\r\n                                        target=\"_blank\"\r\n                                        rel=\"noopener noreferrer\"\r\n                                        style={{ color: AI_PROVIDERS[selectedProvider].color }}\r\n                                    >\r\n                                        {selectedProvider === 'groq' ? 'Groq Console' : selectedProvider === 'deepseek' ? 'DeepSeek Platform' : 'Google AI Studio'}\r\n                                    </a>\r\n                                </Typography>\r\n                            </Box>\r\n                        </>\r\n                    ) : (\r\n                        // Pro/Ultimate View or Free Ollama View\r\n                        <Typography variant=\"body2\" color=\"text.secondary\">\r\n                            {selectedProvider === 'ollama'\r\n                                ? \"This provider is free to use for all users. No API key required.\"\r\n                                : \"Your plan includes full access to this provider. No personal API key required.\"\r\n                            }\r\n                        </Typography>\r\n                    )}\r\n                </Paper>\r\n            </AnimatePresence>\r\n\r\n            {/* Status Message */}\r\n            <Collapse in={!!message}>\r\n                <Alert\r\n                    severity={message?.type === 'warning' ? 'warning' : message?.type}\r\n                    sx={{ mt: 2 }}\r\n                    onClose={() => setMessage(null)}\r\n                >\r\n                    {message?.text}\r\n                </Alert>\r\n            </Collapse>\r\n\r\n            {/* Delete Confirmation Dialog */}\r\n            <Dialog\r\n                open={deleteDialogOpen}\r\n                onClose={() => setDeleteDialogOpen(false)}\r\n                PaperProps={{\r\n                    sx: { borderRadius: 3 }\r\n                }}\r\n            >\r\n                <DialogTitle sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                    <WarningIcon color=\"warning\" />\r\n                    Delete API Key?\r\n                </DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText>\r\n                        Are you sure you want to delete your{' '}\r\n                        <strong>{providerToDelete ? AI_PROVIDERS[providerToDelete].name : ''}</strong>{' '}\r\n                        API key? This action cannot be undone and you will need to add a new key to use AI Chat with this provider.\r\n                    </DialogContentText>\r\n                </DialogContent>\r\n                <DialogActions sx={{ px: 3, pb: 2 }}>\r\n                    <Button\r\n                        onClick={() => setDeleteDialogOpen(false)}\r\n                        disabled={deleting}\r\n                    >\r\n                        Cancel\r\n                    </Button>\r\n                    <Button\r\n                        onClick={handleDelete}\r\n                        color=\"error\"\r\n                        variant=\"contained\"\r\n                        disabled={deleting}\r\n                        startIcon={deleting ? <CircularProgress size={18} color=\"inherit\" /> : <DeleteIcon />}\r\n                    >\r\n                        {deleting ? 'Deleting...' : 'Delete'}\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\subscription\\FeatureList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\subscription\\TierBadge.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WorkspacePremiumIcon' is defined but never used.","line":11,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tier Badge Component\r\n * Displays user subscription tier with appropriate styling\r\n */\r\n\r\n'use client';\r\n\r\nimport { Chip, ChipProps } from '@mui/material';\r\nimport StarIcon from '@mui/icons-material/Star';\r\nimport DiamondIcon from '@mui/icons-material/Diamond';\r\nimport WorkspacePremiumIcon from '@mui/icons-material/WorkspacePremium';\r\nimport SpeedIcon from '@mui/icons-material/Speed';\r\nimport { UserTier } from '@/types/user';\r\n\r\ninterface TierBadgeProps extends Omit<ChipProps, 'color'> {\r\n    tier: UserTier;\r\n}\r\n\r\nexport default function TierBadge({ tier, sx, ...props }: TierBadgeProps) {\r\n    let icon = undefined;\r\n    let label = 'FREE';\r\n    let color: ChipProps['color'] = 'default';\r\n    let gradient = undefined;\r\n\r\n    switch (tier) {\r\n        case 'plus':\r\n            label = 'PLUS';\r\n            icon = <SpeedIcon />;\r\n            color = 'info';\r\n            gradient = 'linear-gradient(45deg, #2196F3 30%, #21CBF3 90%)';\r\n            break;\r\n        case 'pro':\r\n            label = 'PRO';\r\n            icon = <StarIcon />;\r\n            color = 'warning';\r\n            gradient = 'linear-gradient(45deg, #FCD34D 30%, #FB923C 90%)';\r\n            break;\r\n        case 'ultimate':\r\n            label = 'ULTIMATE';\r\n            icon = <DiamondIcon />;\r\n            color = 'secondary'; // or 'error'/purple custom\r\n            gradient = 'linear-gradient(45deg, #8B5CF6 30%, #EC4899 90%)';\r\n            break;\r\n        default: // free\r\n            label = 'FREE';\r\n            color = 'default';\r\n            break;\r\n    }\r\n\r\n    return (\r\n        <Chip\r\n            icon={icon}\r\n            label={label}\r\n            color={color}\r\n            variant=\"filled\"\r\n            sx={{\r\n                fontWeight: 'bold',\r\n                ...(tier !== 'free' && {\r\n                    background: gradient,\r\n                    border: 'none',\r\n                    color: 'white',\r\n                    '& .MuiChip-icon': {\r\n                        color: 'inherit'\r\n                    }\r\n                }),\r\n                ...sx,\r\n            }}\r\n            {...props}\r\n        />\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\subscription\\UpgradePrompt.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\theme\\ThemeCustomizer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3936,3939],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3936,3939],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Theme Customizer Drawer\r\n * Advanced theme customization UI with color pickers and live preview\r\n */\r\n\r\n'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport Drawer from '@mui/material/Drawer';\r\nimport Box from '@mui/material/Box';\r\nimport Typography from '@mui/material/Typography';\r\nimport IconButton from '@mui/material/IconButton';\r\nimport Button from '@mui/material/Button';\r\nimport Grid from '@mui/material/Grid';\r\nimport Card from '@mui/material/Card';\r\nimport CardContent from '@mui/material/CardContent';\r\nimport CardActionArea from '@mui/material/CardActionArea';\r\nimport Slider from '@mui/material/Slider';\r\nimport FormControl from '@mui/material/FormControl';\r\nimport InputLabel from '@mui/material/InputLabel';\r\nimport Select from '@mui/material/Select';\r\nimport MenuItem from '@mui/material/MenuItem';\r\nimport Switch from '@mui/material/Switch';\r\nimport FormControlLabel from '@mui/material/FormControlLabel';\r\nimport Divider from '@mui/material/Divider';\r\nimport TextField from '@mui/material/TextField';\r\nimport CloseIcon from '@mui/icons-material/Close';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport { motion } from 'framer-motion';\r\nimport { useTheme } from '@/lib/hooks/useTheme';\r\nimport { themeList } from '@/lib/theme/themes';\r\nimport { CustomThemeColors, ThemeMode } from '@/types/theme';\r\n\r\ninterface ThemeCustomizerProps {\r\n    open: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport default function ThemeCustomizer({ open, onClose }: ThemeCustomizerProps) {\r\n    const { themeId, setTheme, customizeTheme, resetTheme, customColors } = useTheme();\r\n\r\n    // Custom theme state\r\n    const [customPrimary, setCustomPrimary] = useState(customColors?.primary || '#10B981');\r\n    const [customSecondary, setCustomSecondary] = useState(customColors?.secondary || '#059669');\r\n    const [customBackground, setCustomBackground] = useState(customColors?.background || '#F9FAFB');\r\n    const [customMode, setCustomMode] = useState<ThemeMode>(customColors?.mode || 'light');\r\n    const [customBorderRadius, setCustomBorderRadius] = useState(customColors?.borderRadius || 12);\r\n    const [customFontFamily, setCustomFontFamily] = useState(customColors?.fontFamily || \"'Inter', sans-serif\");\r\n\r\n    const handleSaveCustomTheme = () => {\r\n        const colors: CustomThemeColors = {\r\n            primary: customPrimary,\r\n            secondary: customSecondary,\r\n            background: customBackground,\r\n            mode: customMode,\r\n            borderRadius: customBorderRadius,\r\n            fontFamily: customFontFamily,\r\n        };\r\n        customizeTheme(colors);\r\n        onClose();\r\n    };\r\n\r\n    const handleReset = () => {\r\n        resetTheme();\r\n        onClose();\r\n    };\r\n\r\n    return (\r\n        <Drawer\r\n            anchor=\"right\"\r\n            open={open}\r\n            onClose={onClose}\r\n            sx={{\r\n                '& .MuiDrawer-paper': {\r\n                    width: { xs: '100%', sm: 400 },\r\n                    p: 3,\r\n                },\r\n            }}\r\n        >\r\n            <Box>\r\n                {/* Header */}\r\n                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>\r\n                    <Typography variant=\"h5\" fontWeight=\"bold\">\r\n                        Theme Customizer\r\n                    </Typography>\r\n                    <IconButton onClick={onClose}>\r\n                        <CloseIcon />\r\n                    </IconButton>\r\n                </Box>\r\n\r\n                {/* Predefined Themes */}\r\n                <Typography variant=\"h6\" gutterBottom>\r\n                    Predefined Themes\r\n                </Typography>\r\n                <Grid container spacing={2} sx={{ mb: 4 }}>\r\n                    {themeList.map((theme) => (\r\n                        <Grid size={{ xs: 6 }} key={theme.id}>\r\n                            <Card\r\n                                component={motion.div as any}\r\n                                whileHover={{ scale: 1.05 }}\r\n                                whileTap={{ scale: 0.95 }}\r\n                                sx={{\r\n                                    position: 'relative',\r\n                                    border: themeId === theme.id ? 2 : 0,\r\n                                    borderColor: 'primary.main',\r\n                                }}\r\n                            >\r\n                                <CardActionArea onClick={() => setTheme(theme.id)}>\r\n                                    <CardContent>\r\n                                        {/* Color Preview */}\r\n                                        <Box sx={{ display: 'flex', gap: 0.5, mb: 1 }}>\r\n                                            <Box\r\n                                                sx={{\r\n                                                    width: 30,\r\n                                                    height: 30,\r\n                                                    borderRadius: 1,\r\n                                                    bgcolor: theme.colors.primary.main,\r\n                                                }}\r\n                                            />\r\n                                            <Box\r\n                                                sx={{\r\n                                                    width: 30,\r\n                                                    height: 30,\r\n                                                    borderRadius: 1,\r\n                                                    bgcolor: theme.colors.secondary.main,\r\n                                                }}\r\n                                            />\r\n                                            <Box\r\n                                                sx={{\r\n                                                    width: 30,\r\n                                                    height: 30,\r\n                                                    borderRadius: 1,\r\n                                                    bgcolor: theme.colors.background.default,\r\n                                                    border: '1px solid',\r\n                                                    borderColor: 'divider',\r\n                                                }}\r\n                                            />\r\n                                        </Box>\r\n\r\n                                        <Typography variant=\"body2\" fontWeight=\"medium\">\r\n                                            {theme.name}\r\n                                        </Typography>\r\n\r\n                                        {themeId === theme.id && (\r\n                                            <CheckCircleIcon\r\n                                                sx={{\r\n                                                    position: 'absolute',\r\n                                                    top: 8,\r\n                                                    right: 8,\r\n                                                    color: 'primary.main',\r\n                                                    fontSize: 20,\r\n                                                }}\r\n                                            />\r\n                                        )}\r\n                                    </CardContent>\r\n                                </CardActionArea>\r\n                            </Card>\r\n                        </Grid>\r\n                    ))}\r\n                </Grid>\r\n\r\n                <Divider sx={{ my: 3 }} />\r\n\r\n                {/* Custom Theme Builder */}\r\n                <Typography variant=\"h6\" gutterBottom>\r\n                    Custom Theme\r\n                </Typography>\r\n\r\n                {/* Mode Toggle */}\r\n                <FormControlLabel\r\n                    control={\r\n                        <Switch\r\n                            checked={customMode === 'dark'}\r\n                            onChange={(e) => setCustomMode(e.target.checked ? 'dark' : 'light')}\r\n                        />\r\n                    }\r\n                    label={`${customMode === 'dark' ? 'Dark' : 'Light'} Mode`}\r\n                    sx={{ mb: 2 }}\r\n                />\r\n\r\n                {/* Primary Color */}\r\n                <Box sx={{ mb: 3 }}>\r\n                    <Typography variant=\"body2\" gutterBottom>\r\n                        Primary Color\r\n                    </Typography>\r\n                    <Box sx={{ display: 'flex', gap: 1, alignItems: 'center' }}>\r\n                        <TextField\r\n                            type=\"color\"\r\n                            value={customPrimary}\r\n                            onChange={(e) => setCustomPrimary(e.target.value)}\r\n                            sx={{ width: 60 }}\r\n                        />\r\n                        <TextField\r\n                            value={customPrimary}\r\n                            onChange={(e) => setCustomPrimary(e.target.value)}\r\n                            size=\"small\"\r\n                            fullWidth\r\n                        />\r\n                    </Box>\r\n                </Box>\r\n\r\n                {/* Secondary Color */}\r\n                <Box sx={{ mb: 3 }}>\r\n                    <Typography variant=\"body2\" gutterBottom>\r\n                        Secondary Color\r\n                    </Typography>\r\n                    <Box sx={{ display: 'flex', gap: 1, alignItems: 'center' }}>\r\n                        <TextField\r\n                            type=\"color\"\r\n                            value={customSecondary}\r\n                            onChange={(e) => setCustomSecondary(e.target.value)}\r\n                            sx={{ width: 60 }}\r\n                        />\r\n                        <TextField\r\n                            value={customSecondary}\r\n                            onChange={(e) => setCustomSecondary(e.target.value)}\r\n                            size=\"small\"\r\n                            fullWidth\r\n                        />\r\n                    </Box>\r\n                </Box>\r\n\r\n                {/* Background Color */}\r\n                <Box sx={{ mb: 3 }}>\r\n                    <Typography variant=\"body2\" gutterBottom>\r\n                        Background Color\r\n                    </Typography>\r\n                    <Box sx={{ display: 'flex', gap: 1, alignItems: 'center' }}>\r\n                        <TextField\r\n                            type=\"color\"\r\n                            value={customBackground}\r\n                            onChange={(e) => setCustomBackground(e.target.value)}\r\n                            sx={{ width: 60 }}\r\n                        />\r\n                        <TextField\r\n                            value={customBackground}\r\n                            onChange={(e) => setCustomBackground(e.target.value)}\r\n                            size=\"small\"\r\n                            fullWidth\r\n                        />\r\n                    </Box>\r\n                </Box>\r\n\r\n                {/* Border Radius */}\r\n                <Box sx={{ mb: 3 }}>\r\n                    <Typography variant=\"body2\" gutterBottom>\r\n                        Border Radius: {customBorderRadius}px\r\n                    </Typography>\r\n                    <Slider\r\n                        value={customBorderRadius}\r\n                        onChange={(_, value) => setCustomBorderRadius(value as number)}\r\n                        min={0}\r\n                        max={24}\r\n                        step={2}\r\n                        marks\r\n                    />\r\n                </Box>\r\n\r\n                {/* Font Family */}\r\n                <FormControl fullWidth sx={{ mb: 3 }}>\r\n                    <InputLabel>Font Family</InputLabel>\r\n                    <Select\r\n                        value={customFontFamily}\r\n                        onChange={(e) => setCustomFontFamily(e.target.value)}\r\n                        label=\"Font Family\"\r\n                    >\r\n                        <MenuItem value=\"'Inter', sans-serif\">Inter</MenuItem>\r\n                        <MenuItem value=\"'Roboto', sans-serif\">Roboto</MenuItem>\r\n                        <MenuItem value=\"'Poppins', sans-serif\">Poppins</MenuItem>\r\n                        <MenuItem value=\"'Outfit', sans-serif\">Outfit</MenuItem>\r\n                        <MenuItem value=\"'Montserrat', sans-serif\">Montserrat</MenuItem>\r\n                    </Select>\r\n                </FormControl>\r\n\r\n                <Divider sx={{ my: 3 }} />\r\n\r\n                {/* Live Preview */}\r\n                <Typography variant=\"h6\" gutterBottom>\r\n                    Preview\r\n                </Typography>\r\n                <Box\r\n                    sx={{\r\n                        p: 2,\r\n                        borderRadius: `${customBorderRadius}px`,\r\n                        bgcolor: customBackground,\r\n                        mb: 3,\r\n                    }}\r\n                >\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        fullWidth\r\n                        sx={{\r\n                            bgcolor: customPrimary,\r\n                            borderRadius: `${customBorderRadius}px`,\r\n                            fontFamily: customFontFamily,\r\n                            mb: 1,\r\n                            '&:hover': {\r\n                                bgcolor: customPrimary,\r\n                                opacity: 0.9,\r\n                            },\r\n                        }}\r\n                    >\r\n                        Primary Button\r\n                    </Button>\r\n                    <Button\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                        sx={{\r\n                            borderColor: customSecondary,\r\n                            color: customSecondary,\r\n                            borderRadius: `${customBorderRadius}px`,\r\n                            fontFamily: customFontFamily,\r\n                            '&:hover': {\r\n                                borderColor: customSecondary,\r\n                                bgcolor: `${customSecondary}20`,\r\n                            },\r\n                        }}\r\n                    >\r\n                        Secondary Button\r\n                    </Button>\r\n                </Box>\r\n\r\n                {/* Action Buttons */}\r\n                <Box sx={{ display: 'flex', gap: 2 }}>\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        fullWidth\r\n                        onClick={handleSaveCustomTheme}\r\n                    >\r\n                        Save Custom Theme\r\n                    </Button>\r\n                    <Button\r\n                        variant=\"outlined\"\r\n                        onClick={handleReset}\r\n                    >\r\n                        Reset\r\n                    </Button>\r\n                </Box>\r\n            </Box>\r\n        </Drawer>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\theme\\ThemeProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\theme\\ThemeSelector.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnimatePresence' is defined but never used.","line":25,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1425,1428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1425,1428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6896,6899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6896,6899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Theme Selector Component\r\n * Creative visual theme picker with animated gradients and interaction\r\n */\r\n\r\n'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport {\r\n    Box,\r\n    Typography,\r\n    Paper,\r\n    Grid,\r\n    IconButton,\r\n    Tooltip,\r\n    Skeleton,\r\n    alpha,\r\n    Collapse,\r\n} from '@mui/material';\r\nimport KeyboardArrowDownIcon from '@mui/icons-material/KeyboardArrowDown';\r\nimport KeyboardArrowUpIcon from '@mui/icons-material/KeyboardArrowUp';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport PaletteIcon from '@mui/icons-material/Palette';\r\nimport AutoAwesomeIcon from '@mui/icons-material/AutoAwesome';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useTheme } from '@/lib/hooks/useTheme';\r\nimport { themeList } from '@/lib/theme/themes';\r\nimport ThemeCustomizer from './ThemeCustomizer';\r\nimport { ThemeConfig } from '@/types/theme';\r\n\r\ninterface ThemeSelectorProps {\r\n    showCustomizer?: boolean;\r\n}\r\n\r\nexport default function ThemeSelector({ showCustomizer = true }: ThemeSelectorProps) {\r\n    const { themeId, setTheme, isLoading, globalThemes, systemMode } = useTheme();\r\n    const [customizerOpen, setCustomizerOpen] = useState(false);\r\n    const [isOpen, setIsOpen] = useState(false);\r\n\r\n    // Combine built-in themes with system option\r\n    const allThemes: (ThemeConfig | { id: 'system'; name: string; mode: 'light' | 'dark'; colors: any })[] = [\r\n        {\r\n            id: 'system',\r\n            name: 'System Default',\r\n            mode: systemMode,\r\n            colors: themeList.find(t => t.mode === systemMode)?.colors || themeList[0].colors\r\n        },\r\n        ...themeList,\r\n    ];\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <Paper sx={{ p: 4, borderRadius: 4 }}>\r\n                <Skeleton variant=\"text\" width={200} height={40} sx={{ mb: 1 }} />\r\n                <Skeleton variant=\"text\" width={300} height={20} sx={{ mb: 4 }} />\r\n                <Grid container spacing={3}>\r\n                    {[1, 2, 3].map((i) => (\r\n                        <Grid size={{ xs: 12, md: 4 }} key={i}>\r\n                            <Skeleton variant=\"rounded\" height={160} sx={{ borderRadius: 4 }} />\r\n                        </Grid>\r\n                    ))}\r\n                </Grid>\r\n            </Paper>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <Paper\r\n                elevation={0}\r\n                sx={{\r\n                    p: 4,\r\n                    borderRadius: 4,\r\n                    bgcolor: 'background.paper',\r\n                    border: '1px solid',\r\n                    borderColor: 'divider',\r\n                    position: 'relative',\r\n                    overflow: 'hidden',\r\n                    transition: 'all 0.3s ease'\r\n                }}\r\n            >\r\n                {/* Decorative background blur */}\r\n                <Box sx={{\r\n                    position: 'absolute',\r\n                    top: -100,\r\n                    right: -100,\r\n                    width: 300,\r\n                    height: 300,\r\n                    borderRadius: '50%',\r\n                    background: theme => `radial-gradient(circle, ${alpha(theme.palette.primary.main, 0.05)} 0%, transparent 70%)`,\r\n                    pointerEvents: 'none',\r\n                    zIndex: 0\r\n                }} />\r\n\r\n                <Box\r\n                    onClick={() => setIsOpen(!isOpen)}\r\n                    sx={{\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        mb: isOpen ? 1 : 0,\r\n                        position: 'relative',\r\n                        zIndex: 1,\r\n                        cursor: 'pointer'\r\n                    }}\r\n                >\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5 }}>\r\n                        <AutoAwesomeIcon color=\"primary\" sx={{ fontSize: 28 }} />\r\n                        <Typography variant=\"h5\" fontWeight=\"800\">\r\n                            Appearance\r\n                        </Typography>\r\n                    </Box>\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                        {showCustomizer && isOpen && (\r\n                            <Tooltip title=\"Create Custom Theme\">\r\n                                <IconButton\r\n                                    onClick={(e) => {\r\n                                        e.stopPropagation();\r\n                                        setCustomizerOpen(true);\r\n                                    }}\r\n                                    size=\"small\"\r\n                                    sx={{\r\n                                        bgcolor: 'primary.main',\r\n                                        color: 'primary.contrastText',\r\n                                        mr: 1,\r\n                                        '&:hover': {\r\n                                            bgcolor: 'primary.dark',\r\n                                        }\r\n                                    }}\r\n                                >\r\n                                    <PaletteIcon fontSize=\"small\" />\r\n                                </IconButton>\r\n                            </Tooltip>\r\n                        )}\r\n                        <IconButton size=\"small\">\r\n                            {isOpen ? <KeyboardArrowUpIcon /> : <KeyboardArrowDownIcon />}\r\n                        </IconButton>\r\n                    </Box>\r\n                </Box>\r\n\r\n                <Collapse in={isOpen}>\r\n                    <Typography variant=\"body1\" color=\"text.secondary\" sx={{ mb: 4, position: 'relative', zIndex: 1 }}>\r\n                        Choose a theme that matches your vibe.\r\n                    </Typography>\r\n\r\n                    <Grid container spacing={2.5} sx={{ position: 'relative', zIndex: 1, pb: 2 }}>\r\n                        {allThemes.map((theme) => {\r\n                            const isSelected = themeId === theme.id;\r\n                            const primaryColor = theme.colors.primary.main;\r\n                            const secondaryColor = theme.colors.secondary.main;\r\n                            const bgColor = theme.colors.background.default;\r\n                            const textColor = theme.colors.text.primary;\r\n                            const isDark = theme.mode === 'dark';\r\n\r\n                            return (\r\n                                <Grid size={{ xs: 6, md: 4, lg: 3 }} key={theme.id}>\r\n                                    <motion.div\r\n                                        whileHover={{ y: -5, scale: 1.02 }}\r\n                                        whileTap={{ scale: 0.98 }}\r\n                                    >\r\n                                        <Box\r\n                                            onClick={() => setTheme(theme.id as any)}\r\n                                            sx={{\r\n                                                height: 140,\r\n                                                borderRadius: 4,\r\n                                                position: 'relative',\r\n                                                cursor: 'pointer',\r\n                                                overflow: 'hidden',\r\n                                                bgcolor: bgColor, // Use real background color of the theme\r\n                                                border: isSelected ? `2px solid ${primaryColor}` : '1px solid',\r\n                                                borderColor: isSelected ? primaryColor : 'divider',\r\n                                                boxShadow: isSelected ? `0 8px 24px ${alpha(primaryColor, 0.25)}` : 'none',\r\n                                                transition: 'border-color 0.3s, box-shadow 0.3s',\r\n                                            }}\r\n                                        >\r\n                                            {/* Animated Color Blobs */}\r\n                                            <Box\r\n                                                component={motion.div}\r\n                                                animate={{\r\n                                                    scale: [1, 1.1, 1],\r\n                                                    rotate: [0, 5, -5, 0],\r\n                                                    x: [0, 10, -10, 0]\r\n                                                }}\r\n                                                transition={{ duration: 8, repeat: Infinity, ease: \"easeInOut\" }}\r\n                                                sx={{\r\n                                                    position: 'absolute',\r\n                                                    top: -20,\r\n                                                    right: -20,\r\n                                                    width: 100,\r\n                                                    height: 100,\r\n                                                    borderRadius: '40% 60% 70% 30% / 40% 50% 60% 50%',\r\n                                                    bgcolor: primaryColor,\r\n                                                    opacity: 0.8,\r\n                                                    filter: 'blur(10px)',\r\n                                                }}\r\n                                            />\r\n                                            <Box\r\n                                                component={motion.div}\r\n                                                animate={{\r\n                                                    scale: [1, 1.2, 1],\r\n                                                    rotate: [0, -10, 10, 0],\r\n                                                    x: [0, -5, 5, 0]\r\n                                                }}\r\n                                                transition={{ duration: 10, repeat: Infinity, ease: \"easeInOut\", delay: 1 }}\r\n                                                sx={{\r\n                                                    position: 'absolute',\r\n                                                    bottom: -30,\r\n                                                    left: -10,\r\n                                                    width: 120,\r\n                                                    height: 120,\r\n                                                    borderRadius: '60% 40% 30% 70% / 60% 30% 70% 40%',\r\n                                                    bgcolor: secondaryColor,\r\n                                                    opacity: 0.6,\r\n                                                    filter: 'blur(15px)',\r\n                                                }}\r\n                                            />\r\n\r\n                                            {/* Glassmorphism Overlay */}\r\n                                            <Box sx={{\r\n                                                position: 'absolute',\r\n                                                top: 0,\r\n                                                left: 0,\r\n                                                right: 0,\r\n                                                bottom: 0,\r\n                                                background: `linear-gradient(135deg, ${alpha('#fff', 0.1)} 0%, ${alpha('#fff', 0.0)} 100%)`,\r\n                                                backdropFilter: 'blur(0px)', // subtle \r\n                                                zIndex: 1\r\n                                            }} />\r\n\r\n                                            {/* Content */}\r\n                                            <Box sx={{\r\n                                                position: 'relative',\r\n                                                zIndex: 2,\r\n                                                height: '100%',\r\n                                                p: 2,\r\n                                                display: 'flex',\r\n                                                flexDirection: 'column',\r\n                                                justifyContent: 'space-between'\r\n                                            }}>\r\n                                                {/* Selected Checkmark */}\r\n                                                <Box sx={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n                                                    {isSelected && (\r\n                                                        <motion.div\r\n                                                            initial={{ scale: 0, rotate: -180 }}\r\n                                                            animate={{ scale: 1, rotate: 0 }}\r\n                                                            transition={{ type: \"spring\", stiffness: 200, damping: 10 }}\r\n                                                        >\r\n                                                            <CheckCircleIcon sx={{ color: isDark ? '#fff' : primaryColor, fontSize: 24, filter: 'drop-shadow(0 2px 4px rgba(0,0,0,0.2))' }} />\r\n                                                        </motion.div>\r\n                                                    )}\r\n                                                </Box>\r\n\r\n                                                {/* Theme Name */}\r\n                                                <Box>\r\n                                                    <Typography\r\n                                                        variant=\"subtitle1\"\r\n                                                        fontWeight=\"700\"\r\n                                                        sx={{\r\n                                                            color: textColor, // Use theme text color\r\n                                                            textShadow: isDark || isSelected ? '0 2px 10px rgba(0,0,0,0.1)' : 'none'\r\n                                                        }}\r\n                                                    >\r\n                                                        {theme.name}\r\n                                                    </Typography>\r\n                                                    {theme.id === 'system' && (\r\n                                                        <Typography variant=\"caption\" sx={{ color: textColor, opacity: 0.7 }}>\r\n                                                            Auto-detect\r\n                                                        </Typography>\r\n                                                    )}\r\n                                                </Box>\r\n                                            </Box>\r\n                                        </Box>\r\n                                    </motion.div>\r\n                                </Grid>\r\n                            );\r\n                        })}\r\n\r\n                        {/* Global Admin Themes */}\r\n                        {globalThemes.map((theme) => (\r\n                            <Grid size={{ xs: 6, md: 4, lg: 3 }} key={theme.id}>\r\n                                <motion.div whileHover={{ y: -5, scale: 1.02 }} whileTap={{ scale: 0.98 }}>\r\n                                    <Box\r\n                                        onClick={() => setTheme(theme.id)}\r\n                                        sx={{\r\n                                            height: 140,\r\n                                            borderRadius: 4,\r\n                                            position: 'relative',\r\n                                            cursor: 'pointer',\r\n                                            overflow: 'hidden',\r\n                                            bgcolor: theme.colors.background.default,\r\n                                            border: themeId === theme.id ? `2px solid ${theme.colors.primary.main}` : '1px solid',\r\n                                            borderColor: themeId === theme.id ? theme.colors.primary.main : 'divider',\r\n                                            boxShadow: themeId === theme.id ? 4 : 0,\r\n                                            transition: 'all 0.3s'\r\n                                        }}\r\n                                    >\r\n                                        {/* Simple gradient blob for custom themes */}\r\n                                        <Box sx={{\r\n                                            position: 'absolute',\r\n                                            top: -30, right: -30,\r\n                                            width: 140, height: 140,\r\n                                            borderRadius: '50%',\r\n                                            background: `radial-gradient(circle, ${theme.colors.primary.main} 0%, transparent 70%)`,\r\n                                            opacity: 0.4\r\n                                        }} />\r\n\r\n                                        <Box sx={{ p: 2, height: '100%', display: 'flex', flexDirection: 'column', justifyContent: 'space-between', position: 'relative', zIndex: 2 }}>\r\n                                            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>\r\n                                                <Typography\r\n                                                    variant=\"caption\"\r\n                                                    sx={{\r\n                                                        bgcolor: alpha(theme.colors.primary.main, 0.1),\r\n                                                        color: theme.colors.primary.main,\r\n                                                        px: 1, py: 0.5, borderRadius: 1, fontWeight: 'bold'\r\n                                                    }}\r\n                                                >\r\n                                                    CUSTOM\r\n                                                </Typography>\r\n                                                {themeId === theme.id && <CheckCircleIcon color=\"primary\" />}\r\n                                            </Box>\r\n                                            <Typography variant=\"subtitle1\" fontWeight=\"700\" sx={{ color: theme.colors.text.primary }}>\r\n                                                {theme.name}\r\n                                            </Typography>\r\n                                        </Box>\r\n                                    </Box>\r\n                                </motion.div>\r\n                            </Grid>\r\n                        ))}\r\n\r\n                        {/* Custom Theme Creator Card */}\r\n                        {showCustomizer && (\r\n                            <Grid size={{ xs: 6, md: 4, lg: 3 }}>\r\n                                <motion.div whileHover={{ y: -5, scale: 1.02 }} whileTap={{ scale: 0.98 }}>\r\n                                    <Box\r\n                                        onClick={() => setCustomizerOpen(true)}\r\n                                        sx={{\r\n                                            height: 140,\r\n                                            borderRadius: 4,\r\n                                            border: '2px dashed',\r\n                                            borderColor: 'divider',\r\n                                            display: 'flex',\r\n                                            flexDirection: 'column',\r\n                                            alignItems: 'center',\r\n                                            justifyContent: 'center',\r\n                                            cursor: 'pointer',\r\n                                            bgcolor: 'action.hover',\r\n                                            color: 'text.secondary',\r\n                                            gap: 1,\r\n                                            transition: 'all 0.2s',\r\n                                            '&:hover': {\r\n                                                borderColor: 'primary.main',\r\n                                                color: 'primary.main',\r\n                                                bgcolor: alpha('#6366F1', 0.05)\r\n                                            }\r\n                                        }}\r\n                                    >\r\n                                        <Box\r\n                                            sx={{\r\n                                                p: 1.5,\r\n                                                borderRadius: '50%',\r\n                                                bgcolor: 'background.paper',\r\n                                                boxShadow: 1,\r\n                                                display: 'flex',\r\n                                                mb: 1\r\n                                            }}\r\n                                        >\r\n                                            <PaletteIcon />\r\n                                        </Box>\r\n                                        <Typography variant=\"body2\" fontWeight=\"600\">Create New</Typography>\r\n                                    </Box>\r\n                                </motion.div>\r\n                            </Grid>\r\n                        )}\r\n                    </Grid>\r\n                </Collapse>\r\n            </Paper>\r\n\r\n            <ThemeCustomizer open={customizerOpen} onClose={() => setCustomizerOpen(false)} />\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\theme\\ThemeToggle.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'themeId' is assigned a value but never used.","line":27,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1599,1602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1599,1602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Theme Toggle Button\r\n * Quick theme switcher for navbar with light/dark toggle\r\n */\r\n\r\n'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport IconButton from '@mui/material/IconButton';\r\nimport Tooltip from '@mui/material/Tooltip';\r\nimport LightModeIcon from '@mui/icons-material/LightMode';\r\nimport DarkModeIcon from '@mui/icons-material/DarkMode';\r\nimport PaletteIcon from '@mui/icons-material/Palette';\r\nimport Menu from '@mui/material/Menu';\r\nimport MenuItem from '@mui/material/MenuItem';\r\nimport ListItemIcon from '@mui/material/ListItemIcon';\r\nimport ListItemText from '@mui/material/ListItemText';\r\nimport Divider from '@mui/material/Divider';\r\nimport { motion } from 'framer-motion';\r\nimport { useTheme } from '@/lib/hooks/useTheme';\r\n\r\ninterface ThemeToggleProps {\r\n    onOpenCustomizer?: () => void;\r\n}\r\n\r\nexport default function ThemeToggle({ onOpenCustomizer }: ThemeToggleProps) {\r\n    const { currentTheme, setTheme, themeId } = useTheme();\r\n    const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\r\n    const open = Boolean(anchorEl);\r\n\r\n    const handleClick = (event: React.MouseEvent<HTMLElement>) => {\r\n        setAnchorEl(event.currentTarget);\r\n    };\r\n\r\n    const handleClose = () => {\r\n        setAnchorEl(null);\r\n    };\r\n\r\n    const handleQuickToggle = () => {\r\n        // Toggle between light and dark mode\r\n        if (currentTheme.mode === 'light') {\r\n            setTheme('dark');\r\n        } else {\r\n            setTheme('default');\r\n        }\r\n    };\r\n\r\n    const handleThemeSelect = (themeId: string) => {\r\n        setTheme(themeId as any);\r\n        handleClose();\r\n    };\r\n\r\n    const handleOpenCustomizer = () => {\r\n        handleClose();\r\n        onOpenCustomizer?.();\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <Tooltip title=\"Change Theme\">\r\n                <IconButton\r\n                    component={motion.button}\r\n                    whileHover={{ scale: 1.1 }}\r\n                    whileTap={{ scale: 0.9 }}\r\n                    onClick={handleClick}\r\n                    sx={{ color: 'text.primary' }}\r\n                >\r\n                    {currentTheme.mode === 'dark' ? (\r\n                        <DarkModeIcon />\r\n                    ) : (\r\n                        <LightModeIcon />\r\n                    )}\r\n                </IconButton>\r\n            </Tooltip>\r\n\r\n            <Menu\r\n                anchorEl={anchorEl}\r\n                open={open}\r\n                onClose={handleClose}\r\n                transformOrigin={{ horizontal: 'right', vertical: 'top' }}\r\n                anchorOrigin={{ horizontal: 'right', vertical: 'bottom' }}\r\n            >\r\n                <MenuItem onClick={handleQuickToggle}>\r\n                    <ListItemIcon>\r\n                        {currentTheme.mode === 'dark' ? <LightModeIcon /> : <DarkModeIcon />}\r\n                    </ListItemIcon>\r\n                    <ListItemText>\r\n                        Switch to {currentTheme.mode === 'dark' ? 'Light' : 'Dark'} Mode\r\n                    </ListItemText>\r\n                </MenuItem>\r\n\r\n                <Divider />\r\n\r\n                <MenuItem onClick={() => handleThemeSelect('default')}>\r\n                    <ListItemText>TruthLens Default</ListItemText>\r\n                </MenuItem>\r\n\r\n                <MenuItem onClick={() => handleThemeSelect('dark')}>\r\n                    <ListItemText>Dark Mode</ListItemText>\r\n                </MenuItem>\r\n\r\n                <MenuItem onClick={() => handleThemeSelect('ocean')}>\r\n                    <ListItemText>Ocean Blue</ListItemText>\r\n                </MenuItem>\r\n\r\n                <MenuItem onClick={() => handleThemeSelect('forest')}>\r\n                    <ListItemText>Forest Green</ListItemText>\r\n                </MenuItem>\r\n\r\n                <MenuItem onClick={() => handleThemeSelect('purple')}>\r\n                    <ListItemText>Purple Dreams</ListItemText>\r\n                </MenuItem>\r\n\r\n                <Divider />\r\n\r\n                <MenuItem onClick={handleOpenCustomizer}>\r\n                    <ListItemIcon>\r\n                        <PaletteIcon />\r\n                    </ListItemIcon>\r\n                    <ListItemText>Customize Theme...</ListItemText>\r\n                </MenuItem>\r\n            </Menu>\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\ui\\AnimatedButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\ui\\AnimatedCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[996,999],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[996,999],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Animated Card Component\r\n * Card with hover animations and optional pulse effect\r\n */\r\n\r\n'use client';\r\n\r\nimport { motion } from 'framer-motion';\r\nimport { Card, CardProps } from '@mui/material';\r\nimport { ReactNode, forwardRef } from 'react';\r\n\r\ninterface AnimatedCardProps extends Omit<CardProps, 'component'> {\r\n    children: ReactNode;\r\n    hoverScale?: number;\r\n    hoverY?: number;\r\n    enablePulse?: boolean;\r\n}\r\n\r\nconst AnimatedCard = forwardRef<HTMLDivElement, AnimatedCardProps>(\r\n    ({ children, hoverScale = 1.02, hoverY = -5, enablePulse = false, ...props }, ref) => {\r\n        const pulseAnimation = enablePulse\r\n            ? {\r\n                scale: [1, 1.02, 1],\r\n                transition: {\r\n                    duration: 2,\r\n                    repeat: Infinity,\r\n                    ease: 'easeInOut',\r\n                },\r\n            }\r\n            : {};\r\n\r\n        return (\r\n            <Card\r\n                ref={ref}\r\n                component={motion.div as any}\r\n                whileHover={{\r\n                    scale: hoverScale,\r\n                    y: hoverY,\r\n                }}\r\n                animate={pulseAnimation}\r\n                transition={{\r\n                    type: 'spring',\r\n                    stiffness: 300,\r\n                    damping: 20,\r\n                }}\r\n                {...props}\r\n            >\r\n                {children}\r\n            </Card>\r\n        );\r\n    }\r\n);\r\n\r\nAnimatedCard.displayName = 'AnimatedCard';\r\n\r\nexport default AnimatedCard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\ui\\EmptyState.tsx","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":90,"column":18,"nodeType":"Block","messageId":"tsIgnoreInsteadOfExpectError","endLine":90,"endColumn":34,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[2679,2695],"text":"/* @ts-expect-error */"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Empty State Component\r\n * Display when no data is available\r\n */\r\n\r\n'use client';\r\n\r\nimport { Box, Typography, Button } from '@mui/material';\r\nimport { motion } from 'framer-motion';\r\nimport { ReactNode } from 'react';\r\n\r\ninterface EmptyStateProps {\r\n    icon?: ReactNode;\r\n    title: string;\r\n    description?: string;\r\n    actionLabel?: string;\r\n    onAction?: () => void;\r\n    secondaryActionLabel?: string;\r\n    onSecondaryAction?: () => void;\r\n}\r\n\r\nexport default function EmptyState({\r\n    icon,\r\n    title,\r\n    description,\r\n    actionLabel,\r\n    onAction,\r\n    ...props\r\n}: EmptyStateProps) {\r\n    return (\r\n        <Box\r\n            component={motion.div}\r\n            initial={{ opacity: 0, scale: 0.9 }}\r\n            animate={{ opacity: 1, scale: 1 }}\r\n            transition={{ duration: 0.3 }}\r\n            sx={{\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                textAlign: 'center',\r\n                py: 8,\r\n                px: 3,\r\n            }}\r\n        >\r\n            {icon && (\r\n                <Box\r\n                    component={motion.div}\r\n                    animate={{\r\n                        y: [0, -10, 0],\r\n                    }}\r\n                    transition={{\r\n                        duration: 2,\r\n                        repeat: Infinity,\r\n                        ease: 'easeInOut',\r\n                    }}\r\n                    sx={{\r\n                        fontSize: '4rem',\r\n                        color: 'text.secondary',\r\n                        mb: 3,\r\n                    }}\r\n                >\r\n                    {icon}\r\n                </Box>\r\n            )}\r\n\r\n            <Typography variant=\"h5\" gutterBottom fontWeight=\"medium\">\r\n                {title}\r\n            </Typography>\r\n\r\n            {description && (\r\n                <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 3, maxWidth: 400 }}>\r\n                    {description}\r\n                </Typography>\r\n            )}\r\n\r\n            <Box sx={{ display: 'flex', gap: 2, flexWrap: 'wrap', justifyContent: 'center' }}>\r\n                {actionLabel && onAction && (\r\n                    <Button\r\n                        component={motion.button}\r\n                        whileHover={{ scale: 1.05 }}\r\n                        whileTap={{ scale: 0.95 }}\r\n                        variant=\"contained\"\r\n                        onClick={onAction}\r\n                        sx={{ minWidth: 140 }}\r\n                    >\r\n                        {actionLabel}\r\n                    </Button>\r\n                )}\r\n                {/* @ts-ignore */}\r\n                {props.secondaryActionLabel && props.onSecondaryAction && (\r\n                    <Button\r\n                        component={motion.button}\r\n                        whileHover={{ scale: 1.05 }}\r\n                        whileTap={{ scale: 0.95 }}\r\n                        variant=\"outlined\"\r\n                        onClick={props.onSecondaryAction}\r\n                        sx={{ minWidth: 140 }}\r\n                    >\r\n                        {props.secondaryActionLabel}\r\n                    </Button>\r\n                )}\r\n            </Box>\r\n        </Box>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\ui\\GlassCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'theme' is defined but never used.","line":14,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { Box, BoxProps } from '@mui/material';\r\nimport { styled } from '@mui/material/styles';\r\n\r\ninterface GlassCardProps extends BoxProps {\r\n    blur?: number;\r\n    opacity?: number;\r\n    hoverEffect?: boolean;\r\n}\r\n\r\nconst StyledBox = styled(Box, {\r\n    shouldForwardProp: (prop) => prop !== 'blur' && prop !== 'opacity' && prop !== 'hoverEffect',\r\n})<GlassCardProps>(({ theme, blur = 10, opacity = 0.7, hoverEffect = false }) => ({\r\n    background: `rgba(30, 30, 30, ${opacity})`,\r\n    backdropFilter: `blur(${blur}px)`,\r\n    WebkitBackdropFilter: `blur(${blur}px)`, // Safari support\r\n    border: '1px solid rgba(255, 255, 255, 0.1)',\r\n    borderRadius: '24px',\r\n    boxShadow: '0 8px 32px 0 rgba(0, 0, 0, 0.37)',\r\n    transition: 'all 0.3s ease-in-out',\r\n\r\n    ...(hoverEffect && {\r\n        '&:hover': {\r\n            background: `rgba(40, 40, 40, ${opacity + 0.1})`,\r\n            transform: 'translateY(-4px)',\r\n            boxShadow: '0 12px 40px 0 rgba(108, 99, 255, 0.2)',\r\n            border: '1px solid rgba(108, 99, 255, 0.3)',\r\n        },\r\n    }),\r\n}));\r\n\r\nexport default function GlassCard({ children, ...props }: GlassCardProps) {\r\n    return <StyledBox {...props}>{children}</StyledBox>;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\ui\\LoadingSpinner.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'size' is assigned a value but never used.","line":19,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":9},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[742,745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[742,745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Loading Spinner Component\r\n * Beautiful animated loader with theme-aware colors\r\n */\r\n\r\n'use client';\r\n\r\nimport { motion } from 'framer-motion';\r\nimport { Box, Typography } from '@mui/material';\r\nimport QrCodeScannerIcon from '@mui/icons-material/QrCodeScanner';\r\n\r\ninterface LoadingSpinnerProps {\r\n    size?: number;\r\n    message?: string;\r\n    fullScreen?: boolean;\r\n}\r\n\r\nexport default function LoadingSpinner({\r\n    size = 40,\r\n    message,\r\n    fullScreen = false,\r\n}: LoadingSpinnerProps) {\r\n    const dotVariants = {\r\n        start: { y: 0 },\r\n        end: { y: -10 }\r\n    };\r\n\r\n    const dotTransition = {\r\n        duration: 0.5,\r\n        repeat: Infinity,\r\n        repeatType: 'reverse',\r\n        ease: 'easeInOut'\r\n    } as any;\r\n\r\n    const content = (\r\n        <Box\r\n            sx={{\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                gap: 3,\r\n            }}\r\n        >\r\n            {/* Animated Icon with Pulse */}\r\n            <motion.div\r\n                animate={{\r\n                    scale: [1, 1.1, 1],\r\n                    rotate: [0, 5, -5, 0],\r\n                }}\r\n                transition={{\r\n                    duration: 2,\r\n                    repeat: Infinity,\r\n                    ease: 'easeInOut',\r\n                }}\r\n            >\r\n                <Box\r\n                    sx={{\r\n                        position: 'relative',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                    }}\r\n                >\r\n                    {/* Pulsing Gradient Background */}\r\n                    <motion.div\r\n                        animate={{\r\n                            scale: [1, 1.5, 1],\r\n                            opacity: [0.3, 0.6, 0.3],\r\n                        }}\r\n                        transition={{\r\n                            duration: 2,\r\n                            repeat: Infinity,\r\n                            ease: 'easeInOut',\r\n                        }}\r\n                        style={{\r\n                            position: 'absolute',\r\n                            width: 100,\r\n                            height: 100,\r\n                            borderRadius: '50%',\r\n                            background: 'linear-gradient(135deg, rgba(108, 99, 255, 0.4) 0%, rgba(0, 240, 255, 0.4) 100%)',\r\n                            filter: 'blur(20px)',\r\n                        }}\r\n                    />\r\n\r\n                    {/* Icon */}\r\n                    <QrCodeScannerIcon\r\n                        sx={{\r\n                            fontSize: { xs: 50, sm: 60 },\r\n                            color: '#6C63FF',\r\n                            position: 'relative',\r\n                            zIndex: 1,\r\n                        }}\r\n                    />\r\n                </Box>\r\n            </motion.div>\r\n\r\n            {/* Bouncing Dots */}\r\n            <Box sx={{ display: 'flex', gap: { xs: 0.75, sm: 1 }, alignItems: 'center' }}>\r\n                <motion.div\r\n                    variants={dotVariants}\r\n                    animate=\"end\"\r\n                    transition={{ ...dotTransition, delay: 0 }}\r\n                >\r\n                    <Box\r\n                        sx={{\r\n                            width: 10,\r\n                            height: 10,\r\n                            borderRadius: '50%',\r\n                            bgcolor: '#6C63FF',\r\n                        }}\r\n                    />\r\n                </motion.div>\r\n                <motion.div\r\n                    variants={dotVariants}\r\n                    animate=\"end\"\r\n                    transition={{ ...dotTransition, delay: 0.2 }}\r\n                >\r\n                    <Box\r\n                        sx={{\r\n                            width: 10,\r\n                            height: 10,\r\n                            borderRadius: '50%',\r\n                            bgcolor: '#00F0FF',\r\n                        }}\r\n                    />\r\n                </motion.div>\r\n                <motion.div\r\n                    variants={dotVariants}\r\n                    animate=\"end\"\r\n                    transition={{ ...dotTransition, delay: 0.4 }}\r\n                >\r\n                    <Box\r\n                        sx={{\r\n                            width: 10,\r\n                            height: 10,\r\n                            borderRadius: '50%',\r\n                            bgcolor: '#6C63FF',\r\n                        }}\r\n                    />\r\n                </motion.div>\r\n            </Box>\r\n\r\n            {/* Message with Fade Animation */}\r\n            {message && (\r\n                <motion.div\r\n                    initial={{ opacity: 0, y: 10 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ duration: 0.5 }}\r\n                >\r\n                    <Typography\r\n                        variant=\"h6\"\r\n                        sx={{\r\n                            fontSize: { xs: '1rem', sm: '1.25rem' },\r\n                            background: 'linear-gradient(45deg, #6C63FF 30%, #00F0FF 90%)',\r\n                            backgroundClip: 'text',\r\n                            WebkitBackgroundClip: 'text',\r\n                            WebkitTextFillColor: 'transparent',\r\n                            fontWeight: 600,\r\n                            textAlign: 'center',\r\n                        }}\r\n                    >\r\n                        {message}\r\n                    </Typography>\r\n                </motion.div>\r\n            )}\r\n        </Box>\r\n    );\r\n\r\n    if (fullScreen) {\r\n        return (\r\n            <Box\r\n                component={motion.div}\r\n                initial={{ opacity: 0 }}\r\n                animate={{ opacity: 1 }}\r\n                sx={{\r\n                    position: 'fixed',\r\n                    top: 0,\r\n                    left: 0,\r\n                    right: 0,\r\n                    bottom: 0,\r\n                    width: '100vw',\r\n                    height: '100vh',\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    bgcolor: 'background.default',\r\n                    zIndex: 9999,\r\n                    px: 2, // Horizontal padding for mobile\r\n                    m: 0, // Ensure no margin\r\n                }}\r\n            >\r\n                {content}\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    return content;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\ui\\SearchingAnimation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\ui\\SkeletonCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\ui\\WelcomeModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":3,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Container' is defined but never used.","line":4,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":57}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Box, Typography, Button, Modal, Fade, Container } from '@mui/material';\r\nimport { motion } from 'framer-motion';\r\nimport WavingHandIcon from '@mui/icons-material/WavingHand';\r\nimport ArrowForwardIcon from '@mui/icons-material/ArrowForward';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\ninterface WelcomeModalProps {\r\n    open: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport default function WelcomeModal({ open, onClose }: WelcomeModalProps) {\r\n    const router = useRouter();\r\n    const { t } = useTranslation();\r\n\r\n    const handleGetStarted = () => {\r\n        onClose();\r\n        router.push('/signup');\r\n    };\r\n\r\n    const handleExplore = () => {\r\n        onClose();\r\n    };\r\n\r\n    return (\r\n        <Modal\r\n            open={open}\r\n            onClose={onClose}\r\n            closeAfterTransition\r\n            sx={{\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n            }}\r\n        >\r\n            <Fade in={open}>\r\n                <Box\r\n                    component={motion.div}\r\n                    initial={{ scale: 0.9, opacity: 0 }}\r\n                    animate={{ scale: 1, opacity: 1 }}\r\n                    transition={{ duration: 0.3 }}\r\n                    sx={{\r\n                        position: 'relative',\r\n                        width: { xs: '90%', sm: 500 },\r\n                        bgcolor: '#121212', // Solid dark background\r\n                        color: '#fff',\r\n                        borderRadius: 4,\r\n                        boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.5)',\r\n                        p: 4,\r\n                        outline: 'none',\r\n                        // Gradient Overlay using background-image to not override color if possible, or just a solid gradient\r\n                        background: 'linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%)',\r\n                        border: '1px solid rgba(255, 255, 255, 0.1)',\r\n                        // Additional readability\r\n                        backdropFilter: 'blur(10px)',\r\n                    }}\r\n                >\r\n                    {/* Decorative Elements */}\r\n                    <Box\r\n                        sx={{\r\n                            position: 'absolute',\r\n                            top: -50,\r\n                            right: -50,\r\n                            width: 150,\r\n                            height: 150,\r\n                            borderRadius: '50%',\r\n                            background: 'radial-gradient(circle, rgba(108,99,255,0.2) 0%, transparent 70%)',\r\n                            filter: 'blur(40px)',\r\n                            pointerEvents: 'none',\r\n                        }}\r\n                    />\r\n\r\n                    {/* Icon */}\r\n                    <Box sx={{ display: 'flex', justifyContent: 'center', mb: 3 }}>\r\n                        <Box\r\n                            component={motion.div}\r\n                            animate={{ rotate: [0, 15, -15, 15, 0] }}\r\n                            transition={{ duration: 1.5, repeat: Infinity, repeatDelay: 2 }}\r\n                            sx={{\r\n                                width: 80,\r\n                                height: 80,\r\n                                borderRadius: '50%',\r\n                                bgcolor: 'rgba(108, 99, 255, 0.1)',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                            }}\r\n                        >\r\n                            <WavingHandIcon sx={{ fontSize: 48, color: '#6C63FF' }} />\r\n                        </Box>\r\n                    </Box>\r\n\r\n                    {/* Content */}\r\n                    <Typography\r\n                        variant=\"h4\"\r\n                        fontWeight=\"bold\"\r\n                        textAlign=\"center\"\r\n                        sx={{\r\n                            mb: 2,\r\n                            background: 'linear-gradient(45deg, #6C63FF, #00F0FF)',\r\n                            WebkitBackgroundClip: 'text',\r\n                            WebkitTextFillColor: 'transparent',\r\n                        }}\r\n                    >\r\n                        {t('welcome_modal_title')}\r\n                    </Typography>\r\n\r\n                    <Typography\r\n                        variant=\"body1\"\r\n                        textAlign=\"center\"\r\n                        color=\"text.secondary\"\r\n                        sx={{ mb: 4, lineHeight: 1.6 }}\r\n                    >\r\n                        {t('welcome_modal_desc')}\r\n                    </Typography>\r\n\r\n                    {/* Key Features */}\r\n                    <Box sx={{ mb: 4 }}>\r\n                        {[\r\n                            t('welcome_feature_1'),\r\n                            t('welcome_feature_2'),\r\n                            t('welcome_feature_3'),\r\n                        ].map((feature, i) => (\r\n                            <Box\r\n                                key={i}\r\n                                component={motion.div}\r\n                                initial={{ opacity: 0, x: -20 }}\r\n                                animate={{ opacity: 1, x: 0 }}\r\n                                transition={{ delay: i * 0.1 + 0.3 }}\r\n                                sx={{\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    mb: 1.5,\r\n                                    p: 1.5,\r\n                                    borderRadius: 2,\r\n                                    bgcolor: 'rgba(255,255,255,0.05)',\r\n                                    border: '1px solid rgba(255,255,255,0.1)',\r\n                                }}\r\n                            >\r\n                                <Typography variant=\"body2\">{feature}</Typography>\r\n                            </Box>\r\n                        ))}\r\n                    </Box>\r\n\r\n                    {/* Actions */}\r\n                    <Box sx={{ display: 'flex', gap: 2, flexDirection: { xs: 'column', sm: 'row' } }}>\r\n                        <Button\r\n                            fullWidth\r\n                            variant=\"contained\"\r\n                            size=\"large\"\r\n                            endIcon={<ArrowForwardIcon />}\r\n                            onClick={handleGetStarted}\r\n                            sx={{\r\n                                py: 1.5,\r\n                                background: 'linear-gradient(45deg, #6C63FF 30%, #00F0FF 90%)',\r\n                                boxShadow: '0 8px 32px rgba(108, 99, 255, 0.4)',\r\n                                '&:hover': {\r\n                                    transform: 'translateY(-2px)',\r\n                                    boxShadow: '0 12px 40px rgba(108, 99, 255, 0.5)',\r\n                                },\r\n                                transition: 'all 0.3s',\r\n                            }}\r\n                        >\r\n                            {t('welcome_get_started_free')}\r\n                        </Button>\r\n                        <Button\r\n                            fullWidth\r\n                            variant=\"outlined\"\r\n                            size=\"large\"\r\n                            onClick={handleExplore}\r\n                            sx={{\r\n                                py: 1.5,\r\n                                borderColor: 'rgba(108, 99, 255, 0.5)',\r\n                                color: 'text.primary',\r\n                                '&:hover': {\r\n                                    borderColor: '#6C63FF',\r\n                                    bgcolor: 'rgba(108, 99, 255, 0.05)',\r\n                                },\r\n                            }}\r\n                        >\r\n                            {t('welcome_explore_first')}\r\n                        </Button>\r\n                    </Box>\r\n                </Box>\r\n            </Fade>\r\n        </Modal>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\user\\DietaryPreferencesSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardActionArea' is defined but never used.","line":23,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Fade' is defined but never used.","line":25,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircleIcon' is defined but never used.","line":28,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Dietary Preferences Section\r\n * Modern, card-based UI for managing user dietary settings\r\n */\r\n\r\n'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport {\r\n    Box,\r\n    Typography,\r\n    Paper,\r\n    Grid,\r\n    Switch,\r\n    Chip,\r\n    Button,\r\n    Alert,\r\n    IconButton,\r\n    TextField,\r\n    Autocomplete,\r\n    alpha,\r\n    CardActionArea,\r\n    Collapse,\r\n    Fade\r\n} from '@mui/material';\r\nimport AutoAwesomeIcon from '@mui/icons-material/AutoAwesome';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport EggAltIcon from '@mui/icons-material/EggAlt'; // Protein/Keto\r\nimport GrassIcon from '@mui/icons-material/Grass'; // Vegan\r\nimport WaterDropIcon from '@mui/icons-material/WaterDrop'; // Diabetic/Sugar\r\nimport FavoriteIcon from '@mui/icons-material/Favorite'; // Heart/Sodium\r\nimport SpaIcon from '@mui/icons-material/Spa'; // Gluten Free\r\nimport WarningAmberIcon from '@mui/icons-material/WarningAmber';\r\nimport SaveIcon from '@mui/icons-material/Save';\r\nimport Brightness3Icon from '@mui/icons-material/Brightness3'; // Halal\r\nimport KeyboardArrowDownIcon from '@mui/icons-material/KeyboardArrowDown';\r\nimport KeyboardArrowUpIcon from '@mui/icons-material/KeyboardArrowUp';\r\nimport RestaurantMenuIcon from '@mui/icons-material/RestaurantMenu';\r\nimport { motion } from 'framer-motion';\r\nimport { DietaryPreferences } from '@/types/user';\r\n\r\ninterface DietaryPreferencesSectionProps {\r\n    preferences: DietaryPreferences;\r\n    onChange: (key: keyof DietaryPreferences) => void;\r\n    onUpdateGranular: (key: 'allergens' | 'avoidIngredients' | 'healthGoals', value: string[]) => void;\r\n    onSave: () => void;\r\n    onAiSetup: () => void;\r\n    isSaving: boolean;\r\n}\r\n\r\nconst DIET_TYPES = [\r\n    { key: 'isKeto' as const, labelKey: 'diet_keto_label', descKey: 'diet_keto_desc', icon: EggAltIcon, color: '#F59E0B' },\r\n    { key: 'isVegan' as const, labelKey: 'diet_vegan_label', descKey: 'diet_vegan_desc', icon: GrassIcon, color: '#10B981' },\r\n    { key: 'isDiabetic' as const, labelKey: 'diet_diabetic_label', descKey: 'diet_diabetic_desc', icon: WaterDropIcon, color: '#3B82F6' },\r\n    { key: 'lowSodium' as const, labelKey: 'diet_lowsodium_label', descKey: 'diet_lowsodium_desc', icon: FavoriteIcon, color: '#EF4444' },\r\n    { key: 'glutenFree' as const, labelKey: 'diet_glutenfree_label', descKey: 'diet_glutenfree_desc', icon: SpaIcon, color: '#8B5CF6' },\r\n    { key: 'isHalal' as const, labelKey: 'diet_halal_label', descKey: 'diet_halal_desc', icon: Brightness3Icon, color: '#059669' },\r\n];\r\n\r\nexport default function DietaryPreferencesSection({\r\n    preferences,\r\n    onChange,\r\n    onUpdateGranular,\r\n    onSave,\r\n    onAiSetup,\r\n    isSaving\r\n}: DietaryPreferencesSectionProps) {\r\n    const { t } = useTranslation();\r\n    const [isOpen, setIsOpen] = useState(false);\r\n\r\n    return (\r\n        <Paper elevation={0} sx={{\r\n            p: 4,\r\n            borderRadius: 4,\r\n            bgcolor: 'background.paper',\r\n            border: '1px solid',\r\n            borderColor: 'divider',\r\n            position: 'relative',\r\n            overflow: 'hidden',\r\n            transition: 'all 0.3s ease'\r\n        }}>\r\n            {/* Header - Clickable for toggle */}\r\n            <Box\r\n                onClick={() => setIsOpen(!isOpen)}\r\n                sx={{\r\n                    display: 'flex',\r\n                    justifyContent: 'space-between',\r\n                    alignItems: 'center',\r\n                    mb: isOpen ? 3 : 0,\r\n                    cursor: 'pointer'\r\n                }}\r\n            >\r\n                <Box>\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5 }}>\r\n                        <RestaurantMenuIcon color=\"primary\" sx={{ fontSize: 28 }} />\r\n                        <Typography variant=\"h5\" fontWeight=\"800\" gutterBottom={false}>\r\n                            {t('dietary_preferences_title')}\r\n                        </Typography>\r\n                        <IconButton size=\"small\">\r\n                            {isOpen ? <KeyboardArrowUpIcon /> : <KeyboardArrowDownIcon />}\r\n                        </IconButton>\r\n                    </Box>\r\n                    <Typography variant=\"body2\" color=\"text.secondary\" sx={{ ml: 5 }}>\r\n                        {t('dietary_preferences_subtitle')}\r\n                    </Typography>\r\n                </Box>\r\n                <Button\r\n                    variant=\"contained\"\r\n                    onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        onAiSetup();\r\n                    }}\r\n                    sx={{\r\n                        borderRadius: 3,\r\n                        background: 'linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%)',\r\n                        boxShadow: '0 4px 14px 0 rgba(99, 102, 241, 0.39)',\r\n                        textTransform: 'none',\r\n                        px: 3\r\n                    }}\r\n                    startIcon={<AutoAwesomeIcon />}\r\n                >\r\n                    {t('ai_setup_button')}\r\n                </Button>\r\n            </Box>\r\n\r\n            <Collapse in={isOpen}>\r\n                <Alert\r\n                    icon={<AutoAwesomeIcon fontSize=\"inherit\" />}\r\n                    severity=\"info\"\r\n                    sx={{\r\n                        mb: 4,\r\n                        borderRadius: 3,\r\n                        bgcolor: alpha('#6366F1', 0.05),\r\n                        color: 'text.primary',\r\n                        border: '1px solid',\r\n                        borderColor: alpha('#6366F1', 0.1),\r\n                        '& .MuiAlert-icon': { color: '#6366F1' }\r\n                    }}\r\n                >\r\n                    {t('ai_analysis_info')}\r\n                </Alert>\r\n\r\n                {/* Diet Types Grid */}\r\n                <Typography variant=\"h6\" fontWeight=\"bold\" sx={{ mb: 2 }}>\r\n                    {t('core_diets_title')}\r\n                </Typography>\r\n\r\n                <Grid container spacing={2} sx={{ mb: 4 }}>\r\n                    {DIET_TYPES.map((diet) => {\r\n                        const isActive = preferences[diet.key];\r\n                        const Icon = diet.icon;\r\n\r\n                        return (\r\n                            <Grid size={{ xs: 12, sm: 6, lg: 4 }} key={diet.key}>\r\n                                <motion.div whileHover={{ y: -2 }} whileTap={{ scale: 0.98 }}>\r\n                                    <Paper\r\n                                        elevation={0}\r\n                                        onClick={() => onChange(diet.key)}\r\n                                        sx={{\r\n                                            p: 2,\r\n                                            borderRadius: 3,\r\n                                            cursor: 'pointer',\r\n                                            border: '1px solid',\r\n                                            borderColor: isActive ? diet.color : 'divider',\r\n                                            bgcolor: isActive ? alpha(diet.color, 0.05) : 'background.paper',\r\n                                            transition: 'all 0.2s ease',\r\n                                            display: 'flex',\r\n                                            alignItems: 'center',\r\n                                            gap: 2,\r\n                                            position: 'relative',\r\n                                            overflow: 'hidden'\r\n                                        }}\r\n                                    >\r\n                                        <Box sx={{\r\n                                            p: 1.5,\r\n                                            borderRadius: '50%',\r\n                                            bgcolor: isActive ? diet.color : alpha(diet.color, 0.1),\r\n                                            color: isActive ? '#fff' : diet.color,\r\n                                            display: 'flex'\r\n                                        }}>\r\n                                            <Icon />\r\n                                        </Box>\r\n                                        <Box sx={{ flex: 1 }}>\r\n                                            <Typography variant=\"body1\" fontWeight=\"bold\">\r\n                                                {t(diet.labelKey)}\r\n                                            </Typography>\r\n                                            <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                                {t(diet.descKey)}\r\n                                            </Typography>\r\n                                        </Box>\r\n                                        <Switch\r\n                                            checked={isActive as boolean}\r\n                                            onChange={() => onChange(diet.key)}\r\n                                            onClick={(e) => e.stopPropagation()}\r\n                                            color=\"primary\"\r\n                                            sx={{\r\n                                                '& .MuiSwitch-switchBase.Mui-checked': {\r\n                                                    color: diet.color,\r\n                                                    '&:hover': { backgroundColor: alpha(diet.color, 0.08) },\r\n                                                },\r\n                                                '& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track': {\r\n                                                    backgroundColor: diet.color,\r\n                                                },\r\n                                            }}\r\n                                        />\r\n                                    </Paper>\r\n                                </motion.div>\r\n                            </Grid>\r\n                        );\r\n                    })}\r\n                </Grid>\r\n\r\n                {/* Granular Preferences */}\r\n                <Typography variant=\"h6\" fontWeight=\"bold\" sx={{ mb: 2 }}>\r\n                    {t('specific_needs_title')}\r\n                </Typography>\r\n\r\n                <Grid container spacing={3}>\r\n                    <Grid size={{ xs: 12, md: 6 }}>\r\n                        <Paper variant=\"outlined\" sx={{ p: 3, borderRadius: 3, height: '100%', borderColor: alpha('#EF4444', 0.2), bgcolor: alpha('#EF4444', 0.02) }}>\r\n                            <Box sx={{ display: 'flex', gap: 1, alignItems: 'center', mb: 2 }}>\r\n                                <WarningAmberIcon color=\"error\" />\r\n                                <Typography variant=\"subtitle1\" fontWeight=\"bold\">{t('allergens_title')}</Typography>\r\n                            </Box>\r\n                            <Autocomplete\r\n                                multiple\r\n                                freeSolo\r\n                                options={[]}\r\n                                value={preferences.allergens || []}\r\n                                onChange={(e, newValue) => onUpdateGranular('allergens', newValue as string[])}\r\n                                renderTags={(value, getTagProps) =>\r\n                                    value.map((option, index) => (\r\n                                        <Chip variant=\"filled\" label={option} color=\"error\" size=\"small\" {...getTagProps({ index })} key={index} />\r\n                                    ))\r\n                                }\r\n                                renderInput={(params) => (\r\n                                    <TextField\r\n                                        {...params}\r\n                                        variant=\"outlined\"\r\n                                        placeholder={t('placeholder_add_allergens')}\r\n                                        sx={{ bgcolor: 'background.paper', borderRadius: 1 }}\r\n                                    />\r\n                                )}\r\n                            />\r\n                            <Typography variant=\"caption\" color=\"text.secondary\" sx={{ mt: 1, display: 'block' }}>\r\n                                {t('allergens_help')}\r\n                            </Typography>\r\n                        </Paper>\r\n                    </Grid>\r\n\r\n                    <Grid size={{ xs: 12, md: 6 }}>\r\n                        <Paper variant=\"outlined\" sx={{ p: 3, borderRadius: 3, height: '100%', borderColor: alpha('#F59E0B', 0.2), bgcolor: alpha('#F59E0B', 0.02) }}>\r\n                            <Box sx={{ display: 'flex', gap: 1, alignItems: 'center', mb: 2 }}>\r\n                                <WarningAmberIcon color=\"warning\" />\r\n                                <Typography variant=\"subtitle1\" fontWeight=\"bold\">{t('avoid_ingredients_title')}</Typography>\r\n                            </Box>\r\n                            <Autocomplete\r\n                                multiple\r\n                                freeSolo\r\n                                options={[]}\r\n                                value={preferences.avoidIngredients || []}\r\n                                onChange={(e, newValue) => onUpdateGranular('avoidIngredients', newValue as string[])}\r\n                                renderTags={(value, getTagProps) =>\r\n                                    value.map((option, index) => (\r\n                                        <Chip variant=\"filled\" label={option} color=\"warning\" size=\"small\" {...getTagProps({ index })} key={index} />\r\n                                    ))\r\n                                }\r\n                                renderInput={(params) => (\r\n                                    <TextField\r\n                                        {...params}\r\n                                        variant=\"outlined\"\r\n                                        placeholder={t('placeholder_add_ingredients')}\r\n                                        sx={{ bgcolor: 'background.paper', borderRadius: 1 }}\r\n                                    />\r\n                                )}\r\n                            />\r\n                            <Typography variant=\"caption\" color=\"text.secondary\" sx={{ mt: 1, display: 'block' }}>\r\n                                {t('avoid_ingredients_help')}\r\n                            </Typography>\r\n                        </Paper>\r\n                    </Grid>\r\n\r\n                    <Grid size={{ xs: 12 }}>\r\n                        <Paper variant=\"outlined\" sx={{ p: 3, borderRadius: 3, borderColor: alpha('#10B981', 0.2), bgcolor: alpha('#10B981', 0.02) }}>\r\n                            <Box sx={{ display: 'flex', gap: 1, alignItems: 'center', mb: 2 }}>\r\n                                <AutoAwesomeIcon color=\"success\" />\r\n                                <Typography variant=\"subtitle1\" fontWeight=\"bold\">{t('health_goals_title')}</Typography>\r\n                            </Box>\r\n                            <Autocomplete\r\n                                multiple\r\n                                freeSolo\r\n                                options={['High Protein', 'Low Carb', 'Muscle Gain', 'Weight Loss', 'Heart Health']}\r\n                                value={preferences.healthGoals || []}\r\n                                onChange={(e, newValue) => onUpdateGranular('healthGoals', newValue as string[])}\r\n                                renderTags={(value, getTagProps) =>\r\n                                    value.map((option, index) => (\r\n                                        <Chip variant=\"filled\" label={option} color=\"success\" size=\"small\" {...getTagProps({ index })} key={index} />\r\n                                    ))\r\n                                }\r\n                                renderInput={(params) => (\r\n                                    <TextField\r\n                                        {...params}\r\n                                        variant=\"outlined\"\r\n                                        placeholder={t('placeholder_select_type')}\r\n                                        sx={{ bgcolor: 'background.paper', borderRadius: 1 }}\r\n                                    />\r\n                                )}\r\n                            />\r\n                            <Typography variant=\"caption\" color=\"text.secondary\" sx={{ mt: 1, display: 'block' }}>\r\n                                {t('health_goals_help')}\r\n                            </Typography>\r\n                        </Paper>\r\n                    </Grid>\r\n                </Grid>\r\n\r\n                <Box sx={{ mt: 4, display: 'flex', justifyContent: 'flex-end' }}>\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        size=\"large\"\r\n                        onClick={onSave}\r\n                        disabled={isSaving}\r\n                        startIcon={isSaving ? undefined : <SaveIcon />}\r\n                        sx={{\r\n                            borderRadius: 3,\r\n                            px: 4,\r\n                            py: 1.5,\r\n                            boxShadow: 4,\r\n                            bgcolor: 'primary.main',\r\n                            '&:hover': { bgcolor: 'primary.dark' }\r\n                        }}\r\n                    >\r\n                        {isSaving ? t('saving_changes') : t('save_preferences')}\r\n                    </Button>\r\n                </Box>\r\n            </Collapse>\r\n        </Paper>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\components\\user\\UserHome.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isPro' is assigned a value but never used.","line":33,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tierFeatures' is assigned a value but never used.","line":33,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'dietaryPreferences' is assigned a value but never used.","line":33,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6244,6247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6244,6247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6308,6311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6308,6311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'query'. Either include it or remove the dependency array.","line":140,"column":8,"nodeType":"ArrayExpression","endLine":140,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [query, searchParams]","fix":{"range":[6724,6738],"text":"[query, searchParams]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 't'. Either include it or remove the dependency array.","line":214,"column":8,"nodeType":"ArrayExpression","endLine":214,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [t, user]","fix":{"range":[9377,9383],"text":"[t, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":429,"column":141,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":429,"endColumn":144,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21078,21081],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21078,21081],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":429,"column":170,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":429,"endColumn":173,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21107,21110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21107,21110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":496,"column":153,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":496,"endColumn":156,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25399,25402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25399,25402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":496,"column":182,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":496,"endColumn":185,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25428,25431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25428,25431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":603,"column":169,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":603,"endColumn":172,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32765,32768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32765,32768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":603,"column":198,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":603,"endColumn":201,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32794,32797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32794,32797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Box, Container, Typography, Grid, Paper, IconButton, Avatar, InputBase, CircularProgress } from '@mui/material';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport TierBadge from '@/components/subscription/TierBadge';\r\nimport SearchIcon from '@mui/icons-material/Search';\r\nimport QrCodeScannerIcon from '@mui/icons-material/QrCodeScanner';\r\nimport HistoryIcon from '@mui/icons-material/History';\r\nimport RecommendIcon from '@mui/icons-material/Recommend';\r\nimport KeyboardArrowRightIcon from '@mui/icons-material/KeyboardArrowRight';\r\nimport StarIcon from '@mui/icons-material/Star';\r\nimport PersonIcon from '@mui/icons-material/Person';\r\nimport PublicIcon from '@mui/icons-material/Public';\r\nimport CloseIcon from '@mui/icons-material/Close';\r\nimport FavoriteIcon from '@mui/icons-material/Favorite';\r\nimport ChatBubbleOutlineIcon from '@mui/icons-material/ChatBubbleOutline';\r\nimport SmartToyIcon from '@mui/icons-material/SmartToy';\r\nimport ComputerIcon from '@mui/icons-material/Computer';\r\nimport StaggerList, { StaggerItem } from '@/components/animation/StaggerList';\r\nimport AnimatedCard from '@/components/ui/AnimatedCard';\r\nimport ScrollReveal from '@/components/animation/ScrollReveal';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { generateDynamicGreeting } from '@/services/aiService';\r\nimport NotificationsIcon from '@mui/icons-material/Notifications';\r\nimport Badge from '@mui/material/Badge';\r\nimport UserNotificationsMenu from '@/components/layout/UserNotificationsMenu';\r\nimport { listenForUnreadForUser } from '@/services/supportService';\r\n\r\nexport default function UserHome() {\r\n    const { user, tier, isPro, features: tierFeatures, dietaryPreferences } = useAuth();\r\n    const router = useRouter();\r\n    const searchParams = useSearchParams();\r\n    const [notificationAnchor, setNotificationAnchor] = useState<null | HTMLElement>(null);\r\n    const [unreadCount, setUnreadCount] = useState(0);\r\n\r\n    const { t } = useTranslation();\r\n\r\n    // Features Definition (Moved up for Search Access)\r\n    const features = [\r\n        {\r\n            title: t('feature_scan_title'),\r\n            icon: <QrCodeScannerIcon sx={{ fontSize: 40, color: '#6C63FF' }} />,\r\n            path: '/scan',\r\n            color: 'rgba(108, 99, 255, 0.1)',\r\n            desc: t('feature_scan_desc'),\r\n            gradient: 'linear-gradient(135deg, rgba(108, 99, 255, 0.1) 0%, rgba(108, 99, 255, 0.05) 100%)'\r\n        },\r\n        {\r\n            title: t('feature_chat_title'),\r\n            icon: <SmartToyIcon sx={{ fontSize: 40, color: '#9333EA' }} />,\r\n            path: '/ai-chat',\r\n            color: 'rgba(147, 51, 234, 0.1)',\r\n            desc: t('feature_chat_desc'),\r\n            gradient: 'linear-gradient(135deg, rgba(147, 51, 234, 0.1) 0%, rgba(147, 51, 234, 0.05) 100%)'\r\n        },\r\n        {\r\n            title: t('feature_history_title'),\r\n            icon: <HistoryIcon sx={{ fontSize: 40, color: '#00F0FF' }} />,\r\n            path: '/history',\r\n            color: 'rgba(0, 240, 255, 0.1)',\r\n            desc: t('feature_history_desc'),\r\n            gradient: 'linear-gradient(135deg, rgba(0, 240, 255, 0.1) 0%, rgba(0, 240, 255, 0.05) 100%)'\r\n        },\r\n        {\r\n            title: t('feature_globalsearch_title'),\r\n            icon: <PublicIcon sx={{ fontSize: 40, color: '#00E676' }} />,\r\n            path: '/global-search',\r\n            color: 'rgba(0, 230, 118, 0.1)',\r\n            desc: t('feature_globalsearch_desc'),\r\n            gradient: 'linear-gradient(135deg, rgba(0, 230, 118, 0.1) 0%, rgba(0, 230, 118, 0.05) 100%)'\r\n        },\r\n        {\r\n            title: t('feature_foryou_title'),\r\n            icon: <RecommendIcon sx={{ fontSize: 40, color: '#FCD34D' }} />,\r\n            path: '/recommendations',\r\n            color: 'rgba(252, 211, 77, 0.1)',\r\n            desc: t('feature_foryou_desc'),\r\n            gradient: 'linear-gradient(135deg, rgba(252, 211, 77, 0.1) 0%, rgba(252, 211, 77, 0.05) 100%)'\r\n        },\r\n        {\r\n            title: 'PC Builder',\r\n            icon: <ComputerIcon sx={{ fontSize: 40, color: '#FF6B35' }} />,\r\n            path: '/pc-builder',\r\n            color: 'rgba(255, 107, 53, 0.1)',\r\n            desc: 'Build Your PC',\r\n            gradient: 'linear-gradient(135deg, rgba(255, 107, 53, 0.1) 0%, rgba(255, 107, 53, 0.05) 100%)'\r\n        },\r\n        {\r\n            title: t('feature_favorites_title'),\r\n            icon: <FavoriteIcon sx={{ fontSize: 40, color: '#FF4081' }} />,\r\n            path: '/favorites',\r\n            color: 'rgba(255, 64, 129, 0.1)',\r\n            desc: t('feature_favorites_desc'),\r\n            gradient: 'linear-gradient(135deg, rgba(255, 64, 129, 0.1) 0%, rgba(255, 64, 129, 0.05) 100%)'\r\n        },\r\n        {\r\n            title: t('feature_profile_title'),\r\n            icon: <PersonIcon sx={{ fontSize: 40, color: '#10B981' }} />,\r\n            path: '/profile',\r\n            color: 'rgba(16, 185, 129, 0.1)',\r\n            desc: t('feature_profile_desc'),\r\n            gradient: 'linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%)',\r\n            hiddenInGrid: true // Redundant with Header Icon\r\n        },\r\n        {\r\n            title: t('feature_upgrade_title'),\r\n            icon: <StarIcon sx={{ fontSize: 40, color: '#F59E0B' }} />,\r\n            path: '/upgrade',\r\n            color: 'rgba(245, 158, 11, 0.1)',\r\n            desc: t('feature_upgrade_desc'),\r\n            gradient: 'linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%)'\r\n        },\r\n        {\r\n            title: t('feature_support_title'),\r\n            icon: <ChatBubbleOutlineIcon sx={{ fontSize: 40, color: '#3B82F6' }} />,\r\n            path: '/support',\r\n            color: 'rgba(59, 130, 246, 0.1)',\r\n            desc: t('feature_support_desc'),\r\n            gradient: 'linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%)'\r\n        }\r\n    ];\r\n\r\n    // Search State\r\n    const [query, setQuery] = useState('');\r\n    const [featureResults, setFeatureResults] = useState<any[]>([]);\r\n    const [suggestions, setSuggestions] = useState<any[]>([]); // Real-time suggestions\r\n    const [loading, setLoading] = useState(false);\r\n    const [hasSearched, setHasSearched] = useState(false);\r\n\r\n    // Auto-search from URL (e.g. from Scanner)\r\n    useEffect(() => {\r\n        const urlQuery = searchParams.get('search');\r\n        if (urlQuery && urlQuery !== query) {\r\n            setQuery(urlQuery);\r\n            // Just populate the field\r\n        }\r\n    }, [searchParams]);\r\n\r\n    const performSearch = async (searchQuery: string) => {\r\n        if (!searchQuery.trim()) return;\r\n        setLoading(true);\r\n        setHasSearched(true);\r\n\r\n        // 1. Search Features\r\n        const searchLower = searchQuery.toLowerCase().trim();\r\n        const matchedFeatures = features.filter(item => {\r\n            // Explicitly exclude Global Search page from results\r\n            if (item.path === '/global-search') return false;\r\n\r\n            // Tier & Feature Gate Logic\r\n            if (item.path === '/pc-builder') {\r\n                if (tier !== 'pro' && tier !== 'ultimate') return false;\r\n            }\r\n            if (item.path === '/upgrade') {\r\n                if (tier === 'ultimate') return false;\r\n            }\r\n\r\n            // Keyword Match\r\n            return item.title.toLowerCase().includes(searchLower) ||\r\n                item.desc.toLowerCase().includes(searchLower);\r\n        });\r\n        setFeatureResults(matchedFeatures);\r\n        setLoading(false);\r\n    };\r\n\r\n    const handleSearch = async (e?: React.FormEvent) => {\r\n        if (e) e.preventDefault();\r\n\r\n        // If it's a feature match, perform local search to show it.\r\n        const searchLower = query.toLowerCase().trim();\r\n        const matchedFeatures = features.filter(item =>\r\n            item.title.toLowerCase().includes(searchLower) || item.desc.toLowerCase().includes(searchLower)\r\n        );\r\n\r\n        if (matchedFeatures.length > 0) {\r\n            // Show local results\r\n            performSearch(query);\r\n        } else {\r\n            // Redirect to Global Search for products\r\n            router.push(`/global-search?search=${encodeURIComponent(query)}`);\r\n        }\r\n    };\r\n\r\n    const clearSearch = () => {\r\n        setQuery('');\r\n        setFeatureResults([]);\r\n        setHasSearched(false);\r\n    };\r\n\r\n    const [greeting, setGreeting] = useState('Hello');\r\n\r\n    useEffect(() => {\r\n        const hour = new Date().getHours();\r\n        const name = user?.displayName?.split(' ')[0] || 'Explorer';\r\n\r\n        // Late Night: 00:00 - 06:00 (AI Powered)\r\n        if (hour >= 0 && hour < 6) {\r\n            setGreeting(t('greeting_late_night')); // Immediate placeholder\r\n            generateDynamicGreeting(name, 'late_night').then((aiMsg) => {\r\n                if (aiMsg) setGreeting(aiMsg);\r\n            });\r\n        }\r\n        // Standard Hours: Simple Greeting\r\n        else if (hour < 12) {\r\n            setGreeting(t('greeting_morning'));\r\n        } else if (hour < 18) {\r\n            setGreeting(t('greeting_afternoon'));\r\n        } else {\r\n            setGreeting(t('greeting_evening'));\r\n        }\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        if (!user) return;\r\n        const unsubscribeSupport = listenForUnreadForUser(user.uid, (supportCount) => {\r\n            import('@/services/accessRequestService').then(({ getUserNotifications }) => {\r\n                getUserNotifications(user.uid).then(notifs => {\r\n                    const notifCount = notifs.filter(n => !n.read).length;\r\n                    setUnreadCount(supportCount + notifCount);\r\n                });\r\n            });\r\n        });\r\n        return () => unsubscribeSupport();\r\n    }, [user, notificationAnchor]);\r\n\r\n    return (\r\n        <Box sx={{ pb: 12, minHeight: '100vh', bgcolor: 'background.default' }}>\r\n            {/* Header Section */}\r\n            <Box\r\n                component={motion.div}\r\n                initial={{ opacity: 0, y: -20 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                transition={{ duration: 0.5 }}\r\n                sx={{\r\n                    pt: { xs: 3, sm: 4 },\r\n                    pb: { xs: 5, sm: 6 },\r\n                    px: { xs: 2, sm: 3 },\r\n                    background: 'linear-gradient(135deg, #6C63FF 0%, #5a52d5 100%)',\r\n                    borderRadius: '0 0 24px 24px',\r\n                    color: 'white',\r\n                    mb: 3,\r\n                    boxShadow: '0 4px 20px rgba(108, 99, 255, 0.3)'\r\n                }}\r\n            >\r\n                <Container maxWidth=\"sm\" disableGutters>\r\n                    <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>\r\n                        <Box>\r\n                            <Typography variant=\"h6\" sx={{ opacity: 0.9, fontWeight: 500, mb: 0.5, textShadow: '0 2px 4px rgba(0,0,0,0.1)' }}>\r\n                                {greeting}\r\n                            </Typography>\r\n                            <Typography variant=\"h3\" fontWeight={800} sx={{\r\n                                fontSize: { xs: '2rem', sm: '2.5rem' },\r\n                                letterSpacing: '-0.02em',\r\n                                textShadow: '0 2px 10px rgba(0,0,0,0.1)'\r\n                            }}>\r\n                                {user?.displayName?.split(' ')[0] || 'Explorer'}\r\n                            </Typography>\r\n                            <Box sx={{ mt: 1 }}>\r\n                                <TierBadge tier={useAuth().tier} size=\"small\" />\r\n                            </Box>\r\n                        </Box>\r\n\r\n                        {/* Profile & Notifications */}\r\n                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                            <IconButton\r\n                                onClick={(e) => setNotificationAnchor(e.currentTarget)}\r\n                                sx={{\r\n                                    bgcolor: 'rgba(255,255,255,0.15)',\r\n                                    color: 'white',\r\n                                    '&:hover': { bgcolor: 'rgba(255,255,255,0.25)' }\r\n                                }}\r\n                            >\r\n                                <Badge badgeContent={unreadCount} color=\"error\">\r\n                                    <NotificationsIcon />\r\n                                </Badge>\r\n                            </IconButton>\r\n\r\n                            <IconButton\r\n                                component={motion.button}\r\n                                whileHover={{ scale: 1.1 }}\r\n                                whileTap={{ scale: 0.95 }}\r\n                                onClick={() => router.push('/profile')}\r\n                                sx={{\r\n                                    bgcolor: 'rgba(255,255,255,0.15)',\r\n                                    color: 'white',\r\n                                    '&:hover': { bgcolor: 'rgba(255,255,255,0.25)' }\r\n                                }}\r\n                            >\r\n                                {user?.photoURL ? (\r\n                                    <Avatar src={user.photoURL} sx={{ width: 24, height: 24 }} />\r\n                                ) : (\r\n                                    <PersonIcon />\r\n                                )}\r\n                            </IconButton>\r\n\r\n                            <UserNotificationsMenu\r\n                                anchorEl={notificationAnchor}\r\n                                open={Boolean(notificationAnchor)}\r\n                                onClose={() => setNotificationAnchor(null)}\r\n                            />\r\n                        </Box>\r\n                    </Box>\r\n\r\n                    {/* Search Bar Container with Relative Positioning for Dropdown */}\r\n                    <Box sx={{ position: 'relative', zIndex: 10 }}>\r\n                        <Paper\r\n                            component=\"form\"\r\n                            onSubmit={handleSearch}\r\n                            elevation={0}\r\n                            sx={{\r\n                                p: '10px 16px',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                borderRadius: 4,\r\n                                bgcolor: 'rgba(255, 255, 255, 0.95)',\r\n                                transition: 'all 0.3s',\r\n                                boxShadow: '0 2px 8px rgba(0,0,0,0.1)',\r\n                                '&:hover, &:focus-within': {\r\n                                    boxShadow: '0 4px 16px rgba(0,0,0,0.15)',\r\n                                    bgcolor: 'white'\r\n                                }\r\n                            }}\r\n                        >\r\n                            <SearchIcon sx={{ color: 'grey.500', mr: 1 }} />\r\n                            <InputBase\r\n                                sx={{\r\n                                    ml: 1,\r\n                                    flex: 1,\r\n                                    fontSize: { xs: '0.95rem', sm: '1rem' },\r\n                                    color: 'grey.900' // Force dark text on white search bar\r\n                                }}\r\n                                placeholder={t('home_search_placeholder')}\r\n                                inputProps={{ 'aria-label': 'search products' }}\r\n                                value={query}\r\n                                onChange={(e) => {\r\n                                    const val = e.target.value;\r\n                                    setQuery(val);\r\n\r\n                                    // Real-time suggestions\r\n                                    if (!val.trim()) {\r\n                                        setSuggestions([]);\r\n                                        return;\r\n                                    }\r\n                                    const searchLower = val.toLowerCase().trim();\r\n                                    const matches = features.filter(item => {\r\n                                        // Explicitly exclude Global Search page from suggestions\r\n                                        if (item.path === '/global-search') return false;\r\n\r\n                                        // Tier & Feature Gate Logic\r\n                                        if (item.path === '/pc-builder') {\r\n                                            if (tier !== 'pro' && tier !== 'ultimate') return false;\r\n                                        }\r\n                                        if (item.path === '/upgrade') {\r\n                                            if (tier === 'ultimate') return false;\r\n                                        }\r\n                                        // We include hidden items in suggestions!\r\n                                        return item.title.toLowerCase().includes(searchLower) ||\r\n                                            item.desc.toLowerCase().includes(searchLower);\r\n                                    });\r\n                                    setSuggestions(matches);\r\n                                }}\r\n                            />\r\n                            {query && (\r\n                                <IconButton size=\"small\" onClick={clearSearch} sx={{ mr: 0.5, color: 'grey.500' }}>\r\n                                    <CloseIcon fontSize=\"small\" />\r\n                                </IconButton>\r\n                            )}\r\n                            <IconButton\r\n                                type=\"submit\"\r\n                                sx={{\r\n                                    bgcolor: '#6C63FF',\r\n                                    borderRadius: 2,\r\n                                    p: 0.5,\r\n                                    color: 'white',\r\n                                    transition: 'all 0.3s',\r\n                                    '&:hover': { bgcolor: '#5a52d5' }\r\n                                }}\r\n                            >\r\n                                {loading ? <CircularProgress size={20} color=\"inherit\" /> : <KeyboardArrowRightIcon fontSize=\"small\" />}\r\n                            </IconButton>\r\n                        </Paper>\r\n\r\n                        {/* Suggestions Dropdown */}\r\n                        {suggestions.length > 0 && !hasSearched && (\r\n                            <Paper\r\n                                component={motion.div}\r\n                                initial={{ opacity: 0, y: -10 }}\r\n                                animate={{ opacity: 1, y: 0 }}\r\n                                elevation={4}\r\n                                sx={{\r\n                                    position: 'absolute',\r\n                                    top: '110%',\r\n                                    left: 0,\r\n                                    right: 0,\r\n                                    borderRadius: 3,\r\n                                    overflow: 'hidden',\r\n                                    bgcolor: 'background.paper', // Adapt to theme (Dark in DarkMode)\r\n                                    backgroundImage: 'none',\r\n                                    zIndex: 20,\r\n                                    border: '1px solid',\r\n                                    borderColor: 'divider'\r\n                                }}\r\n                            >\r\n                                {suggestions.map((item, index) => (\r\n                                    <Box\r\n                                        key={index}\r\n                                        onClick={() => router.push(item.path)}\r\n                                        sx={{\r\n                                            p: 2,\r\n                                            display: 'flex',\r\n                                            alignItems: 'center',\r\n                                            cursor: 'pointer',\r\n                                            borderBottom: index < suggestions.length - 1 ? '1px solid' : 'none',\r\n                                            borderColor: 'divider',\r\n                                            transition: 'bgcolor 0.2s',\r\n                                            '&:hover': { bgcolor: 'action.hover' }\r\n                                        }}\r\n                                    >\r\n                                        <Box sx={{\r\n                                            mr: 2,\r\n                                            bgcolor: item.color,\r\n                                            p: 1,\r\n                                            borderRadius: 1.5,\r\n                                            display: 'flex'\r\n                                        }}>\r\n                                            {React.cloneElement(item.icon as React.ReactElement, { sx: { fontSize: 20, color: (item.icon as any).props?.sx?.color } } as any)}\r\n                                        </Box>\r\n                                        <Box>\r\n                                            <Typography variant=\"body1\" fontWeight={500} color=\"text.primary\">\r\n                                                {item.title}\r\n                                            </Typography>\r\n                                            <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                                {item.desc}\r\n                                            </Typography>\r\n                                        </Box>\r\n                                        <Box sx={{ flexGrow: 1 }} />\r\n                                        <KeyboardArrowRightIcon fontSize=\"small\" color=\"action\" />\r\n                                    </Box>\r\n                                ))}\r\n                            </Paper>\r\n                        )}\r\n                    </Box>\r\n                </Container>\r\n            </Box>\r\n\r\n            <Container maxWidth=\"md\" sx={{ px: { xs: 2, sm: 3 } }}>\r\n                <AnimatePresence mode=\"wait\">\r\n                    {hasSearched ? (\r\n                        <ScrollReveal key=\"results\">\r\n\r\n                            {/* RESULTS HEADER */}\r\n                            <Box sx={{ mb: 2, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                                <Typography variant=\"h6\" fontWeight=\"bold\">\r\n                                    {t('home_search_results')}\r\n                                </Typography>\r\n                                <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                    {featureResults.length} {t('home_found')}\r\n                                </Typography>\r\n                            </Box>\r\n\r\n                            {/* FEATURE RESULTS ONLY */}\r\n                            {featureResults.length > 0 ? (\r\n                                <Box sx={{ mb: 4 }}>\r\n                                    <Grid container spacing={2} sx={{ mt: 0.5 }}>\r\n                                        {featureResults.map((item, index) => (\r\n                                            <Grid size={{ xs: 12, sm: 6 }} key={index}>\r\n                                                <AnimatedCard\r\n                                                    onClick={() => router.push(item.path)}\r\n                                                    sx={{\r\n                                                        p: 2,\r\n                                                        display: 'flex',\r\n                                                        alignItems: 'center',\r\n                                                        borderRadius: 3,\r\n                                                        cursor: 'pointer',\r\n                                                        border: '1px solid',\r\n                                                        borderColor: 'primary.light',\r\n                                                        bgcolor: 'primary.50',\r\n                                                        transition: 'all 0.3s',\r\n                                                        '&:hover': {\r\n                                                            borderColor: 'primary.main',\r\n                                                            bgcolor: 'white',\r\n                                                            boxShadow: '0 4px 12px rgba(108, 99, 255, 0.15)'\r\n                                                        }\r\n                                                    }}\r\n                                                >\r\n                                                    <Box sx={{\r\n                                                        mr: 2,\r\n                                                        bgcolor: item.color,\r\n                                                        p: 1.5,\r\n                                                        borderRadius: 2,\r\n                                                        display: 'flex'\r\n                                                    }}>\r\n                                                        {React.cloneElement(item.icon as React.ReactElement, { sx: { fontSize: 28, color: (item.icon as any).props?.sx?.color } } as any)}\r\n                                                    </Box>\r\n                                                    <Box>\r\n                                                        <Typography variant=\"subtitle1\" fontWeight=\"bold\">\r\n                                                            {item.title}\r\n                                                        </Typography>\r\n                                                        <Typography variant=\"caption\" color=\"text.secondary\">\r\n                                                            {item.desc}\r\n                                                        </Typography>\r\n                                                    </Box>\r\n                                                    <Box sx={{ flexGrow: 1 }} />\r\n                                                    <KeyboardArrowRightIcon color=\"action\" />\r\n                                                </AnimatedCard>\r\n                                            </Grid>\r\n                                        ))}\r\n                                    </Grid>\r\n                                </Box>\r\n                            ) : (\r\n                                !loading && (\r\n                                    <Box sx={{ textAlign: 'center', py: 8, opacity: 0.7 }}>\r\n                                        <SearchIcon sx={{ fontSize: 60, color: 'text.disabled', mb: 2 }} />\r\n                                        <Typography variant=\"h6\" color=\"text.secondary\">\r\n                                            {t('home_no_results')}\r\n                                        </Typography>\r\n                                        <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                            {t('home_try_searching')}\r\n                                        </Typography>\r\n                                    </Box>\r\n                                )\r\n                            )}\r\n                        </ScrollReveal>\r\n                    ) : (\r\n                        <Box key=\"features\">\r\n                            <ScrollReveal>\r\n                                <Typography\r\n                                    variant=\"h6\"\r\n                                    fontWeight=\"bold\"\r\n                                    sx={{\r\n                                        mb: 2.5,\r\n                                        px: 0.5,\r\n                                        fontSize: { xs: '1.1rem', sm: '1.25rem' }\r\n                                    }}\r\n                                >\r\n                                    {t('home_quick_actions')}\r\n                                </Typography>\r\n                            </ScrollReveal>\r\n\r\n                            <StaggerList>\r\n                                <Grid container spacing={{ xs: 1.5, sm: 2 }}>\r\n                                    {features.filter(item => {\r\n                                        // Hidden Flags (Global Search, Profile)\r\n                                        if (item.hiddenInGrid) return false;\r\n\r\n                                        // Global Search: Only for Pro and Ultimate\r\n                                        if (item.path === '/global-search') {\r\n                                            return tier === 'pro' || tier === 'ultimate';\r\n                                        }\r\n                                        // PC Builder: Only for Pro and Ultimate\r\n                                        if (item.path === '/pc-builder') {\r\n                                            return tier === 'pro' || tier === 'ultimate';\r\n                                        }\r\n                                        // Upgrade: Hide for Ultimate (highest tier)\r\n                                        if (item.path === '/upgrade') {\r\n                                            return tier !== 'ultimate';\r\n                                        }\r\n                                        return true;\r\n                                    }).map((item, index) => (\r\n                                        <Grid size={{ xs: 6, sm: 6, md: 4 }} key={index}>\r\n                                            <StaggerItem>\r\n                                                <AnimatedCard\r\n                                                    onClick={() => router.push(item.path)}\r\n                                                    sx={{\r\n                                                        p: { xs: 2, sm: 2.5 },\r\n                                                        height: '100%',\r\n                                                        display: 'flex',\r\n                                                        flexDirection: { xs: 'column', sm: 'row' },\r\n                                                        alignItems: 'center',\r\n                                                        justifyContent: { xs: 'center', sm: 'flex-start' },\r\n                                                        textAlign: { xs: 'center', sm: 'left' },\r\n                                                        borderRadius: 3,\r\n                                                        cursor: 'pointer',\r\n                                                        border: '1px solid',\r\n                                                        borderColor: 'divider',\r\n                                                        background: item.gradient,\r\n                                                        transition: 'all 0.3s',\r\n                                                        '&:hover': {\r\n                                                            borderColor: 'primary.main',\r\n                                                            boxShadow: '0 4px 12px rgba(108, 99, 255, 0.15)'\r\n                                                        }\r\n                                                    }}\r\n                                                >\r\n                                                    <Box\r\n                                                        component={motion.div}\r\n                                                        whileHover={{ rotate: 5 }}\r\n                                                        sx={{\r\n                                                            width: { xs: 48, sm: 60 },\r\n                                                            height: { xs: 48, sm: 60 },\r\n                                                            borderRadius: 2.5,\r\n                                                            bgcolor: item.color,\r\n                                                            display: 'flex',\r\n                                                            alignItems: 'center',\r\n                                                            justifyContent: 'center',\r\n                                                            mr: { xs: 0, sm: 2 },\r\n                                                            mb: { xs: 1.5, sm: 0 },\r\n                                                            transition: 'all 0.3s'\r\n                                                        }}\r\n                                                    >\r\n                                                        {React.cloneElement(item.icon as React.ReactElement, { sx: { fontSize: { xs: 28, sm: 40 }, color: (item.icon as any).props?.sx?.color } } as any)}\r\n                                                    </Box>\r\n                                                    <Box sx={{ flex: 1, width: '100%' }}>\r\n                                                        <Typography\r\n                                                            variant=\"h6\"\r\n                                                            fontWeight=\"bold\"\r\n                                                            sx={{\r\n                                                                fontSize: { xs: '0.9rem', sm: '1.1rem' },\r\n                                                                lineHeight: 1.2,\r\n                                                                mb: { xs: 0.5, sm: 0 }\r\n                                                            }}\r\n                                                        >\r\n                                                            {item.title}\r\n                                                        </Typography>\r\n                                                        <Typography\r\n                                                            variant=\"body2\"\r\n                                                            color=\"text.secondary\"\r\n                                                            sx={{\r\n                                                                fontSize: { xs: '0.75rem', sm: '0.9rem' },\r\n                                                                display: { xs: 'none', sm: 'block' } // Clean 2x2 grid on mobile\r\n                                                            }}\r\n                                                        >\r\n                                                            {item.desc}\r\n                                                        </Typography>\r\n                                                    </Box>\r\n                                                    <IconButton\r\n                                                        size=\"small\"\r\n                                                        sx={{\r\n                                                            transition: 'transform 0.3s',\r\n                                                            '&:hover': { transform: 'translateX(4px)' },\r\n                                                            display: { xs: 'none', sm: 'inline-flex' } // Hide arrow on mobile, redundant\r\n                                                        }}\r\n                                                    >\r\n                                                        <KeyboardArrowRightIcon color=\"action\" />\r\n                                                    </IconButton>\r\n                                                </AnimatedCard>\r\n                                            </StaggerItem>\r\n                                        </Grid>\r\n                                    ))}\r\n                                </Grid>\r\n                            </StaggerList>\r\n                        </Box>\r\n                    )}\r\n                </AnimatePresence>\r\n            </Container>\r\n        </Box >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\context\\AuthContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'db' is defined but never used.","line":4,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'doc' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setDoc' is defined but never used.","line":5,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TIER_CONFIG' is defined but never used.","line":8,"column":118,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":129},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'user'. Either include it or remove the dependency array.","line":95,"column":8,"nodeType":"ArrayExpression","endLine":95,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [user]","fix":{"range":[3377,3379],"text":"[user]"}}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":105,"column":17,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":105,"endColumn":87,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[3756,3826],"text":"// @ts-expect-error - access role safely even if type is partial during load"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'user'. Either include it or remove the dependency array.","line":144,"column":8,"nodeType":"ArrayExpression","endLine":144,"endColumn":65,"suggestions":[{"desc":"Update the dependencies array to be: [maintenanceMode, userProfile, pathname, loading, router, user]","fix":{"range":[5470,5527],"text":"[maintenanceMode, userProfile, pathname, loading, router, user]"}}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadUserProfile` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\context\\AuthContext.tsx:158:23\n  156 |\n  157 |             if (user) {\n> 158 |                 await loadUserProfile(user);\n      |                       ^^^^^^^^^^^^^^^ `loadUserProfile` accessed before it is declared\n  159 |             } else {\n  160 |                 setUserProfile(null);\n  161 |             }\n\nC:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\context\\AuthContext.tsx:185:5\n  183 |     }, []);\n  184 |\n> 185 |     const loadUserProfile = async (user: User) => {\n      |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 186 |         try {\n      | ^^^^^^^^^^^^^\n> 187 |             const profile = await getUserProfile(\n      ΓÇª\n      | ^^^^^^^^^^^^^\n> 215 |         }\n      | ^^^^^^^^^^^^^\n> 216 |     };\n      | ^^^^^^^ `loadUserProfile` is declared here\n  217 |\n  218 |     const refreshProfile = async () => {\n  219 |         if (user) {","line":158,"column":23,"nodeType":null,"endLine":158,"endColumn":38},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":226,"column":9,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":226,"endColumn":22,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[8151,8164],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport { onAuthStateChanged, User, signOut as firebaseSignOut } from 'firebase/auth';\r\nimport { auth, db } from '@/lib/firebase';\r\nimport { doc, setDoc } from 'firebase/firestore';\r\nimport { useRouter, usePathname } from 'next/navigation';\r\n// import i18n from '@/lib/i18n';\r\nimport { UserProfile, UserTier, DietaryPreferences, TierFeatures, DEFAULT_SUBSCRIPTION, DEFAULT_DIETARY_PREFERENCES, TIER_CONFIG } from '@/types/user';\r\nimport { getUserProfile, getFeatureAccess } from '@/services/subscriptionService';\r\nimport { subscribeToSystemSettings } from '@/services/systemService';\r\nimport { SystemTierConfig, TierDefinition } from '@/types/system';\r\nimport { useFcmToken } from '@/hooks/useFcmToken';\r\nimport { usePresence } from '@/hooks/usePresence';\r\n\r\n\r\ninterface AuthContextType {\r\n    user: User | null;\r\n    userProfile: UserProfile | null;\r\n    loading: boolean;\r\n    logout: () => Promise<void>;\r\n    immediateLogout: () => Promise<void>;\r\n    isPro: boolean;\r\n    isPlus: boolean;\r\n    isUltimate: boolean;\r\n    isFree: boolean;\r\n    tier: UserTier;\r\n    features: TierFeatures;\r\n    dietaryPreferences: DietaryPreferences;\r\n    refreshProfile: () => Promise<void>;\r\n    isBetaEnabled: boolean;\r\n    // New: Dynamic Config\r\n    tierConfig: SystemTierConfig | null;\r\n    getTierDef: (tier: UserTier) => TierDefinition | null;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType>({\r\n    user: null,\r\n    userProfile: null,\r\n    loading: true,\r\n    logout: async () => { },\r\n    immediateLogout: async () => { },\r\n    isPro: false,\r\n    isPlus: false,\r\n    isUltimate: false,\r\n    isFree: true,\r\n    tier: 'free',\r\n    features: getFeatureAccess('free'),\r\n    dietaryPreferences: DEFAULT_DIETARY_PREFERENCES,\r\n    refreshProfile: async () => { },\r\n    isBetaEnabled: false,\r\n    tierConfig: null,\r\n    getTierDef: () => null,\r\n});\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n\r\nexport const AuthProvider = ({ children }: { children: React.ReactNode }) => {\r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [userProfile, setUserProfile] = useState<UserProfile | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [maintenanceMode, setMaintenanceMode] = useState(false);\r\n    const [betaMode, setBetaMode] = useState(false);\r\n    const [tierConfig, setTierConfig] = useState<SystemTierConfig | null>(null);\r\n\r\n\r\n\r\n    // Initialize FCM Token Management\r\n    useFcmToken();\r\n\r\n    // Initialize Presence System (Heartbeat)\r\n    usePresence(user);\r\n\r\n\r\n    const router = useRouter();\r\n    const pathname = usePathname();\r\n\r\n    // Listen to System Settings (Maintenance Mode + Tier Config) - Only when authenticated\r\n    useEffect(() => {\r\n        if (!user) {\r\n            // Reset to defaults or keep clean state when logged out\r\n            setMaintenanceMode(false);\r\n            setBetaMode(false);\r\n            setTierConfig(null);\r\n            return;\r\n        }\r\n\r\n        const unsubscribe = subscribeToSystemSettings((settings) => {\r\n            setMaintenanceMode(settings.maintenanceMode);\r\n            setBetaMode(settings.betaAccess);\r\n            if (settings.tierConfig) {\r\n                setTierConfig(settings.tierConfig);\r\n            }\r\n        });\r\n        return () => unsubscribe();\r\n    }, []); // Empty dependency array to run only once on mount\r\n\r\n    // Maintenance Mode & Admin Strict Isolation Guard\r\n    useEffect(() => {\r\n        if (loading) return;\r\n\r\n        // Allow access to login page BUT redirect if already logged in\r\n        if (pathname === '/login') {\r\n            if (user) {\r\n                // Determine destination based on role\r\n                // @ts-ignore - access role safely even if type is partial during load\r\n                const target = userProfile?.role === 'admin' ? '/admin' : '/';\r\n                router.replace(target);\r\n            }\r\n            return;\r\n        }\r\n\r\n        const isAdminUser = userProfile?.role === 'admin';\r\n\r\n        // STRICT ADMIN ISOLATION: Admins can ONLY see /admin/* pages (and set-admin for testing/setup)\r\n        if (isAdminUser) {\r\n            // Check if current path starts with /admin or is /set-admin\r\n            const isAllowedAdminPath = pathname.startsWith('/admin') || pathname === '/set-admin';\r\n\r\n            if (!isAllowedAdminPath) {\r\n                console.log('[AUTH] Admin strict mode: Redirecting to dashboard');\r\n                router.replace('/admin');\r\n                return;\r\n            }\r\n        }\r\n\r\n        // If Maintenance Mode is ON\r\n        if (maintenanceMode) {\r\n            console.log('[AUTH] Maintenance Mode is ON. isAdmin:', isAdminUser, 'pathname:', pathname);\r\n            // Allow Admins through (already handled above roughly, but double check)\r\n            if (isAdminUser) return;\r\n\r\n            // If not admin, and not already on maintenance page, redirect\r\n            if (pathname !== '/maintenance') {\r\n                console.log('[AUTH] Redirecting to maintenance page...');\r\n                router.push('/maintenance');\r\n            }\r\n        } else {\r\n            // If Maintenance Mode is OFF, and user is on maintenance page, redirect home\r\n            if (pathname === '/maintenance') {\r\n                console.log('[AUTH] Maintenance OFF, redirecting from maintenance page...');\r\n                router.push('/');\r\n            }\r\n        }\r\n    }, [maintenanceMode, userProfile, pathname, loading, router]);\r\n\r\n\r\n\r\n\r\n    // Load user profile when auth state changes\r\n    useEffect(() => {\r\n        console.log('[AUTH] Setting up auth state listener...');\r\n\r\n        const unsubscribe = onAuthStateChanged(auth, async (user) => {\r\n            console.log('[AUTH] Auth state changed:', user ? `User: ${user.email}` : 'No user');\r\n            setUser(user);\r\n\r\n            if (user) {\r\n                await loadUserProfile(user);\r\n            } else {\r\n                setUserProfile(null);\r\n            }\r\n\r\n            setLoading(false);\r\n            console.log('[AUTH] Loading complete');\r\n        }, (error) => {\r\n            // Error callback for onAuthStateChanged\r\n            console.error('[AUTH] Auth state error:', error);\r\n            setLoading(false); // Important: stop loading even on error\r\n            setUser(null);\r\n            setUserProfile(null);\r\n        });\r\n\r\n        // Fallback: If auth doesn't respond within 3 seconds, stop loading\r\n        const timeout = setTimeout(() => {\r\n            console.warn('[AUTH] Auth initialization timeout - forcing loading to false');\r\n            setLoading(false);\r\n        }, 8000);\r\n\r\n        return () => {\r\n            clearTimeout(timeout);\r\n            unsubscribe();\r\n        };\r\n    }, []);\r\n\r\n    const loadUserProfile = async (user: User) => {\r\n        try {\r\n            const profile = await getUserProfile(\r\n                user.uid,\r\n                user.email || '',\r\n                user.displayName,\r\n                user.photoURL\r\n            );\r\n\r\n            setUserProfile(profile);\r\n            console.log('[AUTH] User profile loaded:', {\r\n                uid: profile.uid,\r\n                email: profile.email,\r\n                tier: profile.subscription?.tier,\r\n                role: profile.role\r\n            });\r\n        } catch (error) {\r\n            console.error('Failed to load user profile:', error);\r\n            // Set default profile on error\r\n            setUserProfile({\r\n                uid: user.uid,\r\n                email: user.email || '',\r\n                displayName: user.displayName,\r\n                photoURL: user.photoURL,\r\n                subscription: DEFAULT_SUBSCRIPTION,\r\n                dietaryPreferences: DEFAULT_DIETARY_PREFERENCES,\r\n                createdAt: new Date(),\r\n                // Default fallback for error state\r\n                preferences: {}\r\n            });\r\n        }\r\n    };\r\n\r\n    const refreshProfile = async () => {\r\n        if (user) {\r\n            await loadUserProfile(user);\r\n        }\r\n    };\r\n\r\n    const logout = async () => {\r\n        // Safe check for user profile\r\n        // @ts-ignore\r\n        if (userProfile?.role === 'admin') {\r\n            // Admins get fast logout\r\n            await immediateLogout();\r\n        } else {\r\n            // Users get the immersive quest page\r\n            router.push('/quest');\r\n        }\r\n    };\r\n\r\n    const immediateLogout = async () => {\r\n        await firebaseSignOut(auth);\r\n        setUserProfile(null);\r\n        router.push('/login');\r\n    };\r\n\r\n    // Computed values\r\n    // Ensure tier is lowercase to match TIER_CONFIG keys\r\n    const tier = (userProfile?.subscription.tier || 'free').toLowerCase() as UserTier;\r\n\r\n    // Exact tier checks\r\n    const isAdmin = userProfile?.role === 'admin';\r\n    const isUltimate = tier === 'ultimate' || isAdmin; // Admins get full access\r\n\r\n    // Inclusive tier checks (Hierarchy: Free < Plus < Pro < Ultimate)\r\n    const isPro = tier === 'pro' || isUltimate;\r\n    const isPlus = tier === 'plus' || isPro; // Includes Pro and Ultimate\r\n    const isFree = tier === 'free' && !isAdmin;\r\n\r\n\r\n    // Dynamic Feature Resolution\r\n    // CRITICAL: Ultimate and Admin users ALWAYS get ALL features\r\n    let features: TierFeatures;\r\n\r\n    if (isUltimate) {\r\n        // Force Ultimate features for Ultimate tier and Admins\r\n        features = tierConfig?.['ultimate']?.features || getFeatureAccess('ultimate');\r\n        console.log('[AUTH] Ultimate/Admin user detected. Forcing all features. Tier:', tier);\r\n    } else if (tierConfig && tierConfig[tier]) {\r\n        // Use dynamic config if available\r\n        features = tierConfig[tier].features;\r\n        console.log(`[AUTH] Using dynamic tier config for ${tier}`);\r\n    } else {\r\n        // Fallback to hardcoded config\r\n        features = getFeatureAccess(tier);\r\n        console.log(`[AUTH] Using hardcoded tier config for ${tier}`);\r\n    }\r\n\r\n    const dietaryPreferences = userProfile?.dietaryPreferences || DEFAULT_DIETARY_PREFERENCES;\r\n\r\n    const getTierDef = (t: UserTier) => {\r\n        if (tierConfig && tierConfig[t]) return tierConfig[t];\r\n        // Fallback or return null\r\n        return null;\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={{\r\n            user,\r\n            userProfile,\r\n            loading,\r\n            logout,\r\n            immediateLogout,\r\n            isPro,\r\n            isPlus,\r\n            isUltimate,\r\n            isFree,\r\n            tier,\r\n            features,\r\n            dietaryPreferences,\r\n            refreshProfile,\r\n            isBetaEnabled: betaMode,\r\n            tierConfig,\r\n            getTierDef\r\n        }}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\context\\CompareContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\debug-azure-ollama.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":15,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nconst axios = require('axios');\r\n\r\nconst OLLAMA_URL = 'http://20.199.129.203:11434';\r\n\r\nasync function testConnection() {\r\n    console.log(`[TEST] Attempting to connect to Azure Ollama at: ${OLLAMA_URL}...`);\r\n    try {\r\n        const start = Date.now();\r\n        const response = await axios.get(`${OLLAMA_URL}/api/tags`, { timeout: 10000 });\r\n        const duration = Date.now() - start;\r\n\r\n        console.log(`[SUCCESS] Connected in ${duration}ms`);\r\n        console.log(`[INFO] Status: ${response.status}`);\r\n        console.log(`[INFO] Models Found:`, response.data.models?.map(m => m.name));\r\n    } catch (error) {\r\n        console.error(`[FAILED] Connection Error:`, error.message);\r\n        if (error.code === 'ECONNREFUSED') {\r\n            console.error(' -> Server is reachable but Port 11434 is closed or Ollama is not listening.');\r\n            console.error(' -> FIX: Ensure Ollama is running with OLLAMA_HOST=0.0.0.0');\r\n        } else if (error.code === 'ETIMEDOUT') {\r\n            console.error(' -> Connection Timed Out. Firewall/NSG is likely blocking the port.');\r\n            console.error(' -> FIX: Check Azure Network Security Group Inbound Rules for Port 11434.');\r\n        } else {\r\n            console.error(' -> Details:', error.response?.data || error);\r\n        }\r\n    }\r\n}\r\n\r\ntestConnection();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\debug-ollama.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":15,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nconst axios = require('axios');\r\n\r\nconst url = 'http://20.199.129.203:11434/api/tags';\r\n\r\nasync function test() {\r\n    try {\r\n        console.log('Testing connection to:', url);\r\n        const res = await axios.get(url, { timeout: 10000 });\r\n        console.log('Status:', res.status);\r\n        console.log('Data:', JSON.stringify(res.data, null, 2));\r\n    } catch (e) {\r\n        console.error('Error:', e.message);\r\n        if (e.response) {\r\n            console.error('Response status:', e.response.status);\r\n            console.error('Response data:', e.response.data);\r\n        } else if (e.request) {\r\n            console.error('No response received');\r\n        } else {\r\n            console.error('Error setting up request:', e.message);\r\n        }\r\n    }\r\n}\r\n\r\ntest();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\fetch_models.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":15,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nconst axios = require('axios');\r\n\r\nconst url = 'http://20.199.129.203:11434/api/tags';\r\n\r\nasync function listModels() {\r\n    try {\r\n        console.log('Fetching models from ' + url + '...');\r\n        const response = await axios.get(url, { timeout: 5000 });\r\n        const models = response.data.models || [];\r\n        console.log('--- INSTALLED MODELS ---');\r\n        models.forEach(m => console.log(m.name));\r\n        console.log('------------------------');\r\n\r\n        const deepseek = models.find(m => m.name.includes('deepseek'));\r\n        if (deepseek) {\r\n            console.log('Γ£à DeepSeek found: ' + deepseek.name);\r\n        } else {\r\n            console.log('Γ¥î DeepSeek NOT found.');\r\n        }\r\n\r\n    } catch (e) {\r\n        console.error('Error fetching models:', e.message);\r\n    }\r\n}\r\n\r\nlistModels();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\hooks\\useFcmToken.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\hooks\\usePresence.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":50,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect } from 'react';\r\nimport { db } from '@/lib/firebase';\r\nimport { doc, updateDoc, serverTimestamp } from 'firebase/firestore'; // onDisconnect is for RDB, Firestore relies on heartbeat\r\nimport { User } from 'firebase/auth';\r\n\r\n/**\r\n * usePresence Hook\r\n * Updates the user's \"lastSeen\" field in Firestore every 30 seconds.\r\n * This allows the Admin Dashboard to determine if a user is \"Online\" (active within last 60s).\r\n */\r\nexport const usePresence = (user: User | null) => {\r\n    useEffect(() => {\r\n        if (!user) return;\r\n\r\n        const userRef = doc(db, 'users', user.uid);\r\n\r\n        // 1. Initial \"Online\" set\r\n        const setOnline = async () => {\r\n            try {\r\n                await updateDoc(userRef, {\r\n                    status: 'online',\r\n                    lastSeen: serverTimestamp()\r\n                });\r\n            } catch (error) {\r\n                console.error(\"Presence Error:\", error);\r\n            }\r\n        };\r\n\r\n        setOnline();\r\n\r\n        // 2. Heartbeat every 30s\r\n        const intervalId = setInterval(() => {\r\n            updateDoc(userRef, {\r\n                lastSeen: serverTimestamp()\r\n            }).catch(e => console.error(\"Heartbeat fail\", e));\r\n        }, 30000);\r\n\r\n        // 3. Cleanup: Try to set offline (best effort, as this won't run on hard crash/tab close sometimes)\r\n        // For accurate offline detection, the Admin side relies on \"lastSeen < 60s ago\"\r\n        // But we try to set 'offline' on unmount for cleaner data if user navigates away properly.\r\n        const setOffline = async () => {\r\n            // Only if we are still authenticated? \r\n            // Actually unsafe to run async in cleanup but we try\r\n            try {\r\n                // We can't await in cleanup typically, we fire and forget\r\n                updateDoc(userRef, {\r\n                    status: 'offline',\r\n                    lastSeen: serverTimestamp()\r\n                });\r\n            } catch (e) {\r\n                // ignore\r\n            }\r\n        };\r\n\r\n        // Window visibility handling\r\n        const handleVisibilityChange = () => {\r\n            if (document.visibilityState === 'visible') {\r\n                updateDoc(userRef, { status: 'online', lastSeen: serverTimestamp() });\r\n            } else {\r\n                // Optional: Set to 'away' or just rely on heartbeat stopping?\r\n                // Let's set 'away' to be fancy? Or keep it simple.\r\n                // Sending 'offline' might be aggressive if they just switched tabs.\r\n                // Let's just update lastSeen so they stay online for a bit.\r\n            }\r\n        };\r\n\r\n        document.addEventListener('visibilitychange', handleVisibilityChange);\r\n\r\n        return () => {\r\n            clearInterval(intervalId);\r\n            document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n            setOffline();\r\n        };\r\n    }, [user]);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\hooks\\useWindowSize.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\lib\\animations\\variants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\lib\\appwriteAdmin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\lib\\firebase-admin.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":13,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { ServiceAccount } from 'firebase-admin';\r\nimport * as admin from 'firebase-admin';\r\n\r\nif (!admin.apps.length) {\r\n    try {\r\n        const serviceAccountKey = process.env.FIREBASE_SERVICE_ACCOUNT_KEY;\r\n\r\n        if (serviceAccountKey) {\r\n            // Handle both stringified JSON and base64 encoded JSON\r\n            let serviceAccount: ServiceAccount;\r\n            try {\r\n                serviceAccount = JSON.parse(serviceAccountKey);\r\n            } catch (e) {\r\n                // If parse fails, it might be base64 encoded or just raw fields\r\n                serviceAccount = JSON.parse(Buffer.from(serviceAccountKey, 'base64').toString('ascii'));\r\n            }\r\n\r\n            admin.initializeApp({\r\n                credential: admin.credential.cert(serviceAccount),\r\n                projectId: \"nutrilens-c24a6\", // Hardcoded based on client config\r\n            });\r\n        } else {\r\n            console.warn('FIREBASE_SERVICE_ACCOUNT_KEY not set. Push notifications will not work.');\r\n        }\r\n    } catch (error) {\r\n        console.error('Firebase Admin Init Error:', error);\r\n    }\r\n}\r\n\r\nexport const adminDb = admin.apps.length ? admin.firestore() : null;\r\nexport const adminMessaging = admin.apps.length ? admin.messaging() : null;\r\nexport const adminAuth = admin.apps.length ? admin.auth() : null;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\lib\\firebase.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[971,974],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[971,974],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { initializeApp, getApps, getApp } from 'firebase/app';\r\nimport { getAuth, GoogleAuthProvider } from 'firebase/auth';\r\nimport { getFirestore } from 'firebase/firestore';\r\nimport { getStorage } from 'firebase/storage';\r\nimport { getAnalytics, isSupported } from \"firebase/analytics\";\r\n\r\nconst firebaseConfig = {\r\n    apiKey: \"AIzaSyAwzrOcRTSM6tP4DUYks77K5NeW1D8GXu0\",\r\n    authDomain: \"nutrilens-c24a6.firebaseapp.com\",\r\n    projectId: \"nutrilens-c24a6\",\r\n    storageBucket: \"nutrilens-c24a6.firebasestorage.app\",\r\n    messagingSenderId: \"667801974110\",\r\n    appId: \"1:667801974110:web:862ea16de0280a63ab0bcf\",\r\n    measurementId: \"G-91D6PJFTXK\"\r\n};\r\n\r\n// Initialize Firebase (Singleton pattern)\r\nconst app = !getApps().length ? initializeApp(firebaseConfig) : getApp();\r\nconst auth = getAuth(app);\r\nconst db = getFirestore(app);\r\nconst storage = getStorage(app);\r\nconst googleProvider = new GoogleAuthProvider();\r\n\r\n// Analytics (Client-side only)\r\nlet analytics: any = null;\r\nif (typeof window !== 'undefined') {\r\n    isSupported().then((supported) => {\r\n        if (supported) {\r\n            analytics = getAnalytics(app);\r\n        }\r\n    });\r\n}\r\n\r\nexport { app, auth, db, storage, googleProvider, analytics };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\lib\\firebaseAdmin.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":14,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import 'server-only';\r\nimport * as admin from 'firebase-admin';\r\n\r\nif (!admin.apps.length) {\r\n    try {\r\n        const serviceAccountKey = process.env.FIREBASE_SERVICE_ACCOUNT_KEY;\r\n\r\n        if (!serviceAccountKey) {\r\n            console.warn('ΓÜá∩╕Å FIREBASE_SERVICE_ACCOUNT_KEY not set. Admin SDK will not be available.');\r\n        } else {\r\n            let serviceAccount;\r\n            try {\r\n                serviceAccount = JSON.parse(serviceAccountKey);\r\n            } catch (e) {\r\n                // Handle base64 encoded key\r\n                serviceAccount = JSON.parse(Buffer.from(serviceAccountKey, 'base64').toString('ascii'));\r\n            }\r\n\r\n            admin.initializeApp({\r\n                credential: admin.credential.cert(serviceAccount),\r\n            });\r\n\r\n            console.log('Γ£à Firebase Admin SDK initialized');\r\n        }\r\n    } catch (error) {\r\n        console.error('Γ¥î Failed to initialize Firebase Admin SDK:', error);\r\n    }\r\n}\r\n\r\nexport const adminDb = admin.apps.length > 0 ? admin.firestore() : null;\r\nexport const adminAuth = admin.apps.length > 0 ? admin.auth() : null;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\lib\\hooks\\useTheme.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\lib\\i18n.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\lib\\theme\\ThemeContext.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'applyThemePreference'. Either include it or remove the dependency array.","line":125,"column":8,"nodeType":"ArrayExpression","endLine":125,"endColumn":65,"suggestions":[{"desc":"Update the dependencies array to be: [userId, isAdminContext, storageKey, refreshGlobalThemes, applyThemePreference]","fix":{"range":[4908,4965],"text":"[userId, isAdminContext, storageKey, refreshGlobalThemes, applyThemePreference]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Theme Context\r\n * Global state management for theme system with Firebase persistence\r\n * Supports context-aware themes: separate themes for admin vs user areas\r\n */\r\n\r\n'use client';\r\n\r\nimport React, { createContext, useContext, useState, useEffect, ReactNode, useCallback } from 'react';\r\nimport { usePathname } from 'next/navigation';\r\nimport { ThemeId, ThemeConfig, CustomThemeColors, UserThemePreference, GlobalTheme } from '@/types/theme';\r\nimport { themes, defaultTheme, darkTheme } from './themes';\r\nimport { saveUserTheme, loadUserTheme, saveAdminTheme, loadAdminTheme, getGlobalThemes, globalThemeToConfig } from '@/services/themeService';\r\n\r\ninterface ThemeContextType {\r\n    currentTheme: ThemeConfig;\r\n    themeId: ThemeId;\r\n    setTheme: (themeId: ThemeId) => void;\r\n    customizeTheme: (colors: CustomThemeColors) => void;\r\n    resetTheme: () => void;\r\n    isCustomTheme: boolean;\r\n    customColors: CustomThemeColors | null;\r\n    isLoading: boolean;\r\n    availableThemes: ThemeConfig[];\r\n    globalThemes: GlobalTheme[];\r\n    refreshGlobalThemes: () => Promise<void>;\r\n    systemMode: 'light' | 'dark';\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\r\n\r\n// Storage keys for two-bucket approach\r\nconst USER_THEME_STORAGE_KEY = 'truthlens_theme';\r\nconst ADMIN_THEME_STORAGE_KEY = 'truthlens_admin_theme';\r\n\r\ninterface ThemeProviderProps {\r\n    children: ReactNode;\r\n    userId?: string | null;\r\n}\r\n\r\nexport function ThemeContextProvider({ children, userId }: ThemeProviderProps) {\r\n    // Route detection for context-aware theming\r\n    const pathname = usePathname();\r\n    const isAdminContext = pathname?.startsWith('/admin') ?? false;\r\n\r\n    const [themeId, setThemeId] = useState<ThemeId>('default');\r\n    const [customColors, setCustomColors] = useState<CustomThemeColors | null>(null);\r\n    const [currentTheme, setCurrentTheme] = useState<ThemeConfig>(defaultTheme);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [globalThemes, setGlobalThemes] = useState<GlobalTheme[]>([]);\r\n    const [systemMode, setSystemMode] = useState<'light' | 'dark'>('light');\r\n\r\n    // Get context-aware storage key\r\n    const storageKey = isAdminContext ? ADMIN_THEME_STORAGE_KEY : USER_THEME_STORAGE_KEY;\r\n\r\n    // Detect system theme preference\r\n    useEffect(() => {\r\n        const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n\r\n        const handleChange = (e: MediaQueryListEvent | MediaQueryList) => {\r\n            const newMode = e.matches ? 'dark' : 'light';\r\n            setSystemMode(newMode);\r\n\r\n            // Update theme if user has system mode selected\r\n            if (themeId === 'system') {\r\n                setCurrentTheme(newMode === 'dark' ? darkTheme : defaultTheme);\r\n            }\r\n        };\r\n\r\n        // Initial check\r\n        handleChange(mediaQuery);\r\n\r\n        // Listen for changes\r\n        mediaQuery.addEventListener('change', handleChange);\r\n        return () => mediaQuery.removeEventListener('change', handleChange);\r\n    }, [themeId]);\r\n\r\n    // Load global themes from Firebase\r\n    const refreshGlobalThemes = useCallback(async () => {\r\n        try {\r\n            const fetchedThemes = await getGlobalThemes();\r\n            setGlobalThemes(fetchedThemes);\r\n        } catch (error) {\r\n            console.error('[ThemeContext] Failed to load global themes:', error);\r\n        }\r\n    }, []);\r\n\r\n    // Load theme on mount - Context-aware: admin vs user bucket\r\n    useEffect(() => {\r\n        const loadTheme = async () => {\r\n            setIsLoading(true);\r\n            try {\r\n                // Load global themes\r\n                await refreshGlobalThemes();\r\n\r\n                // Try Firebase first if user is logged in\r\n                if (userId) {\r\n                    // Context-aware loading: check which bucket to use\r\n                    const firebaseTheme = isAdminContext\r\n                        ? await loadAdminTheme(userId)\r\n                        : await loadUserTheme(userId);\r\n\r\n                    if (firebaseTheme) {\r\n                        console.log(`[ThemeContext] Loaded ${isAdminContext ? 'admin' : 'user'} theme:`, firebaseTheme.id);\r\n                        applyThemePreference(firebaseTheme);\r\n                        setIsLoading(false);\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                // Fallback to context-aware localStorage\r\n                const saved = localStorage.getItem(storageKey);\r\n                if (saved) {\r\n                    const preference: UserThemePreference = JSON.parse(saved);\r\n                    applyThemePreference(preference);\r\n                }\r\n            } catch (error) {\r\n                console.error('[ThemeContext] Failed to load theme:', error);\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n\r\n        loadTheme();\r\n    }, [userId, isAdminContext, storageKey, refreshGlobalThemes]);\r\n\r\n    // Apply a theme preference\r\n    const applyThemePreference = useCallback((preference: UserThemePreference) => {\r\n        setThemeId(preference.id);\r\n\r\n        if (preference.id === 'system') {\r\n            setCurrentTheme(systemMode === 'dark' ? darkTheme : defaultTheme);\r\n            setCustomColors(null);\r\n        } else if (preference.id === 'custom' && preference.customColors) {\r\n            setCustomColors(preference.customColors);\r\n            setCurrentTheme(createCustomTheme(preference.customColors));\r\n        } else if (themes[preference.id]) {\r\n            setCustomColors(null);\r\n            setCurrentTheme(themes[preference.id]);\r\n        } else {\r\n            // Check if it's a global theme\r\n            const globalTheme = globalThemes.find(t => t.id === preference.id);\r\n            if (globalTheme) {\r\n                setCustomColors(null);\r\n                setCurrentTheme(globalThemeToConfig(globalTheme));\r\n            } else {\r\n                setCurrentTheme(defaultTheme);\r\n            }\r\n        }\r\n    }, [systemMode, globalThemes]);\r\n\r\n    // Save theme to localStorage and Firebase - Context-aware\r\n    const persistTheme = useCallback(async (newThemeId: ThemeId, newCustomColors: CustomThemeColors | null) => {\r\n        // Save to context-aware localStorage (always, for offline support)\r\n        try {\r\n            const preference: UserThemePreference = {\r\n                id: newThemeId,\r\n                customColors: newCustomColors || undefined,\r\n            };\r\n            localStorage.setItem(storageKey, JSON.stringify(preference));\r\n        } catch (error) {\r\n            console.error('[ThemeContext] Failed to save theme to localStorage:', error);\r\n        }\r\n\r\n        // Save to Firebase if logged in - use correct bucket\r\n        if (userId) {\r\n            try {\r\n                if (isAdminContext) {\r\n                    await saveAdminTheme(userId, newThemeId, newCustomColors || undefined);\r\n                    console.log('[ThemeContext] Admin theme saved:', newThemeId);\r\n                } else {\r\n                    await saveUserTheme(userId, newThemeId, newCustomColors || undefined);\r\n                    console.log('[ThemeContext] User theme saved:', newThemeId);\r\n                }\r\n            } catch (error) {\r\n                console.error('[ThemeContext] Failed to save theme to Firebase:', error);\r\n            }\r\n        }\r\n    }, [userId, isAdminContext, storageKey]);\r\n\r\n    const setTheme = useCallback((newThemeId: ThemeId) => {\r\n        setThemeId(newThemeId);\r\n\r\n        if (newThemeId === 'system') {\r\n            setCurrentTheme(systemMode === 'dark' ? darkTheme : defaultTheme);\r\n            setCustomColors(null);\r\n        } else if (newThemeId === 'custom') {\r\n            // Keep current custom colors\r\n            if (customColors) {\r\n                setCurrentTheme(createCustomTheme(customColors));\r\n            }\r\n        } else if (themes[newThemeId]) {\r\n            setCustomColors(null);\r\n            setCurrentTheme(themes[newThemeId]);\r\n        } else {\r\n            // Check global themes\r\n            const globalTheme = globalThemes.find(t => t.id === newThemeId);\r\n            if (globalTheme) {\r\n                setCustomColors(null);\r\n                setCurrentTheme(globalThemeToConfig(globalTheme));\r\n            } else {\r\n                setCurrentTheme(defaultTheme);\r\n            }\r\n        }\r\n\r\n        // Persist\r\n        persistTheme(newThemeId, newThemeId === 'custom' ? customColors : null);\r\n    }, [customColors, globalThemes, persistTheme, systemMode]);\r\n\r\n    const customizeTheme = useCallback((colors: CustomThemeColors) => {\r\n        setThemeId('custom');\r\n        setCustomColors(colors);\r\n        setCurrentTheme(createCustomTheme(colors));\r\n        persistTheme('custom', colors);\r\n    }, [persistTheme]);\r\n\r\n    const resetTheme = useCallback(() => {\r\n        setThemeId('default');\r\n        setCustomColors(null);\r\n        setCurrentTheme(defaultTheme);\r\n        localStorage.removeItem(storageKey);\r\n\r\n        if (userId) {\r\n            if (isAdminContext) {\r\n                saveAdminTheme(userId, 'default').catch(console.error);\r\n            } else {\r\n                saveUserTheme(userId, 'default').catch(console.error);\r\n            }\r\n        }\r\n    }, [userId, isAdminContext, storageKey]);\r\n\r\n    // Build available themes list (built-in + global)\r\n    const availableThemes: ThemeConfig[] = [\r\n        ...Object.values(themes),\r\n        ...globalThemes.map(globalThemeToConfig),\r\n    ];\r\n\r\n    const value: ThemeContextType = {\r\n        currentTheme,\r\n        themeId,\r\n        setTheme,\r\n        customizeTheme,\r\n        resetTheme,\r\n        isCustomTheme: themeId === 'custom',\r\n        customColors,\r\n        isLoading,\r\n        availableThemes,\r\n        globalThemes,\r\n        refreshGlobalThemes,\r\n        systemMode,\r\n    };\r\n\r\n    return <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>;\r\n}\r\n\r\nexport function useThemeContext() {\r\n    const context = useContext(ThemeContext);\r\n    if (!context) {\r\n        throw new Error('useThemeContext must be used within ThemeContextProvider');\r\n    }\r\n    return context;\r\n}\r\n\r\n/**\r\n * Helper function to create custom theme config\r\n */\r\nfunction createCustomTheme(colors: CustomThemeColors): ThemeConfig {\r\n    return {\r\n        id: 'custom',\r\n        name: 'Custom Theme',\r\n        mode: colors.mode,\r\n        colors: {\r\n            primary: {\r\n                main: colors.primary,\r\n                light: adjustColor(colors.primary, 20),\r\n                dark: adjustColor(colors.primary, -20),\r\n                contrastText: colors.mode === 'dark' ? '#000000' : '#FFFFFF',\r\n            },\r\n            secondary: {\r\n                main: colors.secondary,\r\n                light: adjustColor(colors.secondary, 20),\r\n                dark: adjustColor(colors.secondary, -20),\r\n                contrastText: colors.mode === 'dark' ? '#000000' : '#FFFFFF',\r\n            },\r\n            background: {\r\n                default: colors.background,\r\n                paper: colors.mode === 'dark' ? '#1E293B' : '#FFFFFF',\r\n            },\r\n            text: {\r\n                primary: colors.mode === 'dark' ? '#F1F5F9' : '#1F2937',\r\n                secondary: colors.mode === 'dark' ? '#94A3B8' : '#6B7280',\r\n            },\r\n            error: {\r\n                main: '#EF4444',\r\n                light: '#F87171',\r\n                dark: '#DC2626',\r\n            },\r\n            warning: {\r\n                main: '#F59E0B',\r\n                light: '#FBBF24',\r\n                dark: '#D97706',\r\n            },\r\n            info: {\r\n                main: '#3B82F6',\r\n                light: '#60A5FA',\r\n                dark: '#2563EB',\r\n            },\r\n            success: {\r\n                main: '#10B981',\r\n                light: '#34D399',\r\n                dark: '#059669',\r\n            },\r\n        },\r\n        typography: {\r\n            fontFamily: colors.fontFamily || \"'Inter', 'Roboto', 'Helvetica', 'Arial', sans-serif\",\r\n            fontSize: 14,\r\n            fontWeightLight: 300,\r\n            fontWeightRegular: 400,\r\n            fontWeightMedium: 500,\r\n            fontWeightBold: 700,\r\n        },\r\n        shape: {\r\n            borderRadius: colors.borderRadius,\r\n        },\r\n    };\r\n}\r\n\r\n/**\r\n * Adjust color brightness\r\n * @param color - Hex color string\r\n * @param amount - Positive to lighten, negative to darken\r\n */\r\nfunction adjustColor(color: string, amount: number): string {\r\n    try {\r\n        // Remove # if present\r\n        const hex = color.replace('#', '');\r\n\r\n        // Parse RGB\r\n        const r = parseInt(hex.substring(0, 2), 16);\r\n        const g = parseInt(hex.substring(2, 4), 16);\r\n        const b = parseInt(hex.substring(4, 6), 16);\r\n\r\n        // Adjust\r\n        const newR = Math.min(255, Math.max(0, r + amount));\r\n        const newG = Math.min(255, Math.max(0, g + amount));\r\n        const newB = Math.min(255, Math.max(0, b + amount));\r\n\r\n        // Convert back to hex\r\n        return `#${newR.toString(16).padStart(2, '0')}${newG.toString(16).padStart(2, '0')}${newB.toString(16).padStart(2, '0')}`;\r\n    } catch {\r\n        return color;\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\lib\\theme\\muiTheme.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\lib\\theme\\themes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\next.config.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":6,"column":3,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":6,"endColumn":59,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[143,199],"text":"// @ts-expect-error - silence Turbopack/Webpack config warning"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextConfig } from \"next\";\nimport withPWA from \"@ducanh2912/next-pwa\";\n\nconst nextConfig: NextConfig = {\n  reactCompiler: true,\n  // @ts-ignore - silence Turbopack/Webpack config warning\n  turbopack: {},\n  experimental: {\n    // allowedDevOrigins: [\"localhost:3000\", \"192.168.8.100:3000\"],\n  },\n  async redirects() {\n    return [\n      {\n        source: '/search',\n        destination: '/global-search',\n        permanent: true,\n      },\n    ];\n  },\n};\n\nexport default withPWA({\n  dest: \"public\",\n  disable: process.env.NODE_ENV === \"development\",\n  register: true,\n})(nextConfig);\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\public\\firebase-messaging-sw.js","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'no-restricted-globals').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[0,42],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'no-undef').","line":2,"column":1,"severity":1,"nodeType":null,"fix":{"range":[44,73],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":2,"source":"/* eslint-disable no-restricted-globals */\r\n/* eslint-disable no-undef */\r\n\r\n// Give the service worker access to Firebase Messaging.\r\nimportScripts('https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js');\r\nimportScripts('https://www.gstatic.com/firebasejs/9.0.0/firebase-messaging-compat.js');\r\n\r\n// Initialize the Firebase app in the service worker by passing in the messagingSenderId.\r\nfirebase.initializeApp({\r\n    apiKey: \"AIzaSyAwzrOcRTSM6tP4DUYks77K5NeW1D8GXu0\",\r\n    authDomain: \"nutrilens-c24a6.firebaseapp.com\",\r\n    projectId: \"nutrilens-c24a6\",\r\n    storageBucket: \"nutrilens-c24a6.firebasestorage.app\",\r\n    messagingSenderId: \"667801974110\",\r\n    appId: \"1:667801974110:web:862ea16de0280a63ab0bcf\",\r\n});\r\n\r\n// Retrieve an instance of Firebase Messaging so that it can handle background messages.\r\nconst messaging = firebase.messaging();\r\n\r\nmessaging.onBackgroundMessage(function (payload) {\r\n    console.log('[firebase-messaging-sw.js] Received background message ', payload);\r\n\r\n    const notificationTitle = payload.notification.title;\r\n    const notificationOptions = {\r\n        body: payload.notification.body,\r\n        icon: '/icons/icon-192x192.png', // Use our new icon\r\n        badge: '/icons/icon-192x192.png'\r\n    };\r\n\r\n    self.registration.showNotification(notificationTitle, notificationOptions);\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\public\\service-worker.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\public\\sw.js","messages":[{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":156,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":203},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":209,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":233},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":626,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":21257}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"if(!self.define){let e,a={};const s=(s,c)=>(s=new URL(s+\".js\",c).href,a[s]||new Promise(a=>{if(\"document\"in self){const e=document.createElement(\"script\");e.src=s,e.onload=a,document.head.appendChild(e)}else e=s,importScripts(s),a()}).then(()=>{let e=a[s];if(!e)throw new Error(`Module ${s} didnΓÇÖt register its module`);return e}));self.define=(c,i)=>{const n=e||(\"document\"in self?document.currentScript.src:\"\")||location.href;if(a[n])return;let t={};const r=e=>s(e,n),d={module:{uri:n},exports:t,require:r};a[n]=Promise.all(c.map(e=>d[e]||r(e))).then(e=>(i(...e),t))}}define([\"./workbox-f1770938\"],function(e){\"use strict\";importScripts(),self.skipWaiting(),e.clientsClaim(),e.precacheAndRoute([{url:\"/_next/static/chunks/1033-afbfeea7beedebb9.js\",revision:\"afbfeea7beedebb9\"},{url:\"/_next/static/chunks/1272-f59241a3d6fff9a5.js\",revision:\"f59241a3d6fff9a5\"},{url:\"/_next/static/chunks/1385-b08b965eec3fb07a.js\",revision:\"b08b965eec3fb07a\"},{url:\"/_next/static/chunks/1537.e4052a55c124ae05.js\",revision:\"e4052a55c124ae05\"},{url:\"/_next/static/chunks/1615-4b93b34658e8dc98.js\",revision:\"4b93b34658e8dc98\"},{url:\"/_next/static/chunks/1669-7efcdd6ebd6248d8.js\",revision:\"7efcdd6ebd6248d8\"},{url:\"/_next/static/chunks/1717-e1e6aa54b8e89cc2.js\",revision:\"e1e6aa54b8e89cc2\"},{url:\"/_next/static/chunks/1836-bcb1f31624488edf.js\",revision:\"bcb1f31624488edf\"},{url:\"/_next/static/chunks/1864-ae477d803800cbc3.js\",revision:\"ae477d803800cbc3\"},{url:\"/_next/static/chunks/2123-8b9f54df571ffef5.js\",revision:\"8b9f54df571ffef5\"},{url:\"/_next/static/chunks/2266-01fbd38c4de20b7b.js\",revision:\"01fbd38c4de20b7b\"},{url:\"/_next/static/chunks/2303-fd2c5537110a1769.js\",revision:\"fd2c5537110a1769\"},{url:\"/_next/static/chunks/2385-2347d503fb8173fd.js\",revision:\"2347d503fb8173fd\"},{url:\"/_next/static/chunks/2707-d47cc50b3d23b095.js\",revision:\"d47cc50b3d23b095\"},{url:\"/_next/static/chunks/276-95a981ae22872fe3.js\",revision:\"95a981ae22872fe3\"},{url:\"/_next/static/chunks/2793-807b4ce967036bb3.js\",revision:\"807b4ce967036bb3\"},{url:\"/_next/static/chunks/2862-b6e45f84ff3fecc7.js\",revision:\"b6e45f84ff3fecc7\"},{url:\"/_next/static/chunks/2871-48fb9d092831bb4d.js\",revision:\"48fb9d092831bb4d\"},{url:\"/_next/static/chunks/2948-d04fc81456fb8c3f.js\",revision:\"d04fc81456fb8c3f\"},{url:\"/_next/static/chunks/301-f408e1902c428e4a.js\",revision:\"f408e1902c428e4a\"},{url:\"/_next/static/chunks/3083-99f530ae927d7de7.js\",revision:\"99f530ae927d7de7\"},{url:\"/_next/static/chunks/3342.0a1c2833d7450d08.js\",revision:\"0a1c2833d7450d08\"},{url:\"/_next/static/chunks/3549-7043b8188fcf44a4.js\",revision:\"7043b8188fcf44a4\"},{url:\"/_next/static/chunks/3677-843429e1a286ded1.js\",revision:\"843429e1a286ded1\"},{url:\"/_next/static/chunks/3931-f0c2bcd439ec1a9e.js\",revision:\"f0c2bcd439ec1a9e\"},{url:\"/_next/static/chunks/4053-b9fbe5dc8fe7879e.js\",revision:\"b9fbe5dc8fe7879e\"},{url:\"/_next/static/chunks/4077.cfe37d788f312b84.js\",revision:\"cfe37d788f312b84\"},{url:\"/_next/static/chunks/4104-4283c03dd525f180.js\",revision:\"4283c03dd525f180\"},{url:\"/_next/static/chunks/4110-fe72a52c167ccf33.js\",revision:\"fe72a52c167ccf33\"},{url:\"/_next/static/chunks/4326-9a91a5dcfb4de3ef.js\",revision:\"9a91a5dcfb4de3ef\"},{url:\"/_next/static/chunks/4398-d5af1fb54d1b2ee0.js\",revision:\"d5af1fb54d1b2ee0\"},{url:\"/_next/static/chunks/441-660ccdf8f9733744.js\",revision:\"660ccdf8f9733744\"},{url:\"/_next/static/chunks/4461-d933bf684c1e56d0.js\",revision:\"d933bf684c1e56d0\"},{url:\"/_next/static/chunks/4683.2e388804eb27198a.js\",revision:\"2e388804eb27198a\"},{url:\"/_next/static/chunks/4bd1b696-7a9198eb45eb8b1c.js\",revision:\"7a9198eb45eb8b1c\"},{url:\"/_next/static/chunks/5431-f939fd8406b7cc27.js\",revision:\"f939fd8406b7cc27\"},{url:\"/_next/static/chunks/5557-7759d2e647ece579.js\",revision:\"7759d2e647ece579\"},{url:\"/_next/static/chunks/5648-7064a8d8c1b83d57.js\",revision:\"7064a8d8c1b83d57\"},{url:\"/_next/static/chunks/5667-c496ec958b73feac.js\",revision:\"c496ec958b73feac\"},{url:\"/_next/static/chunks/570-07fe2e3c203f4094.js\",revision:\"07fe2e3c203f4094\"},{url:\"/_next/static/chunks/5941-84290b67bc577570.js\",revision:\"84290b67bc577570\"},{url:\"/_next/static/chunks/6036-c1b63891e122e6a8.js\",revision:\"c1b63891e122e6a8\"},{url:\"/_next/static/chunks/6283.5272b8babe703e89.js\",revision:\"5272b8babe703e89\"},{url:\"/_next/static/chunks/6440-9568af14fb92bee9.js\",revision:\"9568af14fb92bee9\"},{url:\"/_next/static/chunks/6575.6dccfc7a5d0c6f74.js\",revision:\"6dccfc7a5d0c6f74\"},{url:\"/_next/static/chunks/6729-df2cc451f16b3904.js\",revision:\"df2cc451f16b3904\"},{url:\"/_next/static/chunks/6732-1c732fb21399c6b2.js\",revision:\"1c732fb21399c6b2\"},{url:\"/_next/static/chunks/6766-e602ca68086cd4eb.js\",revision:\"e602ca68086cd4eb\"},{url:\"/_next/static/chunks/6795-0f9852e0a88db28b.js\",revision:\"0f9852e0a88db28b\"},{url:\"/_next/static/chunks/6878-4972f4fdd6f15ffe.js\",revision:\"4972f4fdd6f15ffe\"},{url:\"/_next/static/chunks/7014-b38e7979000bb6b9.js\",revision:\"b38e7979000bb6b9\"},{url:\"/_next/static/chunks/7115-dd5cdc42bc2d4d78.js\",revision:\"dd5cdc42bc2d4d78\"},{url:\"/_next/static/chunks/7140-7faed552c2e96004.js\",revision:\"7faed552c2e96004\"},{url:\"/_next/static/chunks/7204-e9c91e5ea5025427.js\",revision:\"e9c91e5ea5025427\"},{url:\"/_next/static/chunks/7226-6ea1a1140d5357f9.js\",revision:\"6ea1a1140d5357f9\"},{url:\"/_next/static/chunks/7472-85edbdfb39c35955.js\",revision:\"85edbdfb39c35955\"},{url:\"/_next/static/chunks/7508b87c-51275abc95f809c0.js\",revision:\"51275abc95f809c0\"},{url:\"/_next/static/chunks/755-3ca5e7f05e7db9c6.js\",revision:\"3ca5e7f05e7db9c6\"},{url:\"/_next/static/chunks/7699-56f1ad433c536786.js\",revision:\"56f1ad433c536786\"},{url:\"/_next/static/chunks/7749-92bbfb51c364a342.js\",revision:\"92bbfb51c364a342\"},{url:\"/_next/static/chunks/7790-3c737584860ee0d3.js\",revision:\"3c737584860ee0d3\"},{url:\"/_next/static/chunks/7924-f5bcb8e57805adaa.js\",revision:\"f5bcb8e57805adaa\"},{url:\"/_next/static/chunks/7cb1fa1f-7161c9be2dee283e.js\",revision:\"7161c9be2dee283e\"},{url:\"/_next/static/chunks/8096-bd45171042e301de.js\",revision:\"bd45171042e301de\"},{url:\"/_next/static/chunks/8262-2790c3217b0e3e0c.js\",revision:\"2790c3217b0e3e0c\"},{url:\"/_next/static/chunks/84c12632-488ba79494e86c16.js\",revision:\"488ba79494e86c16\"},{url:\"/_next/static/chunks/8657-d6c5d81106aeefd4.js\",revision:\"d6c5d81106aeefd4\"},{url:\"/_next/static/chunks/8743-57009c5873b32567.js\",revision:\"57009c5873b32567\"},{url:\"/_next/static/chunks/8774.e7b9c539a0e84861.js\",revision:\"e7b9c539a0e84861\"},{url:\"/_next/static/chunks/8861-316e9b4abc154bf7.js\",revision:\"316e9b4abc154bf7\"},{url:\"/_next/static/chunks/8982-6667875038f8d587.js\",revision:\"6667875038f8d587\"},{url:\"/_next/static/chunks/9021-85f1bed834458cfd.js\",revision:\"85f1bed834458cfd\"},{url:\"/_next/static/chunks/9069-4e927dc6cc3e288e.js\",revision:\"4e927dc6cc3e288e\"},{url:\"/_next/static/chunks/9131-88bb740c454e084a.js\",revision:\"88bb740c454e084a\"},{url:\"/_next/static/chunks/9332-ba925e59a469b9ab.js\",revision:\"ba925e59a469b9ab\"},{url:\"/_next/static/chunks/9340-7b8b827ffd3b5550.js\",revision:\"7b8b827ffd3b5550\"},{url:\"/_next/static/chunks/9493-e25844752a8ff756.js\",revision:\"e25844752a8ff756\"},{url:\"/_next/static/chunks/9539-d5690cb4fe4b4ae2.js\",revision:\"d5690cb4fe4b4ae2\"},{url:\"/_next/static/chunks/971.941448c68a942b40.js\",revision:\"941448c68a942b40\"},{url:\"/_next/static/chunks/9833.e26550c584743875.js\",revision:\"e26550c584743875\"},{url:\"/_next/static/chunks/989-323f371e87f57b05.js\",revision:\"323f371e87f57b05\"},{url:\"/_next/static/chunks/9998.a265691c2bede888.js\",revision:\"a265691c2bede888\"},{url:\"/_next/static/chunks/app/(admin)/admin/access-codes/page-ae635bac62963e70.js\",revision:\"ae635bac62963e70\"},{url:\"/_next/static/chunks/app/(admin)/admin/access-requests/page-c0425e29a0e046a6.js\",revision:\"c0425e29a0e046a6\"},{url:\"/_next/static/chunks/app/(admin)/admin/cancellations/page-526dd76fbe31202d.js\",revision:\"526dd76fbe31202d\"},{url:\"/_next/static/chunks/app/(admin)/admin/chat/page-0a21b814157447da.js\",revision:\"0a21b814157447da\"},{url:\"/_next/static/chunks/app/(admin)/admin/events/page-fb93fcfe5e989679.js\",revision:\"fb93fcfe5e989679\"},{url:\"/_next/static/chunks/app/(admin)/admin/layout-e9b3e28328feb4d6.js\",revision:\"e9b3e28328feb4d6\"},{url:\"/_next/static/chunks/app/(admin)/admin/page-e5ddc74bd9fd2b31.js\",revision:\"e5ddc74bd9fd2b31\"},{url:\"/_next/static/chunks/app/(admin)/admin/payments/page-d4b3382ab2b3fd23.js\",revision:\"d4b3382ab2b3fd23\"},{url:\"/_next/static/chunks/app/(admin)/admin/pc-requests/%5Bid%5D/page-f0c78d14a5d97a18.js\",revision:\"f0c78d14a5d97a18\"},{url:\"/_next/static/chunks/app/(admin)/admin/pc-requests/page-095046f6b75b0d51.js\",revision:\"095046f6b75b0d51\"},{url:\"/_next/static/chunks/app/(admin)/admin/settings/page-bfa1843f99c07f80.js\",revision:\"bfa1843f99c07f80\"},{url:\"/_next/static/chunks/app/(admin)/admin/settings/recovery/page-4717ec5b49f66f48.js\",revision:\"4717ec5b49f66f48\"},{url:\"/_next/static/chunks/app/(admin)/admin/support/page-160c5e917daf1d56.js\",revision:\"160c5e917daf1d56\"},{url:\"/_next/static/chunks/app/(admin)/admin/themes/page-a2485a6abf3298e6.js\",revision:\"a2485a6abf3298e6\"},{url:\"/_next/static/chunks/app/(admin)/admin/tiers/page-8d013f37c8525d0e.js\",revision:\"8d013f37c8525d0e\"},{url:\"/_next/static/chunks/app/(admin)/admin/users/page-0f555b07757eed5e.js\",revision:\"0f555b07757eed5e\"},{url:\"/_next/static/chunks/app/(admin)/layout-6929cbbeaa72e7f8.js\",revision:\"6929cbbeaa72e7f8\"},{url:\"/_next/static/chunks/app/_global-error/page-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/_not-found/page-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/ai-chat/page-35b69dfb61887fb4.js\",revision:\"35b69dfb61887fb4\"},{url:\"/_next/static/chunks/app/api/access/submit/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/access/validate/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/admin/action/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/admin/ai-test/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/admin/backup/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/admin/delete-file/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/admin/keys/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/admin/ollama/models/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/admin/openrouter/models/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/admin/send-notification/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/admin/upload/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/admin/users/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/notifications/send-chat-push/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/notifications/subscribe/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/ollama/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/pc-builder/generate/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/pc-builder/save/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/product/scan/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/search-by-image/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/api/v1/event_config/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/cancel-membership/page-c3700bdc5dde8c4f.js\",revision:\"c3700bdc5dde8c4f\"},{url:\"/_next/static/chunks/app/compare/page-05d4e0630f3a89da.js\",revision:\"05d4e0630f3a89da\"},{url:\"/_next/static/chunks/app/favorites/page-15eb86ab96cd23a5.js\",revision:\"15eb86ab96cd23a5\"},{url:\"/_next/static/chunks/app/global-search/layout-01c6d5cb8b0d8c96.js\",revision:\"01c6d5cb8b0d8c96\"},{url:\"/_next/static/chunks/app/global-search/page-14f20be8fe52dfd5.js\",revision:\"14f20be8fe52dfd5\"},{url:\"/_next/static/chunks/app/history/layout-3373d832b2c873b4.js\",revision:\"3373d832b2c873b4\"},{url:\"/_next/static/chunks/app/history/page-bfd9057c328f583f.js\",revision:\"bfd9057c328f583f\"},{url:\"/_next/static/chunks/app/install-guide/page-e5ea6da901fd0331.js\",revision:\"e5ea6da901fd0331\"},{url:\"/_next/static/chunks/app/layout-ed94ea5f7cfdde00.js\",revision:\"ed94ea5f7cfdde00\"},{url:\"/_next/static/chunks/app/login/page-3df5f775b05c24ea.js\",revision:\"3df5f775b05c24ea\"},{url:\"/_next/static/chunks/app/maintenance/page-c1790545d22e71f5.js\",revision:\"c1790545d22e71f5\"},{url:\"/_next/static/chunks/app/manifest.webmanifest/route-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/app/meal-planner/page-859090e33c1c2c34.js\",revision:\"859090e33c1c2c34\"},{url:\"/_next/static/chunks/app/not-found-8de899c2c4f76bba.js\",revision:\"8de899c2c4f76bba\"},{url:\"/_next/static/chunks/app/page-621961108e82fe10.js\",revision:\"621961108e82fe10\"},{url:\"/_next/static/chunks/app/payment/success/page-87845a69def25185.js\",revision:\"87845a69def25185\"},{url:\"/_next/static/chunks/app/pc-builder/page-7f681bdc11d03fbc.js\",revision:\"7f681bdc11d03fbc\"},{url:\"/_next/static/chunks/app/product/%5Bid%5D/page-81ef9ca0100a5770.js\",revision:\"81ef9ca0100a5770\"},{url:\"/_next/static/chunks/app/profile/layout-da6840cc92dd5427.js\",revision:\"da6840cc92dd5427\"},{url:\"/_next/static/chunks/app/profile/page-67343101f0bca520.js\",revision:\"67343101f0bca520\"},{url:\"/_next/static/chunks/app/quest/page-98fa68e6c2702554.js\",revision:\"98fa68e6c2702554\"},{url:\"/_next/static/chunks/app/recommendations/page-a28be6f298b3eee4.js\",revision:\"a28be6f298b3eee4\"},{url:\"/_next/static/chunks/app/request-access/page-8ed3683eeffe8957.js\",revision:\"8ed3683eeffe8957\"},{url:\"/_next/static/chunks/app/reset-password/page-3775d5cb1b446baa.js\",revision:\"3775d5cb1b446baa\"},{url:\"/_next/static/chunks/app/scan/layout-d3abd8344a74d655.js\",revision:\"d3abd8344a74d655\"},{url:\"/_next/static/chunks/app/scan/page-bdfa3786e9d44272.js\",revision:\"bdfa3786e9d44272\"},{url:\"/_next/static/chunks/app/search/photo/page-3e1c88c57f0afd3e.js\",revision:\"3e1c88c57f0afd3e\"},{url:\"/_next/static/chunks/app/set-admin/page-3bf2e9b5c347f5d8.js\",revision:\"3bf2e9b5c347f5d8\"},{url:\"/_next/static/chunks/app/signup/page-4c8339c1499d2730.js\",revision:\"4c8339c1499d2730\"},{url:\"/_next/static/chunks/app/support/page-a443031425f4fd8a.js\",revision:\"a443031425f4fd8a\"},{url:\"/_next/static/chunks/app/template-743af95d5eff0b5e.js\",revision:\"743af95d5eff0b5e\"},{url:\"/_next/static/chunks/app/upgrade/page-eb12c84fffbc4045.js\",revision:\"eb12c84fffbc4045\"},{url:\"/_next/static/chunks/dc112a36-d2bf0d50c3702be1.js\",revision:\"d2bf0d50c3702be1\"},{url:\"/_next/static/chunks/framework-bd61ec64032c2de7.js\",revision:\"bd61ec64032c2de7\"},{url:\"/_next/static/chunks/main-26b6531ed0e5bb28.js\",revision:\"26b6531ed0e5bb28\"},{url:\"/_next/static/chunks/main-app-8f72d7bbe1108379.js\",revision:\"8f72d7bbe1108379\"},{url:\"/_next/static/chunks/next/dist/client/components/builtin/app-error-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/next/dist/client/components/builtin/forbidden-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/next/dist/client/components/builtin/global-error-fda311ecac135248.js\",revision:\"fda311ecac135248\"},{url:\"/_next/static/chunks/next/dist/client/components/builtin/unauthorized-0aad0010c48cab4a.js\",revision:\"0aad0010c48cab4a\"},{url:\"/_next/static/chunks/polyfills-42372ed130431b0a.js\",revision:\"846118c33b2c0e922d7b3a7676f81f6f\"},{url:\"/_next/static/chunks/webpack-cc02aec581f4181d.js\",revision:\"cc02aec581f4181d\"},{url:\"/_next/static/css/7e5ea5f0ae390305.css\",revision:\"7e5ea5f0ae390305\"},{url:\"/_next/static/media/7b0b24f36b1a6d0b-s.p.woff2\",revision:\"98ccc2b7f18991a5126a91ac56fbb1fc\"},{url:\"/_next/static/media/98848575513c9742-s.woff2\",revision:\"e2b64ddcb351dbe7397e0da426a8c8d6\"},{url:\"/_next/static/xOAAZXwj95NIaZ0frdshq/_buildManifest.js\",revision:\"0a67e81d6325bb707cd5497c5d3e1c9a\"},{url:\"/_next/static/xOAAZXwj95NIaZ0frdshq/_ssgManifest.js\",revision:\"b6652df95db52feb4daf4eca35380933\"},{url:\"/apple-touch-icon.png\",revision:\"25fcde2fdc9f2900469dbb61574ce092\"},{url:\"/favicon.ico\",revision:\"f2fcc91223ff5dc101b0f50846042fba\"},{url:\"/file.svg\",revision:\"d09f95206c3fa0bb9bd9fefabfd0ea71\"},{url:\"/firebase-messaging-sw.js\",revision:\"14956a98e1263c8fee8fe1bb8921aef6\"},{url:\"/globe.svg\",revision:\"2aaafa6a49b6563925fe440891e32717\"},{url:\"/icons/icon-192x192.png\",revision:\"38d70127e229b5ce224a27d48e19aa38\"},{url:\"/icons/icon-512x512.png\",revision:\"dbb47ed193dc917bbfbdf3f814a910d4\"},{url:\"/images/install-guide/ios-add-home-step.png\",revision:\"a581a42e85457b89defc5dcf26e10c67\"},{url:\"/images/install-guide/ios-share-step.png\",revision:\"5b3921ac24e04862e5df5d67855b1626\"},{url:\"/locales/en/translation.json\",revision:\"5f922c7290eb0b5b260de37c2db6a8fb\"},{url:\"/locales/es/translation.json\",revision:\"020e4077ef2dde4e2fdbe9e10d23ce8f\"},{url:\"/locales/fr/translation.json\",revision:\"7c55bd0262e20dfecbd09e610aaff80d\"},{url:\"/locales/pt/translation.json\",revision:\"85ab77c87e6810a41a366a2112998236\"},{url:\"/next.svg\",revision:\"8e061864f388b47f33a1c3780831193e\"},{url:\"/service-worker.js\",revision:\"74cd9b52c75399ab31ba63ec7708fea1\"},{url:\"/special-song.mp3\",revision:\"f43618eaf9ca0fb5f244c1452271c29f\"},{url:\"/window.svg\",revision:\"a2760511c65806022ad20adf74370ff3\"}],{ignoreURLParametersMatching:[/^utm_/,/^fbclid$/]}),e.cleanupOutdatedCaches(),e.registerRoute(\"/\",new e.NetworkFirst({cacheName:\"start-url\",plugins:[{cacheWillUpdate:async({response:e})=>e&&\"opaqueredirect\"===e.type?new Response(e.body,{status:200,statusText:\"OK\",headers:e.headers}):e}]}),\"GET\"),e.registerRoute(/^https:\\/\\/fonts\\.(?:gstatic)\\.com\\/.*/i,new e.CacheFirst({cacheName:\"google-fonts-webfonts\",plugins:[new e.ExpirationPlugin({maxEntries:4,maxAgeSeconds:31536e3})]}),\"GET\"),e.registerRoute(/^https:\\/\\/fonts\\.(?:googleapis)\\.com\\/.*/i,new e.StaleWhileRevalidate({cacheName:\"google-fonts-stylesheets\",plugins:[new e.ExpirationPlugin({maxEntries:4,maxAgeSeconds:604800})]}),\"GET\"),e.registerRoute(/\\.(?:eot|otf|ttc|ttf|woff|woff2|font.css)$/i,new e.StaleWhileRevalidate({cacheName:\"static-font-assets\",plugins:[new e.ExpirationPlugin({maxEntries:4,maxAgeSeconds:604800})]}),\"GET\"),e.registerRoute(/\\.(?:jpg|jpeg|gif|png|svg|ico|webp)$/i,new e.StaleWhileRevalidate({cacheName:\"static-image-assets\",plugins:[new e.ExpirationPlugin({maxEntries:64,maxAgeSeconds:2592e3})]}),\"GET\"),e.registerRoute(/\\/_next\\/static.+\\.js$/i,new e.CacheFirst({cacheName:\"next-static-js-assets\",plugins:[new e.ExpirationPlugin({maxEntries:64,maxAgeSeconds:86400})]}),\"GET\"),e.registerRoute(/\\/_next\\/image\\?url=.+$/i,new e.StaleWhileRevalidate({cacheName:\"next-image\",plugins:[new e.ExpirationPlugin({maxEntries:64,maxAgeSeconds:86400})]}),\"GET\"),e.registerRoute(/\\.(?:mp3|wav|ogg)$/i,new e.CacheFirst({cacheName:\"static-audio-assets\",plugins:[new e.RangeRequestsPlugin,new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400})]}),\"GET\"),e.registerRoute(/\\.(?:mp4|webm)$/i,new e.CacheFirst({cacheName:\"static-video-assets\",plugins:[new e.RangeRequestsPlugin,new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400})]}),\"GET\"),e.registerRoute(/\\.(?:js)$/i,new e.StaleWhileRevalidate({cacheName:\"static-js-assets\",plugins:[new e.ExpirationPlugin({maxEntries:48,maxAgeSeconds:86400})]}),\"GET\"),e.registerRoute(/\\.(?:css|less)$/i,new e.StaleWhileRevalidate({cacheName:\"static-style-assets\",plugins:[new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400})]}),\"GET\"),e.registerRoute(/\\/_next\\/data\\/.+\\/.+\\.json$/i,new e.StaleWhileRevalidate({cacheName:\"next-data\",plugins:[new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400})]}),\"GET\"),e.registerRoute(/\\.(?:json|xml|csv)$/i,new e.NetworkFirst({cacheName:\"static-data-assets\",plugins:[new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400})]}),\"GET\"),e.registerRoute(({sameOrigin:e,url:{pathname:a}})=>!(!e||a.startsWith(\"/api/auth/callback\")||!a.startsWith(\"/api/\")),new e.NetworkFirst({cacheName:\"apis\",networkTimeoutSeconds:10,plugins:[new e.ExpirationPlugin({maxEntries:16,maxAgeSeconds:86400})]}),\"GET\"),e.registerRoute(({request:e,url:{pathname:a},sameOrigin:s})=>\"1\"===e.headers.get(\"RSC\")&&\"1\"===e.headers.get(\"Next-Router-Prefetch\")&&s&&!a.startsWith(\"/api/\"),new e.NetworkFirst({cacheName:\"pages-rsc-prefetch\",plugins:[new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400})]}),\"GET\"),e.registerRoute(({request:e,url:{pathname:a},sameOrigin:s})=>\"1\"===e.headers.get(\"RSC\")&&s&&!a.startsWith(\"/api/\"),new e.NetworkFirst({cacheName:\"pages-rsc\",plugins:[new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400})]}),\"GET\"),e.registerRoute(({url:{pathname:e},sameOrigin:a})=>a&&!e.startsWith(\"/api/\"),new e.NetworkFirst({cacheName:\"pages\",plugins:[new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400})]}),\"GET\"),e.registerRoute(({sameOrigin:e})=>!e,new e.NetworkFirst({cacheName:\"cross-origin\",networkTimeoutSeconds:10,plugins:[new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:3600})]}),\"GET\")});\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\public\\workbox-f1770938.js","messages":[{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":49,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":80},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is defined but never used.","line":1,"column":87,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":88},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":211,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":251},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":257,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":291},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is defined but never used.","line":1,"column":298,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":299},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":381,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":425},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":642,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":671},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":813,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":832},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":989,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":1017},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":1093,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":1167},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":1738,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":1763},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":2263,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":2337},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":3058,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":3095},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is defined but never used.","line":1,"column":3102,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":3103},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":3598,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":3626},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":3727,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":3847},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":7052,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":7174},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":7234,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":7291},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i' is defined but never used.","line":1,"column":7954,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":7955},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":7962,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":8056},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":8066,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":8091},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":8368,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":8410},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":9440,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":9541},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":9550,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":9557},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":9566,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":9625},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":9627,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":9719},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":9962,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":10029},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":10038,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":10056},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":10065,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":10079},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":10081,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":10142},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":10163,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":10197},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":10963,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":11000},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is defined but never used.","line":1,"column":11007,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":11008},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":11122,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":11142},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":11194,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":11295},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":11301,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":11462},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":11382,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":11453},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":11623,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":11656},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":11941,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":12031},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":12060,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":12097},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":12464,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":12575},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":12684,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":12793},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":13012,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":13065},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":13272,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":13313},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":13319,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":13360},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is defined but never used.","line":1,"column":13367,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":13368},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is defined but never used.","line":1,"column":14423,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":14424},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":14555,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":14592},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is defined but never used.","line":1,"column":14599,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":14600},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":15097,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":15468},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":15191,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":15215},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":15404,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":15458},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":15514,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":15692},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":16025,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":16050},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is defined but never used.","line":1,"column":16057,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":16058},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":16165,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":16292},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":16591,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":16732},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":16958,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":17076},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":17076,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":17176},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":17178,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":17384},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":17458,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":17677},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":17719,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":17855},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":17903,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":17970},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":19089,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":19137},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":20040,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":20063},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":20129,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":20176},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":20260,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":20286},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":20317,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":20349},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":20514,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":23575},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":20635,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":20660},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":20768,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":21260},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is defined but never used.","line":1,"column":20988,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":20989},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":21080,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":21134},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":21657,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":21702},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":21768,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":21880},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":21988,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":22001},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":1,"column":22227,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":22228},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'s' is defined but never used.","line":1,"column":22385,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":22386},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":22450,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":22475},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":22748,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":22825},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":22962,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":22987},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'t' is defined but never used.","line":1,"column":23349,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":23350},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":1,"message":"Expected an assignment or function call and instead saw an expression.","line":1,"column":23479,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1,"endColumn":23556}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":83,"fixableErrorCount":0,"fixableWarningCount":0,"source":"define([\"exports\"],function(t){\"use strict\";try{self[\"workbox:core:7.0.0\"]&&_()}catch(t){}const e=(t,...e)=>{let s=t;return e.length>0&&(s+=` :: ${JSON.stringify(e)}`),s};class s extends Error{constructor(t,s){super(e(t,s)),this.name=t,this.details=s}}try{self[\"workbox:routing:7.0.0\"]&&_()}catch(t){}const n=t=>t&&\"object\"==typeof t?t:{handle:t};class r{constructor(t,e,s=\"GET\"){this.handler=n(e),this.match=t,this.method=s}setCatchHandler(t){this.catchHandler=n(t)}}class i extends r{constructor(t,e,s){super(({url:e})=>{const s=t.exec(e.href);if(s&&(e.origin===location.origin||0===s.index))return s.slice(1)},e,s)}}class a{constructor(){this.t=new Map,this.i=new Map}get routes(){return this.t}addFetchListener(){self.addEventListener(\"fetch\",t=>{const{request:e}=t,s=this.handleRequest({request:e,event:t});s&&t.respondWith(s)})}addCacheListener(){self.addEventListener(\"message\",t=>{if(t.data&&\"CACHE_URLS\"===t.data.type){const{payload:e}=t.data,s=Promise.all(e.urlsToCache.map(e=>{\"string\"==typeof e&&(e=[e]);const s=new Request(...e);return this.handleRequest({request:s,event:t})}));t.waitUntil(s),t.ports&&t.ports[0]&&s.then(()=>t.ports[0].postMessage(!0))}})}handleRequest({request:t,event:e}){const s=new URL(t.url,location.href);if(!s.protocol.startsWith(\"http\"))return;const n=s.origin===location.origin,{params:r,route:i}=this.findMatchingRoute({event:e,request:t,sameOrigin:n,url:s});let a=i&&i.handler;const o=t.method;if(!a&&this.i.has(o)&&(a=this.i.get(o)),!a)return;let c;try{c=a.handle({url:s,request:t,event:e,params:r})}catch(t){c=Promise.reject(t)}const h=i&&i.catchHandler;return c instanceof Promise&&(this.o||h)&&(c=c.catch(async n=>{if(h)try{return await h.handle({url:s,request:t,event:e,params:r})}catch(t){t instanceof Error&&(n=t)}if(this.o)return this.o.handle({url:s,request:t,event:e});throw n})),c}findMatchingRoute({url:t,sameOrigin:e,request:s,event:n}){const r=this.t.get(s.method)||[];for(const i of r){let r;const a=i.match({url:t,sameOrigin:e,request:s,event:n});if(a)return r=a,(Array.isArray(r)&&0===r.length||a.constructor===Object&&0===Object.keys(a).length||\"boolean\"==typeof a)&&(r=void 0),{route:i,params:r}}return{}}setDefaultHandler(t,e=\"GET\"){this.i.set(e,n(t))}setCatchHandler(t){this.o=n(t)}registerRoute(t){this.t.has(t.method)||this.t.set(t.method,[]),this.t.get(t.method).push(t)}unregisterRoute(t){if(!this.t.has(t.method))throw new s(\"unregister-route-but-not-found-with-method\",{method:t.method});const e=this.t.get(t.method).indexOf(t);if(!(e>-1))throw new s(\"unregister-route-route-not-registered\");this.t.get(t.method).splice(e,1)}}let o;const c=()=>(o||(o=new a,o.addFetchListener(),o.addCacheListener()),o);function h(t,e,n){let a;if(\"string\"==typeof t){const s=new URL(t,location.href);a=new r(({url:t})=>t.href===s.href,e,n)}else if(t instanceof RegExp)a=new i(t,e,n);else if(\"function\"==typeof t)a=new r(t,e,n);else{if(!(t instanceof r))throw new s(\"unsupported-route-type\",{moduleName:\"workbox-routing\",funcName:\"registerRoute\",paramName:\"capture\"});a=t}return c().registerRoute(a),a}try{self[\"workbox:strategies:7.0.0\"]&&_()}catch(t){}const u={cacheWillUpdate:async({response:t})=>200===t.status||0===t.status?t:null},l={googleAnalytics:\"googleAnalytics\",precache:\"precache-v2\",prefix:\"workbox\",runtime:\"runtime\",suffix:\"undefined\"!=typeof registration?registration.scope:\"\"},f=t=>[l.prefix,t,l.suffix].filter(t=>t&&t.length>0).join(\"-\"),w=t=>t||f(l.precache),d=t=>t||f(l.runtime);function p(t,e){const s=new URL(t);for(const t of e)s.searchParams.delete(t);return s.href}class y{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}const g=new Set;function m(t){return\"string\"==typeof t?new Request(t):t}class v{constructor(t,e){this.h={},Object.assign(this,e),this.event=e.event,this.u=t,this.l=new y,this.p=[],this.m=[...t.plugins],this.v=new Map;for(const t of this.m)this.v.set(t,{});this.event.waitUntil(this.l.promise)}async fetch(t){const{event:e}=this;let n=m(t);if(\"navigate\"===n.mode&&e instanceof FetchEvent&&e.preloadResponse){const t=await e.preloadResponse;if(t)return t}const r=this.hasCallback(\"fetchDidFail\")?n.clone():null;try{for(const t of this.iterateCallbacks(\"requestWillFetch\"))n=await t({request:n.clone(),event:e})}catch(t){if(t instanceof Error)throw new s(\"plugin-error-request-will-fetch\",{thrownErrorMessage:t.message})}const i=n.clone();try{let t;t=await fetch(n,\"navigate\"===n.mode?void 0:this.u.fetchOptions);for(const s of this.iterateCallbacks(\"fetchDidSucceed\"))t=await s({event:e,request:i,response:t});return t}catch(t){throw r&&await this.runCallbacks(\"fetchDidFail\",{error:t,event:e,originalRequest:r.clone(),request:i.clone()}),t}}async fetchAndCachePut(t){const e=await this.fetch(t),s=e.clone();return this.waitUntil(this.cachePut(t,s)),e}async cacheMatch(t){const e=m(t);let s;const{cacheName:n,matchOptions:r}=this.u,i=await this.getCacheKey(e,\"read\"),a=Object.assign(Object.assign({},r),{cacheName:n});s=await caches.match(i,a);for(const t of this.iterateCallbacks(\"cachedResponseWillBeUsed\"))s=await t({cacheName:n,matchOptions:r,cachedResponse:s,request:i,event:this.event})||void 0;return s}async cachePut(t,e){const n=m(t);var r;await(r=0,new Promise(t=>setTimeout(t,r)));const i=await this.getCacheKey(n,\"write\");if(!e)throw new s(\"cache-put-with-no-response\",{url:(a=i.url,new URL(String(a),location.href).href.replace(new RegExp(`^${location.origin}`),\"\"))});var a;const o=await this.R(e);if(!o)return!1;const{cacheName:c,matchOptions:h}=this.u,u=await self.caches.open(c),l=this.hasCallback(\"cacheDidUpdate\"),f=l?await async function(t,e,s,n){const r=p(e.url,s);if(e.url===r)return t.match(e,n);const i=Object.assign(Object.assign({},n),{ignoreSearch:!0}),a=await t.keys(e,i);for(const e of a)if(r===p(e.url,s))return t.match(e,n)}(u,i.clone(),[\"__WB_REVISION__\"],h):null;try{await u.put(i,l?o.clone():o)}catch(t){if(t instanceof Error)throw\"QuotaExceededError\"===t.name&&await async function(){for(const t of g)await t()}(),t}for(const t of this.iterateCallbacks(\"cacheDidUpdate\"))await t({cacheName:c,oldResponse:f,newResponse:o.clone(),request:i,event:this.event});return!0}async getCacheKey(t,e){const s=`${t.url} | ${e}`;if(!this.h[s]){let n=t;for(const t of this.iterateCallbacks(\"cacheKeyWillBeUsed\"))n=m(await t({mode:e,request:n,event:this.event,params:this.params}));this.h[s]=n}return this.h[s]}hasCallback(t){for(const e of this.u.plugins)if(t in e)return!0;return!1}async runCallbacks(t,e){for(const s of this.iterateCallbacks(t))await s(e)}*iterateCallbacks(t){for(const e of this.u.plugins)if(\"function\"==typeof e[t]){const s=this.v.get(e),n=n=>{const r=Object.assign(Object.assign({},n),{state:s});return e[t](r)};yield n}}waitUntil(t){return this.p.push(t),t}async doneWaiting(){let t;for(;t=this.p.shift();)await t}destroy(){this.l.resolve(null)}async R(t){let e=t,s=!1;for(const t of this.iterateCallbacks(\"cacheWillUpdate\"))if(e=await t({request:this.request,response:e,event:this.event})||void 0,s=!0,!e)break;return s||e&&200!==e.status&&(e=void 0),e}}class R{constructor(t={}){this.cacheName=d(t.cacheName),this.plugins=t.plugins||[],this.fetchOptions=t.fetchOptions,this.matchOptions=t.matchOptions}handle(t){const[e]=this.handleAll(t);return e}handleAll(t){t instanceof FetchEvent&&(t={event:t,request:t.request});const e=t.event,s=\"string\"==typeof t.request?new Request(t.request):t.request,n=\"params\"in t?t.params:void 0,r=new v(this,{event:e,request:s,params:n}),i=this.q(r,s,e);return[i,this.D(i,r,s,e)]}async q(t,e,n){let r;await t.runCallbacks(\"handlerWillStart\",{event:n,request:e});try{if(r=await this.U(e,t),!r||\"error\"===r.type)throw new s(\"no-response\",{url:e.url})}catch(s){if(s instanceof Error)for(const i of t.iterateCallbacks(\"handlerDidError\"))if(r=await i({error:s,event:n,request:e}),r)break;if(!r)throw s}for(const s of t.iterateCallbacks(\"handlerWillRespond\"))r=await s({event:n,request:e,response:r});return r}async D(t,e,s,n){let r,i;try{r=await t}catch(i){}try{await e.runCallbacks(\"handlerDidRespond\",{event:n,request:s,response:r}),await e.doneWaiting()}catch(t){t instanceof Error&&(i=t)}if(await e.runCallbacks(\"handlerDidComplete\",{event:n,request:s,response:r,error:i}),e.destroy(),i)throw i}}function b(t){t.then(()=>{})}function q(){return q=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)({}).hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},q.apply(null,arguments)}let D,U;const x=new WeakMap,L=new WeakMap,I=new WeakMap,C=new WeakMap,E=new WeakMap;let N={get(t,e,s){if(t instanceof IDBTransaction){if(\"done\"===e)return L.get(t);if(\"objectStoreNames\"===e)return t.objectStoreNames||I.get(t);if(\"store\"===e)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return k(t[e])},set:(t,e,s)=>(t[e]=s,!0),has:(t,e)=>t instanceof IDBTransaction&&(\"done\"===e||\"store\"===e)||e in t};function O(t){return t!==IDBDatabase.prototype.transaction||\"objectStoreNames\"in IDBTransaction.prototype?(U||(U=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(B(this),e),k(x.get(this))}:function(...e){return k(t.apply(B(this),e))}:function(e,...s){const n=t.call(B(this),e,...s);return I.set(n,e.sort?e.sort():[e]),k(n)}}function T(t){return\"function\"==typeof t?O(t):(t instanceof IDBTransaction&&function(t){if(L.has(t))return;const e=new Promise((e,s)=>{const n=()=>{t.removeEventListener(\"complete\",r),t.removeEventListener(\"error\",i),t.removeEventListener(\"abort\",i)},r=()=>{e(),n()},i=()=>{s(t.error||new DOMException(\"AbortError\",\"AbortError\")),n()};t.addEventListener(\"complete\",r),t.addEventListener(\"error\",i),t.addEventListener(\"abort\",i)});L.set(t,e)}(t),e=t,(D||(D=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(t,N):t);var e}function k(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,s)=>{const n=()=>{t.removeEventListener(\"success\",r),t.removeEventListener(\"error\",i)},r=()=>{e(k(t.result)),n()},i=()=>{s(t.error),n()};t.addEventListener(\"success\",r),t.addEventListener(\"error\",i)});return e.then(e=>{e instanceof IDBCursor&&x.set(e,t)}).catch(()=>{}),E.set(e,t),e}(t);if(C.has(t))return C.get(t);const e=T(t);return e!==t&&(C.set(t,e),E.set(e,t)),e}const B=t=>E.get(t);const P=[\"get\",\"getKey\",\"getAll\",\"getAllKeys\",\"count\"],M=[\"put\",\"add\",\"delete\",\"clear\"],W=new Map;function j(t,e){if(!(t instanceof IDBDatabase)||e in t||\"string\"!=typeof e)return;if(W.get(e))return W.get(e);const s=e.replace(/FromIndex$/,\"\"),n=e!==s,r=M.includes(s);if(!(s in(n?IDBIndex:IDBObjectStore).prototype)||!r&&!P.includes(s))return;const i=async function(t,...e){const i=this.transaction(t,r?\"readwrite\":\"readonly\");let a=i.store;return n&&(a=a.index(e.shift())),(await Promise.all([a[s](...e),r&&i.done]))[0]};return W.set(e,i),i}N=(t=>q({},t,{get:(e,s,n)=>j(e,s)||t.get(e,s,n),has:(e,s)=>!!j(e,s)||t.has(e,s)}))(N);try{self[\"workbox:expiration:7.0.0\"]&&_()}catch(t){}const S=\"cache-entries\",K=t=>{const e=new URL(t,location.href);return e.hash=\"\",e.href};class A{constructor(t){this._=null,this.L=t}I(t){const e=t.createObjectStore(S,{keyPath:\"id\"});e.createIndex(\"cacheName\",\"cacheName\",{unique:!1}),e.createIndex(\"timestamp\",\"timestamp\",{unique:!1})}C(t){this.I(t),this.L&&function(t,{blocked:e}={}){const s=indexedDB.deleteDatabase(t);e&&s.addEventListener(\"blocked\",t=>e(t.oldVersion,t)),k(s).then(()=>{})}(this.L)}async setTimestamp(t,e){const s={url:t=K(t),timestamp:e,cacheName:this.L,id:this.N(t)},n=(await this.getDb()).transaction(S,\"readwrite\",{durability:\"relaxed\"});await n.store.put(s),await n.done}async getTimestamp(t){const e=await this.getDb(),s=await e.get(S,this.N(t));return null==s?void 0:s.timestamp}async expireEntries(t,e){const s=await this.getDb();let n=await s.transaction(S).store.index(\"timestamp\").openCursor(null,\"prev\");const r=[];let i=0;for(;n;){const s=n.value;s.cacheName===this.L&&(t&&s.timestamp<t||e&&i>=e?r.push(n.value):i++),n=await n.continue()}const a=[];for(const t of r)await s.delete(S,t.id),a.push(t.url);return a}N(t){return this.L+\"|\"+K(t)}async getDb(){return this._||(this._=await function(t,e,{blocked:s,upgrade:n,blocking:r,terminated:i}={}){const a=indexedDB.open(t,e),o=k(a);return n&&a.addEventListener(\"upgradeneeded\",t=>{n(k(a.result),t.oldVersion,t.newVersion,k(a.transaction),t)}),s&&a.addEventListener(\"blocked\",t=>s(t.oldVersion,t.newVersion,t)),o.then(t=>{i&&t.addEventListener(\"close\",()=>i()),r&&t.addEventListener(\"versionchange\",t=>r(t.oldVersion,t.newVersion,t))}).catch(()=>{}),o}(\"workbox-expiration\",1,{upgrade:this.C.bind(this)})),this._}}class F{constructor(t,e={}){this.O=!1,this.T=!1,this.k=e.maxEntries,this.B=e.maxAgeSeconds,this.P=e.matchOptions,this.L=t,this.M=new A(t)}async expireEntries(){if(this.O)return void(this.T=!0);this.O=!0;const t=this.B?Date.now()-1e3*this.B:0,e=await this.M.expireEntries(t,this.k),s=await self.caches.open(this.L);for(const t of e)await s.delete(t,this.P);this.O=!1,this.T&&(this.T=!1,b(this.expireEntries()))}async updateTimestamp(t){await this.M.setTimestamp(t,Date.now())}async isURLExpired(t){if(this.B){const e=await this.M.getTimestamp(t),s=Date.now()-1e3*this.B;return void 0===e||e<s}return!1}async delete(){this.T=!1,await this.M.expireEntries(1/0)}}try{self[\"workbox:range-requests:7.0.0\"]&&_()}catch(t){}async function H(t,e){try{if(206===e.status)return e;const n=t.headers.get(\"range\");if(!n)throw new s(\"no-range-header\");const r=function(t){const e=t.trim().toLowerCase();if(!e.startsWith(\"bytes=\"))throw new s(\"unit-must-be-bytes\",{normalizedRangeHeader:e});if(e.includes(\",\"))throw new s(\"single-range-only\",{normalizedRangeHeader:e});const n=/(\\d*)-(\\d*)/.exec(e);if(!n||!n[1]&&!n[2])throw new s(\"invalid-range-values\",{normalizedRangeHeader:e});return{start:\"\"===n[1]?void 0:Number(n[1]),end:\"\"===n[2]?void 0:Number(n[2])}}(n),i=await e.blob(),a=function(t,e,n){const r=t.size;if(n&&n>r||e&&e<0)throw new s(\"range-not-satisfiable\",{size:r,end:n,start:e});let i,a;return void 0!==e&&void 0!==n?(i=e,a=n+1):void 0!==e&&void 0===n?(i=e,a=r):void 0!==n&&void 0===e&&(i=r-n,a=r),{start:i,end:a}}(i,r.start,r.end),o=i.slice(a.start,a.end),c=o.size,h=new Response(o,{status:206,statusText:\"Partial Content\",headers:e.headers});return h.headers.set(\"Content-Length\",String(c)),h.headers.set(\"Content-Range\",`bytes ${a.start}-${a.end-1}/${i.size}`),h}catch(t){return new Response(\"\",{status:416,statusText:\"Range Not Satisfiable\"})}}function $(t,e){const s=e();return t.waitUntil(s),s}try{self[\"workbox:precaching:7.0.0\"]&&_()}catch(t){}function z(t){if(!t)throw new s(\"add-to-cache-list-unexpected-type\",{entry:t});if(\"string\"==typeof t){const e=new URL(t,location.href);return{cacheKey:e.href,url:e.href}}const{revision:e,url:n}=t;if(!n)throw new s(\"add-to-cache-list-unexpected-type\",{entry:t});if(!e){const t=new URL(n,location.href);return{cacheKey:t.href,url:t.href}}const r=new URL(n,location.href),i=new URL(n,location.href);return r.searchParams.set(\"__WB_REVISION__\",e),{cacheKey:r.href,url:i.href}}class G{constructor(){this.updatedURLs=[],this.notUpdatedURLs=[],this.handlerWillStart=async({request:t,state:e})=>{e&&(e.originalRequest=t)},this.cachedResponseWillBeUsed=async({event:t,state:e,cachedResponse:s})=>{if(\"install\"===t.type&&e&&e.originalRequest&&e.originalRequest instanceof Request){const t=e.originalRequest.url;s?this.notUpdatedURLs.push(t):this.updatedURLs.push(t)}return s}}}class V{constructor({precacheController:t}){this.cacheKeyWillBeUsed=async({request:t,params:e})=>{const s=(null==e?void 0:e.cacheKey)||this.W.getCacheKeyForURL(t.url);return s?new Request(s,{headers:t.headers}):t},this.W=t}}let J,Q;async function X(t,e){let n=null;if(t.url){n=new URL(t.url).origin}if(n!==self.location.origin)throw new s(\"cross-origin-copy-response\",{origin:n});const r=t.clone(),i={headers:new Headers(r.headers),status:r.status,statusText:r.statusText},a=e?e(i):i,o=function(){if(void 0===J){const t=new Response(\"\");if(\"body\"in t)try{new Response(t.body),J=!0}catch(t){J=!1}J=!1}return J}()?r.body:await r.blob();return new Response(o,a)}class Y extends R{constructor(t={}){t.cacheName=w(t.cacheName),super(t),this.j=!1!==t.fallbackToNetwork,this.plugins.push(Y.copyRedirectedCacheableResponsesPlugin)}async U(t,e){const s=await e.cacheMatch(t);return s||(e.event&&\"install\"===e.event.type?await this.S(t,e):await this.K(t,e))}async K(t,e){let n;const r=e.params||{};if(!this.j)throw new s(\"missing-precache-entry\",{cacheName:this.cacheName,url:t.url});{const s=r.integrity,i=t.integrity,a=!i||i===s;n=await e.fetch(new Request(t,{integrity:\"no-cors\"!==t.mode?i||s:void 0})),s&&a&&\"no-cors\"!==t.mode&&(this.A(),await e.cachePut(t,n.clone()))}return n}async S(t,e){this.A();const n=await e.fetch(t);if(!await e.cachePut(t,n.clone()))throw new s(\"bad-precaching-response\",{url:t.url,status:n.status});return n}A(){let t=null,e=0;for(const[s,n]of this.plugins.entries())n!==Y.copyRedirectedCacheableResponsesPlugin&&(n===Y.defaultPrecacheCacheabilityPlugin&&(t=s),n.cacheWillUpdate&&e++);0===e?this.plugins.push(Y.defaultPrecacheCacheabilityPlugin):e>1&&null!==t&&this.plugins.splice(t,1)}}Y.defaultPrecacheCacheabilityPlugin={cacheWillUpdate:async({response:t})=>!t||t.status>=400?null:t},Y.copyRedirectedCacheableResponsesPlugin={cacheWillUpdate:async({response:t})=>t.redirected?await X(t):t};class Z{constructor({cacheName:t,plugins:e=[],fallbackToNetwork:s=!0}={}){this.F=new Map,this.H=new Map,this.$=new Map,this.u=new Y({cacheName:w(t),plugins:[...e,new V({precacheController:this})],fallbackToNetwork:s}),this.install=this.install.bind(this),this.activate=this.activate.bind(this)}get strategy(){return this.u}precache(t){this.addToCacheList(t),this.G||(self.addEventListener(\"install\",this.install),self.addEventListener(\"activate\",this.activate),this.G=!0)}addToCacheList(t){const e=[];for(const n of t){\"string\"==typeof n?e.push(n):n&&void 0===n.revision&&e.push(n.url);const{cacheKey:t,url:r}=z(n),i=\"string\"!=typeof n&&n.revision?\"reload\":\"default\";if(this.F.has(r)&&this.F.get(r)!==t)throw new s(\"add-to-cache-list-conflicting-entries\",{firstEntry:this.F.get(r),secondEntry:t});if(\"string\"!=typeof n&&n.integrity){if(this.$.has(t)&&this.$.get(t)!==n.integrity)throw new s(\"add-to-cache-list-conflicting-integrities\",{url:r});this.$.set(t,n.integrity)}if(this.F.set(r,t),this.H.set(r,i),e.length>0){const t=`Workbox is precaching URLs without revision info: ${e.join(\", \")}\\nThis is generally NOT safe. Learn more at https://bit.ly/wb-precache`;console.warn(t)}}}install(t){return $(t,async()=>{const e=new G;this.strategy.plugins.push(e);for(const[e,s]of this.F){const n=this.$.get(s),r=this.H.get(e),i=new Request(e,{integrity:n,cache:r,credentials:\"same-origin\"});await Promise.all(this.strategy.handleAll({params:{cacheKey:s},request:i,event:t}))}const{updatedURLs:s,notUpdatedURLs:n}=e;return{updatedURLs:s,notUpdatedURLs:n}})}activate(t){return $(t,async()=>{const t=await self.caches.open(this.strategy.cacheName),e=await t.keys(),s=new Set(this.F.values()),n=[];for(const r of e)s.has(r.url)||(await t.delete(r),n.push(r.url));return{deletedURLs:n}})}getURLsToCacheKeys(){return this.F}getCachedURLs(){return[...this.F.keys()]}getCacheKeyForURL(t){const e=new URL(t,location.href);return this.F.get(e.href)}getIntegrityForCacheKey(t){return this.$.get(t)}async matchPrecache(t){const e=t instanceof Request?t.url:t,s=this.getCacheKeyForURL(e);if(s){return(await self.caches.open(this.strategy.cacheName)).match(s)}}createHandlerBoundToURL(t){const e=this.getCacheKeyForURL(t);if(!e)throw new s(\"non-precached-url\",{url:t});return s=>(s.request=new Request(t),s.params=Object.assign({cacheKey:e},s.params),this.strategy.handle(s))}}const tt=()=>(Q||(Q=new Z),Q);class et extends r{constructor(t,e){super(({request:s})=>{const n=t.getURLsToCacheKeys();for(const r of function*(t,{ignoreURLParametersMatching:e=[/^utm_/,/^fbclid$/],directoryIndex:s=\"index.html\",cleanURLs:n=!0,urlManipulation:r}={}){const i=new URL(t,location.href);i.hash=\"\",yield i.href;const a=function(t,e=[]){for(const s of[...t.searchParams.keys()])e.some(t=>t.test(s))&&t.searchParams.delete(s);return t}(i,e);if(yield a.href,s&&a.pathname.endsWith(\"/\")){const t=new URL(a.href);t.pathname+=s,yield t.href}if(n){const t=new URL(a.href);t.pathname+=\".html\",yield t.href}if(r){const t=r({url:i});for(const e of t)yield e.href}}(s.url,e)){const e=n.get(r);if(e){return{cacheKey:e,integrity:t.getIntegrityForCacheKey(e)}}}},t.strategy)}}t.CacheFirst=class extends R{async U(t,e){let n,r=await e.cacheMatch(t);if(!r)try{r=await e.fetchAndCachePut(t)}catch(t){t instanceof Error&&(n=t)}if(!r)throw new s(\"no-response\",{url:t.url,error:n});return r}},t.ExpirationPlugin=class{constructor(t={}){this.cachedResponseWillBeUsed=async({event:t,request:e,cacheName:s,cachedResponse:n})=>{if(!n)return null;const r=this.V(n),i=this.J(s);b(i.expireEntries());const a=i.updateTimestamp(e.url);if(t)try{t.waitUntil(a)}catch(t){}return r?n:null},this.cacheDidUpdate=async({cacheName:t,request:e})=>{const s=this.J(t);await s.updateTimestamp(e.url),await s.expireEntries()},this.X=t,this.B=t.maxAgeSeconds,this.Y=new Map,t.purgeOnQuotaError&&function(t){g.add(t)}(()=>this.deleteCacheAndMetadata())}J(t){if(t===d())throw new s(\"expire-custom-caches-only\");let e=this.Y.get(t);return e||(e=new F(t,this.X),this.Y.set(t,e)),e}V(t){if(!this.B)return!0;const e=this.Z(t);if(null===e)return!0;return e>=Date.now()-1e3*this.B}Z(t){if(!t.headers.has(\"date\"))return null;const e=t.headers.get(\"date\"),s=new Date(e).getTime();return isNaN(s)?null:s}async deleteCacheAndMetadata(){for(const[t,e]of this.Y)await self.caches.delete(t),await e.delete();this.Y=new Map}},t.NetworkFirst=class extends R{constructor(t={}){super(t),this.plugins.some(t=>\"cacheWillUpdate\"in t)||this.plugins.unshift(u),this.tt=t.networkTimeoutSeconds||0}async U(t,e){const n=[],r=[];let i;if(this.tt){const{id:s,promise:a}=this.et({request:t,logs:n,handler:e});i=s,r.push(a)}const a=this.st({timeoutId:i,request:t,logs:n,handler:e});r.push(a);const o=await e.waitUntil((async()=>await e.waitUntil(Promise.race(r))||await a)());if(!o)throw new s(\"no-response\",{url:t.url});return o}et({request:t,logs:e,handler:s}){let n;return{promise:new Promise(e=>{n=setTimeout(async()=>{e(await s.cacheMatch(t))},1e3*this.tt)}),id:n}}async st({timeoutId:t,request:e,logs:s,handler:n}){let r,i;try{i=await n.fetchAndCachePut(e)}catch(t){t instanceof Error&&(r=t)}return t&&clearTimeout(t),!r&&i||(i=await n.cacheMatch(e)),i}},t.RangeRequestsPlugin=class{constructor(){this.cachedResponseWillBeUsed=async({request:t,cachedResponse:e})=>e&&t.headers.has(\"range\")?await H(t,e):e}},t.StaleWhileRevalidate=class extends R{constructor(t={}){super(t),this.plugins.some(t=>\"cacheWillUpdate\"in t)||this.plugins.unshift(u)}async U(t,e){const n=e.fetchAndCachePut(t).catch(()=>{});e.waitUntil(n);let r,i=await e.cacheMatch(t);if(i);else try{i=await n}catch(t){t instanceof Error&&(r=t)}if(!i)throw new s(\"no-response\",{url:t.url,error:r});return i}},t.cleanupOutdatedCaches=function(){self.addEventListener(\"activate\",t=>{const e=w();t.waitUntil((async(t,e=\"-precache-\")=>{const s=(await self.caches.keys()).filter(s=>s.includes(e)&&s.includes(self.registration.scope)&&s!==t);return await Promise.all(s.map(t=>self.caches.delete(t))),s})(e).then(t=>{}))})},t.clientsClaim=function(){self.addEventListener(\"activate\",()=>self.clients.claim())},t.precacheAndRoute=function(t,e){!function(t){tt().precache(t)}(t),function(t){const e=tt();h(new et(e,t))}(e)},t.registerRoute=h});\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\scripts\\createProUser.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'admin' is assigned a value but never used.","line":4,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":12},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":4,"column":15,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":4,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'serviceAccount' is assigned a value but never used.","line":7,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":21},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":7,"column":24,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":7,"endColumn":50},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":11,"column":27,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":11,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'serverTimestamp' is assigned a value but never used.","line":12,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":51},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":12,"column":56,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":12,"endColumn":85}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Temporary script to create Pro user in Firestore\r\n// Run with: node scripts/createProUser.js\r\n\r\nconst admin = require('firebase-admin');\r\n\r\n// Initialize Firebase Admin (uses your project's credentials)\r\nconst serviceAccount = require('../lib/firebase'); // Will use your existing config\r\n\r\n// For Admin SDK, we need server-side initialization\r\n// Since you're using client SDK, we'll use a workaround\r\nconst { initializeApp } = require('firebase/app');\r\nconst { getFirestore, doc, setDoc, serverTimestamp } = require('firebase/firestore');\r\n\r\n// Your Firebase config from .env.local\r\nconst firebaseConfig = {\r\n    apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\r\n    authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\r\n    projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\r\n    storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\r\n    messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\r\n    appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\r\n};\r\n\r\n// Initialize Firebase\r\nconst app = initializeApp(firebaseConfig);\r\nconst db = getFirestore(app);\r\n\r\nasync function createProUser() {\r\n    const userId = 'ORJ9FSZnKgg6cQpoUiAxzbiEIVc2';\r\n\r\n    const userData = {\r\n        email: 'test@test.com',\r\n        displayName: 'Test User',\r\n        photoURL: null,\r\n        subscription: {\r\n            tier: 'pro',\r\n            startDate: new Date(),\r\n            endDate: null,\r\n            autoRenew: true,\r\n        },\r\n        dietaryPreferences: {\r\n            isKeto: false,\r\n            isVegan: false,\r\n            isDiabetic: false,\r\n            lowSodium: false,\r\n            glutenFree: false,\r\n        },\r\n        createdAt: new Date(),\r\n    };\r\n\r\n    try {\r\n        await setDoc(doc(db, 'users', userId), userData);\r\n        console.log('Γ£à Pro user created successfully!');\r\n        console.log('User ID:', userId);\r\n        console.log('Email:', userData.email);\r\n        console.log('Tier:', userData.subscription.tier);\r\n        console.log('\\n≡ƒÄë Refresh your app to see Pro features!');\r\n        process.exit(0);\r\n    } catch (error) {\r\n        console.error('Γ¥î Error creating user:', error);\r\n        process.exit(1);\r\n    }\r\n}\r\n\r\ncreateProUser();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\scripts\\createProUser.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\scripts\\setAdminRole.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\scripts\\testGrading.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[365,368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[365,368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { calculateSmartGrade } from '../services/gradingService';\r\nimport { DietaryPreferences } from '../types/user';\r\n\r\n// Mock ProductData locally to avoid importing 'use server' files\r\ninterface ProductData {\r\n    id: string;\r\n    name: string;\r\n    brand: string;\r\n    image: string;\r\n    ingredients: string[];\r\n    nutrition_grades: string;\r\n    nutriments: any;\r\n    description: string;\r\n    categories?: string[];\r\n}\r\n\r\n// Mock Data\r\nconst mockProduct: ProductData = {\r\n    id: '123',\r\n    name: 'Test Cookie',\r\n    brand: 'TestBrand',\r\n    image: '',\r\n    ingredients: ['Enriched Flour', 'Sugar', 'Palm Oil', 'Peanuts', 'Milk'],\r\n    nutrition_grades: 'D',\r\n    nutriments: { sugars_100g: 40, proteins_100g: 2 },\r\n    description: 'A test cookie',\r\n    categories: ['Snacks']\r\n};\r\n\r\nconst mockPreferences: DietaryPreferences = {\r\n    isKeto: false,\r\n    isVegan: false,\r\n    isDiabetic: false,\r\n    lowSodium: false,\r\n    glutenFree: false,\r\n    isHalal: false,\r\n    allergens: ['Peanuts'],\r\n    avoidIngredients: ['Palm Oil'],\r\n    healthGoals: ['High Protein']\r\n};\r\n\r\nasync function runTest() {\r\n    console.log('--- Starting Smart Grading Test ---');\r\n    console.log('Product:', mockProduct.name);\r\n    console.log('Ingredients:', mockProduct.ingredients);\r\n    console.log('Base Grade:', mockProduct.nutrition_grades);\r\n    console.log('\\nPreferences:', {\r\n        allergens: mockPreferences.allergens,\r\n        avoid: mockPreferences.avoidIngredients\r\n    });\r\n\r\n    const result = calculateSmartGrade(mockProduct, mockPreferences);\r\n\r\n    console.log('\\n--- Result ---');\r\n    console.log('New Grade:', result.grade);\r\n    console.log('Score:', result.score);\r\n    console.log('Warnings:', result.warnings);\r\n    console.log('Reasons:', result.reasons);\r\n\r\n    // Assertions\r\n    let passed = true;\r\n    if (result.grade !== 'F') {\r\n        console.error('FAIL: Grade should be F due to Allergen (Peanuts)');\r\n        passed = false;\r\n    }\r\n    if (!result.warnings.some(w => w.includes('Allergen'))) {\r\n        console.error('FAIL: Missing allergen warning');\r\n        passed = false;\r\n    }\r\n    if (!result.warnings.some(w => w.includes('avoided ingredient'))) {\r\n        console.error('FAIL: Missing avoid ingredient warning (Palm Oil)');\r\n        passed = false;\r\n    }\r\n\r\n    if (passed) {\r\n        console.log('\\nΓ£à TEST PASSED');\r\n    } else {\r\n        console.log('\\nΓ¥î TEST FAILED');\r\n    }\r\n}\r\n\r\nrunTest();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\accessRequestService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'increment' is defined but never used.","line":4,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'addDoc' is defined but never used.","line":4,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":49}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from '@/lib/firebase';\r\nimport {\r\n    collection, doc, getDoc, getDocs, setDoc, updateDoc, query,\r\n    where, orderBy, Timestamp, increment, addDoc\r\n} from 'firebase/firestore';\r\nimport { AccessCode, FreeAccessRequest, UserNotification, AccessCodeTier } from '@/types/accessRequest';\r\n\r\nconst ACCESS_CODES_COLLECTION = 'accessCodes';\r\nconst ACCESS_REQUESTS_COLLECTION = 'freeAccessRequests';\r\nconst NOTIFICATIONS_COLLECTION = 'notifications';\r\nconst USERS_COLLECTION = 'users';\r\n\r\n// ==================== ACCESS CODES ====================\r\n\r\n// ==================== ACCESS CODES (Client API Wrapper) ====================\r\n\r\n/**\r\n * Validate an access code (Secure Server API)\r\n */\r\nexport const validateAccessCode = async (code: string): Promise<{ valid: boolean; codeData?: AccessCode; error?: string }> => {\r\n    try {\r\n        const response = await fetch('/api/access/validate', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ code })\r\n        });\r\n\r\n        const data = await response.json();\r\n        return data;\r\n    } catch (error) {\r\n        console.error('[AccessRequest] API Error:', error);\r\n        return { valid: false, error: 'Network error validating code' };\r\n    }\r\n};\r\n\r\n/**\r\n * Create a new access code (Admin only)\r\n */\r\nexport const createAccessCode = async (\r\n    code: string,\r\n    tier: AccessCodeTier,\r\n    type: 'student' | 'general',\r\n    usageLimit: number,\r\n    expiresAt: Date | null,\r\n    adminId: string\r\n): Promise<string> => {\r\n    const codeRef = doc(collection(db, ACCESS_CODES_COLLECTION));\r\n    await setDoc(codeRef, {\r\n        code: code.toUpperCase(),\r\n        tier,\r\n        type,\r\n        usageLimit,\r\n        usedCount: 0,\r\n        expiresAt: expiresAt ? Timestamp.fromDate(expiresAt) : null,\r\n        createdBy: adminId,\r\n        createdAt: Timestamp.now(),\r\n        active: true\r\n    });\r\n    return codeRef.id;\r\n};\r\n\r\n/**\r\n * Get all access codes (Admin)\r\n */\r\nexport const getAllAccessCodes = async (): Promise<AccessCode[]> => {\r\n    const codesRef = collection(db, ACCESS_CODES_COLLECTION);\r\n    const q = query(codesRef, orderBy('createdAt', 'desc'));\r\n    const snapshot = await getDocs(q);\r\n    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as AccessCode));\r\n};\r\n\r\n/**\r\n * Toggle access code active status\r\n */\r\nexport const toggleAccessCodeStatus = async (codeId: string, active: boolean): Promise<void> => {\r\n    await updateDoc(doc(db, ACCESS_CODES_COLLECTION, codeId), { active });\r\n};\r\n\r\n// ==================== ACCESS REQUESTS (Client API Wrapper) ====================\r\n\r\n/**\r\n * Submit a free access request (Secure Server API)\r\n */\r\nexport const submitAccessRequest = async (\r\n    userId: string,\r\n    data: {\r\n        fullName: string;\r\n        username: string;\r\n        email: string;\r\n        useAccountEmail: boolean;\r\n        phone: string;\r\n        reason: string;\r\n        code: string;\r\n        isStudent: boolean;\r\n        studentProofUrl: string | null;\r\n    }\r\n): Promise<{ success: boolean; requestId?: string; autoApproved?: boolean; error?: string }> => {\r\n    try {\r\n        // Get current auth token\r\n        const { getAuth } = await import('firebase/auth');\r\n        const auth = getAuth();\r\n        const token = await auth.currentUser?.getIdToken();\r\n\r\n        if (!token) throw new Error('Not authenticated');\r\n\r\n        const response = await fetch('/api/access/submit', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token}`\r\n            },\r\n            body: JSON.stringify(data)\r\n        });\r\n\r\n        const result = await response.json();\r\n        if (!response.ok || !result.success) {\r\n            return { success: false, error: result.error || 'Submission failed' };\r\n        }\r\n\r\n        return result;\r\n    } catch (error) {\r\n        console.error('[AccessRequest] Submit API Error:', error);\r\n        return { success: false, error: 'Failed to submit request' };\r\n    }\r\n};\r\n\r\n/**\r\n * Get all pending requests (Admin)\r\n */\r\nexport const getPendingRequests = async (): Promise<FreeAccessRequest[]> => {\r\n    const reqRef = collection(db, ACCESS_REQUESTS_COLLECTION);\r\n    const q = query(reqRef, where('status', '==', 'pending'), orderBy('createdAt', 'desc'));\r\n    const snapshot = await getDocs(q);\r\n    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as FreeAccessRequest));\r\n};\r\n\r\n/**\r\n * Get all requests (Admin)\r\n */\r\nexport const getAllRequests = async (): Promise<FreeAccessRequest[]> => {\r\n    const reqRef = collection(db, ACCESS_REQUESTS_COLLECTION);\r\n    const q = query(reqRef, orderBy('createdAt', 'desc'));\r\n    const snapshot = await getDocs(q);\r\n    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as FreeAccessRequest));\r\n};\r\n\r\n/**\r\n * Approve a request (Admin)\r\n */\r\nexport const approveRequest = async (requestId: string, adminId: string): Promise<boolean> => {\r\n    try {\r\n        const requestRef = doc(db, ACCESS_REQUESTS_COLLECTION, requestId);\r\n        const requestSnap = await getDoc(requestRef);\r\n\r\n        if (!requestSnap.exists()) return false;\r\n\r\n        const request = requestSnap.data() as FreeAccessRequest;\r\n\r\n        // Calculate expiry (3 months from now)\r\n        const expiresAt = new Date();\r\n        expiresAt.setMonth(expiresAt.getMonth() + 3);\r\n\r\n        await updateDoc(requestRef, {\r\n            status: 'approved',\r\n            processedAt: Timestamp.now(),\r\n            processedBy: adminId,\r\n            accessExpiresAt: Timestamp.fromDate(expiresAt)\r\n        });\r\n\r\n        // Upgrade user tier\r\n        await upgradeTier(request.userId, request.codeTier, expiresAt);\r\n\r\n        // Notify user\r\n        await createNotification(request.userId, 'access_approved',\r\n            '≡ƒÄë Free Access Approved!',\r\n            `Your request for free access has been approved! You now have ${request.codeTier.toUpperCase()} access for 3 months.`,\r\n            { requestId, tier: request.codeTier, expiresAt }\r\n        );\r\n\r\n        return true;\r\n    } catch (error) {\r\n        console.error('[AccessRequest] Error approving request:', error);\r\n        return false;\r\n    }\r\n};\r\n\r\n/**\r\n * Deny a request (Admin)\r\n */\r\nexport const denyRequest = async (requestId: string, adminId: string, reason: string): Promise<boolean> => {\r\n    try {\r\n        const requestRef = doc(db, ACCESS_REQUESTS_COLLECTION, requestId);\r\n        const requestSnap = await getDoc(requestRef);\r\n\r\n        if (!requestSnap.exists()) return false;\r\n\r\n        const request = requestSnap.data() as FreeAccessRequest;\r\n\r\n        await updateDoc(requestRef, {\r\n            status: 'denied',\r\n            denialReason: reason,\r\n            processedAt: Timestamp.now(),\r\n            processedBy: adminId\r\n        });\r\n\r\n        // Notify user with reason\r\n        await createNotification(request.userId, 'access_denied',\r\n            'Γ¥î Free Access Request Denied',\r\n            `Your request for free access was not approved. Reason: ${reason}`,\r\n            { requestId }\r\n        );\r\n\r\n        return true;\r\n    } catch (error) {\r\n        console.error('[AccessRequest] Error denying request:', error);\r\n        return false;\r\n    }\r\n};\r\n\r\n// ==================== USER TIER MANAGEMENT ====================\r\n\r\n/**\r\n * Upgrade user to a tier with expiry\r\n */\r\nconst upgradeTier = async (userId: string, tier: AccessCodeTier, expiresAt: Date): Promise<void> => {\r\n    const userRef = doc(db, USERS_COLLECTION, userId);\r\n    const userSnap = await getDoc(userRef);\r\n\r\n    // Store original tier for revert later\r\n    const originalTier = userSnap.exists() ? (userSnap.data()?.subscription?.tier || 'free') : 'free';\r\n\r\n    await updateDoc(userRef, {\r\n        'subscription.tier': tier,\r\n        'subscription.freeAccessGranted': true,\r\n        'subscription.freeAccessExpiresAt': Timestamp.fromDate(expiresAt),\r\n        'subscription.originalTier': originalTier\r\n    });\r\n};\r\n\r\n// ==================== NOTIFICATIONS ====================\r\n\r\n/**\r\n * Create a notification for user\r\n */\r\nexport const createNotification = async (\r\n    userId: string,\r\n    type: UserNotification['type'],\r\n    title: string,\r\n    message: string,\r\n    metadata?: UserNotification['metadata']\r\n): Promise<void> => {\r\n    const notifRef = doc(collection(db, USERS_COLLECTION, userId, NOTIFICATIONS_COLLECTION));\r\n    await setDoc(notifRef, {\r\n        type,\r\n        title,\r\n        message,\r\n        read: false,\r\n        createdAt: Timestamp.now(),\r\n        metadata: metadata || null\r\n    });\r\n};\r\n\r\n/**\r\n * Get user notifications\r\n */\r\nexport const getUserNotifications = async (userId: string): Promise<UserNotification[]> => {\r\n    const notifRef = collection(db, USERS_COLLECTION, userId, NOTIFICATIONS_COLLECTION);\r\n    const q = query(notifRef, orderBy('createdAt', 'desc'));\r\n    const snapshot = await getDocs(q);\r\n    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as UserNotification));\r\n};\r\n\r\n/**\r\n * Mark notification as read\r\n */\r\nexport const markNotificationRead = async (userId: string, notificationId: string): Promise<void> => {\r\n    await updateDoc(doc(db, USERS_COLLECTION, userId, NOTIFICATIONS_COLLECTION, notificationId), {\r\n        read: true\r\n    });\r\n};\r\n\r\n/**\r\n * Get user's access request history\r\n */\r\nexport const getUserAccessRequests = async (userId: string): Promise<FreeAccessRequest[]> => {\r\n    const reqRef = collection(db, ACCESS_REQUESTS_COLLECTION);\r\n    const q = query(reqRef, where('userId', '==', userId), orderBy('createdAt', 'desc'));\r\n    const snapshot = await getDocs(q);\r\n    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as FreeAccessRequest));\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\adminService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[370,373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[370,373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[391,394],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[391,394],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":127,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4182,4185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4182,4185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from '@/lib/firebase';\r\nimport { collection, doc, setDoc, updateDoc, getDocs, getDoc, serverTimestamp, query, orderBy, Timestamp } from 'firebase/firestore';\r\n\r\nconst TOKENS_COLLECTION = 'admin_setup_tokens';\r\n\r\nexport interface AdminInvite {\r\n    token: string;\r\n    email: string;\r\n    status: 'pending' | 'used' | 'expired' | 'revoked';\r\n    createdAt: any;\r\n    expiresAt: any;\r\n}\r\n\r\n/**\r\n * Generate a new random admin setup token linked to an email\r\n */\r\nimport * as OTPAuth from 'otpauth';\r\n\r\n/**\r\n * Generate a new random admin setup token linked to an email.\r\n * Includes a TOTP Secret for 2FA.\r\n */\r\nexport const generateAdminToken = async (email: string): Promise<{ token: string; secret: string; otpAuthUrl: string }> => {\r\n    try {\r\n        const token = Math.random().toString(36).substring(2, 10).toUpperCase(); // 8 chars (ID)\r\n\r\n        // Generate TOTP Secret (Base32)\r\n        const secret = new OTPAuth.Secret({ size: 20 });\r\n        const secretStr = secret.base32;\r\n\r\n        const totp = new OTPAuth.TOTP({\r\n            issuer: 'TruthLens',\r\n            label: `Admin Recovery (${email})`,\r\n            algorithm: 'SHA1',\r\n            digits: 6,\r\n            period: 30,\r\n            secret: secret\r\n        });\r\n\r\n        const otpAuthUrl = totp.toString(); // otpauth://totp/... URL for QR Code\r\n\r\n        const now = new Date();\r\n        const expiresAt = new Date(now.getTime() + 24 * 60 * 60 * 1000); // 24 hours\r\n\r\n        await setDoc(doc(db, TOKENS_COLLECTION, token), {\r\n            token,\r\n            email: email.toLowerCase(),\r\n            secret: secretStr, // Store secret\r\n            status: 'pending',\r\n            createdAt: serverTimestamp(),\r\n            expiresAt: Timestamp.fromDate(expiresAt),\r\n        });\r\n\r\n        return { token, secret: secretStr, otpAuthUrl };\r\n    } catch (error) {\r\n        console.error('Error generating admin token:', error);\r\n        throw error;\r\n    }\r\n};\r\n\r\n/**\r\n * Revoke a specific token\r\n */\r\nexport const revokeAdminToken = async (token: string): Promise<void> => {\r\n    try {\r\n        await updateDoc(doc(db, TOKENS_COLLECTION, token), {\r\n            status: 'revoked'\r\n        });\r\n    } catch (error) {\r\n        console.error('Error revoking admin token:', error);\r\n        throw error;\r\n    }\r\n};\r\n\r\n/**\r\n * Get all admin invite tokens (history)\r\n */\r\nexport const getAdminInvites = async (): Promise<AdminInvite[]> => {\r\n    try {\r\n        const q = query(collection(db, TOKENS_COLLECTION), orderBy('createdAt', 'desc'));\r\n        const snap = await getDocs(q);\r\n        return snap.docs.map(doc => ({\r\n            token: doc.id,\r\n            ...doc.data()\r\n        } as AdminInvite));\r\n    } catch (error) {\r\n        console.error('Error fetching admin invites:', error);\r\n        return [];\r\n    }\r\n};\r\n\r\n/**\r\n * Validate and use an admin token\r\n */\r\nexport const validateAndUseAdminToken = async (token: string, userEmail: string): Promise<{ valid: boolean; error?: string }> => {\r\n    try {\r\n        const docRef = doc(db, TOKENS_COLLECTION, token);\r\n        const docSnap = await getDoc(docRef);\r\n\r\n        if (!docSnap.exists()) {\r\n            return { valid: false, error: 'Invalid token.' };\r\n        }\r\n\r\n        const data = docSnap.data() as AdminInvite;\r\n        const now = new Date();\r\n\r\n        if (data.status !== 'pending') {\r\n            return { valid: false, error: `Token is ${data.status}.` };\r\n        }\r\n\r\n        if (data.email.toLowerCase() !== userEmail.toLowerCase()) {\r\n            return { valid: false, error: 'This invite is not for this email address.' };\r\n        }\r\n\r\n        // Check expiry (convert Firestore Timestamp to Date if needed)\r\n        const expiresAt = data.expiresAt instanceof Timestamp ? data.expiresAt.toDate() : new Date(data.expiresAt);\r\n        if (now > expiresAt) {\r\n            // Auto-expire if found expired during validation\r\n            await updateDoc(docRef, { status: 'expired' });\r\n            return { valid: false, error: 'Token has expired.' };\r\n        }\r\n\r\n        // Token is valid, mark as used\r\n        await updateDoc(docRef, { status: 'used' });\r\n        return { valid: true };\r\n\r\n    } catch (error: any) {\r\n        console.error('Error validating token:', error);\r\n        return { valid: false, error: error.message };\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\aiChatService.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":148,"column":9,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":148,"endColumn":22,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[4664,4677],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"prefer-const","severity":2,"message":"'targetModel' is never reassigned. Use 'const' instead.","line":195,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":195,"endColumn":20,"fix":{"range":[6308,6342],"text":"const targetModel = configuredModel;"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":266,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9500,9503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9500,9503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":279,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10286,10289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10286,10289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":429,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":429,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15794,15797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15794,15797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { db } from '@/lib/firebase';\r\nimport { doc, getDoc, setDoc, updateDoc, deleteField } from 'firebase/firestore';\r\nimport { getSystemSettings } from './systemService';\r\nimport { chatWithOllamaMessages } from './ollamaService';\r\nimport { AIProvider, AILanguage, AIChatError, UserApiKeys, AI_LANGUAGES } from '@/types/aiChat';\r\nimport { UserTier } from '@/types/user';\r\n\r\nconst USERS_COLLECTION = 'users';\r\n\r\n/**\r\n * Get user's saved API keys from Firestore\r\n */\r\nexport const getUserApiKeys = async (userId: string): Promise<UserApiKeys> => {\r\n    try {\r\n        const userRef = doc(db, USERS_COLLECTION, userId);\r\n        const userSnap = await getDoc(userRef);\r\n\r\n        if (userSnap.exists()) {\r\n            const data = userSnap.data();\r\n            return {\r\n                groq: data.customApiKeys?.groq || undefined,\r\n                gemini: data.customApiKeys?.gemini || undefined,\r\n                preferredProvider: data.customApiKeys?.preferredProvider || 'groq',\r\n                preferredLanguage: data.customApiKeys?.preferredLanguage || 'en'\r\n            };\r\n        }\r\n        return { preferredProvider: 'groq', preferredLanguage: 'en' };\r\n    } catch (error) {\r\n        console.error('[AI_CHAT] Error fetching user API keys:', error);\r\n        return { preferredProvider: 'groq' };\r\n    }\r\n};\r\n\r\n/**\r\n * Save user's API key to Firestore\r\n */\r\nexport const saveUserApiKey = async (\r\n    userId: string,\r\n    provider: AIProvider,\r\n    apiKey: string\r\n): Promise<void> => {\r\n    try {\r\n        const userRef = doc(db, USERS_COLLECTION, userId);\r\n        await setDoc(userRef, {\r\n            customApiKeys: {\r\n                [provider]: apiKey\r\n            }\r\n        }, { merge: true });\r\n        console.log(`[AI_CHAT] Saved ${provider} API key for user ${userId}`);\r\n    } catch (error) {\r\n        console.error('[AI_CHAT] Error saving API key:', error);\r\n        throw error;\r\n    }\r\n};\r\n\r\n/**\r\n * Delete user's API key from Firestore\r\n */\r\nexport const deleteUserApiKey = async (\r\n    userId: string,\r\n    provider: AIProvider\r\n): Promise<void> => {\r\n    try {\r\n        const userRef = doc(db, USERS_COLLECTION, userId);\r\n        await updateDoc(userRef, {\r\n            [`customApiKeys.${provider}`]: deleteField()\r\n        });\r\n        console.log(`[AI_CHAT] Deleted ${provider} API key for user ${userId}`);\r\n    } catch (error) {\r\n        console.error('[AI_CHAT] Error deleting API key:', error);\r\n        throw error;\r\n    }\r\n};\r\n\r\n/**\r\n * Save user's preferred provider\r\n */\r\nexport const savePreferredProvider = async (\r\n    userId: string,\r\n    provider: AIProvider\r\n): Promise<void> => {\r\n    try {\r\n        const userRef = doc(db, USERS_COLLECTION, userId);\r\n        await setDoc(userRef, {\r\n            customApiKeys: {\r\n                preferredProvider: provider\r\n            }\r\n        }, { merge: true });\r\n    } catch (error) {\r\n        console.error('[AI_CHAT] Error saving preferred provider:', error);\r\n        throw error;\r\n    }\r\n};\r\n\r\n/**\r\n * Save user's preferred language\r\n */\r\nexport const savePreferredLanguage = async (\r\n    userId: string,\r\n    language: AILanguage\r\n): Promise<void> => {\r\n    try {\r\n        const userRef = doc(db, USERS_COLLECTION, userId);\r\n        await setDoc(userRef, {\r\n            customApiKeys: {\r\n                preferredLanguage: language\r\n            }\r\n        }, { merge: true });\r\n        console.log(`[AI_CHAT] Saved preferred language ${language} for user ${userId}`);\r\n    } catch (error) {\r\n        console.error('[AI_CHAT] Error saving preferred language:', error);\r\n        throw error;\r\n    }\r\n};\r\n\r\n/**\r\n * Determine if user must provide their own key based on tier\r\n */\r\nexport const requiresOwnKey = (tier: UserTier): boolean => {\r\n    return tier === 'free' || tier === 'plus';\r\n};\r\n\r\n/**\r\n * Get the appropriate API key based on user tier\r\n */\r\nexport const resolveApiKey = async (\r\n    userId: string,\r\n    tier: UserTier,\r\n    provider: AIProvider\r\n): Promise<{ key: string; source: 'user' | 'platform' }> => {\r\n    // Azure AI (Ollama) is self-hosted and free\r\n    if (provider === 'ollama') {\r\n        return { key: 'azure-internal', source: 'platform' };\r\n    }\r\n\r\n    // 1. Check if user has a custom key saved (Prioritize this for ALL tiers)\r\n    // This allows Pro users to override the platform key with their own if desired\r\n    const userKeys = await getUserApiKeys(userId);\r\n    const userKey = userKeys[provider];\r\n\r\n    if (userKey) {\r\n        return { key: userKey, source: 'user' };\r\n    }\r\n\r\n    // 2. Pro and Ultimate users fallback to platform key\r\n    if (!requiresOwnKey(tier)) {\r\n        const settings = await getSystemSettings();\r\n        // @ts-ignore\r\n        const platformKey = settings.apiKeys?.[provider as keyof typeof settings.apiKeys];\r\n\r\n        if (!platformKey) {\r\n            const error: AIChatError = {\r\n                code: 'API_ERROR',\r\n                message: `Platform API key for ${provider} is not configured in Admin Settings.`,\r\n                provider\r\n            };\r\n            throw error;\r\n        }\r\n\r\n        return { key: platformKey as string, source: 'platform' };\r\n    }\r\n\r\n    // 3. Free/Plus users must have a key (and we already checked above)\r\n    // If we reached here, they don't have a key\r\n    const error: AIChatError = {\r\n        code: 'MISSING_KEY',\r\n        message: `Please add your ${provider === 'groq' ? 'Groq' : 'Gemini'} API key in Settings to use AI Chat.`,\r\n        provider\r\n    };\r\n    throw error;\r\n};\r\n\r\n/**\r\n * Send a chat message to the AI provider\r\n */\r\nexport const sendAIChatMessage = async (\r\n    userId: string,\r\n    tier: UserTier,\r\n    message: string,\r\n    provider: AIProvider,\r\n    conversationHistory: { role: 'user' | 'assistant'; content: string }[] = [],\r\n    language: AILanguage = 'en'\r\n): Promise<string> => {\r\n    // Resolve the API key\r\n    const { key, source } = await resolveApiKey(userId, tier, provider);\r\n\r\n    // Get System Settings for configured models\r\n    const settings = await getSystemSettings();\r\n    const models = settings.apiKeys?.models;\r\n    const configuredModel = models?.[provider as keyof typeof models];\r\n\r\n    // Determine target model\r\n    // 1. If Platform Key: Use Configured Model -> Default\r\n    // 2. If User Key: Use High Tier -> Fallback Low Tier (Smart Logic)\r\n    let targetModel = configuredModel;\r\n\r\n\r\n    // Get language name for prompt\r\n    const languageInfo = AI_LANGUAGES[language];\r\n    const languageName = languageInfo?.name || 'English';\r\n\r\n    // Build messages array with history\r\n    const messages = [\r\n        {\r\n            role: 'system' as const,\r\n            content: `You are TruthLens AI ≡ƒÑù≡ƒÆ╗, a versatile and intelligent assistant specializing in TWO main areas:\r\n1. FOOD & NUTRITION: You help users understand food labels, ingredients, and healthy choices.\r\n2. TECH & HARDWARE: You are an expert in PC building, component specs, and troubleshooting technical issues.\r\n\r\nYou are also a general helper for this application. If a user asks \"how to reset password\" or \"how to use the scanner\", guide them clearly.\r\n\r\nRESPONSE STYLE:\r\n- Use relevant emojis naturally (≡ƒÑù≡ƒìÄ for food, ≡ƒÆ╗ΓÜí for tech).\r\n- Be conversational, warm, and encouraging.\r\n- Vary your wording - never repeat the same phrases.\r\n- Keep responses concise but informative.\r\n- Use bullet points and formatting for clarity.\r\n\r\nLANGUAGE: You MUST respond in ${languageName}. All your responses should be written in ${languageName}.\r\n\r\nIDENTITY KNOWLEDGE:\r\n- TruthLens: An AI-powered app that helps users analyze products (Food & Tech) and build PCs.\r\n- Creator: Youssef Boubli (known as TRADMSS).\r\n- PC Builder: If asked about building a PC, offer to help select components or explain the \"PC Builder\" feature in the app.\r\n\r\nWhen users ask about TruthLens (any spelling variation) or who made/created/built it, share this info naturally using your own creative wording.`\r\n        },\r\n        ...conversationHistory.map(msg => ({\r\n            role: msg.role as 'user' | 'assistant',\r\n            content: msg.content\r\n        })),\r\n        { role: 'user' as const, content: message }\r\n    ];\r\n\r\n    const attemptCall = async (modelToUse?: string) => {\r\n        if (provider === 'groq') {\r\n            return await callGroqAPI(key, messages, modelToUse);\r\n        } else if (provider === 'ollama') {\r\n            return await chatWithOllamaMessages(messages); // Ollama handles its own model config via settings\r\n        } else if (provider === 'deepseek') {\r\n            return await callDeepSeekAPI(key, messages, modelToUse);\r\n        } else if (provider === 'openrouter') {\r\n            return await callOpenRouterAPI(key, messages, modelToUse);\r\n        } else {\r\n            return await callGeminiAPI(key, messages, modelToUse);\r\n        }\r\n    };\r\n\r\n    try {\r\n        // If it's a user key, we might want to try \"Best\" then \"Fallback\"\r\n        if (source === 'user' && !targetModel) {\r\n            // Define defaults/fallbacks for user keys\r\n            let primaryModel = '';\r\n            let fallbackModel = '';\r\n\r\n            if (provider === 'gemini') {\r\n                primaryModel = 'gemini-1.5-pro';\r\n                fallbackModel = 'gemini-1.5-flash';\r\n            } else if (provider === 'groq') {\r\n                primaryModel = 'llama-3.3-70b-versatile';\r\n                fallbackModel = 'llama-3.1-8b-instant';\r\n            }\r\n\r\n            try {\r\n                return await attemptCall(primaryModel || undefined);\r\n            } catch (primaryError: any) {\r\n                console.warn(`[AI_SMART_FALLBACK] Primary model ${primaryModel} failed for user ${userId}. Retrying with ${fallbackModel}. Error:`, primaryError.message);\r\n                // Only retry on specific errors (404 Not Found, 429 Rate Limit?) - Actually user wants \"if api failed switch\"\r\n                // We retry if it's NOT an auth error.\r\n                if (primaryError?.code === 'INVALID_KEY' || primaryError?.status === 401) {\r\n                    throw primaryError; // Don't retry auth errors\r\n                }\r\n                return await attemptCall(fallbackModel);\r\n            }\r\n        } else {\r\n            // Platform key or configured model - just one attempt\r\n            return await attemptCall(targetModel);\r\n        }\r\n    } catch (error: any) {\r\n        // Handle specific API errors\r\n        if (error?.code) {\r\n            throw error; // Already formatted AIChatError\r\n        }\r\n\r\n        // Check for isInvalidKey flag (from Gemini parser)\r\n        if (error?.isInvalidKey) {\r\n            const chatError: AIChatError = {\r\n                code: 'INVALID_KEY',\r\n                message: `Your ${provider === 'groq' ? 'Groq' : provider === 'ollama' ? 'Azure AI' : 'Gemini'} API key is invalid. Please update it in Settings.`,\r\n                provider\r\n            };\r\n            throw chatError;\r\n        }\r\n\r\n        // Check for authentication errors (401 for Groq, 400/403 for Gemini)\r\n        if (error?.status === 401 ||\r\n            error?.status === 400 ||\r\n            error?.status === 403 ||\r\n            error?.message?.includes('401') ||\r\n            error?.message?.includes('invalid') ||\r\n            error?.message?.includes('invalid') ||\r\n            error?.message?.includes('API key') ||\r\n            error?.message?.includes('authentication')) {\r\n            const chatError: AIChatError = {\r\n                code: 'INVALID_KEY',\r\n                message: `Your ${provider === 'groq' ? 'Groq' : provider === 'deepseek' ? 'DeepSeek' : provider === 'ollama' ? 'Azure AI' : 'Gemini'} API key is invalid or expired. Please update it in Settings.`,\r\n                provider\r\n            };\r\n            throw chatError;\r\n        }\r\n\r\n        // Check for rate limit\r\n        if (error?.status === 429 || error?.message?.includes('429') || error?.message?.includes('rate')) {\r\n            const chatError: AIChatError = {\r\n                code: 'RATE_LIMIT',\r\n                message: 'Rate limit exceeded. Please wait a moment and try again.',\r\n                provider\r\n            };\r\n            throw chatError;\r\n        }\r\n\r\n        // Check for Ollama Model Not Found (404)\r\n        if (provider === 'ollama' && (error?.status === 404 || error?.message?.includes('404'))) {\r\n            const chatError: AIChatError = {\r\n                code: 'API_ERROR',\r\n                message: `The selected AI model is not installed on the Azure server. Please go to Admin Settings > AI & Models to select an available model.`,\r\n                provider\r\n            };\r\n            throw chatError;\r\n        }\r\n\r\n        // Generic API error - don't show raw messages\r\n        const genericError: AIChatError = {\r\n            code: 'API_ERROR',\r\n            message: 'An error occurred while communicating with the AI. Please try again.',\r\n            provider\r\n        };\r\n        throw genericError;\r\n    }\r\n};\r\n\r\n/**\r\n * Call Groq API\r\n */\r\nconst callGroqAPI = async (\r\n    apiKey: string,\r\n    messages: { role: string; content: string }[],\r\n    model: string = 'llama-3.3-70b-versatile'\r\n): Promise<string> => {\r\n    const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: {\r\n            'Authorization': `Bearer ${apiKey}`,\r\n            'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n            model: model,\r\n            messages,\r\n            temperature: 0.7,\r\n            max_tokens: 1024\r\n        })\r\n    });\r\n\r\n    if (!response.ok) {\r\n        const errorText = await response.text();\r\n        throw { status: response.status, message: errorText };\r\n    }\r\n\r\n    const data = await response.json();\r\n    return data.choices?.[0]?.message?.content || 'No response generated.';\r\n};\r\n\r\n/**\r\n * Call Gemini API\r\n */\r\nconst callGeminiAPI = async (\r\n    apiKey: string,\r\n    messages: { role: string; content: string }[],\r\n    model: string = 'gemini-1.5-flash'\r\n): Promise<string> => {\r\n    // Convert messages to Gemini format\r\n    const contents = messages\r\n        .filter(m => m.role !== 'system')\r\n        .map(m => ({\r\n            role: m.role === 'assistant' ? 'model' : 'user',\r\n            parts: [{ text: m.content }]\r\n        }));\r\n\r\n    // Add system instruction to first user message if present\r\n    const systemMsg = messages.find(m => m.role === 'system');\r\n    if (systemMsg && contents.length > 0) {\r\n        contents[0].parts[0].text = `${systemMsg.content}\\n\\n${contents[0].parts[0].text}`;\r\n    }\r\n\r\n    const response = await fetch(\r\n        `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`,\r\n        {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n            body: JSON.stringify({\r\n                contents,\r\n                generationConfig: {\r\n                    temperature: 0.7,\r\n                    maxOutputTokens: 1024\r\n                }\r\n            })\r\n        }\r\n    );\r\n\r\n    if (!response.ok) {\r\n        const errorText = await response.text();\r\n\r\n        // Try to parse Gemini error JSON and extract clean message\r\n        try {\r\n            const errorJson = JSON.parse(errorText);\r\n            const errorMessage = errorJson?.error?.message || 'Unknown error';\r\n            const errorStatus = errorJson?.error?.status || '';\r\n\r\n            // Check for specific error types\r\n            if (errorStatus === 'INVALID_ARGUMENT' ||\r\n                errorMessage.includes('API key not valid') ||\r\n                errorMessage.includes('invalid')) {\r\n                throw { status: 400, message: 'API key is invalid', isInvalidKey: true };\r\n            }\r\n\r\n            throw { status: response.status, message: errorMessage };\r\n        } catch (parseError: any) {\r\n            // If it's our formatted error, rethrow it\r\n            if (parseError.isInvalidKey) {\r\n                throw parseError;\r\n            }\r\n            // Otherwise throw with raw text\r\n            throw { status: response.status, message: errorText };\r\n        }\r\n    }\r\n\r\n    const data = await response.json();\r\n    return data.candidates?.[0]?.content?.parts?.[0]?.text || 'No response generated.';\r\n};\r\n\r\n/**\r\n * Call DeepSeek API\r\n */\r\nconst callDeepSeekAPI = async (\r\n    apiKey: string,\r\n    messages: { role: string; content: string }[],\r\n    model: string = 'deepseek-chat'\r\n): Promise<string> => {\r\n    // Get Base URL from settings\r\n    const settings = await getSystemSettings();\r\n    const baseUrl = settings.apiKeys?.deepseekBaseUrl || 'https://api.deepseek.com';\r\n\r\n    // Ensure URL ends with /chat/completions or /v1/chat/completions if it's Ollama\r\n    // If it's pure DeepSeek API: https://api.deepseek.com/chat/completions\r\n    // If it's Ollama: http://ip:11434/v1/chat/completions\r\n    let endpoint = baseUrl;\r\n    if (!endpoint.endsWith('/chat/completions')) {\r\n        if (endpoint.endsWith('/v1')) {\r\n            endpoint = `${endpoint}/chat/completions`;\r\n        } else if (endpoint.endsWith('/')) {\r\n            endpoint = `${endpoint}chat/completions`; // Aggressive assumption, usually needs /v1\r\n        } else {\r\n            // If it looks like a root URL (e.g. port 11434), append /v1/chat/completions\r\n            // DeepSeek official is special, but for self-hosted we assume OpenAI compatibility\r\n            if (endpoint.includes('api.deepseek.com')) {\r\n                endpoint = `${endpoint}/chat/completions`;\r\n            } else {\r\n                endpoint = `${endpoint}/v1/chat/completions`;\r\n            }\r\n        }\r\n    }\r\n\r\n    const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        headers: {\r\n            'Authorization': `Bearer ${apiKey}`,\r\n            'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n            model: model,\r\n            messages,\r\n            stream: false\r\n        })\r\n    });\r\n\r\n    if (!response.ok) {\r\n        const errorText = await response.text();\r\n        throw { status: response.status, message: errorText };\r\n    }\r\n\r\n    const data = await response.json();\r\n    return data.choices?.[0]?.message?.content || 'No response generated.';\r\n};\r\n\r\n/**\r\n * Call OpenRouter API\r\n */\r\nconst callOpenRouterAPI = async (\r\n    apiKey: string,\r\n    messages: { role: string; content: string }[],\r\n    model?: string\r\n): Promise<string> => {\r\n    // Get settings for model configuration\r\n    const settings = await getSystemSettings();\r\n    const defaultModel = settings.apiKeys?.openrouterModel || 'meta-llama/llama-3.1-8b-instruct:free';\r\n\r\n    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: {\r\n            'Authorization': `Bearer ${apiKey}`,\r\n            'Content-Type': 'application/json',\r\n            'HTTP-Referer': typeof window !== 'undefined' ? window.location.origin : 'https://truthlens.app',\r\n            'X-Title': 'TruthLens AI'\r\n        },\r\n        body: JSON.stringify({\r\n            model: model || defaultModel,\r\n            messages,\r\n            stream: false\r\n        })\r\n    });\r\n\r\n    if (!response.ok) {\r\n        const errorText = await response.text();\r\n        throw { status: response.status, message: errorText };\r\n    }\r\n\r\n    const data = await response.json();\r\n    return data.choices?.[0]?.message?.content || 'No response generated.';\r\n};\r\n/**\r\n * Test an API key to verify it works\r\n */\r\nexport const testApiKey = async (provider: AIProvider, apiKey: string): Promise<boolean> => {\r\n    try {\r\n        const testMessage = [{ role: 'user', content: 'Hi' }];\r\n\r\n        if (provider === 'groq') {\r\n            await callGroqAPI(apiKey, testMessage, 'llama-3.1-8b-instant');\r\n        } else if (provider === 'gemini') {\r\n            await callGeminiAPI(apiKey, testMessage, 'gemini-1.5-flash');\r\n        } else if (provider === 'deepseek') {\r\n            // Use default model for test\r\n            await callDeepSeekAPI(apiKey, testMessage);\r\n        } else if (provider === 'openrouter') {\r\n            await callOpenRouterAPI(apiKey, testMessage);\r\n        } else if (provider === 'ollama') {\r\n            // Ollama is always \"valid\" if the server is reachable, but here we just return true\r\n            // because key validation isn't really applicable unless we're testing the URL connection which is separate\r\n            return true;\r\n        }\r\n\r\n        return true;\r\n    } catch (error) {\r\n        console.error(`[AI_TEST] ${provider} key validation failed:`, error);\r\n        return false;\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\aiService.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":28,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":28,"endColumn":26,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[1231,1244],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":31,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":19},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":35,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":35,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[1449,1462],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4010,4013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4010,4013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":160,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5711,5714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5711,5714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":196,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7344,7347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7344,7347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":257,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10280,10283],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10280,10283],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":461,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":461,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18592,18595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18592,18595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":484,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":484,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19983,19986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19983,19986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":499,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":499,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20674,20677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20674,20677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":562,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":562,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23062,23065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23062,23065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":627,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":627,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25543,25546],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25543,25546],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'nutriments' is defined but never used.","line":733,"column":91,"nodeType":null,"messageId":"unusedVar","endLine":733,"endColumn":101},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":733,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":733,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29764,29767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29764,29767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":741,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":741,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30324,30327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30324,30327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":794,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":794,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32454,32457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32454,32457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { GoogleGenerativeAI } from \"@google/generative-ai\";\r\nimport { UserTier } from '@/types/user';\r\nimport Groq from \"groq-sdk\";\r\nimport axios from 'axios';\r\n\r\n// Environment Variables\r\nconst GEMINI_API_KEY = process.env.NEXT_PUBLIC_GEMINI_API_KEY || '';\r\nconst GROQ_API_KEY = process.env.NEXT_PUBLIC_GROQ_API_KEY || '';\r\nconst DEEPSEEK_API_KEY = process.env.NEXT_PUBLIC_DEEPSEEK_API_KEY || '';\r\nconst CEREBRAS_API_KEY = process.env.NEXT_PUBLIC_CEREBRAS_API_KEY || '';\r\nconst SAMBANOVA_API_KEY = process.env.NEXT_PUBLIC_SAMBANOVA_API_KEY || '';\r\nconst SERPAPI_API_KEY = process.env.NEXT_PUBLIC_SERPAPI_API_KEY || '';\r\nconst OPENAI_API_KEY = process.env.NEXT_PUBLIC_OPENAI_API_KEY || '';\r\n\r\n// Initialize Clients lazily or per-request to support dynamic keys\r\nimport { getSystemSettings } from './systemService';\r\n\r\n// Interfaces for key caching\r\nlet cachedApiKeys: Record<string, string> | null = null;\r\nlet lastFetch = 0;\r\nconst CACHE_TTL = 60000; // 1 minute cache\r\n\r\nconst getDynamicKey = async (keyName: string, envVar: string): Promise<string> => {\r\n    const now = Date.now();\r\n    if (!cachedApiKeys || (now - lastFetch > CACHE_TTL)) {\r\n        try {\r\n            const settings = await getSystemSettings();\r\n            // @ts-ignore\r\n            cachedApiKeys = settings.apiKeys || {};\r\n            lastFetch = now;\r\n        } catch (e) {\r\n            console.warn(\"Failed to fetch dynamic keys, using env only\");\r\n        }\r\n    }\r\n    // @ts-ignore\r\n    return (cachedApiKeys && cachedApiKeys[keyName]) ? cachedApiKeys[keyName] : envVar;\r\n};\r\n\r\n// --- Clients Wrappers ---\r\n\r\nconst getGeminiClient = async () => {\r\n    const key = await getDynamicKey('gemini', GEMINI_API_KEY);\r\n    if (!key) throw new Error(\"Gemini Key Missing\");\r\n    return new GoogleGenerativeAI(key);\r\n};\r\n\r\nconst getGroqClient = async () => {\r\n    const key = await getDynamicKey('groq', GROQ_API_KEY);\r\n    if (!key) throw new Error(\"Groq Key Missing\");\r\n    return new Groq({ apiKey: key, dangerouslyAllowBrowser: true });\r\n};\r\n\r\nconst getOpenAIClient = async () => {\r\n    const key = await getDynamicKey('openai', OPENAI_API_KEY);\r\n    if (!key) throw new Error(\"OpenAI Key Missing\");\r\n    return { apiKey: key, baseUrl: 'https://api.openai.com/v1' };\r\n};\r\n\r\n// --- Interfaces ---\r\n\r\nexport interface AIAnalysis {\r\n    grade: string;\r\n    summary: string;\r\n    pros: string[];\r\n    cons: string[];\r\n    healthScore: number; // 0-100\r\n}\r\n\r\nexport interface HarmfulIngredient {\r\n    name: string;\r\n    reason: string;\r\n    severity: 'low' | 'medium' | 'high';\r\n}\r\n\r\nexport interface AITruthDetectorResult {\r\n    harmfulIngredients: HarmfulIngredient[];\r\n    overallRisk: 'low' | 'medium' | 'high';\r\n    recommendation: string;\r\n}\r\n\r\nexport interface RecommendedProduct {\r\n    name: string;\r\n    brand: string;\r\n    reason: string; // concise reason for recommendation\r\n}\r\n\r\nexport interface SustainabilityAnalysis {\r\n    ecoScore: number; // 0-100\r\n    carbonFootprint: string; // e.g. \"Low\", \"1.2kg\"\r\n    packagingRating: 'good' | 'fair' | 'poor';\r\n    sustainabilityTips: string[];\r\n}\r\n\r\nexport interface ARProductDetails {\r\n    dimensions: { length: number; width: number; height: number; unit: string };\r\n    shape: 'box' | 'cylinder' | 'bottle' | 'bag' | 'pouch';\r\n    color: string;\r\n    texture: string;\r\n    estimatedRealWorldSize: string; // e.g. \"Size of a soda can\"\r\n}\r\n\r\nexport interface MealPlanDay {\r\n    day: string;\r\n    meals: {\r\n        breakfast: string;\r\n        lunch: string;\r\n        dinner: string;\r\n        snacks: string[];\r\n    };\r\n    nutritionalSummary: string;\r\n}\r\n\r\n// --- Helper Functions for AI Providers ---\r\n\r\nconst callGemini = async (prompt: string): Promise<string> => {\r\n    const genAI = await getGeminiClient();\r\n    try {\r\n        // User enforced: Always use free gemini-1.5-flash\r\n        const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\r\n        const result = await model.generateContent(prompt);\r\n        return result.response.text();\r\n    } catch (e: any) {\r\n        if (e.message.includes('404') || e.message.includes('not found')) {\r\n            console.warn(\"ΓÜá∩╕Å 'gemini-1.5-flash' alias failed, trying 'gemini-1.5-flash-latest'\");\r\n            // Fallback to latest variant\r\n            const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash-latest\" });\r\n            const result = await model.generateContent(prompt);\r\n            return result.response.text();\r\n        }\r\n        throw e;\r\n    }\r\n};\r\n\r\nconst callGroq = async (prompt: string): Promise<string> => {\r\n    const groq = await getGroqClient();\r\n    const completion = await groq.chat.completions.create({\r\n        messages: [{ role: \"user\", content: prompt }],\r\n        model: \"llama-3.3-70b-versatile\", // Latest Llama 3.3 (Performant & Free on Groq)\r\n        temperature: 0.5,\r\n    });\r\n    return completion.choices[0]?.message?.content || \"\";\r\n};\r\n\r\n// Generic function for OpenAI-compatible APIs (DeepSeek, Cerebras, SambaNova)\r\nconst callOpenAICompatible = async (prompt: string, envKey: string, keyName: string, baseUrl: string, modelName: string): Promise<string> => {\r\n    const apiKey = await getDynamicKey(keyName, envKey);\r\n\r\n    if (!apiKey) throw new Error(`API Key Missing for ${modelName}`);\r\n    try {\r\n        const response = await axios.post(\r\n            `${baseUrl}/chat/completions`,\r\n            {\r\n                model: modelName,\r\n                messages: [{ role: \"user\", content: prompt }],\r\n                temperature: 0.5,\r\n            },\r\n            { headers: { 'Authorization': `Bearer ${apiKey}`, 'Content-Type': 'application/json' } }\r\n        );\r\n        return response.data.choices[0]?.message?.content || \"\";\r\n    } catch (error: any) {\r\n        console.error(`Error calling ${modelName}:`, error.message);\r\n        throw error;\r\n    }\r\n};\r\n\r\nconst callDeepSeek = (prompt: string) => callOpenAICompatible(prompt, DEEPSEEK_API_KEY, 'deepseek', \"https://api.deepseek.com/v1\", \"deepseek-chat\");\r\nconst callCerebras = (prompt: string) => callOpenAICompatible(prompt, CEREBRAS_API_KEY, 'cerebras', \"https://api.cerebras.ai/v1\", \"llama3.1-70b\");\r\nconst callSambaNova = (prompt: string) => callOpenAICompatible(prompt, SAMBANOVA_API_KEY, 'sambanova', \"https://api.sambanova.ai/v1\", \"Meta-Llama-3.1-70B-Instruct\");\r\n\r\n// Self-hosted Ollama (Free, Unlimited)\r\nconst callOllama = async (prompt: string): Promise<string> => {\r\n    const { chatWithOllama, checkOllamaHealth } = await import('./ollamaService');\r\n\r\n    // Check if Ollama is available\r\n    const isHealthy = await checkOllamaHealth();\r\n    if (!isHealthy) {\r\n        throw new Error('Ollama is not available');\r\n    }\r\n\r\n    return chatWithOllama(prompt, 'llama3.2');\r\n};\r\n\r\nconst callOpenAI = async (prompt: string): Promise<string> => {\r\n    const { apiKey } = await getOpenAIClient();\r\n    try {\r\n        const response = await axios.post(\r\n            'https://api.openai.com/v1/chat/completions',\r\n            {\r\n                model: \"gpt-4o-mini\", // Optimized for free tier/efficiency\r\n                messages: [{ role: \"user\", content: prompt }],\r\n                temperature: 0.5,\r\n            },\r\n            { headers: { 'Authorization': `Bearer ${apiKey}`, 'Content-Type': 'application/json' } }\r\n        );\r\n        return response.data.choices[0]?.message?.content || \"\";\r\n    } catch (error: any) {\r\n        console.error(\"Error calling OpenAI:\", error.message);\r\n        throw error;\r\n    }\r\n};\r\n\r\n// --- AI Swarm Logic (Generic) ---\r\n\r\n// --- AI Swarm Logic (Hybrid: Client Key or Server Action) ---\r\n\r\nimport { serverSwarmResponse } from '@/app/actions/aiActions';\r\n\r\nconst getSwarmResponse = async (prompt: string, trustedProviders: Array<{ name: string, fn: (p: string) => Promise<string> }> = []): Promise<string> => {\r\n    // 1. Check for User-Provided Keys (Client Side)\r\n    // If user has their own key, we use client-side calls (faster, no server load)\r\n    const userProviders: Array<{ name: string, fn: (p: string) => Promise<string> }> = [];\r\n\r\n    // Check keys concurrently\r\n    const [hasGroq, hasGemini, hasDeepSeek, hasCerebras, hasSambaNova, hasOpenAI] = await Promise.all([\r\n        getDynamicKey('groq', ''),\r\n        getDynamicKey('gemini', ''),\r\n        getDynamicKey('deepseek', ''),\r\n        getDynamicKey('cerebras', ''),\r\n        getDynamicKey('sambanova', ''),\r\n        getDynamicKey('openai', '')\r\n    ]);\r\n\r\n    if (hasGroq) userProviders.push({ name: 'Groq', fn: callGroq });\r\n    if (hasGemini) userProviders.push({ name: 'Gemini', fn: callGemini });\r\n    if (hasDeepSeek) userProviders.push({ name: 'DeepSeek', fn: callDeepSeek });\r\n    if (hasCerebras) userProviders.push({ name: 'Cerebras', fn: callCerebras });\r\n    if (hasSambaNova) userProviders.push({ name: 'SambaNova', fn: callSambaNova });\r\n    if (hasOpenAI) userProviders.push({ name: 'OpenAI', fn: callOpenAI });\r\n\r\n    // Always add Ollama (Free, Self-Hosted, Client-side proxy or direct)\r\n    // Actually Ollama is usually local or proxied. \r\n    userProviders.push({ name: 'Ollama', fn: callOllama });\r\n\r\n    // Filter trusted if specified\r\n    const activeClientProviders = trustedProviders.length > 0\r\n        ? trustedProviders.filter(p => userProviders.some(up => up.name === p.name))\r\n        : userProviders;\r\n\r\n    // 2. If User has keys, race them\r\n    if (activeClientProviders.length > 0 && activeClientProviders.some(p => p.name !== 'Ollama')) { // Prefer user keys over server if valid\r\n        console.log(`≡ƒÉ¥ [Client Swarm] Racing User Keys: ${activeClientProviders.map(p => p.name).join(', ')}...`);\r\n        try {\r\n            return await Promise.any(activeClientProviders.map(p => p.fn(prompt)));\r\n        } catch (e) {\r\n            console.warn(\"Client swarm failed, falling back to server...\", e);\r\n        }\r\n    }\r\n\r\n    // 3. Fallback to Server Swarm (System Keys)\r\n    // If no user keys, or client swarm failed, use Server Actions (which use hidden System Keys)\r\n    try {\r\n        const serverProviders = trustedProviders.length > 0\r\n            ? trustedProviders.map(p => p.name.toLowerCase()).filter(n => ['groq', 'gemini', 'deepseek', 'cerebras', 'sambanova'].includes(n))\r\n            : ['groq', 'gemini'];\r\n\r\n        return await serverSwarmResponse(prompt, serverProviders);\r\n    } catch (error: any) {\r\n        console.error(\"Γÿá∩╕Å [Swarm Failed] Both Client and Server swarms failed:\", error);\r\n        throw error;\r\n    }\r\n};\r\n\r\n// --- Specialized Feature Functions ---\r\n\r\nexport const analyzeIngredientsForHarmfulCompounds = async (ingredients: string[]): Promise<AITruthDetectorResult | null> => {\r\n    if (!ingredients || ingredients.length === 0) return null;\r\n\r\n    const prompt = `\r\n      You are a food safety expert. Analyze these ingredients for harmful additives: ${ingredients.join(', ')}.\r\n      Identify potential health risks (carcinogens, allergens, inflammatory agents).\r\n      Return JSON ONLY:\r\n      {\r\n        \"harmfulIngredients\": [{\"name\": \"string\", \"reason\": \"string\", \"severity\": \"low/medium/high\"}],\r\n        \"overallRisk\": \"low/medium/high\",\r\n        \"recommendation\": \"Safety advice\"\r\n      }\r\n    `;\r\n\r\n    try {\r\n        const text = await getSwarmResponse(prompt, [\r\n            { name: 'Groq', fn: callGroq },\r\n            { name: 'DeepSeek', fn: callDeepSeek }\r\n        ]);\r\n        const cleaned = text.replace(/```json/g, '').replace(/```/g, '').trim();\r\n        return JSON.parse(cleaned) as AITruthDetectorResult;\r\n    } catch (e) {\r\n        console.error(\"Truth Detector Error:\", e);\r\n        return null;\r\n    }\r\n};\r\n\r\nexport const calculateSustainabilityScore = async (productName: string, brand: string, ingredients: string[]): Promise<SustainabilityAnalysis | null> => {\r\n    const prompt = `\r\n        Analyze the sustainability of \"${productName}\" by ${brand}.\r\n        Ingredients: ${ingredients.join(', ')}.\r\n        Estimate carbon footprint, packaging waste, and ethical sourcing.\r\n        Return JSON ONLY:\r\n        {\r\n            \"ecoScore\": number (0-100),\r\n            \"carbonFootprint\": \"string (e.g. Low)\",\r\n            \"packagingRating\": \"good/fair/poor\",\r\n            \"sustainabilityTips\": [\"tip1\", \"tip2\"]\r\n        }\r\n    `;\r\n\r\n    try {\r\n        const text = await getSwarmResponse(prompt, [\r\n            { name: 'Cerebras', fn: callCerebras },\r\n            { name: 'SambaNova', fn: callSambaNova },\r\n            { name: 'Gemini', fn: callGemini }\r\n        ]);\r\n        const cleaned = text.replace(/```json/g, '').replace(/```/g, '').trim();\r\n        return JSON.parse(cleaned) as SustainabilityAnalysis;\r\n    } catch (e) {\r\n        console.error(\"Sustainability Error:\", e);\r\n        return null;\r\n    }\r\n};\r\n\r\nexport const generateMealPlan = async (inventory: string[]): Promise<MealPlanDay[] | null> => {\r\n    const prompt = `\r\n        Create a 3-day healthy meal plan using these ingredients available: ${inventory.join(', ')}.\r\n        Fill in gaps with common pantry items.\r\n        Return JSON ONLY as Array of objects:\r\n        [\r\n            {\r\n                \"day\": \"Day 1\",\r\n                \"meals\": { \"breakfast\": \"\", \"lunch\": \"\", \"dinner\": \"\", \"snacks\": [] },\r\n                \"nutritionalSummary\": \"Brief summary\"\r\n            }\r\n        ]\r\n    `;\r\n\r\n    try {\r\n        const text = await getSwarmResponse(prompt, [\r\n            { name: 'Gemini', fn: callGemini },\r\n            { name: 'SambaNova', fn: callSambaNova }\r\n        ]);\r\n        const cleaned = text.replace(/```json/g, '').replace(/```/g, '').trim();\r\n        return JSON.parse(cleaned) as MealPlanDay[];\r\n    } catch (e) {\r\n        console.error(\"Meal Planner Error:\", e);\r\n        return null;\r\n    }\r\n};\r\n\r\nexport const getARProductDetails = async (productName: string, category: string): Promise<ARProductDetails | null> => {\r\n    const prompt = `\r\n        Estimate the physical dimensions and shape of this product for an AR visualizations: \"${productName}\" (${category}).\r\n        Return JSON ONLY:\r\n        {\r\n            \"dimensions\": { \"length\": number (cm), \"width\": number (cm), \"height\": number (cm), \"unit\": \"cm\" },\r\n            \"shape\": \"box\" | \"cylinder\" | \"bottle\" | \"bag\" | \"pouch\",\r\n            \"color\": \"dominant hex color\",\r\n            \"texture\": \"matte/glossy/metallic\",\r\n            \"estimatedRealWorldSize\": \"Comparison string (e.g. Size of a smartphone)\"\r\n        }\r\n    `;\r\n\r\n    try {\r\n        const text = await getSwarmResponse(prompt, [\r\n            { name: 'SambaNova', fn: callSambaNova },\r\n            { name: 'Cerebras', fn: callCerebras },\r\n            { name: 'Groq', fn: callGroq }\r\n        ]);\r\n        const cleaned = text.replace(/```json/g, '').replace(/```/g, '').trim();\r\n        return JSON.parse(cleaned) as ARProductDetails;\r\n    } catch (e) {\r\n        console.error(\"AR Data Layer Error:\", e);\r\n        return null;\r\n    }\r\n};\r\n\r\nexport const extractDietaryEntities = async (text: string): Promise<{ allergens: string[], avoidIngredients: string[], healthGoals: string[] }> => {\r\n    const prompt = `\r\n        Analyze this user's dietary description: \"${text}\".\r\n        Extract:\r\n        1. \"allergens\": Specific allergies (e.g., Peanuts, Shellfish).\r\n        2. \"avoidIngredients\": Ingredients to avoid (e.g., Sugar, Palm Oil).\r\n        3. \"healthGoals\": Goals mentioned (e.g., Weight Loss, Muscle Gain).\r\n        \r\n        IGNORE anything not related to Food, Allergies, or Health (e.g., \"I like cars\").\r\n        Return JSON ONLY: { \"allergens\": [], \"avoidIngredients\": [], \"healthGoals\": [] }\r\n    `;\r\n\r\n    try {\r\n        const responseText = await getSwarmResponse(prompt, [\r\n            { name: 'Groq', fn: callGroq },\r\n            { name: 'Gemini', fn: callGemini }\r\n        ]);\r\n        const cleaned = responseText.replace(/```json/g, '').replace(/```/g, '').trim();\r\n        return JSON.parse(cleaned);\r\n    } catch (e) {\r\n        console.error(\"Dietary Entity Extraction Error:\", e);\r\n        return { allergens: [], avoidIngredients: [], healthGoals: [] };\r\n    }\r\n};\r\n\r\nexport interface PairedProduct {\r\n    name: string;\r\n    brand: string;\r\n    reason: string;\r\n}\r\n\r\nexport interface RecommendationPair {\r\n    rejected: PairedProduct;\r\n    recommended: PairedProduct;\r\n}\r\n\r\nexport const getSwarmPairedRecommendations = async (historyContext: string): Promise<RecommendationPair[]> => {\r\n    const prompt = `\r\n        You are a strict nutritionist. Analyze the user's recent food history:\r\n        ${historyContext}\r\n\r\n        Identify up to 5 \"unhealthy\" or mediocre products (Grade C, D, E, or high sugar/processed).\r\n        For EACH, suggest a realistic, healthier alternative.\r\n        CRITICAL: The recommended item MUST BE A SPECIFIC, FAMOUS BRANDED PRODUCT (e.g., \"Chobani Greek Yogurt\", \"Tropicana Pure Premium\", \"Kind Bar\").\r\n        DO NOT suggest generic items (e.g., \"Greek Yogurt\"). It must be a scannable commercial product.\r\n\r\n        Return JSON ONLY as an Array:\r\n        [\r\n            {\r\n                \"rejected\": { \"name\": \"Exact Name from History\", \"brand\": \"Brand\", \"reason\": \"Why it's unhealthy (2-3 words)\" },\r\n                \"recommended\": { \"name\": \"Specific Famous Brand Product\", \"brand\": \"Brand Name\", \"reason\": \"Why it's better (2-3 words)\" }\r\n            }\r\n        ]\r\n        \r\n        If history is empty or has no bad items, generate 3 generic examples of common swaps (e.g. Soda -> Sparkling Water, Chips -> Popcorn).\r\n    `;\r\n\r\n    try {\r\n        const text = await getSwarmResponse(prompt);\r\n        const cleaned = text.replace(/```json/g, '').replace(/```/g, '').trim();\r\n        return JSON.parse(cleaned) as RecommendationPair[];\r\n    } catch (error) {\r\n        console.error(\"[getSwarmPairedRecommendations] Error:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const getSwarmRecommendations = async (historyContext: string): Promise<RecommendedProduct[]> => {\r\n    const prompt = `\r\n        You are a nutrition expert AI. Based on the user's recent food scan history:\r\n        ${historyContext}\r\n\r\n        Suggest 6 SPECIFIC, real-world healthy food products that would be good alternatives or complementary items.\r\n        Return ONLY valid JSON:\r\n        [ { \"name\": \"Product Name\", \"brand\": \"Brand Name\", \"reason\": \"Why this is recommended\" } ]\r\n    `;\r\n\r\n    try {\r\n        const text = await getSwarmResponse(prompt);\r\n        const cleaned = text.replace(/```json/g, '').replace(/```/g, '').trim();\r\n        return JSON.parse(cleaned) as RecommendedProduct[];\r\n    } catch (error) {\r\n        console.error(\"[getSwarmRecommendations] Error:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const searchExternalDatabases = async (query: string): Promise<any> => {\r\n    // Import SearXNG service dynamically to avoid circular deps\r\n    const { searchProductInfo } = await import('./searxngService');\r\n\r\n    try {\r\n        console.log(`[External Search] Searching for: ${query}`);\r\n\r\n        // Try SearXNG first (free, unlimited)\r\n        const searxngResult = await searchProductInfo(query);\r\n\r\n        if (searxngResult && searxngResult.description) {\r\n            // Synthesize the results with AI\r\n            const synthesisPrompt = `Synthesize product info from these search results for \"${query}\": ${searxngResult.description}. Return JSON keys: name, brand, nutrition_grades (A-E), description.`;\r\n            const synthesis = await getSwarmResponse(synthesisPrompt);\r\n            return JSON.parse(synthesis.replace(/```json/g, '').replace(/```/g, '').trim());\r\n        }\r\n\r\n        // Fallback to SerpAPI if configured and SearXNG failed\r\n        if (SERPAPI_API_KEY) {\r\n            const trustedSites = \"site:fdc.nal.usda.gov OR site:ewg.org OR site:nutritionix.com OR site:foodb.ca\";\r\n            const searchUrl = `https://serpapi.com/search.json?q=${encodeURIComponent(query + \" \" + trustedSites)}&api_key=${SERPAPI_API_KEY}`;\r\n            const response = await axios.get(searchUrl);\r\n            if (response.data.organic_results?.length > 0) {\r\n                const snippets = response.data.organic_results.slice(0, 3).map((r: any) => r.snippet).join(\"\\n\");\r\n                const synthesisPrompt = `Synthesize product info from these search results for \"${query}\": ${snippets}. Return JSON keys: name, brand, nutrition_grades (A-E), description.`;\r\n                const synthesis = await getSwarmResponse(synthesisPrompt);\r\n                return JSON.parse(synthesis.replace(/```json/g, '').replace(/```/g, '').trim());\r\n            }\r\n        }\r\n\r\n        return null;\r\n    } catch (error) {\r\n        console.error(\"[External Search] Error:\", error);\r\n        return null;\r\n    }\r\n};\r\n\r\n// --- PRO TIER: Antigravity AI Analysis ---\r\nexport const analyzeProductProMode = async (productName: string, userAttributes: any): Promise<string> => {\r\n    const prompt = `\r\n    ### Role:\r\n    You are \"Antigravity AI,\" an elite product research analyst serving PRO tier users.\r\n    \r\n    ### Input:\r\n    Product: \"${productName}\"\r\n    User Profile: ${JSON.stringify(userAttributes)}\r\n\r\n    ### Objective:\r\n    Provide a deep, critical, and data-driven analysis.\r\n\r\n    ### Output Format:\r\n    Return a **SINGLE VALID JSON OBJECT** (no markdown formatting, no backticks).\r\n    Schema:\r\n    {\r\n      \"marketStatus\": \"Short availability/price summary\",\r\n      \"brandReputation\": \"Short brand check\",\r\n      \"grading\": {\r\n        \"quality\": { \"score\": number (0-100), \"reason\": \"string\" },\r\n        \"value\": { \"score\": number (0-100), \"reason\": \"string\" },\r\n        \"satisfaction\": { \"score\": number (0-100), \"reason\": \"string\" },\r\n        \"totalScore\": number (0-100),\r\n        \"letterGrade\": \"A+|A|B|C|D|F\"\r\n      },\r\n      \"analysis\": {\r\n        \"overview\": \"Concise product summary\",\r\n        \"strengths\": [\"point 1\", \"point 2\", \"point 3\"],\r\n        \"weaknesses\": [\"point 1\", \"point 2\", \"point 3\"],\r\n        \"valueAssessment\": \"Is it worth it?\",\r\n        \"reviewsSummary\": \"User consensus\"\r\n      },\r\n      \"verdict\": {\r\n        \"decision\": \"RECOMMEND\" | \"DO NOT RECOMMEND\" | \"CONSIDER ALTERNATIVES\",\r\n        \"reasoning\": \"Final conclusion\"\r\n      }\r\n    }\r\n    `;\r\n\r\n    try {\r\n        console.log(\"≡ƒÜÇ [Pro Analysis] Starting. Keys present:\", {\r\n            Groq: !!GROQ_API_KEY,\r\n            DeepSeek: !!DEEPSEEK_API_KEY,\r\n            Gemini: !!GEMINI_API_KEY\r\n        });\r\n\r\n        // Use Groq (Llama3-70b) or DeepSeek for high-reasoning capability, fallback to OpenAI/Gemini\r\n        const response = await getSwarmResponse(prompt, [\r\n            { name: 'Groq', fn: callGroq },\r\n            { name: 'DeepSeek', fn: callDeepSeek },\r\n            { name: 'OpenAI', fn: callOpenAI },\r\n            { name: 'Gemini', fn: callGemini } // Robust fallback\r\n        ]);\r\n\r\n        if (!response || response.trim() === \"\" || response.startsWith(\"[Swarm Failed]\")) {\r\n            console.error(\"Γ¥î [Pro Analysis] Invalid response:\", response);\r\n            throw new Error(response || \"Empty response from AI swarm\");\r\n        }\r\n\r\n        // Sanitize JSON if the AI wrap it in backticks\r\n        const cleaned = response.replace(/```json/g, '').replace(/```/g, '').trim();\r\n        return cleaned;\r\n\r\n    } catch (e: any) {\r\n        console.error(\"Γ¥î [Pro Analysis] Critical Error:\", e);\r\n        // Return clearer error for debugging\r\n        return `**Analysis Failed.** Debug Info: ${e.message}. (Check console for details)`;\r\n    }\r\n}\r\n\r\n// --- Data Repair Feature (Vision AI) ---\r\n\r\nconst urlToGenerativePart = async (url: string) => {\r\n    try {\r\n        // Proxy through Next.js simple fetch if needed, \r\n        // but for now try direct. OFF images usually allow CORS or we might need a server action.\r\n        // If direct fetch fails due to CORS, this feature might require a proxy route.\r\n        const response = await fetch(url);\r\n        if (!response.ok) throw new Error(\"Failed to fetch image\");\r\n\r\n        const blob = await response.blob();\r\n        const base64EncodedDataPromise = new Promise<string>((resolve) => {\r\n            const reader = new FileReader();\r\n            reader.onloadend = () => resolve((reader.result as string).split(',')[1]);\r\n            reader.readAsDataURL(blob);\r\n        });\r\n\r\n        return {\r\n            inlineData: {\r\n                data: await base64EncodedDataPromise,\r\n                mimeType: blob.type || \"image/jpeg\",\r\n            },\r\n        };\r\n    } catch (e) {\r\n        console.error(\"Image conversion failed\", e);\r\n        return null;\r\n    }\r\n};\r\n\r\nexport const repairProductMetadata = async (imageUrl: string, currentName: string): Promise<{ name: string, brand: string } | null> => {\r\n    if (!GEMINI_API_KEY) return null;\r\n    if (!imageUrl || imageUrl.includes('placeholder')) return null;\r\n\r\n    try {\r\n        // 1. Get Image Data\r\n        const imagePart = await urlToGenerativePart(imageUrl);\r\n        if (!imagePart) return null;\r\n\r\n        // 2. Prompt Gemini 1.5 Flash (Multimodal)\r\n        // 2. Prompt Gemini 1.5 Flash (Multimodal)\r\n        const genAI = await getGeminiClient();\r\n        const prompt = `\r\n            Look at this product package.\r\n            Extract the exact **Brand Name** and **Product Name** written on the packaging.\r\n            Identify if the current name \"${currentName}\" is generic or incorrect.\r\n            \r\n            Return JSON ONLY:\r\n            {\r\n                \"brand\": \"Exact Brand\",\r\n                \"name\": \"Exact Product Name\"\r\n            }\r\n        `;\r\n\r\n        let result;\r\n\r\n        try {\r\n            const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\r\n            result = await model.generateContent([prompt, imagePart]);\r\n        } catch (e: any) {\r\n            if (e.message.includes('404') || e.message.includes('not found')) {\r\n                console.warn(\"ΓÜá∩╕Å 'gemini-1.5-flash' alias failed, trying 'gemini-1.5-flash-latest'\");\r\n                const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash-latest\" });\r\n                result = await model.generateContent([prompt, imagePart]);\r\n            } else {\r\n                throw e;\r\n            }\r\n        }\r\n        const response = result.response.text();\r\n        const cleaned = response.replace(/```json/g, '').replace(/```/g, '').trim();\r\n        return JSON.parse(cleaned);\r\n\r\n    } catch (error) {\r\n        console.error(\"AI Data Repair Failed:\", error);\r\n        return null;\r\n    }\r\n};\r\n\r\n// --- IRL Quest Generation ---\r\n\r\nexport interface Quest {\r\n    id: string;\r\n    title: string;\r\n    description: string;\r\n    difficulty: 'easy' | 'medium' | 'hard';\r\n    type: 'social' | 'physical' | 'mindfulness' | 'creative';\r\n    completed: boolean;\r\n    createdAt: Date;\r\n}\r\n\r\nexport const generateLogoutQuest = async (userName: string, recentQuests: string[]): Promise<Quest | null> => {\r\n    const prompt = `\r\n    You are a health and nutrition coach assistant for \"TruthLens\", a food scanning app.\r\n    Generate a meaningful, actionable health-related objective for the user \"${userName}\" before they leave.\r\n    \r\n    REQUIREMENTS:\r\n    - The quest MUST be related to health, nutrition, hydration, or wellness.\r\n    - It should be doable in < 10 minutes or be a daily goal.\r\n    - Be specific and practical (e.g., \"Drink a full glass of water right now\", \"Eat a piece of fruit\", \"Check the ingredients on your next snack before eating\").\r\n    - Make it encouraging and positive.\r\n    - Avoid these recently given quests: ${recentQuests.join(', ')}.\r\n    - Choose difficulty: easy (quick action), medium (requires some effort), hard (commitment throughout day).\r\n    - Choose type: \r\n      * physical (exercise, movement)\r\n      * mindfulness (mental health, stress relief)\r\n      * social (share health tips, cook with family)\r\n      * creative (try new healthy recipe, food presentation)\r\n\r\n    GOOD EXAMPLES:\r\n    - \"Hydration Check\" - Drink 2 glasses of water before your next meal\r\n    - \"Label Detective\" - Read the ingredient list on 3 products in your pantry\r\n    - \"Fruit Boost\" - Eat a fresh fruit within the next hour\r\n    - \"Sugar Awareness\" - Avoid added sugars for the rest of the day\r\n    - \"Veggie Victory\" - Include vegetables in your next meal\r\n\r\n    BAD EXAMPLES (DO NOT GENERATE THESE):\r\n    - \"Whisper to a wall\" - nonsensical\r\n    - \"High five a plant\" - not health related\r\n    - \"Dance like nobody's watching\" - not nutrition focused\r\n\r\n    Return JSON ONLY:\r\n    {\r\n        \"title\": \"Short Title (2-4 words)\",\r\n        \"description\": \"Clear, specific health-related instruction\",\r\n        \"difficulty\": \"easy/medium/hard\",\r\n        \"type\": \"social/physical/mindfulness/creative\"\r\n    }\r\n    `;\r\n\r\n    try {\r\n        // Prefer Groq for speed (Llama 3.3)\r\n        const text = await getSwarmResponse(prompt, [\r\n            { name: 'Groq', fn: callGroq },\r\n            { name: 'SambaNova', fn: callSambaNova },\r\n            { name: 'Gemini', fn: callGemini }\r\n        ]);\r\n\r\n        const cleaned = text.replace(/```json/g, '').replace(/```/g, '').trim();\r\n        const data = JSON.parse(cleaned);\r\n\r\n        return {\r\n            id: Date.now().toString(),\r\n            title: data.title,\r\n            description: data.description,\r\n            difficulty: data.difficulty,\r\n            type: data.type,\r\n            completed: false,\r\n            createdAt: new Date()\r\n        };\r\n\r\n    } catch (e) {\r\n        console.error(\"Quest Generation Error:\", e);\r\n        // Fallback Quest - still health-focused\r\n        return {\r\n            id: 'fallback-' + Date.now(),\r\n            title: 'Hydration Boost',\r\n            description: 'Drink a full glass of water right now. Your body will thank you!',\r\n            difficulty: 'easy',\r\n            type: 'physical',\r\n            completed: false,\r\n            createdAt: new Date()\r\n        };\r\n    }\r\n};\r\n\r\nexport const analyzeProductWithSwarm = async (productName: string, ingredients: string[], nutriments: any) => {\r\n    const prompt = `Analyze: ${productName}, Ingredients: ${ingredients.join(', ')}. Return JSON: {grade, summary, pros, cons, healthScore}`;\r\n    const text = await getSwarmResponse(prompt);\r\n    return JSON.parse(text.replace(/```json/g, '').replace(/```/g, '').trim()) as AIAnalysis;\r\n};\r\nexport const analyzeProductWithGemini = analyzeProductWithSwarm;\r\nexport const analyzeProductWithGroq = analyzeProductWithSwarm;\r\n// Enhanced Tier-Aware Analysis\r\nexport const analyzeProductByTier = async (tier: UserTier, name: string, ing: string[], nutr: any): Promise<AIAnalysis> => {\r\n    // 1. Define Tier-Specific Prompts\r\n    let depthInstruction = \"Provide a brief 2-sentence summary. List 3 key pros and 3 key cons.\";\r\n    let persona = \"helpful nutrition assistant\";\r\n\r\n    if (tier === 'plus') {\r\n        depthInstruction = \"Provide a detailed paragraph summary. List 5 detailed pros and 5 cons. Focus on additives severity.\";\r\n        persona = \"expert dietician\";\r\n    } else if (tier === 'pro' || tier === 'ultimate') {\r\n        depthInstruction = \"Provide a comprehensive, critical analysis (2 paragraphs). List 5-7 detailed pros and cons. rigorous health scoring.\";\r\n        persona = \"senior food scientist and toxicologist\";\r\n    }\r\n\r\n    const prompt = `\r\n        Role: You are a ${persona}.\r\n        Analyze this product: \"${name}\".\r\n        Ingredients: ${ing.join(', ')}.\r\n        Nutriments: ${JSON.stringify(nutr)}.\r\n\r\n        Task:\r\n        ${depthInstruction}\r\n        Calculate a Health Score (0-100) based on ingredients quality and nutritional density.\r\n        Determine a letter grade (A, B, C, D, E).\r\n\r\n        Return JSON ONLY:\r\n        {\r\n            \"grade\": \"A/B/C/D/E\",\r\n            \"summary\": \"string\",\r\n            \"pros\": [\"string\", ...],\r\n            \"cons\": [\"string\", ...],\r\n            \"healthScore\": number\r\n        }\r\n    `;\r\n\r\n    try {\r\n        // Use Swarm with Tier-Appropriate Power\r\n        // Pro/Ultimate get the smartest models racing. Free gets efficient ones.\r\n        let providers = [];\r\n        if (tier === 'free') {\r\n            providers = [{ name: 'Gemini', fn: callGemini }, { name: 'Groq', fn: callGroq }];\r\n        } else {\r\n            // Plus/Pro get access to DeepSeek/OpenAI/Cerebras\r\n            providers = [\r\n                { name: 'Groq', fn: callGroq },\r\n                { name: 'DeepSeek', fn: callDeepSeek },\r\n                { name: 'Gemini', fn: callGemini }\r\n            ];\r\n        }\r\n\r\n        const text = await getSwarmResponse(prompt, providers);\r\n        const cleaned = text.replace(/```json/g, '').replace(/```/g, '').trim();\r\n        return JSON.parse(cleaned) as AIAnalysis;\r\n\r\n    } catch (e: any) {\r\n        console.error(\"Tiered Analysis Error:\", e);\r\n        // Fallback to simple analysis if advanced fails\r\n        if (tier !== 'free') return analyzeProductByTier('free', name, ing, nutr);\r\n        throw e;\r\n    }\r\n};\r\n\r\n\r\nexport const generateDynamicGreeting = async (userName: string, timeOfDay: 'morning' | 'afternoon' | 'evening' | 'late_night'): Promise<string> => {\r\n    const prompt = `\r\n        You are a witty, friendly AI assistant for a food scanning app called \"TruthLens\".\r\n        The user has opened the app during the **${timeOfDay.replace('_', ' ')}**.\r\n\r\n        Generate a SHORT, engaging 1-sentence greeting.\r\n        Constraints:\r\n        - If 'late_night' (00:00-06:00): Be humorous, ask why they are up, mention late-night snacking, or tell them to sleep. (e.g. \"Scanning snacks at 3AM? I won't judge... much. ≡ƒìò\")\r\n        - If regular time: Friendly and brief.\r\n        - Max 15 words.\r\n        - Include an emoji.\r\n        - Do NOT include the user's name.\r\n        - Return just the plain text string. No quotes.\r\n    `;\r\n\r\n    try {\r\n        // Use Groq for speed/wit, Gemini as fallback\r\n        const text = await getSwarmResponse(prompt, [\r\n            { name: 'Groq', fn: callGroq },\r\n            { name: 'Gemini', fn: callGemini }\r\n        ]);\r\n        return text.replace(/\"/g, '').trim();\r\n    } catch (e) {\r\n        console.error(\"Greeting Gen Error\", e);\r\n        return \"\"; // Fallback will handle it\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\externalProductService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FOODB_BASE_URL' is assigned a value but never used.","line":13,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1325,1328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1325,1328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'query' is defined but never used.","line":54,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":40}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { searchProducts } from './productService';\r\n\r\n/**\r\n * Service to handle external product databases (USDA, FooDB, etc.)\r\n * This acts as an aggregator for product data outside of OpenFoodFacts.\r\n */\r\n\r\n// Placeholder for USDA API Key (should be in env vars)\r\nconst USDA_API_KEY = process.env.NEXT_PUBLIC_USDA_API_KEY || 'DEMO_KEY';\r\nconst USDA_BASE_URL = 'https://api.nal.usda.gov/fdc/v1';\r\n\r\n// Placeholder for FooDB (no public API easily accessible without key/download, but simulating structure)\r\nconst FOODB_BASE_URL = 'https://foodb.ca/api/v1';\r\n\r\nexport interface ExternalProductResult {\r\n    id: string;\r\n    name: string;\r\n    brand: string;\r\n    image: string;\r\n    source: 'usda' | 'foodb' | 'off' | 'generic';\r\n    grade?: string;\r\n}\r\n\r\n/**\r\n * Search USDA FoodData Central\r\n */\r\nexport const searchUSDA = async (query: string): Promise<ExternalProductResult[]> => {\r\n    try {\r\n        if (!query) return [];\r\n        // Note: USDA search determines foods, but often lacks brand/image data compared to OFF.\r\n        // This is a fallback.\r\n        const response = await fetch(`${USDA_BASE_URL}/foods/search?api_key=${USDA_API_KEY}&query=${encodeURIComponent(query)}&pageSize=3`);\r\n\r\n        if (!response.ok) return [];\r\n\r\n        const data = await response.json();\r\n        return data.foods.map((food: any) => ({\r\n            id: `usda-${food.fdcId}`,\r\n            name: food.description,\r\n            brand: food.brandOwner || 'Unknown',\r\n            image: '', // USDA rarely provides public image URLs directly in search list\r\n            source: 'usda',\r\n            grade: undefined // USDA doesn't have Nutri-Score\r\n        }));\r\n    } catch (error) {\r\n        console.error(\"USDA Search Error:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\n/**\r\n * Search FooDB (Mock/Placeholder as FooDB works differently)\r\n */\r\nexport const searchFooDB = async (query: string): Promise<ExternalProductResult[]> => {\r\n    // FooDB doesn't have a standard open CORS-friendly API for simple search without setup.\r\n    // We will leave this as a stub that can be expanded if the user provides a specific endpoint or key.\r\n    return [];\r\n};\r\n\r\n/**\r\n * Meta-searcher that tries multiple sources\r\n */\r\nexport const searchAllSources = async (query: string): Promise<ExternalProductResult[]> => {\r\n    // 1. Try Open Food Facts (Best for images & grades)\r\n    const offResults = await searchProducts(query);\r\n    if (offResults.length > 0 && offResults[0].image) {\r\n        return offResults.map(p => ({\r\n            id: p.id,\r\n            name: p.name,\r\n            brand: p.brand,\r\n            image: p.image,\r\n            source: 'off',\r\n            grade: p.nutrition_grades\r\n        }));\r\n    }\r\n\r\n    // 2. Try USDA as fallback for data\r\n    const usdaResults = await searchUSDA(query);\r\n    if (usdaResults.length > 0) return usdaResults;\r\n\r\n    // 3. Fallback to generic OFF result even if no image, just to have data\r\n    if (offResults.length > 0) {\r\n        return offResults.map(p => ({\r\n            id: p.id,\r\n            name: p.name,\r\n            brand: p.brand,\r\n            image: p.image || '',\r\n            source: 'off',\r\n            grade: p.nutrition_grades\r\n        }));\r\n    }\r\n\r\n    return [];\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\external\\fdaService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[803,806],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[803,806],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[890,893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[890,893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1162,1165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1162,1165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport axios from 'axios';\r\nimport { EnhancedProductData } from '@/services/productMapper';\r\n\r\nconst FDA_API_URL = 'https://api.fda.gov/drug/label.json';\r\n\r\nexport const searchFDA = async (query: string): Promise<EnhancedProductData[]> => {\r\n    try {\r\n        // FDA API: search string e.g., search=openfda.brand_name:\"tylenol\"\r\n        // We use a broader search on brand_name or generic_name\r\n        const searchQuery = `openfda.brand_name:\"${query}\"+OR+openfda.generic_name:\"${query}\"`;\r\n\r\n        const response = await axios.get(FDA_API_URL, {\r\n            params: {\r\n                search: searchQuery,\r\n                limit: 5\r\n            },\r\n            timeout: 5000 // 5s timeout\r\n        });\r\n\r\n        if (response.data.results) {\r\n            return response.data.results.map((item: any) => mapFDAToEnhanced(item));\r\n        }\r\n\r\n        return [];\r\n    } catch (error: any) {\r\n        // FDA API returns 404 for no results, which is normal\r\n        if (error.response?.status !== 404) {\r\n            console.error('[FDA Service] Search error:', error.message);\r\n        }\r\n        return [];\r\n    }\r\n};\r\n\r\nconst mapFDAToEnhanced = (fdaItem: any): EnhancedProductData => {\r\n    const openfda = fdaItem.openfda || {};\r\n    const brand = openfda.brand_name?.[0] || 'Unknown Brand';\r\n    const generic = openfda.generic_name?.[0] || '';\r\n    const name = generic ? `${brand} (${generic})` : brand;\r\n    const id = openfda.product_ndc?.[0] || fdaItem.id || 'fda_unknown';\r\n\r\n    return {\r\n        id: `fda_${id}`,\r\n        identity: {\r\n            name: name,\r\n            brand: openfda.manufacturer_name?.[0] || 'Unknown Manufacturer',\r\n            barcode: openfda.upc?.[0] || '', // Often missing in FDA open data\r\n            category: 'Medicine',\r\n            description: fdaItem.purpose?.[0] || fdaItem.indications_and_usage?.[0] || 'FDA Approved Medicine'\r\n        },\r\n        // FDA doesn't provide images directly in this endpoint\r\n        media: {\r\n            front_image: '/images/placeholder-medicine.png', // Fallback\r\n            thumbnail: '/images/placeholder-medicine.png'\r\n        },\r\n        grades: {\r\n            nutri_score: '?',\r\n            eco_score: '?',\r\n            processing_score: '?'\r\n        },\r\n        nutrition: { nutriments_raw: {} }, // Not applicable\r\n        sensory_profile: { flavors: [] },\r\n        ingredients: [],\r\n        source: 'FDA' // Custom field used for UI handling if needed\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\external\\foodbService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2084,2087],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2084,2087],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport axios from 'axios';\r\nimport { ProductData } from '../productService';\r\n\r\nconst FOODB_API_KEY = process.env.NEXT_PUBLIC_FOODB_API_KEY || 'DEMO_KEY';\r\nconst FOODB_API_URL = 'https://foodb.ca/api/v1';\r\n\r\nexport const fetchFromFooDB = async (barcode: string): Promise<ProductData | null> => {\r\n    // Note: FooDB public API access can be sporadic or require specific auth headers depending on the plan.\r\n    // This implementation assumes a standard structure similar to other food databases.\r\n\r\n    if (!FOODB_API_KEY) {\r\n        console.warn('FooDB API Key missing. Skipping FooDB fetch.');\r\n        return null;\r\n    }\r\n\r\n    try {\r\n        console.log(`[FooDB] Fetching data for barcode: ${barcode}`);\r\n\r\n        // Hypothetical endpoint - Foodb docs vary on public availability of barcode search\r\n        // We will try a search by string first if barcode lookups aren't direct, \r\n        // but for exact match we usually need an ID or direct mapping.\r\n        // Assuming a standard search endpoint:\r\n        const response = await axios.get(`${FOODB_API_URL}/foods/search`, {\r\n            params: {\r\n                query: barcode,\r\n                apikey: FOODB_API_KEY\r\n            }\r\n        });\r\n\r\n        // Since we don't have a real FooDB key yet and endpoint might be different, \r\n        // we'll structure this defensively.\r\n        if (response.data && response.data.foods && response.data.foods.length > 0) {\r\n            const food = response.data.foods[0];\r\n\r\n            // Map to our structure\r\n            return {\r\n                id: String(food.id),\r\n                name: food.name,\r\n                brand: food.brand || 'Unknown',\r\n                image: food.images?.[0]?.url || '',\r\n                ingredients: [], // FooDB is compound-focused, simplified here\r\n                nutrition_grades: 'unknown',\r\n                nutriments: {}, // Would need comprehensive mapping\r\n                description: food.description || 'FooDB Entry',\r\n                source: 'FooDB'\r\n            };\r\n        }\r\n        return null;\r\n\r\n    } catch (error: any) {\r\n        // Suppress errors for demo purposes as key is likely invalid\r\n        console.log(`[FooDB] Fetch failed or skipped: ${error.message}`);\r\n        return null;\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\favoriteService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[386,389],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[386,389],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[481,484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[481,484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from '@/lib/firebase';\r\nimport { collection, doc, setDoc, deleteDoc, getDocs, getDoc, serverTimestamp, query, orderBy } from 'firebase/firestore';\r\nimport { EnhancedProductData } from '@/app/actions';\r\n\r\n// Define Favorite Item type\r\nexport interface FavoriteItem {\r\n    id: string; // Product ID\r\n    name: string;\r\n    image?: string;\r\n    brand?: string;\r\n    addedAt: any;\r\n}\r\n\r\nexport const addToFavorites = async (userId: string, product: EnhancedProductData | any) => {\r\n    const ref = doc(db, 'users', userId, 'favorites', product.id);\r\n\r\n    // Normalize data\r\n    const data: FavoriteItem = {\r\n        id: product.id,\r\n        name: product.identity?.name || product.product_name || 'Unknown Product',\r\n        image: product.media?.thumbnail || product.image_front_small_url || '',\r\n        brand: product.identity?.brand || product.brands || '',\r\n        addedAt: serverTimestamp(),\r\n    };\r\n\r\n    await setDoc(ref, data);\r\n};\r\n\r\nexport const removeFromFavorites = async (userId: string, productId: string) => {\r\n    const ref = doc(db, 'users', userId, 'favorites', productId);\r\n    await deleteDoc(ref);\r\n};\r\n\r\nexport const getFavorites = async (userId: string): Promise<FavoriteItem[]> => {\r\n    const q = query(collection(db, 'users', userId, 'favorites'), orderBy('addedAt', 'desc'));\r\n    const snapshot = await getDocs(q);\r\n    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as FavoriteItem));\r\n};\r\n\r\nexport const checkIsFavorite = async (userId: string, productId: string): Promise<boolean> => {\r\n    const ref = doc(db, 'users', userId, 'favorites', productId);\r\n    const snap = await getDoc(ref);\r\n    return snap.exists();\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\githubModelsService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PCComponent' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":68,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseError' is defined but never used.","line":132,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":132,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * GitHub Models Service\r\n * Communicates with GitHub Models API for PC build intelligence (replaces Azure ML)\r\n * Uses OpenAI-compatible API format\r\n */\r\n\r\nimport { getSystemSettings } from './systemService';\r\nimport { PCComponent, PCBuildMetrics, GrokBuildResponse, PCBuildComponents, HardwareInput } from '@/types/pcBuilder';\r\n\r\nconst GITHUB_MODELS_ENDPOINT = 'https://models.github.ai/inference/chat/completions';\r\nconst DEFAULT_MODEL = 'openai/gpt-4.1';\r\n\r\n/**\r\n * Make a request to GitHub Models API\r\n */\r\nasync function callGitHubModels(\r\n    messages: { role: string; content: string }[],\r\n    maxTokens: number = 2000\r\n): Promise<string> {\r\n    const settings = await getSystemSettings();\r\n    const token = settings.apiKeys?.githubModelsToken;\r\n    const model = settings.apiKeys?.githubModelsModel || DEFAULT_MODEL;\r\n\r\n    if (!token) {\r\n        throw new Error('GitHub Models API not configured. Please set the token in Admin Settings.');\r\n    }\r\n\r\n    const response = await fetch(GITHUB_MODELS_ENDPOINT, {\r\n        method: 'POST',\r\n        headers: {\r\n            'Accept': 'application/vnd.github+json',\r\n            'Authorization': `Bearer ${token}`,\r\n            'X-GitHub-Api-Version': '2022-11-28',\r\n            'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n            model,\r\n            messages,\r\n            max_tokens: maxTokens,\r\n            temperature: 0.7\r\n        })\r\n    });\r\n\r\n    if (!response.ok) {\r\n        const errorText = await response.text();\r\n        console.error('[GitHub Models] API Error:', response.status, errorText);\r\n        throw new Error(`GitHub Models API error: ${response.status}`);\r\n    }\r\n\r\n    const data = await response.json();\r\n    return data.choices?.[0]?.message?.content || '';\r\n}\r\n\r\n/**\r\n * Generate a PC build recommendation using GitHub Models (GPT-4.1 / Grok-style)\r\n */\r\nexport async function generateBuildWithGitHubModels(\r\n    mode: 'budget' | 'hardware',\r\n    input: { budget?: number; existingHardware?: HardwareInput }\r\n): Promise<GrokBuildResponse> {\r\n    const systemPrompt = `You are a professional PC hardware expert and system builder. \r\nYou analyze hardware compatibility, calculate bottlenecks, and recommend optimal builds.\r\nAlways respond with valid JSON only, no markdown formatting.`;\r\n\r\n    // Format the existing hardware object into a clear list\r\n    const hardwareList = input.existingHardware\r\n        ? Object.entries(input.existingHardware)\r\n            .filter(([_, value]) => value && value.trim() !== '')\r\n            .map(([key, value]) => `- ${key.toUpperCase()}: ${value}`)\r\n            .join('\\n')\r\n        : 'None specified';\r\n\r\n    const userPrompt = mode === 'budget'\r\n        ? `User has a budget of $${input.budget} USD for a complete PC build.\r\nRecommend the best components (CPU, GPU, RAM, Motherboard, PSU, Case, Storage, Cooler) that:\r\n1. Minimize CPU-GPU bottleneck\r\n2. Maximize gaming/workstation performance\r\n3. Stay within budget\r\n4. Are currently available to purchase\r\n\r\nRespond ONLY with this JSON structure:\r\n{\r\n  \"cpu\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"cores\": 8, \"threads\": 16, \"baseClock\": \"3.5GHz\"}},\r\n  \"gpu\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"vram\": \"12GB\", \"architecture\": \"...\"}},\r\n  \"ram\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"capacity\": \"32GB\", \"speed\": \"DDR5-6000\"}},\r\n  \"motherboard\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"socket\": \"AM5\", \"chipset\": \"...\"}},\r\n  \"psu\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"wattage\": 750, \"rating\": \"80+ Gold\"}},\r\n  \"case\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"formFactor\": \"ATX\"}},\r\n  \"storage\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"capacity\": \"1TB\", \"type\": \"NVMe SSD\"}},\r\n  \"cooler\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"type\": \"Tower\", \"tdp\": 250}},\r\n  \"bottleneckScore\": 5,\r\n  \"estimatedWattage\": 550,\r\n  \"reasoning\": \"Brief explanation of choices\"\r\n}`\r\n        : `User ALREADY OWNS the following hardware:\r\n${hardwareList}\r\n\r\nRecommend compatible components to COMPLETE the build.\r\nRULES:\r\n1. DO NOT recommend components that the user already has (unless the existing one is incompatible/garbage, then explain why).\r\n2. Ensure 100% compatibility (Socket, Chipset, Dimension, PSU wattage).\r\n3. Minimize bottleneck.\r\n\r\nRespond ONLY with this JSON structure (omit components the user already has):\r\n{\r\n  \"cpu\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"gpu\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"ram\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"motherboard\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"psu\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"case\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"storage\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"cooler\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"bottleneckScore\": 10,\r\n  \"estimatedWattage\": 600,\r\n  \"reasoning\": \"Brief explanation\"\r\n}`;\r\n\r\n    const content = await callGitHubModels([\r\n        { role: 'system', content: systemPrompt },\r\n        { role: 'user', content: userPrompt }\r\n    ]);\r\n\r\n    // Clean and parse JSON response\r\n    const cleanedJson = content\r\n        .replace(/```json/gi, '')\r\n        .replace(/```/g, '')\r\n        .trim();\r\n\r\n    try {\r\n        return JSON.parse(cleanedJson) as GrokBuildResponse;\r\n    } catch (parseError) {\r\n        console.error('[GitHub Models] Failed to parse response:', cleanedJson);\r\n        throw new Error('Failed to parse AI response. Please try again.');\r\n    }\r\n}\r\n\r\n/**\r\n * Calculate bottleneck score for a given set of components\r\n */\r\nexport async function calculateBottleneckWithGitHubModels(\r\n    components: PCBuildComponents\r\n): Promise<PCBuildMetrics> {\r\n    const systemPrompt = `You are a PC hardware bottleneck analyzer. Analyze component pairings and estimate performance metrics. Respond only in JSON.`;\r\n\r\n    const userPrompt = `Analyze this PC build for CPU-GPU bottleneck and power consumption:\r\n\r\n${JSON.stringify(components, null, 2)}\r\n\r\nRespond with this JSON only:\r\n{\r\n  \"bottleneckScore\": 0-100 (lower is better, 0=perfect balance),\r\n  \"estimatedWattage\": total system power draw in watts,\r\n  \"performanceScore\": 0-100 (overall performance rating),\r\n  \"compatibilityIssues\": [\"issue1\", \"issue2\"] or empty array\r\n}`;\r\n\r\n    try {\r\n        const content = await callGitHubModels([\r\n            { role: 'system', content: systemPrompt },\r\n            { role: 'user', content: userPrompt }\r\n        ], 500);\r\n\r\n        const cleanedJson = content.replace(/```json/gi, '').replace(/```/g, '').trim();\r\n        const parsed = JSON.parse(cleanedJson);\r\n\r\n        return {\r\n            bottleneckScore: parsed.bottleneckScore ?? 10,\r\n            estimatedWattage: parsed.estimatedWattage ?? 500,\r\n            performanceScore: parsed.performanceScore,\r\n            compatibilityIssues: parsed.compatibilityIssues || []\r\n        };\r\n    } catch (error) {\r\n        console.error('[GitHub Models] Bottleneck calculation failed:', error);\r\n        // Fallback estimation\r\n        return {\r\n            bottleneckScore: 15,\r\n            estimatedWattage: 550,\r\n            compatibilityIssues: []\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Check if GitHub Models is configured and working\r\n */\r\nexport async function checkGitHubModelsHealth(): Promise<boolean> {\r\n    try {\r\n        const settings = await getSystemSettings();\r\n        if (!settings.apiKeys?.githubModelsToken) {\r\n            return false;\r\n        }\r\n\r\n        await callGitHubModels([\r\n            { role: 'user', content: 'Say \"OK\" only' }\r\n        ], 10);\r\n\r\n        return true;\r\n    } catch {\r\n        return false;\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\gradingService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'scoreToGrade' is defined but never used.","line":48,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { DietaryPreferences } from '@/types/user';\r\nimport { ProductData } from './productService';\r\n\r\n/**\r\n * Smart Grading Service - Personalized grading for Pro users\r\n * Adjusts product grades based on dietary preferences\r\n */\r\n\r\nexport interface SmartGradeResult {\r\n    grade: string; // A, B, C, D, E, F\r\n    score: number; // 0-100\r\n    reasons: string[];\r\n    warnings: string[];\r\n    isPersonalized: boolean;\r\n}\r\n\r\n/**\r\n * Calculate smart grade based on dietary preferences\r\n * Only available for Pro users\r\n */\r\nimport { calculateSmartGrade as advancedSmartGrade } from './smartGradingService';\r\n\r\nexport const calculateSmartGrade = (\r\n    product: ProductData,\r\n    preferences: DietaryPreferences\r\n): SmartGradeResult => {\r\n    return advancedSmartGrade(product, preferences);\r\n};\r\n\r\n/**\r\n * Convert letter grade to base score\r\n */\r\nfunction getBaseScore(grade: string): number {\r\n    const gradeMap: Record<string, number> = {\r\n        'A': 90,\r\n        'B': 75,\r\n        'C': 60,\r\n        'D': 45,\r\n        'E': 30,\r\n        '?': 50, // Unknown\r\n    };\r\n    return gradeMap[grade.toUpperCase()] || 50;\r\n}\r\n\r\n/**\r\n * Convert score to letter grade\r\n */\r\nfunction scoreToGrade(score: number): string {\r\n    if (score >= 85) return 'A';\r\n    if (score >= 70) return 'B';\r\n    if (score >= 55) return 'C';\r\n    if (score >= 40) return 'D';\r\n    if (score >= 25) return 'E';\r\n    return 'F';\r\n}\r\n\r\n/**\r\n * Get generic grade (for Free users)\r\n */\r\nexport const getGenericGrade = (product: ProductData): SmartGradeResult => {\r\n    const baseScore = getBaseScore(product.nutrition_grades);\r\n\r\n    return {\r\n        grade: product.nutrition_grades,\r\n        score: baseScore,\r\n        reasons: ['Standard nutrition grade from Open Food Facts'],\r\n        warnings: [],\r\n        isPersonalized: false,\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\groqService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PCComponent' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2363,2366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2363,2366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":96,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseError' is defined but never used.","line":160,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":160,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Groq Service\r\n * Fallback AI provider for PC build intelligence\r\n */\r\n\r\nimport { getSystemSettings } from './systemService';\r\nimport { PCComponent, PCBuildMetrics, GrokBuildResponse, PCBuildComponents, HardwareInput } from '@/types/pcBuilder';\r\nimport axios from 'axios';\r\n\r\nconst GROQ_API_URL = 'https://api.groq.com/openai/v1/chat/completions';\r\nconst DEFAULT_MODEL = 'llama3-8b-8192';\r\n\r\nimport { adminDb } from '@/lib/firebaseAdmin';\r\n\r\n/**\r\n * Make a request to Groq API\r\n */\r\nasync function callGroq(\r\n    messages: { role: string; content: string }[],\r\n    maxTokens: number = 2000\r\n): Promise<string> {\r\n\r\n    // ...\r\n\r\n    const settings = await getSystemSettings();\r\n    let token = process.env.GROQ_API_KEY || process.env.NEXT_PUBLIC_GROQ_API_KEY;\r\n    let model = DEFAULT_MODEL;\r\n\r\n    // 1. Check Secure Admin Secrets First (Server-Side Only)\r\n    if (adminDb) {\r\n        try {\r\n            const secretDoc = await adminDb.collection('_system_secrets').doc('api_keys').get();\r\n            if (secretDoc.exists) {\r\n                const secrets = secretDoc.data();\r\n                if (secrets?.groq) {\r\n                    token = secrets.groq;\r\n                    console.log('[Groq] Using Secure Admin Key');\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.warn('[Groq] Failed to fetch admin secrets:', e);\r\n        }\r\n    }\r\n\r\n    // 2. Fallback to Public/Legacy Settings (Admin overrides)\r\n    if (!token && settings.apiKeys?.groq) {\r\n        token = settings.apiKeys.groq;\r\n    }\r\n    if (settings.apiKeys?.models?.groq) {\r\n        model = settings.apiKeys.models.groq;\r\n    }\r\n\r\n    if (!token) {\r\n        throw new Error('Groq API Key not configured.');\r\n    }\r\n\r\n    try {\r\n        const response = await axios.post(\r\n            GROQ_API_URL,\r\n            {\r\n                model,\r\n                messages,\r\n                max_tokens: maxTokens,\r\n                temperature: 0.7,\r\n                response_format: { type: \"json_object\" } // Force JSON mode if supported, or rely on prompt\r\n            },\r\n            {\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                }\r\n            }\r\n        );\r\n\r\n        return response.data.choices?.[0]?.message?.content || '';\r\n    } catch (error: any) {\r\n        console.error('[Groq] API Error:', error.response?.status, error.response?.data || error.message);\r\n        throw new Error(`Groq API error: ${error.response?.status || 'Unknown'}`);\r\n    }\r\n}\r\n\r\n/**\r\n * Generate a PC build recommendation using Groq\r\n */\r\nexport async function generateBuildWithGroq(\r\n    mode: 'budget' | 'hardware',\r\n    input: { budget?: number; existingHardware?: HardwareInput }\r\n): Promise<GrokBuildResponse> {\r\n    const systemPrompt = `You are a professional PC hardware expert and system builder. \r\nYou analyze hardware compatibility, calculate bottlenecks, and recommend optimal builds.\r\nAlways respond with valid JSON only, no markdown formatting.`;\r\n\r\n    // Format the existing hardware object into a clear list\r\n    const hardwareList = input.existingHardware\r\n        ? Object.entries(input.existingHardware)\r\n            .filter(([_, value]) => value && value.trim() !== '')\r\n            .map(([key, value]) => `- ${key.toUpperCase()}: ${value}`)\r\n            .join('\\n')\r\n        : 'None specified';\r\n\r\n    const userPrompt = mode === 'budget'\r\n        ? `User has a budget of $${input.budget} USD for a complete PC build.\r\nRecommend the best components (CPU, GPU, RAM, Motherboard, PSU, Case, Storage, Cooler) that:\r\n1. Minimize CPU-GPU bottleneck\r\n2. Maximize gaming/workstation performance\r\n3. Stay within budget\r\n4. Are currently available to purchase\r\n\r\nRespond ONLY with this JSON structure:\r\n{\r\n  \"cpu\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"cores\": 8, \"threads\": 16, \"baseClock\": \"3.5GHz\"}},\r\n  \"gpu\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"vram\": \"12GB\", \"architecture\": \"...\"}},\r\n  \"ram\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"capacity\": \"32GB\", \"speed\": \"DDR5-6000\"}},\r\n  \"motherboard\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"socket\": \"AM5\", \"chipset\": \"...\"}},\r\n  \"psu\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"wattage\": 750, \"rating\": \"80+ Gold\"}},\r\n  \"case\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"formFactor\": \"ATX\"}},\r\n  \"storage\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"capacity\": \"1TB\", \"type\": \"NVMe SSD\"}},\r\n  \"cooler\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {\"type\": \"Tower\", \"tdp\": 250}},\r\n  \"bottleneckScore\": 5,\r\n  \"estimatedWattage\": 550,\r\n  \"reasoning\": \"Brief explanation of choices\"\r\n}`\r\n        : `User ALREADY OWNS the following hardware:\r\n${hardwareList}\r\n\r\nRecommend compatible components to COMPLETE the build.\r\nRULES:\r\n1. DO NOT recommend components that the user already has (unless the existing one is incompatible/garbage, then explain why).\r\n2. Ensure 100% compatibility (Socket, Chipset, Dimension, PSU wattage).\r\n3. Minimize bottleneck.\r\n\r\nRespond ONLY with this JSON structure (omit components the user already has):\r\n{\r\n  \"cpu\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"gpu\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"ram\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"motherboard\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"psu\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"case\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"storage\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"cooler\": {\"name\": \"Model Name\", \"brand\": \"Brand\", \"specifications\": {...}},\r\n  \"bottleneckScore\": 10,\r\n  \"estimatedWattage\": 600,\r\n  \"reasoning\": \"Brief explanation\"\r\n}`;\r\n\r\n    const content = await callGroq([\r\n        { role: 'system', content: systemPrompt },\r\n        { role: 'user', content: userPrompt }\r\n    ]);\r\n\r\n    // Clean and parse JSON response\r\n    const cleanedJson = content\r\n        .replace(/```json/gi, '')\r\n        .replace(/```/g, '')\r\n        .trim();\r\n\r\n    try {\r\n        return JSON.parse(cleanedJson) as GrokBuildResponse;\r\n    } catch (parseError) {\r\n        console.error('[Groq] Failed to parse response:', cleanedJson);\r\n        throw new Error('Failed to parse AI response from Groq.');\r\n    }\r\n}\r\n\r\n/**\r\n * Calculate bottleneck score for a given set of components using Groq\r\n */\r\nexport async function calculateBottleneckWithGroq(\r\n    components: PCBuildComponents\r\n): Promise<PCBuildMetrics> {\r\n    const systemPrompt = `You are a PC hardware bottleneck analyzer. Analyze component pairings and estimate performance metrics. Respond only in JSON.`;\r\n    const userPrompt = `Analyze this PC build for CPU-GPU bottleneck and power consumption:\r\n${JSON.stringify(components, null, 2)}\r\nRespond with this JSON only:\r\n{\r\n  \"bottleneckScore\": 0-100 (lower is better, 0=perfect balance),\r\n  \"estimatedWattage\": total system power draw in watts,\r\n  \"performanceScore\": 0-100 (overall performance rating),\r\n  \"compatibilityIssues\": [\"issue1\", \"issue2\"] or empty array\r\n}`;\r\n\r\n    try {\r\n        const content = await callGroq([\r\n            { role: 'system', content: systemPrompt },\r\n            { role: 'user', content: userPrompt }\r\n        ], 500);\r\n\r\n        const cleanedJson = content.replace(/```json/gi, '').replace(/```/g, '').trim();\r\n        const parsed = JSON.parse(cleanedJson);\r\n\r\n        return {\r\n            bottleneckScore: parsed.bottleneckScore ?? 10,\r\n            estimatedWattage: parsed.estimatedWattage ?? 500,\r\n            performanceScore: parsed.performanceScore,\r\n            compatibilityIssues: parsed.compatibilityIssues || []\r\n        };\r\n    } catch (error) {\r\n        console.error('[Groq] Bottleneck calculation failed:', error);\r\n        return {\r\n            bottleneckScore: 15,\r\n            estimatedWattage: 550,\r\n            compatibilityIssues: []\r\n        };\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\historyService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[639,642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[639,642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PRODUCTS_COLLECTION' is assigned a value but never used.","line":31,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FREE_USER_HISTORY_LIMIT' is assigned a value but never used.","line":33,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3308,3311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3308,3311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from '@/lib/firebase';\r\nimport {\r\n    collection,\r\n    addDoc,\r\n    getDocs,\r\n    deleteDoc,\r\n    doc,\r\n    query,\r\n    where,\r\n    orderBy,\r\n    limit as firestoreLimit,\r\n    serverTimestamp,\r\n    Timestamp\r\n} from 'firebase/firestore';\r\nimport { UserTier, getTierFeatures } from '@/types/user';\r\nimport { triggerRecommendationAdded, triggerRecommendationRemoved } from './recommendationService';\r\n\r\nexport interface HistoryItem {\r\n    id?: string;\r\n    userId: string;\r\n    type: 'scan' | 'search';\r\n    title: string;\r\n    grade?: string; // A, B, C, D, E\r\n    productId?: string;\r\n    imageUrl?: string;\r\n    createdAt?: any;\r\n}\r\n\r\n// Collection References\r\nconst HISTORY_COLLECTION = 'history';\r\nconst PRODUCTS_COLLECTION = 'products';\r\n\r\nconst FREE_USER_HISTORY_LIMIT = 10;\r\n\r\n/**\r\n * Add an item to the user's history (prevents duplicates)\r\n */\r\nexport const addToHistory = async (userId: string, item: Omit<HistoryItem, 'userId' | 'createdAt'>) => {\r\n    try {\r\n        // Check for duplicates first if productId is present\r\n        if (item.productId) {\r\n            const q = query(\r\n                collection(db, HISTORY_COLLECTION),\r\n                where(\"userId\", \"==\", userId),\r\n                where(\"productId\", \"==\", item.productId),\r\n                where(\"type\", \"==\", item.type), // Also match type (scan vs search) or maybe just productId? logic says if I scan it again, I want ittop.\r\n                firestoreLimit(1)\r\n            );\r\n\r\n            const existingDocs = await getDocs(q);\r\n\r\n            if (!existingDocs.empty) {\r\n                // Update existing document\r\n                const docId = existingDocs.docs[0].id;\r\n                console.log('[HistoryService] ΓÖ╗∩╕Å Found duplicate, updating timestamp for:', docId);\r\n                const docRef = doc(db, HISTORY_COLLECTION, docId);\r\n                await import('firebase/firestore').then(({ updateDoc }) =>\r\n                    updateDoc(docRef, {\r\n                        createdAt: serverTimestamp(),\r\n                        // Update title/grade in case they changed (e.g. better data fetched)\r\n                        title: item.title,\r\n                        grade: item.grade ?? null,\r\n                        imageUrl: item.imageUrl ?? null\r\n                    })\r\n                );\r\n                return docId;\r\n            }\r\n        }\r\n\r\n        const historyData = {\r\n            userId,\r\n            ...item,\r\n            grade: item.grade ?? null, // Ensure undefined is converted to null\r\n            createdAt: serverTimestamp(),\r\n        };\r\n\r\n        // Remove undefined fields to prevent Firebase errors\r\n        Object.keys(historyData).forEach(key => {\r\n            if (historyData[key as keyof typeof historyData] === undefined) {\r\n                delete historyData[key as keyof typeof historyData];\r\n            }\r\n        });\r\n\r\n        const docRef = await addDoc(collection(db, HISTORY_COLLECTION), historyData);\r\n\r\n        // TRIGGER: Update Recommendations if this is a new \"bad\" item\r\n        // Don't await this, let it run in background\r\n        triggerRecommendationAdded(userId, {\r\n            title: item.title,\r\n            grade: item.grade || undefined,\r\n            imageUrl: item.imageUrl // Pass image URL for instant enrichment\r\n        }).catch((err: any) => console.error(\"Trigger Failed:\", err));\r\n\r\n        return docRef.id;\r\n    } catch (error) {\r\n        console.error(\"Error adding history: \", error);\r\n        throw error;\r\n    }\r\n};\r\n\r\n/**\r\n * Fetch history for a specific user (all items, no limit)\r\n */\r\nexport const getUserHistory = async (userId: string) => {\r\n    try {\r\n        const q = query(\r\n            collection(db, HISTORY_COLLECTION),\r\n            where(\"userId\", \"==\", userId),\r\n            orderBy(\"createdAt\", \"desc\")\r\n        );\r\n\r\n        const querySnapshot = await getDocs(q);\r\n        return querySnapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data(),\r\n            // Convert Timestamp to readable date if needed, or keep as object\r\n            createdAt: (doc.data().createdAt as Timestamp)?.toDate()\r\n        })) as HistoryItem[];\r\n    } catch (error) {\r\n        console.error(\"Error fetching history: \", error);\r\n        return []; // Return empty on error to avoid crashing UI\r\n    }\r\n};\r\n\r\n/**\r\n * Fetch history with tier-based limits\r\n * Free users: max 10 items\r\n * Pro users: unlimited\r\n */\r\nexport const getUserHistoryWithLimit = async (userId: string, tier: UserTier) => {\r\n    try {\r\n        console.log('[HistoryService] ≡ƒôÑ Fetching history for userId:', userId, 'Tier:', tier);\r\n        const features = getTierFeatures(tier);\r\n        const limitCnt = features.historyLimit;\r\n\r\n        let q;\r\n\r\n        if (limitCnt !== -1) {\r\n            // Limited history\r\n            console.log('[HistoryService] ≡ƒöÆ Tier limited to', limitCnt, 'items');\r\n            q = query(\r\n                collection(db, HISTORY_COLLECTION),\r\n                where(\"userId\", \"==\", userId),\r\n                orderBy(\"createdAt\", \"desc\"),\r\n                firestoreLimit(limitCnt)\r\n            );\r\n        } else {\r\n            // Unlimited\r\n            console.log('[HistoryService] ≡ƒÆÄ Unlimited history access');\r\n            q = query(\r\n                collection(db, HISTORY_COLLECTION),\r\n                where(\"userId\", \"==\", userId),\r\n                orderBy(\"createdAt\", \"desc\")\r\n            );\r\n        }\r\n\r\n        console.log('[HistoryService] ≡ƒöì Executing Firestore query...');\r\n        const querySnapshot = await getDocs(q);\r\n        console.log('[HistoryService] Γ£à Query complete. Docs found:', querySnapshot.size);\r\n\r\n        const items = querySnapshot.docs.map(doc => {\r\n            const data = doc.data();\r\n            // console.log('[HistoryService] ≡ƒôä Doc:', doc.id, 'Data:', data);\r\n            return {\r\n                id: doc.id,\r\n                ...data,\r\n                createdAt: (data.createdAt as Timestamp)?.toDate()\r\n            };\r\n        }) as HistoryItem[];\r\n\r\n        const result = {\r\n            items,\r\n            hasMore: limitCnt !== -1 && items.length >= limitCnt,\r\n            limit: limitCnt !== -1 ? limitCnt : null,\r\n        };\r\n\r\n        console.log('[HistoryService] ≡ƒôè Returning:', result.items.length, 'items, hasMore:', result.hasMore);\r\n        return result;\r\n    } catch (error) {\r\n        console.error(\"[HistoryService] Γ¥î ERROR fetching history:\", error);\r\n        if (error instanceof Error) {\r\n            console.error('[HistoryService] Error name:', error.name);\r\n            console.error('[HistoryService] Error message:', error.message);\r\n            console.error('[HistoryService] Error stack:', error.stack);\r\n        }\r\n        return { items: [], hasMore: false, limit: null };\r\n    }\r\n};\r\n\r\n\r\n\r\n/**\r\n * Delete a history item\r\n */\r\nexport const deleteHistoryItem = async (itemId: string, userId?: string) => {\r\n    try {\r\n        const docRef = doc(db, HISTORY_COLLECTION, itemId);\r\n\r\n        // 1. Get doc data before deletion to trigger Side Effects\r\n        const snapshot = await import('firebase/firestore').then(({ getDoc }) => getDoc(docRef));\r\n        const data = snapshot.exists() ? snapshot.data() : null;\r\n\r\n        await deleteDoc(docRef);\r\n\r\n        // 2. Trigger Recommendation Removal Sync\r\n        if (data && data.title && data.userId) {\r\n            // Use userId from doc if available, or passed param\r\n            const uid = data.userId || userId;\r\n            if (uid) {\r\n                triggerRecommendationRemoved(uid, data.title).catch(console.error);\r\n            }\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Error deleting history item: \", error);\r\n        throw error;\r\n    }\r\n};\r\n\r\n/**\r\n * Export history to CSV (Pro only)\r\n */\r\nexport const exportHistoryToCSV = async (userId: string): Promise<string> => {\r\n    try {\r\n        const history = await getUserHistory(userId);\r\n\r\n        // Create CSV header\r\n        let csv = 'Date,Type,Product Name,Grade\\n';\r\n\r\n        // Add rows\r\n        history.forEach(item => {\r\n            const date = item.createdAt ? new Date(item.createdAt).toLocaleDateString() : 'N/A';\r\n            const type = item.type;\r\n            const title = item.title.replace(/,/g, ';'); // Replace commas to avoid CSV issues\r\n            const grade = item.grade || 'N/A';\r\n            csv += `${date},${type},${title},${grade}\\n`;\r\n        });\r\n\r\n        return csv;\r\n    } catch (error) {\r\n        console.error(\"Error exporting to CSV: \", error);\r\n        throw error;\r\n    }\r\n};\r\n\r\n/**\r\n * Export history to PDF (Pro only)\r\n * Returns HTML string that can be converted to PDF client-side\r\n */\r\nexport const exportHistoryToPDF = async (userId: string): Promise<string> => {\r\n    try {\r\n        const history = await getUserHistory(userId);\r\n\r\n        // Create HTML for PDF generation\r\n        let html = `\r\n            <!DOCTYPE html>\r\n            <html>\r\n            <head>\r\n                <title>TruthLens History Export</title>\r\n                <style>\r\n                    body { font-family: Arial, sans-serif; margin: 40px; }\r\n                    h1 { color: #6C63FF; }\r\n                    table { width: 100%; border-collapse: collapse; margin-top: 20px; }\r\n                    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }\r\n                    th { background-color: #6C63FF; color: white; }\r\n                    tr:nth-child(even) { background-color: #f2f2f2; }\r\n                    .grade-A, .grade-B { color: green; font-weight: bold; }\r\n                    .grade-C { color: orange; font-weight: bold; }\r\n                    .grade-D, .grade-E { color: red; font-weight: bold; }\r\n                </style>\r\n            </head>\r\n            <body>\r\n                <h1>TruthLens - Scan & Search History</h1>\r\n                <p>Export Date: ${new Date().toLocaleDateString()}</p>\r\n                <table>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Date</th>\r\n                            <th>Type</th>\r\n                            <th>Product Name</th>\r\n                            <th>Grade</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n        `;\r\n\r\n        history.forEach(item => {\r\n            const date = item.createdAt ? new Date(item.createdAt).toLocaleDateString() : 'N/A';\r\n            const type = item.type === 'scan' ? 'Scan' : 'Search';\r\n            const title = item.title;\r\n            const grade = item.grade || 'N/A';\r\n            const gradeClass = grade !== 'N/A' ? `grade-${grade}` : '';\r\n\r\n            html += `\r\n                <tr>\r\n                    <td>${date}</td>\r\n                    <td>${type}</td>\r\n                    <td>${title}</td>\r\n                    <td class=\"${gradeClass}\">${grade}</td>\r\n                </tr>\r\n            `;\r\n        });\r\n\r\n        html += `\r\n                    </tbody>\r\n                </table>\r\n            </body>\r\n            </html>\r\n        `;\r\n\r\n        return html;\r\n    } catch (error) {\r\n        console.error(\"Error exporting to PDF: \", error);\r\n        throw error;\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\mealPlannerService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'where' is defined but never used.","line":2,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":51}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from '@/lib/firebase';\r\nimport { collection, addDoc, getDocs, query, where, orderBy, limit } from 'firebase/firestore';\r\nimport { generateMealPlan, MealPlanDay } from './aiService';\r\nimport { getUserHistory } from './historyService';\r\n\r\nexport const createWeeklyMealPlan = async (userId: string): Promise<MealPlanDay[]> => {\r\n    try {\r\n        // 1. Get User's Scanned Foods (Inventory)\r\n        const history = await getUserHistory(userId);\r\n        // Extract unique product names (last 30)\r\n        const inventory = Array.from(new Set(history.slice(0, 30).map(h => h.title)));\r\n\r\n        if (inventory.length < 5) {\r\n            // Not enough data fallback\r\n            inventory.push(\"Eggs\", \"Spinach\", \"Chicken Breast\", \"Rice\", \"Apples\");\r\n        }\r\n\r\n        console.log(\"≡ƒæ¿ΓÇì≡ƒì│ [MealPlanner] Generating plan with inventory:\", inventory);\r\n\r\n        // 2. Generate Plan with AI (Gemini/Sambanova)\r\n        const plan = await generateMealPlan(inventory);\r\n\r\n        if (plan) {\r\n            // 3. Save to Firestore (optional, if we want to retrieve it later)\r\n            await addDoc(collection(db, 'users', userId, 'meal_plans'), {\r\n                createdAt: new Date(),\r\n                plan: plan\r\n            });\r\n            return plan;\r\n        }\r\n\r\n        return [];\r\n    } catch (error) {\r\n        console.error(\"Error creating meal plan:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const getLatestMealPlan = async (userId: string): Promise<MealPlanDay[] | null> => {\r\n    try {\r\n        const q = query(\r\n            collection(db, 'users', userId, 'meal_plans'),\r\n            orderBy(\"createdAt\", \"desc\"),\r\n            limit(1)\r\n        );\r\n        const snapshot = await getDocs(q);\r\n        if (!snapshot.empty) {\r\n            return snapshot.docs[0].data().plan as MealPlanDay[];\r\n        }\r\n        return null;\r\n    } catch (error) {\r\n        console.error(\"Error fetching meal plan:\", error);\r\n        return null;\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\ollamaService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":37,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1268,1271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1268,1271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1774,1777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1774,1777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":97,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3465,3468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3465,3468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3816,3819],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3816,3819],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4184,4187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4184,4187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":165,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":165,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":212,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":212,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":317,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":317,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11400,11403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11400,11403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":319,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":319,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":333,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":333,"endColumn":19}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Ollama Service\r\n * Uses a self-hosted Ollama instance for LLM inference (free, unlimited)\r\n */\r\n\r\nimport axios from 'axios';\r\nimport { getSystemSettings } from './systemService';\r\n\r\n// Default Ollama URL (can be overridden in Admin settings)\r\nconst DEFAULT_OLLAMA_URL = 'http://20.199.129.203:11434';\r\n\r\nexport interface OllamaMessage {\r\n    role: 'system' | 'user' | 'assistant';\r\n    content: string;\r\n}\r\n\r\nexport interface OllamaResponse {\r\n    model: string;\r\n    created_at: string;\r\n    message: {\r\n        role: string;\r\n        content: string;\r\n    };\r\n    done: boolean;\r\n}\r\n\r\n/**\r\n * Get the configured Ollama URL from Admin settings or use default\r\n */\r\nconst getOllamaUrls = async (): Promise<{ primary: string; fallback?: string }> => {\r\n    try {\r\n        const settings = await getSystemSettings();\r\n        return {\r\n            primary: settings.apiKeys?.ollamaUrl || DEFAULT_OLLAMA_URL,\r\n            fallback: settings.apiKeys?.ollamaFallbackUrl\r\n        };\r\n    } catch (e) {\r\n        console.warn('[Ollama] Could not fetch settings, using default URL');\r\n        return { primary: DEFAULT_OLLAMA_URL };\r\n    }\r\n};\r\n\r\n/**\r\n * Execute a Proxy Request (Client-Side Only)\r\n */\r\nconst executeProxyRequest = async <T>(endpoint: string, payload: any): Promise<T> => {\r\n    try {\r\n        const { getAuth } = await import('firebase/auth');\r\n        const auth = getAuth();\r\n        const token = await auth.currentUser?.getIdToken();\r\n\r\n        if (!token) throw new Error('User must be logged in');\r\n\r\n        const response = await axios.post('/api/ollama', {\r\n            endpoint,\r\n            payload\r\n        }, {\r\n            headers: { 'Authorization': `Bearer ${token}` }\r\n        });\r\n\r\n        return response.data as T;\r\n    } catch (error: any) {\r\n        console.error('[Ollama Service] Proxy Error:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Helper to execute an Ollama request with fallback to secondary URL\r\n * Handles \"Proxy Routing\" for Client-Side execution to avoid Mixed Content errors (HTTPS -> HTTP)\r\n */\r\nconst executeWithFallback = async <T>(\r\n    operationName: string,\r\n    operation: (baseUrl: string) => Promise<T>\r\n): Promise<T> => {\r\n\r\n    // ---------------------------------------------------------------------------\r\n    // OPTIMIZATION: Environment-Aware Routing\r\n    // ---------------------------------------------------------------------------\r\n    if (typeof window !== 'undefined') {\r\n        // [CLIENT-SIDE] -> Go through Secure Proxy (/api/ollama)\r\n        // This prevents \"Mixed Content\" blocks on Vercel (HTTPS)\r\n        // console.log(`[Ollama] Client-Side Detected. Routing '${operationName}' via /api/ollama Proxy.`);\r\n\r\n        try {\r\n            const { getAuth } = await import('firebase/auth');\r\n            const auth = getAuth();\r\n            const token = await auth.currentUser?.getIdToken();\r\n\r\n            if (!token) throw new Error('Authentication required for AI features');\r\n\r\n            // We must throw here to ensure the caller (chatWithOllama, etc.) \r\n            // knows to use the proxy path. But since we can't easily \"redirect\" the closure 'operation',\r\n            // the callers (chatWithOllama etc) must handle the env check themselves using executeProxyRequest.\r\n            // This fallback is only if a caller FORGOT to check env.\r\n            throw new Error('Direct client-side execution not supported. Use executeProxyRequest.');\r\n        } catch (e: any) {\r\n            // Fall through? No, assume caller handles proxy.\r\n        }\r\n    }\r\n\r\n    // [SERVER-SIDE] -> Direct Connection (Fastest)\r\n    const urls = await getOllamaUrls();\r\n\r\n    try {\r\n        console.log(`[Ollama] ${operationName} -> Primary: ${urls.primary}`);\r\n        return await operation(urls.primary);\r\n    } catch (primaryError: any) {\r\n        console.warn(`[Ollama] Primary failed: ${primaryError.message}`);\r\n\r\n        // 2. Try Fallback if available\r\n        if (urls.fallback) {\r\n            console.log(`[Ollama] ${operationName} -> ΓÜá∩╕Å Switching to Fallback: ${urls.fallback}`);\r\n            try {\r\n                return await operation(urls.fallback);\r\n            } catch (fallbackError: any) {\r\n                console.error(`[Ollama] Fallback also failed: ${fallbackError.message}`);\r\n                throw fallbackError; // Throw final error\r\n            }\r\n        }\r\n\r\n        throw primaryError; // No fallback, throw original error\r\n    }\r\n};\r\n\r\n/**\r\n * Task-based model routing configuration\r\n * Maps task types to preferred models for optimal performance\r\n */\r\nexport const MODEL_ROUTING: Record<string, string> = {\r\n    'analysis': 'phi',           // Product/ingredient analysis - needs reasoning\r\n    'chat': 'stablelm2',         // AI Chat Assistant - conversational\r\n    'multilingual': 'qwen:1.8b', // French/Arabic translations\r\n    'quick': 'tinyllama',        // Fast suggestions, simple tasks\r\n    'general': 'llama3.2:1b'     // Default fallback\r\n};\r\n\r\n/**\r\n * Get the best model for a specific task type\r\n * Validates model is enabled, falls back to alternatives if not\r\n */\r\nexport const getModelForTask = async (taskType: keyof typeof MODEL_ROUTING): Promise<string> => {\r\n    const preferredModel = MODEL_ROUTING[taskType] || MODEL_ROUTING['general'];\r\n\r\n    try {\r\n        const settings = await getSystemSettings();\r\n        const enabledModels = settings.apiKeys?.ollamaModels || {};\r\n\r\n        // If preferred model is enabled, use it\r\n        if (enabledModels[preferredModel]) {\r\n            console.log(`[Ollama] Task '${taskType}' -> Using preferred model: ${preferredModel}`);\r\n            return preferredModel;\r\n        }\r\n\r\n        // Fallback: Find any enabled model from routing table\r\n        for (const [, model] of Object.entries(MODEL_ROUTING)) {\r\n            if (enabledModels[model]) {\r\n                console.log(`[Ollama] Task '${taskType}' -> Fallback to: ${model}`);\r\n                return model;\r\n            }\r\n        }\r\n\r\n        // Ultimate fallback\r\n        return await getPreferredModel();\r\n    } catch (e) {\r\n        console.warn(`[Ollama] getModelForTask error, using default: ${preferredModel}`);\r\n        return preferredModel;\r\n    }\r\n};\r\n\r\n/**\r\n * Get preferred model based on System Settings\r\n * Validates if the requested model is enabled by Admin.\r\n * If not, or if no model requested, returns the first enabled model.\r\n */\r\nexport const getPreferredModel = async (requestedModel?: string): Promise<string> => {\r\n    try {\r\n        const settings = await getSystemSettings();\r\n        const enabledModels = settings.apiKeys?.ollamaModels || {};\r\n        const defaultModel = settings.apiKeys?.defaultOllamaModel;\r\n        const availableModels = Object.keys(enabledModels).filter(m => enabledModels[m]);\r\n\r\n        // Default fallback if no config exists yet\r\n        const DEFAULT_MODEL = 'llama3.2:1b';\r\n\r\n        // 1. If specific model requested and enabled, use it\r\n        if (requestedModel && enabledModels[requestedModel]) {\r\n            return requestedModel;\r\n        }\r\n\r\n        // 2. If requested model is NOT enabled, try to find a fallback\r\n        if (requestedModel && !enabledModels[requestedModel]) {\r\n            console.warn(`[Ollama] Requested model '${requestedModel}' is disabled. Finding fallback...`);\r\n        }\r\n\r\n        // 3. Use Administrator's Default Preference if Valid\r\n        if (defaultModel && enabledModels[defaultModel]) {\r\n            return defaultModel;\r\n        }\r\n\r\n        // 4. Return best available model\r\n        if (availableModels.length > 0) {\r\n            // Priority list for smart defaults\r\n            const priority = ['llama3.2:1b', 'qwen:1.8b', 'gemma:2b', 'tinyllama'];\r\n            for (const p of priority) {\r\n                if (enabledModels[p]) return p;\r\n            }\r\n            return availableModels[0]; // Any enabled model\r\n        }\r\n\r\n        return DEFAULT_MODEL; // Fallback to hardcoded default if nothing configured\r\n    } catch (e) {\r\n        return requestedModel || 'llama3.2:1b';\r\n    }\r\n};\r\n\r\n/**\r\n * Chat completion using Ollama\r\n */\r\nexport const chatWithOllama = async (\r\n    prompt: string,\r\n    model?: string,\r\n    systemPrompt?: string\r\n): Promise<string> => {\r\n    const preferredModel = await getPreferredModel(model);\r\n    const messages: OllamaMessage[] = [];\r\n    if (systemPrompt) messages.push({ role: 'system', content: systemPrompt });\r\n    messages.push({ role: 'user', content: prompt });\r\n\r\n    // Client-Side Optimization: Use Proxy\r\n    if (typeof window !== 'undefined') {\r\n        const data = await executeProxyRequest<OllamaResponse>('/api/chat', {\r\n            model: preferredModel,\r\n            messages,\r\n            stream: false\r\n        });\r\n        if (data.message?.content) return data.message.content;\r\n        throw new Error('Empty response from Ollama Proxy');\r\n    }\r\n\r\n    return executeWithFallback('Chat', async (baseUrl) => {\r\n        const response = await axios.post<OllamaResponse>(\r\n            `${baseUrl}/api/chat`,\r\n            { model: preferredModel, messages, stream: false },\r\n            { timeout: 60000 }\r\n        );\r\n\r\n        if (response.data.message?.content) return response.data.message.content;\r\n        throw new Error('Empty response from Ollama');\r\n    });\r\n};\r\n\r\n/**\r\n * Chat completion using Ollama with full history (for AI Chat)\r\n */\r\nexport const chatWithOllamaMessages = async (\r\n    messages: { role: string; content: string }[],\r\n    model: string = 'llama3.2:1b'\r\n): Promise<string> => {\r\n    // Client-Side Optimization: Use Proxy\r\n    if (typeof window !== 'undefined') {\r\n        const data = await executeProxyRequest<OllamaResponse>('/api/chat', {\r\n            model,\r\n            messages,\r\n            stream: false\r\n        });\r\n        if (data.message?.content) return data.message.content;\r\n        throw new Error('Empty response from Ollama Proxy');\r\n    }\r\n\r\n    return executeWithFallback('Chat History', async (baseUrl) => {\r\n        const response = await axios.post<OllamaResponse>(\r\n            `${baseUrl}/api/chat`,\r\n            { model, messages, stream: false },\r\n            { timeout: 60000 }\r\n        );\r\n\r\n        if (response.data.message?.content) return response.data.message.content;\r\n        throw new Error('Empty response from Ollama');\r\n    });\r\n};\r\n\r\n/**\r\n * Simple generate endpoint (non-chat)\r\n */\r\nexport const generateWithOllama = async (\r\n    prompt: string,\r\n    model: string = 'llama3.2:1b'\r\n): Promise<string> => {\r\n    // Client-Side Optimization: Use Proxy\r\n    if (typeof window !== 'undefined') {\r\n        const data = await executeProxyRequest<{ response: string }>('/api/generate', {\r\n            model,\r\n            prompt,\r\n            stream: false\r\n        });\r\n        return data.response || '';\r\n    }\r\n\r\n    return executeWithFallback('Generate', async (baseUrl) => {\r\n        const response = await axios.post(\r\n            `${baseUrl}/api/generate`,\r\n            { model, prompt, stream: false },\r\n            { timeout: 60000 }\r\n        );\r\n        return response.data.response || '';\r\n    });\r\n};\r\n\r\n/**\r\n * List available models\r\n */\r\nexport const listOllamaModels = async (): Promise<string[]> => {\r\n    try {\r\n        return await executeWithFallback('List Models', async (baseUrl) => {\r\n            const response = await axios.get(`${baseUrl}/api/tags`);\r\n            return response.data.models?.map((m: any) => m.name) || [];\r\n        });\r\n    } catch (error) {\r\n        return [];\r\n    }\r\n};\r\n\r\n/**\r\n * Check if Ollama is available\r\n */\r\nexport const checkOllamaHealth = async (): Promise<boolean> => {\r\n    try {\r\n        return await executeWithFallback('Health Check', async (baseUrl) => {\r\n            const response = await axios.get(`${baseUrl}/api/tags`, { timeout: 5000 });\r\n            return response.status === 200;\r\n        });\r\n    } catch (error) {\r\n        return false;\r\n    }\r\n};\r\n\r\n// ============================================\r\n// TASK-SPECIFIC CONVENIENCE FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Chat optimized for product/ingredient analysis\r\n * Uses 'phi' model for reasoning capabilities\r\n */\r\nexport const chatForAnalysis = async (prompt: string, systemPrompt?: string): Promise<string> => {\r\n    const model = await getModelForTask('analysis');\r\n    return chatWithOllama(prompt, model, systemPrompt);\r\n};\r\n\r\n/**\r\n * Chat optimized for AI Assistant conversations\r\n * Uses 'stablelm2' for natural conversation flow\r\n */\r\nexport const chatForAssistant = async (prompt: string, systemPrompt?: string): Promise<string> => {\r\n    const model = await getModelForTask('chat');\r\n    return chatWithOllama(prompt, model, systemPrompt);\r\n};\r\n\r\n/**\r\n * Quick responses for simple tasks\r\n * Uses 'tinyllama' for fast inference\r\n */\r\nexport const chatForQuick = async (prompt: string): Promise<string> => {\r\n    const model = await getModelForTask('quick');\r\n    return chatWithOllama(prompt, model);\r\n};\r\n\r\n/**\r\n * Multilingual tasks (French, Arabic, etc.)\r\n * Uses 'qwen:1.8b' for language capabilities\r\n */\r\nexport const chatForMultilingual = async (prompt: string, systemPrompt?: string): Promise<string> => {\r\n    const model = await getModelForTask('multilingual');\r\n    return chatWithOllama(prompt, model, systemPrompt);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\paymentService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\pcBuilderService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'settings' is assigned a value but never used.","line":79,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":79,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":88,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3604,3607],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3604,3607],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3929,3932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3929,3932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'key' is assigned a value but never used.","line":149,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":149,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ghErr' is defined but never used.","line":174,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":174,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'gErr' is defined but never used.","line":179,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":179,"endColumn":26}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * PC Builder Service\r\n * Orchestrates build generation, price lookups, and storage\r\n */\r\n\r\nimport { db } from '@/lib/firebase';\r\nimport { adminDb } from '@/lib/firebaseAdmin';\r\nimport {\r\n    collection,\r\n    addDoc,\r\n    getDocs,\r\n    query,\r\n    where,\r\n    orderBy,\r\n    Timestamp,\r\n    doc,\r\n    deleteDoc,\r\n    limit\r\n} from 'firebase/firestore';\r\nimport { searchWithSearXNG } from './searxngService';\r\nimport { generateBuildWithGitHubModels, calculateBottleneckWithGitHubModels } from './githubModelsService';\r\nimport { generateBuildWithGroq, calculateBottleneckWithGroq } from './groqService';\r\nimport { getSystemSettings } from './systemService';\r\nimport { SavedBuild, PCComponent, GenerateBuildRequest, PCBuildComponents, PCBuildMetrics, GrokBuildResponse } from '@/types/pcBuilder';\r\n\r\nconst BUILDS_COLLECTION = 'pc_builds';\r\n\r\n/**\r\n * Fetch current price for a component using SearXNG\r\n */\r\nasync function fetchComponentPrice(\r\n    component: PCComponent,\r\n    location: string\r\n): Promise<{ price: number; source: string; url: string } | null> {\r\n    try {\r\n        const currencySymbol = location === 'USA' ? '$' : (location === 'Europe' ? 'Γé¼' : '$');\r\n        const query = `buy ${component.name} price ${location}`;\r\n\r\n        // Search \"general\" or \"shopping\" if available\r\n        const results = await searchWithSearXNG(query);\r\n\r\n        if (!results || results.length === 0) return null;\r\n\r\n        for (const result of results) {\r\n            // Check title and content for price\r\n            const text = `${result.title} ${result.content}`;\r\n\r\n            // Regex for price: $100, $100.00 (simple heuristic)\r\n            const priceRegex = new RegExp(`[${currencySymbol}]\\\\s?(\\\\d{1,3}(?:,\\\\d{3})*(?:\\\\.\\\\d{2})?)`, 'i');\r\n            const match = text.match(priceRegex);\r\n\r\n            if (match && match[1]) {\r\n                const priceStr = match[1].replace(/,/g, '');\r\n                const price = parseFloat(priceStr);\r\n\r\n                if (!isNaN(price) && price > 0) {\r\n                    return {\r\n                        price,\r\n                        source: result.engine || 'Web Search',\r\n                        url: result.url\r\n                    };\r\n                }\r\n            }\r\n        }\r\n\r\n    } catch (error) {\r\n        console.warn(`[PCBuilder] Failed to fetch price for ${component.name}:`, error);\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Generate a complete PC build\r\n */\r\nexport async function generatePCBuild(\r\n    userId: string,\r\n    request: GenerateBuildRequest\r\n): Promise<SavedBuild> {\r\n    const settings = await getSystemSettings();\r\n\r\n    // Get user's location preference from Firestore\r\n    let location = 'USA'; // Default fallback\r\n    try {\r\n        const userDoc = await adminDb?.collection('users').doc(userId).get();\r\n        const userData = userDoc?.data();\r\n        location = userData?.preferences?.location || 'USA';\r\n        console.log(`[PCBuilder] Using user location: ${location}`);\r\n    } catch (error) {\r\n        console.warn('[PCBuilder] Could not fetch user location, using default USD');\r\n    }\r\n\r\n    // ===== Step A: Generate build with GitHub Models (Fallback to Groq) =====\r\n    console.log('[PCBuilder] Step A: Consulting AI for build recommendations...');\r\n    let aiResponse: GrokBuildResponse;\r\n    const inputPayload = {\r\n        budget: request.budget,\r\n        existingHardware: request.existingHardware\r\n    };\r\n\r\n    try {\r\n        console.log('[PCBuilder] Trying GitHub Models...');\r\n        aiResponse = await generateBuildWithGitHubModels(request.mode, inputPayload);\r\n    } catch (githubError: any) {\r\n        console.warn(`[PCBuilder] GitHub Models failed (${githubError.message}). Falling back to Groq...`);\r\n        try {\r\n            aiResponse = await generateBuildWithGroq(request.mode, inputPayload);\r\n            console.log('[PCBuilder] Successfully generated build using Groq.');\r\n        } catch (groqError: any) {\r\n            console.error('[PCBuilder] All AI providers failed:', groqError.message);\r\n            // Throw the specific error message to help the user debug (e.g., \"Groq API Key not configured\")\r\n            throw new Error(`AI Service Error: ${groqError.message}`);\r\n        }\r\n    }\r\n\r\n    // Build components object with proper types\r\n    const components: PCBuildComponents = {};\r\n\r\n    if (aiResponse.cpu) {\r\n        components.cpu = { ...aiResponse.cpu, type: 'cpu' };\r\n    }\r\n    if (aiResponse.gpu) {\r\n        components.gpu = { ...aiResponse.gpu, type: 'gpu' };\r\n    }\r\n    if (aiResponse.ram) {\r\n        components.ram = { ...aiResponse.ram, type: 'ram' };\r\n    }\r\n    if (aiResponse.motherboard) {\r\n        components.motherboard = { ...aiResponse.motherboard, type: 'motherboard' };\r\n    }\r\n    if (aiResponse.psu) {\r\n        components.psu = { ...aiResponse.psu, type: 'psu' };\r\n    }\r\n    if (aiResponse.case) {\r\n        components.case = { ...aiResponse.case, type: 'case' };\r\n    }\r\n    if (aiResponse.storage) {\r\n        components.storage = { ...aiResponse.storage, type: 'storage' };\r\n    }\r\n    if (aiResponse.cooler) {\r\n        components.cooler = { ...aiResponse.cooler, type: 'cooler' };\r\n    }\r\n\r\n    // ===== Step B: Fetch prices via SearXNG =====\r\n    console.log('[PCBuilder] Step B: Fetching prices via SearXNG...');\r\n    let totalPrice = 0;\r\n\r\n    const componentEntries = Object.entries(components) as [keyof PCBuildComponents, PCComponent][];\r\n\r\n    for (const [key, component] of componentEntries) {\r\n        if (component) {\r\n            const priceData = await fetchComponentPrice(component, location);\r\n            if (priceData) {\r\n                component.price = priceData.price;\r\n                component.priceSource = priceData.source;\r\n                component.priceUrl = priceData.url;\r\n                totalPrice += priceData.price;\r\n            }\r\n        }\r\n    }\r\n\r\n    // ===== Step C: Calculate/verify bottleneck =====\r\n    console.log('[PCBuilder] Step C: Optimizing build metrics...');\r\n    let metrics: PCBuildMetrics = {\r\n        bottleneckScore: aiResponse.bottleneckScore ?? 10,\r\n        estimatedWattage: aiResponse.estimatedWattage ?? 500,\r\n        compatibilityIssues: [] as string[]\r\n    };\r\n\r\n    // If AI didn't provide metrics, calculate them\r\n    if (!aiResponse.bottleneckScore || !aiResponse.estimatedWattage) {\r\n        try {\r\n            const calculated = await calculateBottleneckWithGitHubModels(components);\r\n            metrics = { ...calculated, compatibilityIssues: calculated.compatibilityIssues || [] };\r\n        } catch (ghErr) {\r\n            console.warn('[PCBuilder] GitHub Models bottleneck calc failed, trying Groq...');\r\n            try {\r\n                const calculated = await calculateBottleneckWithGroq(components);\r\n                metrics = { ...calculated, compatibilityIssues: calculated.compatibilityIssues || [] };\r\n            } catch (gErr) {\r\n                console.warn('[PCBuilder] Bottleneck calculation failed entirely.');\r\n            }\r\n        }\r\n    }\r\n\r\n    // Create the build object\r\n    const build: SavedBuild = {\r\n        userId,\r\n        buildName: request.mode === 'budget'\r\n            ? `$${request.budget} Build`\r\n            : `Build for ${request.existingHardware}`,\r\n        buildType: request.mode,\r\n        components,\r\n        metrics,\r\n        totalPrice,\r\n        userInput: {\r\n            budget: request.budget,\r\n            existingHardware: request.existingHardware,\r\n            location\r\n        },\r\n        createdAt: new Date(),\r\n        updatedAt: new Date()\r\n    };\r\n\r\n    console.log('[PCBuilder] Build generated successfully:', build.buildName);\r\n    return build;\r\n}\r\n\r\n/**\r\n * Save a build to Firestore\r\n */\r\nexport async function saveBuild(build: SavedBuild): Promise<string> {\r\n    const docRef = await addDoc(collection(db, BUILDS_COLLECTION), {\r\n        ...build,\r\n        createdAt: Timestamp.fromDate(build.createdAt),\r\n        updatedAt: Timestamp.fromDate(build.updatedAt)\r\n    });\r\n    console.log('[PCBuilder] Build saved with ID:', docRef.id);\r\n    return docRef.id;\r\n}\r\n\r\n/**\r\n * Get user's saved builds\r\n */\r\nexport async function getUserBuilds(userId: string, maxBuilds: number = 20): Promise<SavedBuild[]> {\r\n    const q = query(\r\n        collection(db, BUILDS_COLLECTION),\r\n        where('userId', '==', userId),\r\n        orderBy('createdAt', 'desc'),\r\n        limit(maxBuilds)\r\n    );\r\n\r\n    const snapshot = await getDocs(q);\r\n    return snapshot.docs.map(docSnapshot => ({\r\n        id: docSnapshot.id,\r\n        ...docSnapshot.data(),\r\n        createdAt: docSnapshot.data().createdAt?.toDate() || new Date(),\r\n        updatedAt: docSnapshot.data().updatedAt?.toDate() || new Date()\r\n    })) as SavedBuild[];\r\n}\r\n\r\n/**\r\n * Delete a saved build\r\n */\r\nexport async function deleteBuild(buildId: string): Promise<void> {\r\n    await deleteDoc(doc(db, BUILDS_COLLECTION, buildId));\r\n    console.log('[PCBuilder] Build deleted:', buildId);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\productMapper.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1056,1059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1056,1059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2908,2911],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2908,2911],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Product Data Mapping Services\r\n// Separated from actions.ts to avoid 'Server Actions must be async' error\r\n\r\nexport interface EnhancedProductData {\r\n    id: string; // Keep top level for ID\r\n    identity: {\r\n        name: string;\r\n        brand: string;\r\n        barcode: string;\r\n        scientific_name?: string;\r\n        category: string;\r\n        description: string; // Moved details here\r\n    };\r\n    media: {\r\n        front_image: string;\r\n        thumbnail: string; // New field for search results\r\n        ingredients_image?: string;\r\n    };\r\n    grades: {\r\n        nutri_score: string; // A, B, C, D, E or ?\r\n        eco_score: string;   // A-E or number? keeping string for now\r\n        processing_score: string; // NOVA 1-4\r\n        quality_comment?: string;\r\n    };\r\n    nutrition: {\r\n        calories_100g?: number;\r\n        proteins_100g?: number;\r\n        carbs_100g?: number;\r\n        fat_100g?: number;\r\n        detailed_micros?: {\r\n            lycopene?: string;\r\n            potassium?: string;\r\n        };\r\n        nutriments_raw?: any;\r\n    };\r\n    sensory_profile: {\r\n        flavors: string[];\r\n        texture?: string;\r\n    };\r\n    // Flattened helpers for easier access during migration/search\r\n    // (Optional, but good practice to keep some top-level specific accessors if needed by existing generic components, \r\n    // but the user requested strict structure. I will implement getters or just strictly use the object.)\r\n    // For compatibility with components expecting 'ingredients', we might need to add it:\r\n    ingredients: string[];\r\n    source?: 'OFF' | 'FDA' | 'FooDB' | 'AI';\r\n\r\n    // Tech & Non-Food Fields\r\n    specs?: Record<string, string>; // e.g. { \"Processor\": \"M1\", \"RAM\": \"16GB\" }\r\n    analysis?: {\r\n        pros?: string[];\r\n        cons?: string[];\r\n        verdict?: string; // \"Buy\" | \"Pass\" | \"Wait\"\r\n        verdict_text?: string;\r\n        price_analysis?: string;\r\n        score?: number; // 0-100 for Tech Items\r\n    };\r\n}\r\n\r\n/**\r\n * ΓÜá∩╕Å DEVELOPER WARNING: IMAGE EXTRACTION CRITICAL\r\n * -----------------------------------------------------------------------------\r\n * When mapping OpenFoodFacts data, you MUST extract image fields from the API response.\r\n * \r\n * Image fields available in OpenFoodFacts JSON response:\r\n *   - product.image_front_small_url   Γ£à BEST for search bars (lightweight thumbnail)\r\n *   - product.image_small_url         Γ£à Alternative thumbnail\r\n *   - product.image_thumb_url         Γ£à Another thumbnail option\r\n *   - product.image_url               ΓÜá∩╕Å  Full size (slower, use as fallback)\r\n *   - product.image_front_url         ΓÜá∩╕Å  Full size front image\r\n * \r\n * The mapping below extracts these into media.thumbnail and media.front_image\r\n * -----------------------------------------------------------------------------\r\n */\r\n// Helper: Map OFF Data to New Schema\r\nexport const mapOpenFoodFactsToEnhanced = (product: any): EnhancedProductData => {\r\n    // 1. Identity\r\n    const categories = (product.categories_tags || []).map((c: string) =>\r\n        c.replace(/en:|fr:|es:/g, '').replace(/-/g, ' ')\r\n    ).filter((c: string) => c.length > 0);\r\n    const mainCategory = categories[0]\r\n        ? categories[0].charAt(0).toUpperCase() + categories[0].slice(1)\r\n        : 'General Grocery';\r\n\r\n    const brand = product.brands || (product.brands_tags && product.brands_tags.length > 0 ? product.brands_tags[0].replace('brand:', '') : 'Unknown Brand');\r\n\r\n    let description = product.generic_name;\r\n    if (!description || description.trim() === '') {\r\n        description = `A ${mainCategory.toLowerCase()} product`;\r\n        if (brand !== 'Unknown Brand') description += ` by ${brand}.`;\r\n    }\r\n\r\n    // 2. Grades\r\n    const nova = product.nova_group ? `NOVA ${product.nova_group}` : '?';\r\n    const nutri = product.nutrition_grades?.toUpperCase() || '?';\r\n    const eco = product.ecoscore_grade?.toUpperCase() || '?';\r\n\r\n    // 3. Nutrition (Basic mapping from OFF)\r\n    const nutrition = {\r\n        calories_100g: product.nutriments?.['energy-kcal_100g'] || product.nutriments?.['energy-kcal'],\r\n        proteins_100g: product.nutriments?.proteins_100g,\r\n        carbs_100g: product.nutriments?.carbohydrates_100g,\r\n        fat_100g: product.nutriments?.fat_100g,\r\n        nutriments_raw: product.nutriments\r\n    };\r\n\r\n    // DEBUG LOGGING FOR IMAGES\r\n    console.log(`[Image Debug] ${product.product_name}:`, {\r\n        url: product.image_url,\r\n        small: product.image_small_url,\r\n        front: product.image_front_url,\r\n        front_small: product.image_front_small_url,\r\n        thumb: product.image_thumb_url\r\n    });\r\n\r\n    return {\r\n        id: product._id,\r\n        identity: {\r\n            name: product.product_name || 'Unknown Product',\r\n            brand: brand,\r\n            barcode: product._id,\r\n            category: mainCategory,\r\n            description: description\r\n        },\r\n        media: {\r\n            // Prioritize high-res for Detail Page\r\n            front_image: product.image_url || product.image_front_url || product.image_small_url || '',\r\n            // Prioritize small/thumb for Search Results\r\n            thumbnail: product.image_small_url || product.image_front_small_url || product.image_thumb_url || product.image_front_thumb_url || product.image_url || '',\r\n            ingredients_image: product.image_ingredients_url || ''\r\n        },\r\n        grades: {\r\n            nutri_score: nutri,\r\n            eco_score: eco,\r\n            processing_score: nova\r\n        },\r\n        nutrition: nutrition,\r\n        sensory_profile: {\r\n            flavors: [], // Populated by FooDB ideally, or AI\r\n            texture: undefined\r\n        },\r\n        ingredients: product.ingredients_text ? [product.ingredients_text] : []\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\productService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[345,348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[345,348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1907,1910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1907,1910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":147,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5716,5719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5716,5719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import axios from 'axios';\r\nimport { fetchFromFooDB } from './external/foodbService';\r\n\r\nconst OFF_API_URL = 'https://world.openfoodfacts.org/api/v0/product';\r\n\r\nexport interface ProductData {\r\n    id: string;\r\n    name: string;\r\n    brand: string;\r\n    image: string;\r\n    ingredients: string[];\r\n    nutrition_grades: string;\r\n    nutriments: any;\r\n    description: string;\r\n    source?: 'OpenFoodFacts' | 'USDA' | 'FooDB' | 'Aggregated';\r\n}\r\n\r\nconst apiClient = axios.create();\r\n\r\n// Simple in-memory cache for demo purposes (clears on refresh)\r\n// In production, use localStorage or a dedicated caching library\r\nconst productCache: Map<string, { data: ProductData, timestamp: number }> = new Map();\r\nconst CACHE_DURATION = 1000 * 60 * 5; // 5 minutes\r\n\r\n/**\r\n * -----------------------------------------------------------------------------\r\n * DATA FETCHING STRATEGY\r\n * -----------------------------------------------------------------------------\r\n * \r\n * 1. PRIMARY SOURCE: Open Food Facts\r\n *    - Comprehensive product database\r\n *    - Free, no API key required\r\n *    - Provides: name, brand, image, ingredients, nutrition\r\n * \r\n * 2. FALLBACK: FooDB (Optional)\r\n *    - Tertiary source for products not in OFF\r\n *    - Requires API key\r\n * \r\n * 3. BRAND HANDLING:\r\n *    - If brand is missing/invalid, default to \"Unbranded Commodity\"\r\n * \r\n * -----------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * Helper: Check if a brand value is valid (not generic/missing)\r\n */\r\nconst isValidBrand = (brand: string | undefined | null): boolean => {\r\n    if (!brand) return false;\r\n    const normalized = brand.toLowerCase().trim();\r\n    const invalidBrands = ['unknown', 'generic', 'unknown brand', 'n/a', ''];\r\n    return !invalidBrands.includes(normalized);\r\n};\r\n\r\n/**\r\n * Helper: Extract English-first field from OFF product\r\n */\r\nconst getEnglishField = (product: any, field: string, fallback: string = ''): string => {\r\n    // Priority: field_en > field > fallback\r\n    const enField = `${field}_en`;\r\n    return product[enField] || product[field] || fallback;\r\n};\r\n\r\nexport const fetchProductData = async (barcode: string): Promise<ProductData | null> => {\r\n    // 1. Check Cache\r\n    const cached = productCache.get(barcode);\r\n    if (cached) {\r\n        const age = Date.now() - cached.timestamp;\r\n        if (age < CACHE_DURATION) {\r\n            console.log(`[ProductService] Serving ${barcode} from cache`);\r\n            return cached.data;\r\n        } else {\r\n            productCache.delete(barcode); // Expired\r\n        }\r\n    }\r\n\r\n    console.log(`[ProductService] Fetching ${barcode} from APIs...`);\r\n\r\n    try {\r\n        // 2. PRIMARY SOURCE: Open Food Facts\r\n        const offResponse = await apiClient.get(`${OFF_API_URL}/${barcode}.json`);\r\n        let productData: ProductData | null = null;\r\n\r\n        if (offResponse.data.status === 1) {\r\n            const product = offResponse.data.product;\r\n\r\n            // Extract English-prioritized fields\r\n            const productName = getEnglishField(product, 'product_name', 'Unknown Product');\r\n            const genericName = getEnglishField(product, 'generic_name', 'No description available.');\r\n\r\n            // Extract brand with tags fallback\r\n            let brand = product.brands || product.brands_tags?.[0] || '';\r\n\r\n            // Normalize brand\r\n            if (!isValidBrand(brand)) {\r\n                console.log(`[ProductService] Brand missing/invalid in OFF: \"${brand}\". Using default.`);\r\n                brand = 'Unbranded Commodity';\r\n            }\r\n\r\n            // Build product data from OFF\r\n            productData = {\r\n                id: product._id || barcode,\r\n                name: productName,\r\n                brand: brand,\r\n                image: product.image_url || product.image_front_url || '',\r\n                ingredients: product.ingredients_text ? [product.ingredients_text] : [],\r\n                nutrition_grades: product.nutrition_grades?.toUpperCase() || '?',\r\n                nutriments: product.nutriments || {},\r\n                description: genericName,\r\n                source: 'OpenFoodFacts'\r\n            };\r\n        }\r\n\r\n        // 3. Fallback to FooDB if OFF didn't find anything\r\n        if (!productData) {\r\n            const foodbResult = await fetchFromFooDB(barcode);\r\n            if (foodbResult) {\r\n                productData = { ...foodbResult, source: 'FooDB' };\r\n            }\r\n        }\r\n\r\n        // 4. Update Cache\r\n        if (productData) {\r\n            productCache.set(barcode, { data: productData, timestamp: Date.now() });\r\n            console.log(`[ProductService] Final Product: ${productData.brand} ΓåÆ ${productData.name} (Source: ${productData.source})`);\r\n        } else {\r\n            console.log(`[ProductService] No product data found for barcode: ${barcode}`);\r\n        }\r\n\r\n        return productData;\r\n\r\n    } catch (error) {\r\n        console.error(\"Error fetching product data:\", error);\r\n        return null;\r\n    }\r\n};\r\n\r\nexport const searchProducts = async (query: string): Promise<ProductData[]> => {\r\n    try {\r\n        console.log(`[ProductService] Searching for: ${query}`);\r\n        // Search API is currently only OFF. \r\n        // Aggregating search across multiple providers is complex (pagination, ranking).\r\n        // Added sort_by=unique_scans_n to prioritize popular products (likely to have images)\r\n        const response = await apiClient.get(`https://world.openfoodfacts.org/cgi/search.pl?search_terms=${encodeURIComponent(query)}&search_simple=1&action=process&json=1&sort_by=unique_scans_n&page_size=20`);\r\n\r\n        if (response.data.products) {\r\n            return response.data.products.map((product: any) => {\r\n                // Use English-first extraction\r\n                const productName = getEnglishField(product, 'product_name', 'Unknown Product');\r\n                const genericName = getEnglishField(product, 'generic_name', 'No description available.');\r\n                let brand = product.brands || product.brands_tags?.[0] || 'Unknown Brand';\r\n\r\n                // Normalize brand display\r\n                if (!isValidBrand(brand)) {\r\n                    brand = 'Unbranded Commodity';\r\n                }\r\n\r\n                return {\r\n                    id: product._id || product.code,\r\n                    name: productName,\r\n                    brand: brand,\r\n                    image: product.image_url || product.image_front_url || '',\r\n                    ingredients: product.ingredients_text ? [product.ingredients_text] : [],\r\n                    nutrition_grades: product.nutrition_grades?.toUpperCase() || '?',\r\n                    nutriments: product.nutriments || {},\r\n                    description: genericName,\r\n                    source: 'OpenFoodFacts' as const\r\n                };\r\n            }).filter((p: ProductData) => p.name !== 'Unknown Product');\r\n        }\r\n        return [];\r\n    } catch (error) {\r\n        console.error(\"[ProductService] Error searching products:\", error);\r\n        return [];\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\questService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'doc' is defined but never used.","line":4,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setDoc' is defined but never used.","line":11,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'QuestHistoryItem' is defined but never used.","line":13,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from '@/lib/firebase';\r\nimport {\r\n    collection,\r\n    doc,\r\n    addDoc,\r\n    getDocs,\r\n    query,\r\n    orderBy,\r\n    limit,\r\n    serverTimestamp,\r\n    setDoc\r\n} from 'firebase/firestore';\r\nimport { Quest, QuestHistoryItem } from '@/types/quest';\r\n\r\n/**\r\n * Saves a completed or skipped quest to the user's history.\r\n */\r\nexport const saveQuestHistory = async (userId: string, quest: Quest, action: 'completed' | 'skipped' | 'ignored') => {\r\n    try {\r\n        const historyRef = collection(db, `users/${userId}/questHistory`);\r\n        await addDoc(historyRef, {\r\n            questId: quest.id,\r\n            title: quest.title,\r\n            description: quest.description,\r\n            type: quest.type,\r\n            difficulty: quest.difficulty,\r\n            action: action,\r\n            timestamp: serverTimestamp()\r\n        });\r\n        console.log(`[QuestService] Saved quest history: ${action}`);\r\n    } catch (error) {\r\n        console.error(\"Error saving quest history:\", error);\r\n    }\r\n};\r\n\r\n/**\r\n * Fetches the user's last few quests to prevent repetition.\r\n */\r\nexport const getRecentQuests = async (userId: string, count: number = 5): Promise<string[]> => {\r\n    try {\r\n        const historyRef = collection(db, `users/${userId}/questHistory`);\r\n        const q = query(historyRef, orderBy('timestamp', 'desc'), limit(count));\r\n        const snapshot = await getDocs(q);\r\n\r\n        return snapshot.docs.map(doc => doc.data().title);\r\n    } catch (error) {\r\n        console.error(\"Error fetching recent quests:\", error);\r\n        return [];\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\recommendationService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'collection' is defined but never used.","line":2,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getSwarmRecommendations' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'searchExternalDatabases' is defined but never used.","line":4,"column":66,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":89},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'searchProducts' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ProductData' is defined but never used.","line":5,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserRecommendationsFunc' is defined but never used.","line":20,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2316,2319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2316,2319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2335,2338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2335,2338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is defined but never used.","line":281,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":281,"endColumn":52}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from '@/lib/firebase';\r\nimport { doc, getDoc, setDoc, collection, serverTimestamp, Timestamp } from 'firebase/firestore';\r\nimport { getUserHistory } from './historyService';\r\nimport { getSwarmRecommendations, getSwarmPairedRecommendations, searchExternalDatabases } from './aiService';\r\nimport { searchProducts, ProductData } from './productService';\r\n\r\nconst CACHE_DURATION_MS = 24 * 60 * 60 * 1000; // 24 hours\r\n\r\nexport interface Recommendation {\r\n    id: string; // Product ID or temporary ID\r\n    name: string;\r\n    brand: string;\r\n    description: string;\r\n    image: string;\r\n    grade: string;\r\n    reason: string; // Why AI suggested it\r\n    source: 'off' | 'external' | 'ai' | 'usda' | 'foodb' | 'generic'; // Expanded sources\r\n}\r\n\r\ninterface UserRecommendationsFunc {\r\n    items: Recommendation[];\r\n    lastUpdated: Date;\r\n}\r\n\r\n/**\r\n * Main function to get recommendations for a user.\r\n * Checks cache first, then generates new ones.\r\n */\r\nexport interface RecommendationPairResult {\r\n    id: string;\r\n    rejected: Recommendation;\r\n    recommended: Recommendation;\r\n}\r\n\r\n/**\r\n * Main function to get PAIRED recommendations for a user.\r\n */\r\nexport const getUserPairedRecommendations = async (userId: string): Promise<RecommendationPairResult[]> => {\r\n    try {\r\n        const userRecsRef = doc(db, 'users', userId, 'data', 'paired_recommendations');\r\n        const snapshot = await getDoc(userRecsRef);\r\n\r\n        if (snapshot.exists()) {\r\n            const data = snapshot.data();\r\n            const lastUpdated = (data.lastUpdated as Timestamp)?.toDate().getTime();\r\n            const now = Date.now();\r\n\r\n            if (now - lastUpdated < CACHE_DURATION_MS && data.items && data.items.length > 0) {\r\n                console.log('Γ£à [Recommendations] Returning cached pairs');\r\n                return data.items as RecommendationPairResult[];\r\n            }\r\n        }\r\n\r\n        console.log('≡ƒöä [Recommendations] Cache expired or missing. Generating new pairs...');\r\n        return await generateAndCachePairedRecommendations(userId);\r\n\r\n    } catch (error) {\r\n        console.error(\"Error getting paired recommendations:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\nimport { searchAllSources } from './externalProductService';\r\n\r\n// ... other imports\r\n\r\nconst enrichPair = async (pair: any, historyItems: any[] = []): Promise<RecommendationPairResult> => {\r\n    // A. Enrich Rejected Item\r\n    let rejectedItem: Recommendation = {\r\n        id: `rej-${Date.now()}-${Math.random()}`,\r\n        name: pair.rejected.name,\r\n        brand: pair.rejected.brand,\r\n        description: pair.rejected.reason,\r\n        image: '',\r\n        grade: 'E',\r\n        reason: pair.rejected.reason,\r\n        source: 'ai'\r\n    };\r\n\r\n    // 1. Try finding EXACT image in history (Best \"Real Photo\" source)\r\n    // Supports matching by exact name OR fuzzy if history item has image\r\n    const historyMatch = historyItems.find(h =>\r\n    (h.title.toLowerCase().includes(pair.rejected.name.toLowerCase()) ||\r\n        pair.rejected.name.toLowerCase().includes(h.title.toLowerCase()))\r\n    );\r\n\r\n    if (historyMatch && historyMatch.imageUrl) {\r\n        // Use the actual image from history (Scan/Search)\r\n        rejectedItem = { ...rejectedItem, image: historyMatch.imageUrl, name: historyMatch.title };\r\n        if (historyMatch.grade) rejectedItem.grade = historyMatch.grade;\r\n    } else {\r\n        // 2. If not in history or no image, Search External Sources (OFF, USDA, etc.)\r\n        // Try precise search first: Brand + Name\r\n        let searchResults = await searchAllSources(`${pair.rejected.brand} ${pair.rejected.name}`);\r\n\r\n        // If no results, try just Name (broader)\r\n        if (searchResults.length === 0) {\r\n            searchResults = await searchAllSources(pair.rejected.name);\r\n        }\r\n\r\n        if (searchResults.length > 0) {\r\n            const best = searchResults[0];\r\n            rejectedItem = {\r\n                ...rejectedItem,\r\n                id: best.id,\r\n                image: best.image,\r\n                grade: best.grade || 'E',\r\n                name: best.name,\r\n                source: best.source\r\n            };\r\n        }\r\n    }\r\n\r\n    // B. Enrich Recommended Item\r\n    let recommendedItem: Recommendation = {\r\n        id: `rec-${Date.now()}-${Math.random()}`,\r\n        name: pair.recommended.name,\r\n        brand: pair.recommended.brand,\r\n        description: pair.recommended.reason,\r\n        image: '',\r\n        grade: 'A',\r\n        reason: pair.recommended.reason,\r\n        source: 'ai'\r\n    };\r\n\r\n    // Search External Sources for the Good Item\r\n    let recResults = await searchAllSources(`${pair.recommended.brand} ${pair.recommended.name}`);\r\n\r\n    // If empty, try broader search to find SOMETHING to show\r\n    if (recResults.length === 0) {\r\n        // Try searching just the name\r\n        recResults = await searchAllSources(pair.recommended.name);\r\n    }\r\n\r\n    if (recResults.length > 0) {\r\n        // Filter: Prioritize items with REAL Brands over \"Unknown Brand\"\r\n        // Since we sort by popularity, usually the famous brand is top, but we double check.\r\n        const validBrandResults = recResults.filter(p =>\r\n            p.brand &&\r\n            !['unknown brand', 'unbranded commodity', 'generic'].includes(p.brand.toLowerCase())\r\n        );\r\n\r\n        // Use valid brand list if available, otherwise fallback to full list\r\n        const candidates = validBrandResults.length > 0 ? validBrandResults : recResults;\r\n\r\n        // Prefer items with images and good grades\r\n        const bestRec = candidates.find(p => p.image && ['a', 'b'].includes(p.grade?.toLowerCase() || ''))\r\n            || candidates.find(p => p.image) // At least has image\r\n            || candidates[0];\r\n\r\n        recommendedItem = {\r\n            ...recommendedItem,\r\n            id: bestRec.id,\r\n            name: bestRec.name,\r\n            brand: bestRec.brand,\r\n            image: bestRec.image,\r\n            grade: bestRec.grade || 'A',\r\n            source: bestRec.source\r\n        };\r\n    }\r\n\r\n    return {\r\n        id: `pair-${Date.now()}-${Math.random()}`,\r\n        rejected: rejectedItem,\r\n        recommended: recommendedItem\r\n    };\r\n}\r\n\r\nconst generateAndCachePairedRecommendations = async (userId: string): Promise<RecommendationPairResult[]> => {\r\n    try {\r\n        // 1. Get recent bad history\r\n        const history = await getUserHistory(userId);\r\n        const badItems = history.filter(h => ['d', 'e'].includes(h.grade?.toLowerCase() || ''));\r\n\r\n        if (badItems.length === 0) return [];\r\n\r\n        // 2. Prepare context for AI\r\n        const historyContext = badItems.slice(0, 10).map(h => `- ${h.title} (Grade: ${h.grade})`).join('\\n');\r\n\r\n        // 3. Get generic pairings from Swarm\r\n        const rawPairs = await getSwarmPairedRecommendations(historyContext);\r\n\r\n        // 4. Enrich them with real data\r\n        const enrichedPairs: RecommendationPairResult[] = [];\r\n        for (const pair of rawPairs) {\r\n            const enriched = await enrichPair(pair, history);\r\n            enrichedPairs.push(enriched);\r\n        }\r\n\r\n        // 5. Cache\r\n        if (enrichedPairs.length > 0) {\r\n            const userRecsRef = doc(db, 'users', userId, 'data', 'paired_recommendations');\r\n            await setDoc(userRecsRef, {\r\n                items: enrichedPairs,\r\n                lastUpdated: serverTimestamp()\r\n            });\r\n        }\r\n\r\n        return enrichedPairs;\r\n    } catch (e) {\r\n        console.error(\"Error generating pairs:\", e);\r\n        return [];\r\n    }\r\n};\r\n\r\n/**\r\n * TRIGGER: Called when a new item is added to history.\r\n * If grade is bad, generates a recommendation immediately.\r\n */\r\nexport const triggerRecommendationAdded = async (userId: string, historyItem: { title: string, grade?: string | null, imageUrl?: string }) => {\r\n    // Only process if it's potentially \"bad\" or unknown\r\n    const grade = historyItem.grade?.toLowerCase();\r\n    if (grade && ['a', 'b'].includes(grade)) return;\r\n\r\n    try {\r\n        console.log(`[RecTrigger] Generating pair for new bad item: ${historyItem.title}`);\r\n        const context = `- ${historyItem.title} (Grade: ${grade || 'Unknown'})`;\r\n        const pairs = await getSwarmPairedRecommendations(context);\r\n\r\n        if (pairs.length > 0) {\r\n            // Pass the single history item array to checking logic so it finds the image!\r\n            const mockHistoryList = [{\r\n                title: historyItem.title,\r\n                grade: historyItem.grade,\r\n                imageUrl: historyItem.imageUrl\r\n            }];\r\n            const newPair = await enrichPair(pairs[0], mockHistoryList);\r\n\r\n            // Fetch existing\r\n            const userRecsRef = doc(db, 'users', userId, 'data', 'paired_recommendations');\r\n            const snapshot = await getDoc(userRecsRef);\r\n            let existing: RecommendationPairResult[] = [];\r\n            if (snapshot.exists()) {\r\n                existing = snapshot.data().items || [];\r\n            }\r\n\r\n            // Prepend new pair\r\n            const updated = [newPair, ...existing].slice(0, 50);\r\n\r\n            await setDoc(userRecsRef, {\r\n                items: updated,\r\n                lastUpdated: serverTimestamp()\r\n            });\r\n            console.log(`[RecTrigger] Added new recommendation pair.`);\r\n        }\r\n    } catch (e) {\r\n        console.error(\"[RecTrigger] Error:\", e);\r\n    }\r\n};\r\n\r\n/**\r\n * TRIGGER: Called when an item is removed from history.\r\n * Removes associated recommendations.\r\n */\r\nexport const triggerRecommendationRemoved = async (userId: string, itemTitle: string) => {\r\n    try {\r\n        const userRecsRef = doc(db, 'users', userId, 'data', 'paired_recommendations');\r\n        const snapshot = await getDoc(userRecsRef);\r\n\r\n        if (snapshot.exists()) {\r\n            const existing: RecommendationPairResult[] = snapshot.data().items || [];\r\n            // Remove where rejected item name is similar to deleted item\r\n            const updated = existing.filter(p => !p.rejected.name.toLowerCase().includes(itemTitle.toLowerCase()));\r\n\r\n            if (updated.length !== existing.length) {\r\n                await setDoc(userRecsRef, {\r\n                    items: updated,\r\n                    lastUpdated: serverTimestamp()\r\n                });\r\n                console.log(`[RecTrigger] Removed ${existing.length - updated.length} pairs linked to \"${itemTitle}\".`);\r\n            }\r\n        }\r\n    } catch (e) {\r\n        console.error(\"[RecTrigger] Error removing pair:\", e);\r\n    }\r\n};\r\n\r\n/**\r\n * Deprecated: Generates fresh recommendations using AI Swarm and verifies against data sources.\r\n */\r\nexport const getUserRecommendations = async (userId: string): Promise<Recommendation[]> => {\r\n    return [];\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\scanService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FREE_DAILY_SCAN_LIMIT' is assigned a value but never used.","line":6,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from '@/lib/firebase';\r\nimport { collection, query, where, getCountFromServer, Timestamp } from 'firebase/firestore';\r\nimport { UserTier, getTierFeatures } from '@/types/user';\r\n\r\nconst HISTORY_COLLECTION = 'history';\r\nconst FREE_DAILY_SCAN_LIMIT = 5;\r\n\r\n/**\r\n * Check if the user has reached their daily scan limit\r\n */\r\nexport const checkScanLimit = async (userId: string, tier: UserTier): Promise<{ allowed: boolean, remaining: number, limit: number | null }> => {\r\n    const features = getTierFeatures(tier);\r\n    const limit = features.dailyScanLimit;\r\n\r\n    // Unlimited scans\r\n    if (limit === -1) {\r\n        return { allowed: true, remaining: 9999, limit: null };\r\n    }\r\n\r\n    try {\r\n        // Calculate start of today\r\n        const now = new Date();\r\n        const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n\r\n        const q = query(\r\n            collection(db, HISTORY_COLLECTION),\r\n            where('userId', '==', userId),\r\n            where('type', '==', 'scan'),\r\n            where('createdAt', '>=', Timestamp.fromDate(startOfDay))\r\n        );\r\n\r\n        const snapshot = await getCountFromServer(q);\r\n        const count = snapshot.data().count;\r\n\r\n        const remaining = Math.max(0, limit - count);\r\n\r\n        return {\r\n            allowed: count < limit,\r\n            remaining,\r\n            limit\r\n        };\r\n    } catch (error) {\r\n        console.error('Error checking scan limit:', error);\r\n        // Fail open if there's an error to not block users unnecessarily\r\n        return { allowed: true, remaining: 1, limit: limit };\r\n    }\r\n};\r\n\r\n/**\r\n * Get formatted remaining scans message\r\n */\r\nexport const getScanLimitMessage = (tier: UserTier, remaining: number): string => {\r\n    const features = getTierFeatures(tier);\r\n    if (features.dailyScanLimit === -1) return 'Unlimited scans';\r\n    if (remaining === 0) return 'Daily limit reached';\r\n    return `${remaining} daily scan${remaining === 1 ? '' : 's'} remaining`;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\searchAiService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":237,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8674,8677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8674,8677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport axios from 'axios';\r\nimport { EnhancedProductData } from '@/services/productMapper';\r\nimport { getSystemSettings } from './systemService';\r\n\r\n// Waterfall Priority:\r\n// 1. Azure VM (Ollama) - Local, Fast, Privacy (if available)\r\n// 2. GitHub Models - Reliable Cloud Fallback\r\n// 3. Groq - Performant Cloud Fallback\r\n\r\nconst OLLAMA_TIMEOUT = 3000; // 3s timeout for local VM to ensure speed\r\n\r\ninterface WebContext {\r\n    title?: string;\r\n    snippet?: string;\r\n    image?: string;\r\n    sourceUrl?: string;\r\n}\r\n\r\nexport async function generateProductInfoAI(query: string, webContext?: WebContext): Promise<EnhancedProductData | null> {\r\n    try {\r\n        console.log(`[SearchAI] Attempting to generate info for: ${query}${webContext ? ' (with Web Context)' : ''}`);\r\n\r\n        // 1. Try Azure VM (Ollama)\r\n        const ollamaResult = await tryOllama(query, webContext);\r\n        if (ollamaResult) return ollamaResult;\r\n\r\n        // 2. Try GitHub Models\r\n        const githubResult = await tryGitHubModels(query, webContext);\r\n        if (githubResult) return githubResult;\r\n\r\n        // 3. Try Groq\r\n        const groqResult = await tryGroq(query, webContext);\r\n        if (groqResult) return groqResult;\r\n\r\n        return null; // All failed\r\n    } catch (error) {\r\n        console.error('[SearchAI] All providers failed:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\n// --- Providers ---\r\n\r\nasync function tryOllama(query: string, context?: WebContext): Promise<EnhancedProductData | null> {\r\n    const settings = await getSystemSettings();\r\n    const ollamaUrl = process.env.NEXT_PUBLIC_OLLAMA_URL || settings.aiConfig?.ollamaUrl;\r\n\r\n    if (!ollamaUrl) return null;\r\n\r\n    try {\r\n        console.log('[SearchAI] Trying Ollama...');\r\n        const prompt = buildPrompt(query, context);\r\n\r\n        const response = await axios.post(`${ollamaUrl}/api/generate`, {\r\n            model: \"mistral\", // or configured model\r\n            prompt: prompt,\r\n            stream: false,\r\n            format: \"json\"\r\n        }, { timeout: OLLAMA_TIMEOUT });\r\n\r\n        if (response.data.response) {\r\n            return parseAIResponse(response.data.response, query, 'Azure AI (Ollama)', context?.image);\r\n        }\r\n    } catch (err) {\r\n        console.warn('[SearchAI] Ollama failed (skipping):', err);\r\n    }\r\n    return null;\r\n}\r\n\r\nasync function tryGitHubModels(query: string, context?: WebContext): Promise<EnhancedProductData | null> {\r\n    const settings = await getSystemSettings();\r\n    const token = settings.apiKeys?.githubModelsToken;\r\n    const model = settings.apiKeys?.githubModelsModel || 'openai/gpt-4o'; // Use fast model\r\n\r\n    if (!token) return null;\r\n\r\n    try {\r\n        console.log('[SearchAI] Trying GitHub Models...');\r\n        const prompt = buildPrompt(query, context);\r\n\r\n        const response = await fetch('https://models.github.ai/inference/chat/completions', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Authorization': `Bearer ${token}`,\r\n                'Content-Type': 'application/json',\r\n                'Accept': 'application/vnd.github+json',\r\n                'X-GitHub-Api-Version': '2022-11-28',\r\n            },\r\n            body: JSON.stringify({\r\n                model: model,\r\n                messages: [\r\n                    { role: 'system', content: 'You are a product database API. Return valid JSON only.' },\r\n                    { role: 'user', content: prompt }\r\n                ],\r\n                max_tokens: 500,\r\n                temperature: 0.3\r\n            })\r\n        });\r\n\r\n        if (!response.ok) throw new Error(`Status ${response.status}`);\r\n\r\n        const data = await response.json();\r\n        const content = data.choices?.[0]?.message?.content;\r\n\r\n        if (content) {\r\n            return parseAIResponse(content, query, 'GitHub Models', context?.image);\r\n        }\r\n    } catch (err) {\r\n        console.warn('[SearchAI] GitHub Models failed:', err);\r\n    }\r\n    return null;\r\n}\r\n\r\nasync function tryGroq(query: string, context?: WebContext): Promise<EnhancedProductData | null> {\r\n    const groqKey = process.env.GROQ_API_KEY || process.env.NEXT_PUBLIC_GROQ_API_KEY;\r\n    if (!groqKey) return null;\r\n\r\n    try {\r\n        console.log('[SearchAI] Trying Groq...');\r\n        const prompt = buildPrompt(query, context);\r\n\r\n        const response = await axios.post('https://api.groq.com/openai/v1/chat/completions', {\r\n            model: 'llama3-8b-8192',\r\n            messages: [\r\n                { role: 'system', content: 'You are a product database API. Return valid JSON only.' },\r\n                { role: 'user', content: prompt }\r\n            ],\r\n            temperature: 0.3,\r\n            response_format: { type: \"json_object\" }\r\n        }, {\r\n            headers: { 'Authorization': `Bearer ${groqKey}` }\r\n        });\r\n\r\n        const content = response.data.choices[0]?.message?.content;\r\n        if (content) {\r\n            return parseAIResponse(content, query, 'Groq Llama-3', context?.image);\r\n        }\r\n    } catch (err) {\r\n        console.warn('[SearchAI] Groq failed:', err);\r\n    }\r\n    return null;\r\n}\r\n\r\n// --- Helpers ---\r\n\r\n// --- Helpers ---\r\n\r\nfunction buildPrompt(query: string, context?: WebContext): string {\r\n    let promptContext = \"\";\r\n    if (context) {\r\n        promptContext = `\r\n        CONTEXT FROM WEB SEARCH:\r\n        - Title: \"${context.title || 'N/A'}\"\r\n        - Snippet/Description: \"${context.snippet || 'N/A'}\"\r\n        \r\n        Using this context, reconstruct the most accurate product data possible.\r\n        `;\r\n    }\r\n\r\n    return `User Query: \"${query}\"\r\n    ${promptContext}\r\n\r\n    Role: You are an expert product analyst AI (Antigravity AI).\r\n    \r\n    Determine the category of the input query:\r\n    A. FOOD/MEDICINE:\r\n       - Generate Nutrition/Ingredients.\r\n       - Category: Food, Medicine, Beverage, etc.\r\n    \r\n    B. TECH/HARDWARE/ELECTRONICS (e.g. GPU, Phone, Laptop):\r\n       - DO NOT generate nutrition/ingredients.\r\n       - Brand: YOU MUST INFER THE BRAND. (e.g. \"Galaxy S22\" -> \"Samsung\", \"RTX 3060\" -> \"NVIDIA\", \"Pixel\" -> \"Google\"). Never return \"Unknown\".\r\n       - Specs: Generate key technical specs (e.g. { \"VRAM\": \"12GB\", \"Power\": \"170W\", \"Chipset\": \"NVIDIA\" }).\r\n       - Analysis: Provide Pros, Cons, and a Buying Verdict.\r\n       - Score: A score from 0-100 based on modern standards (e.g. RTX 3060 is decent = 75, RTX 4090 is top = 95).\r\n       - Price Analysis: Is it good value?\r\n    \r\n    C. QUESTION/TOPIC:\r\n       - Summary answer as description.\r\n       - Category: Information.\r\n\r\n    Respond ONLY with this JSON schema:\r\n    {\r\n      \"name\": \"Product Name\",\r\n      \"brand\": \"Brand Name\",\r\n      \"category\": \"Food/Tech/Info/Other\",\r\n      \"description\": \"Detailed description\",\r\n      \"ingredients\": [\"ing1\"] (Food only, else []),\r\n      \"nutrition\": {\"energy_kcal\": 0} (Food only, else {}),\r\n      \"specs\": {\"Spec Name\": \"Value\"} (Tech only),\r\n      \"analysis\": {\r\n         \"pros\": [\"pro1\", \"pro2\"],\r\n         \"cons\": [\"con1\", \"con2\"],\r\n         \"verdict\": \"Buy\" | \"Pass\" | \"Wait\",\r\n         \"verdict_text\": \"Short explanation\",\r\n         \"price_analysis\": \"Good value/Overpriced\",\r\n         \"score\": 85\r\n      }\r\n    }`;\r\n}\r\n\r\nfunction parseAIResponse(jsonString: string, query: string, sourceName: string, imageUrl?: string): EnhancedProductData {\r\n    try {\r\n        const cleanJson = jsonString.replace(/```json/gi, '').replace(/```/g, '').trim();\r\n        const data = JSON.parse(cleanJson);\r\n\r\n        return {\r\n            id: `ai_${Date.now()}`,\r\n            identity: {\r\n                name: data.name || query,\r\n                brand: data.brand || 'Unknown',\r\n                barcode: 'AI_GENERATED',\r\n                category: data.category || 'Unknown',\r\n                description: data.description || 'Details generated by AI.',\r\n            },\r\n            media: {\r\n                front_image: imageUrl || '/images/ai-product-placeholder.png', // Use web image if available\r\n                thumbnail: imageUrl || '/images/ai-product-placeholder.png'\r\n            },\r\n            grades: {\r\n                nutri_score: '?',\r\n                eco_score: '?',\r\n                processing_score: '?'\r\n            },\r\n            nutrition: {\r\n                nutriments_raw: data.nutrition || {}\r\n            },\r\n            sensory_profile: { flavors: [] },\r\n            ingredients: (data.ingredients || []).map((ing: string) => ({\r\n                id: ing.toLowerCase().replace(/\\s+/g, '_'),\r\n                name: ing,\r\n                percent: 0,\r\n                rank: 0,\r\n                has_sub_ingredients: false\r\n            })),\r\n            source: sourceName as any,\r\n            // New Tech Fields\r\n            specs: data.specs || {},\r\n            analysis: data.analysis || {}\r\n        };\r\n    } catch (e) {\r\n        console.error('[SearchAI] Parse error:', e);\r\n        throw new Error('Failed to parse AI response');\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\searxngService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[669,672],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[669,672],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":36,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2727,2730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2727,2730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3201,3204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3201,3204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":243,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":243,"endColumn":19}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * SearXNG Search Service\r\n * Uses a self-hosted SearXNG instance for web searches (replaces paid SerpAPI)\r\n */\r\n\r\nimport axios from 'axios';\r\nimport { getSystemSettings } from './systemService';\r\n\r\n// Default SearXNG URL (can be overridden in Admin settings)\r\nconst DEFAULT_SEARXNG_URL = 'http://20.199.129.203:8080';\r\n\r\nexport interface SearXNGResult {\r\n    title: string;\r\n    url: string;\r\n    content: string; // snippet/description\r\n    engine: string;\r\n    img_src?: string;\r\n    thumbnail?: string;\r\n    score?: number;\r\n}\r\n\r\nexport interface SearXNGResponse {\r\n    query: string;\r\n    results: SearXNGResult[];\r\n    suggestions: string[];\r\n    infoboxes: any[];\r\n}\r\n\r\n/**\r\n * Get the configured SearXNG URL from Admin settings or use default\r\n */\r\nconst getSearXNGUrl = async (): Promise<string> => {\r\n    try {\r\n        const settings = await getSystemSettings();\r\n        return settings.apiKeys?.searxngUrl || DEFAULT_SEARXNG_URL;\r\n    } catch (e) {\r\n        console.warn('[SearXNG] Could not fetch settings, using default URL');\r\n        return DEFAULT_SEARXNG_URL;\r\n    }\r\n};\r\n\r\n/**\r\n * Search using SearXNG\r\n * @param query - Search query\r\n * @param categories - Optional: 'general', 'images', 'news', 'science', etc.\r\n * @param engines - Optional: specific engines like 'google', 'bing', 'duckduckgo'\r\n */\r\n/**\r\n * Search using SearXNG\r\n * @param query - Search query\r\n * @param categories - Optional: 'general', 'images', 'news', 'science', etc.\r\n * @param engines - Optional: specific engines like 'google', 'bing', 'duckduckgo'\r\n */\r\nexport const searchWithSearXNG = async (\r\n    query: string,\r\n    categories: string = 'general',\r\n    engines?: string[]\r\n): Promise<SearXNGResult[]> => {\r\n    try {\r\n        const baseUrl = await getSearXNGUrl();\r\n\r\n        // Build search URL with JSON format\r\n        const params = new URLSearchParams({\r\n            q: query,\r\n            format: 'json',\r\n            categories: categories,\r\n        });\r\n\r\n        if (engines && engines.length > 0) {\r\n            params.append('engines', engines.join(','));\r\n        }\r\n\r\n        const searchUrl = `${baseUrl}/search?${params.toString()}`;\r\n        console.log(`[SearXNG] Searching (${categories}): ${query}`);\r\n\r\n        const response = await axios.get<SearXNGResponse>(searchUrl, {\r\n            timeout: 10000, // 10 second timeout\r\n            headers: {\r\n                'Accept': 'application/json',\r\n            }\r\n        });\r\n\r\n        if (response.data.results && response.data.results.length > 0) {\r\n            console.log(`[SearXNG] Found ${response.data.results.length} results`);\r\n            // Map raw results to ensure all fields are present\r\n            return response.data.results.map((r: any) => ({\r\n                title: r.title,\r\n                url: r.url,\r\n                content: r.content,\r\n                engine: r.engine,\r\n                img_src: r.img_src || r.thumbnail_src || (categories === 'images' ? r.url : null), // Handle direct image URLs in image search\r\n                thumbnail: r.thumbnail || r.thumbnail_src || r.img_src || null,\r\n                score: r.score\r\n            }));\r\n        }\r\n\r\n        return [];\r\n    } catch (error: any) {\r\n        console.error('[SearXNG] Search error:', error.message);\r\n\r\n        // Check for common errors\r\n        if (error.response?.status === 403) {\r\n            console.error('[SearXNG] 403 Forbidden - JSON format may be disabled. Enable it in SearXNG settings.yaml');\r\n        } else if (error.code === 'ECONNREFUSED') {\r\n            console.error('[SearXNG] Connection refused - check if SearXNG is running');\r\n        }\r\n\r\n        return [];\r\n    }\r\n};\r\n\r\n/**\r\n * Find product images using SearXNG\r\n */\r\nexport const findProductImages = async (productName: string, limit: number = 1): Promise<string[]> => {\r\n    try {\r\n        console.log(`[SearXNG] Starting Optimized Parallel Image Search for: ${productName}`);\r\n\r\n        // Define Queries (Relaxed \"front view\" quotes to improve recall)\r\n        const strictQuery = `${productName} product official image front view -graph -chart -statistics -plot -diagram -logo -icon -vector -clipart -sketch -blueprint -layout`;\r\n        const moderateQuery = `${productName} product photo -logo -icon`;\r\n\r\n        // EXECUTE PARALLEL SEARCHES (Race for best quality, but don't wait sequentially)\r\n        const [strictResults, moderateResults] = await Promise.all([\r\n            searchWithSearXNG(strictQuery, 'images').catch(err => { console.warn('Strict search failed', err); return []; }),\r\n            searchWithSearXNG(moderateQuery, 'images').catch(err => { console.warn('Moderate search failed', err); return []; })\r\n        ]);\r\n\r\n        // 1. Prefer Strict Results (High Quality)\r\n        const strictImages = processAndFilterImages(strictResults, limit);\r\n        if (strictImages.length > 0) {\r\n            console.log(`[SearXNG] Γ£à Using STRICT results (${strictImages.length})`);\r\n            return strictImages;\r\n        }\r\n\r\n        // 2. Fallback to Moderate Results (Good Quality)\r\n        const moderateImages = processAndFilterImages(moderateResults, limit);\r\n        if (moderateImages.length > 0) {\r\n            console.log(`[SearXNG] ΓÜá∩╕Å Fallback to MODERATE results (${moderateImages.length})`);\r\n            return moderateImages;\r\n        }\r\n\r\n        // 3. Last Resort: Loose Search (Sequential, only if everything else failed)\r\n        console.log('[SearXNG] Γ¥î All parallel searches failed. Trying LOOSE fallback.');\r\n        const looseResults = await searchWithSearXNG(`${productName}`, 'images');\r\n        return processAndFilterImages(looseResults, limit);\r\n\r\n    } catch (error) {\r\n        console.error('[SearXNG] Image search failed:', error);\r\n        return [];\r\n    }\r\n};\r\n\r\n/**\r\n * Helper to process and filter image results\r\n * Adds strict filtering against logos, icons, and noisy filenames\r\n */\r\nfunction processAndFilterImages(results: SearXNGResult[], limit: number): string[] {\r\n    return results\r\n        .map(r => r.img_src || r.thumbnail) // Prefer high-res val, fallback to thumb\r\n        .filter((url): url is string => {\r\n            if (!url || !url.startsWith('http')) return false;\r\n\r\n            const lowerUrl = url.toLowerCase();\r\n            // Ban generic placeholders, logos, icons\r\n            if (lowerUrl.includes('placeholder')) return false;\r\n            if (lowerUrl.includes('logo')) return false;\r\n            if (lowerUrl.includes('icon')) return false;\r\n            if (lowerUrl.includes('avatar')) return false;\r\n            if (lowerUrl.includes('svg')) return false; // Vectors are rarely photos\r\n\r\n            // Ban generic naming patterns often associated with site assets\r\n            if (lowerUrl.includes('/assets/')) return false;\r\n            if (lowerUrl.includes('/static/')) return false;\r\n\r\n            return true;\r\n        })\r\n        .slice(0, limit);\r\n}\r\n\r\n/**\r\n * Search for product information on trusted nutrition databases\r\n * Uses SearXNG to search USDA, EWG, Nutritionix, etc.\r\n */\r\nexport const searchProductInfo = async (productName: string): Promise<{\r\n    name: string;\r\n    brand: string;\r\n    description: string;\r\n    sources: string[];\r\n} | null> => {\r\n    try {\r\n        // Search trusted nutrition sites\r\n        const trustedSites = 'site:fdc.nal.usda.gov OR site:ewg.org OR site:nutritionix.com OR site:foodb.ca';\r\n        const query = `${productName} ${trustedSites}`;\r\n\r\n        const results = await searchWithSearXNG(query, 'general');\r\n\r\n        if (results.length === 0) {\r\n            return null;\r\n        }\r\n\r\n        // Extract useful information from top results\r\n        const topResults = results.slice(0, 5);\r\n        const snippets = topResults.map(r => r.content).filter(Boolean);\r\n        const sources = topResults.map(r => r.url);\r\n\r\n        // Return raw results for AI synthesis\r\n        return {\r\n            name: productName,\r\n            brand: 'Unknown',\r\n            description: snippets.join(' | '),\r\n            sources: sources\r\n        };\r\n    } catch (error) {\r\n        console.error('[SearXNG] Product search error:', error);\r\n        return null;\r\n    }\r\n};\r\n\r\n/**\r\n * Search for health/nutrition information\r\n */\r\nexport const searchHealthInfo = async (topic: string): Promise<string[]> => {\r\n    try {\r\n        const results = await searchWithSearXNG(topic, 'science');\r\n        return results.slice(0, 5).map(r => r.content).filter(Boolean);\r\n    } catch (error) {\r\n        console.error('[SearXNG] Health search error:', error);\r\n        return [];\r\n    }\r\n};\r\n\r\n/**\r\n * Check if SearXNG is available and responding\r\n */\r\nexport const checkSearXNGHealth = async (): Promise<boolean> => {\r\n    try {\r\n        const baseUrl = await getSearXNGUrl();\r\n        const response = await axios.get(`${baseUrl}/search?q=test&format=json`, {\r\n            timeout: 5000\r\n        });\r\n        return response.status === 200;\r\n    } catch (error) {\r\n        return false;\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\smartGradingService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\statsService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'lastMonthTimestamp' is assigned a value but never used.","line":23,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from '@/lib/firebase';\r\nimport { collection, getDocs, query, where, Timestamp } from 'firebase/firestore';\r\n\r\nexport interface DashboardStats {\r\n    totalUsers: number;\r\n    totalAdmins: number;\r\n    totalPayments: number;\r\n    totalRevenue: number;\r\n    totalScans: number;\r\n    userGrowth: number; // percentage\r\n    revenueGrowth: number;\r\n    scanGrowth: number;\r\n}\r\n\r\n/**\r\n * Get real-time dashboard statistics from Firestore\r\n */\r\nexport const getDashboardStats = async (): Promise<DashboardStats> => {\r\n    try {\r\n        // Get current date and last month date for comparison\r\n        const now = new Date();\r\n        const lastMonth = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());\r\n        const lastMonthTimestamp = Timestamp.fromDate(lastMonth);\r\n\r\n        // --- Total Users (excluding admins) ---\r\n        const usersRef = collection(db, 'users');\r\n\r\n        // Use getDocs instead of getCountFromServer to avoid permission issues\r\n        const usersSnap = await getDocs(usersRef);\r\n\r\n        // Count users and admins separately\r\n        let totalAdmins = 0;\r\n        let totalUsers = 0;\r\n        let newUsersCount = 0;\r\n\r\n        usersSnap.forEach((doc) => {\r\n            const data = doc.data();\r\n            if (data.role === 'admin') {\r\n                totalAdmins++;\r\n            } else {\r\n                totalUsers++; // Only count non-admin users\r\n\r\n                // Check if created in last month (for growth)\r\n                if (data.createdAt) {\r\n                    const createdDate = data.createdAt.toDate ? data.createdAt.toDate() : new Date(data.createdAt);\r\n                    if (createdDate >= lastMonth) newUsersCount++;\r\n                }\r\n            }\r\n        });\r\n\r\n        console.log('[STATS] Users:', totalUsers, 'Admins:', totalAdmins);\r\n\r\n        const userGrowth = totalUsers > 0 ? Math.round((newUsersCount / totalUsers) * 100) : 0;\r\n\r\n        // --- Total Scans (from history collection) ---\r\n        const historyRef = collection(db, 'history');\r\n        const historySnap = await getDocs(historyRef);\r\n\r\n        let totalScans = 0;\r\n        let recentScansCount = 0;\r\n\r\n        historySnap.forEach((doc) => {\r\n            const data = doc.data();\r\n            if (data.type === 'scan') {\r\n                totalScans++;\r\n                // Check if scan was in last month\r\n                if (data.timestamp) {\r\n                    const scanDate = data.timestamp.toDate ? data.timestamp.toDate() : new Date(data.timestamp);\r\n                    if (scanDate >= lastMonth) recentScansCount++;\r\n                }\r\n            }\r\n        });\r\n\r\n        const scanGrowth = totalScans > 0 ? Math.round((recentScansCount / totalScans) * 100) : 0;\r\n\r\n        // --- Payments ---\r\n        const paymentsRef = collection(db, 'paymentRequests');\r\n        const approvedPaymentsQuery = query(paymentsRef, where('status', '==', 'approved'));\r\n        const paymentsSnap = await getDocs(approvedPaymentsQuery);\r\n\r\n        let totalRevenue = 0;\r\n        let totalPayments = 0;\r\n        let recentRevenue = 0;\r\n\r\n        paymentsSnap.forEach((doc) => {\r\n            const data = doc.data();\r\n            totalPayments++;\r\n            // Assuming tier prices: plus=$4.99, pro=$9.99, ultimate=$19.99\r\n            const tierPrices: Record<string, number> = {\r\n                plus: 4.99,\r\n                pro: 9.99,\r\n                ultimate: 19.99\r\n            };\r\n            const price = tierPrices[data.targetTier] || 0;\r\n            totalRevenue += price;\r\n\r\n            // Check if payment was in last month\r\n            if (data.approvedAt && data.approvedAt.toDate() >= lastMonth) {\r\n                recentRevenue += price;\r\n            }\r\n        });\r\n\r\n        const revenueGrowth = totalRevenue > 0 ? Math.round((recentRevenue / totalRevenue) * 100) : 0;\r\n\r\n        return {\r\n            totalUsers,\r\n            totalAdmins,\r\n            totalPayments,\r\n            totalRevenue: Math.round(totalRevenue * 100) / 100,\r\n            totalScans,\r\n            userGrowth,\r\n            revenueGrowth,\r\n            scanGrowth\r\n        };\r\n    } catch (error) {\r\n        console.error('[STATS] Error fetching dashboard stats:', error);\r\n        // Return zeros on error\r\n        return {\r\n            totalUsers: 0,\r\n            totalAdmins: 0,\r\n            totalPayments: 0,\r\n            totalRevenue: 0,\r\n            totalScans: 0,\r\n            userGrowth: 0,\r\n            revenueGrowth: 0,\r\n            scanGrowth: 0\r\n        };\r\n    }\r\n};\r\n\r\nexport interface ActivityData {\r\n    date: string;\r\n    activeUsers: number;\r\n    newUsers: number;\r\n}\r\n\r\n/**\r\n * Get daily user activity for the last 30 days\r\n */\r\nexport const getUserActivityData = async (): Promise<ActivityData[]> => {\r\n    try {\r\n        const now = new Date();\r\n        const thirtyDaysAgo = new Date();\r\n        thirtyDaysAgo.setDate(now.getDate() - 30);\r\n\r\n        // Fetch scans in last 30 days (Active Users = users who scanned)\r\n        const historyRef = collection(db, 'history');\r\n        const qHistory = query(historyRef, where('timestamp', '>=', Timestamp.fromDate(thirtyDaysAgo)));\r\n        const historySnap = await getDocs(qHistory);\r\n\r\n        // Fetch users created in last 30 days\r\n        const usersRef = collection(db, 'users');\r\n        const qUsers = query(usersRef, where('createdAt', '>=', Timestamp.fromDate(thirtyDaysAgo)));\r\n        const usersSnap = await getDocs(qUsers);\r\n\r\n        // Process data\r\n        const dailyStats: Record<string, { activeUsers: Set<string>, newUsers: number }> = {};\r\n\r\n        // Initialize last 30 days\r\n        for (let i = 0; i <= 30; i++) {\r\n            const d = new Date(thirtyDaysAgo);\r\n            d.setDate(d.getDate() + i);\r\n            const dateStr = d.toISOString().split('T')[0];\r\n            dailyStats[dateStr] = { activeUsers: new Set(), newUsers: 0 };\r\n        }\r\n\r\n        historySnap.forEach(doc => {\r\n            const data = doc.data();\r\n            if (data.timestamp && data.userId) {\r\n                const date = data.timestamp.toDate ? data.timestamp.toDate() : new Date(data.timestamp);\r\n                const dateStr = date.toISOString().split('T')[0];\r\n                if (dailyStats[dateStr]) {\r\n                    dailyStats[dateStr].activeUsers.add(data.userId);\r\n                }\r\n            }\r\n        });\r\n\r\n        usersSnap.forEach(doc => {\r\n            const data = doc.data();\r\n            if (data.createdAt) {\r\n                const date = data.createdAt.toDate ? data.createdAt.toDate() : new Date(data.createdAt);\r\n                const dateStr = date.toISOString().split('T')[0];\r\n                if (dailyStats[dateStr]) {\r\n                    dailyStats[dateStr].newUsers++;\r\n                }\r\n            }\r\n        });\r\n\r\n        return Object.entries(dailyStats)\r\n            .map(([date, stats]) => ({\r\n                date,\r\n                activeUsers: stats.activeUsers.size,\r\n                newUsers: stats.newUsers\r\n            }))\r\n            .sort((a, b) => a.date.localeCompare(b.date));\r\n\r\n    } catch (error) {\r\n        console.error(\"Error fetching activity data:\", error);\r\n        return [];\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\subscriptionService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\supportService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setDoc' is defined but never used.","line":14,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":11},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2389,2392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2389,2392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'deleteQueryBatch' is defined but never used.","line":211,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":211,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":211,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6512,6515],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6512,6515],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":211,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6524,6527],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6524,6527],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":211,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6538,6541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6538,6541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":221,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6827,6830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6827,6830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":244,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":244,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7578,7581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7578,7581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":245,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":245,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7613,7616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7613,7616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":258,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":258,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8011,8014],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8011,8014],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":277,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8579,8582],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8579,8582],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from '@/lib/firebase';\r\nimport {\r\n    collection,\r\n    addDoc,\r\n    query,\r\n    where,\r\n    orderBy,\r\n    onSnapshot,\r\n    serverTimestamp,\r\n    updateDoc,\r\n    doc,\r\n    getDocs,\r\n    getDoc,\r\n    setDoc,\r\n    deleteDoc,\r\n    writeBatch,\r\n    increment\r\n} from 'firebase/firestore';\r\nimport { Chat, ChatMessage } from '@/types/chat';\r\n\r\nconst CHATS_COLLECTION = 'chats';\r\nconst MESSAGES_SUBCOLLECTION = 'messages';\r\n\r\n/**\r\n * Starts a new chat for a user if one doesn't exist, or returns the existing one.\r\n */\r\nexport const startNewChat = async (userId: string, userEmail?: string, userName?: string): Promise<string> => {\r\n    // Check if chat already exists for this user\r\n    const q = query(collection(db, CHATS_COLLECTION), where('userId', '==', userId));\r\n    const snapshot = await getDocs(q);\r\n\r\n    let finalName = userName || '';\r\n\r\n    // If name is missing, try to fetch from User Profile\r\n    if (!finalName) {\r\n        try {\r\n            const userDoc = await getDoc(doc(db, 'users', userId));\r\n            if (userDoc.exists()) {\r\n                finalName = userDoc.data().displayName || '';\r\n            }\r\n        } catch (e) { console.error(\"Error fetching user name for chat:\", e); }\r\n    }\r\n\r\n    if (!snapshot.empty) {\r\n        const chatDoc = snapshot.docs[0];\r\n        // UPDATE existing chat with latest user details (Name sync)\r\n        if (finalName && chatDoc.data().userName !== finalName) {\r\n            await updateDoc(chatDoc.ref, { userName: finalName });\r\n        }\r\n        return chatDoc.id;\r\n    }\r\n\r\n    // Create new chat\r\n    const chatData = {\r\n        userId,\r\n        userEmail: userEmail || '',\r\n        userName: finalName,\r\n        updatedAt: serverTimestamp(),\r\n        unreadCountUser: 0,\r\n        unreadCountAdmin: 0\r\n    };\r\n\r\n    const docRef = await addDoc(collection(db, CHATS_COLLECTION), chatData);\r\n    return docRef.id;\r\n};\r\n\r\n/**\r\n * Sends a message to a specific chat.\r\n */\r\nexport const sendMessage = async (chatId: string, senderId: string, text: string, senderRole: 'user' | 'admin') => {\r\n    const chatRef = doc(db, CHATS_COLLECTION, chatId);\r\n    const messagesRef = collection(chatRef, MESSAGES_SUBCOLLECTION);\r\n\r\n    // Add message to subcollection\r\n    await addDoc(messagesRef, {\r\n        text,\r\n        senderId,\r\n        senderRole,\r\n        createdAt: serverTimestamp()\r\n    });\r\n\r\n    const updates: any = {\r\n        lastMessage: {\r\n            text,\r\n            createdAt: new Date(),\r\n            senderRole\r\n        },\r\n        updatedAt: serverTimestamp()\r\n    };\r\n\r\n    if (senderRole === 'admin') {\r\n        updates.unreadCountUser = increment(1);\r\n    } else {\r\n        updates.unreadCountAdmin = increment(1);\r\n    }\r\n\r\n    await updateDoc(chatRef, updates);\r\n\r\n    // If Admin is sending, try to send Push Notification to User\r\n    if (senderRole === 'admin') {\r\n        try {\r\n            // 1. Get Chat Metadata to find target User ID\r\n            const chatSnap = await getDoc(chatRef);\r\n            if (chatSnap.exists()) {\r\n                const chatData = chatSnap.data();\r\n                const targetUserId = chatData.userId;\r\n\r\n                if (targetUserId) {\r\n                    // Call new Web Push API\r\n                    fetch('/api/notifications/send-chat-push', {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({\r\n                            userId: targetUserId,\r\n                            messageText: text,\r\n                            senderName: 'Support Team'\r\n                        })\r\n                    }).catch(err => console.error(\"API Call Failed\", err));\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to trigger notification flow:\", error);\r\n        }\r\n    }\r\n};\r\n\r\nexport const markChatAsRead = async (chatId: string, role: 'user' | 'admin') => {\r\n    const chatRef = doc(db, CHATS_COLLECTION, chatId);\r\n    const updates = role === 'user' ? { unreadCountUser: 0 } : { unreadCountAdmin: 0 };\r\n    await updateDoc(chatRef, updates);\r\n};\r\n\r\nexport const listenForUnreadForUser = (userId: string, callback: (count: number) => void) => {\r\n    const q = query(\r\n        collection(db, CHATS_COLLECTION),\r\n        where('userId', '==', userId)\r\n    );\r\n\r\n    return onSnapshot(q, (snapshot) => {\r\n        let totalUnread = 0;\r\n        snapshot.docs.forEach(doc => {\r\n            const data = doc.data();\r\n            totalUnread += (data.unreadCountUser || 0);\r\n        });\r\n        callback(totalUnread);\r\n    });\r\n};\r\n\r\nexport const listenForAdminUnreadCount = (callback: (count: number) => void) => {\r\n    const q = query(\r\n        collection(db, CHATS_COLLECTION),\r\n        where('unreadCountAdmin', '>', 0)\r\n    );\r\n\r\n    return onSnapshot(q, (snapshot) => {\r\n        let totalUnread = 0;\r\n        snapshot.docs.forEach(doc => {\r\n            const data = doc.data();\r\n            totalUnread += (data.unreadCountAdmin || 0);\r\n        });\r\n        callback(totalUnread);\r\n    });\r\n};\r\n\r\n/**\r\n * Listen for messages in a chat.\r\n */\r\nexport const listenForMessages = (chatId: string, callback: (messages: ChatMessage[]) => void) => {\r\n    const messagesRef = collection(db, CHATS_COLLECTION, chatId, MESSAGES_SUBCOLLECTION);\r\n    const q = query(messagesRef, orderBy('createdAt', 'asc'));\r\n\r\n    return onSnapshot(q, (snapshot) => {\r\n        const messages = snapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data()\r\n        } as ChatMessage));\r\n        callback(messages);\r\n    });\r\n};\r\n\r\n/**\r\n * Listen for all chats (for Admin Dashboard).\r\n */\r\nexport const listenForAdminChatList = (callback: (chats: Chat[]) => void) => {\r\n    const q = query(collection(db, CHATS_COLLECTION), orderBy('updatedAt', 'desc'));\r\n\r\n    return onSnapshot(q, (snapshot) => {\r\n        const chats = snapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data()\r\n        } as Chat));\r\n        callback(chats);\r\n    });\r\n};\r\n\r\n/**\r\n * Get all chats (one-off)\r\n */\r\nexport const getAdminChatList = async (): Promise<Chat[]> => {\r\n    const q = query(collection(db, CHATS_COLLECTION), orderBy('updatedAt', 'desc'));\r\n    const snapshot = await getDocs(q);\r\n    return snapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data()\r\n    } as Chat));\r\n};\r\n\r\n/**\r\n * Helper to delete a collection/query in batches of 400 to match Firebase limits.\r\n */\r\nasync function deleteQueryBatch(db: any, query: any, resolve: any) {\r\n    const snapshot = await getDocs(query);\r\n    const batchSize = snapshot.size;\r\n    if (batchSize === 0) {\r\n        // When there are no documents left, we are done\r\n        resolve();\r\n        return;\r\n    }\r\n\r\n    const batch = writeBatch(db);\r\n    snapshot.docs.forEach((doc: any) => {\r\n        batch.delete(doc.ref);\r\n    });\r\n    await batch.commit();\r\n\r\n    // Recurse on the next process tick, to avoid stack overflows\r\n    process.nextTick(() => {\r\n        deleteQueryBatch(db, query, resolve);\r\n    });\r\n}\r\n\r\n/**\r\n * Deletes a single chat and all its messages safely.\r\n */\r\nexport const deleteChat = async (chatId: string) => {\r\n    // 1. Delete all messages (subcollection)\r\n    const messagesRef = collection(db, CHATS_COLLECTION, chatId, MESSAGES_SUBCOLLECTION);\r\n\r\n    // We need to delete all messages. If there are > 500, we need to batch.\r\n    // Simple approach: fetch all and batch delete in chunks.\r\n    const messagesSnapshot = await getDocs(messagesRef);\r\n\r\n    // Split into chunks of 400\r\n    const chunks: any[] = [];\r\n    let currentChunk: any[] = [];\r\n\r\n    messagesSnapshot.docs.forEach((doc) => {\r\n        currentChunk.push(doc.ref);\r\n        if (currentChunk.length >= 400) {\r\n            chunks.push(currentChunk);\r\n            currentChunk = [];\r\n        }\r\n    });\r\n    if (currentChunk.length > 0) chunks.push(currentChunk);\r\n\r\n    for (const chunk of chunks) {\r\n        const batch = writeBatch(db);\r\n        chunk.forEach((ref: any) => batch.delete(ref));\r\n        await batch.commit();\r\n    }\r\n\r\n    // 2. Delete the chat document itself\r\n    await deleteDoc(doc(db, CHATS_COLLECTION, chatId));\r\n};\r\n\r\n/**\r\n * Clears all chats and messages (Admin only).\r\n */\r\nexport const clearAllChats = async () => {\r\n    const chatsQuery = query(collection(db, CHATS_COLLECTION));\r\n    const chatsSnapshot = await getDocs(chatsQuery);\r\n\r\n    for (const chatDoc of chatsSnapshot.docs) {\r\n        await deleteChat(chatDoc.id);\r\n    }\r\n};\r\nexport const listenForChatMetadata = (chatId: string, callback: (data: any) => void) => {\r\n    const chatRef = doc(db, CHATS_COLLECTION, chatId);\r\n    return onSnapshot(chatRef, (doc) => {\r\n        if (doc.exists()) {\r\n            callback(doc.data());\r\n        }\r\n    });\r\n};\r\nexport const toggleAdminVisibility = async (chatId: string, isVisible: boolean) => {\r\n    const chatRef = doc(db, CHATS_COLLECTION, chatId);\r\n    await updateDoc(chatRef, { adminVisible: isVisible });\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\sustainabilityService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\systemService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2949,2952],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2949,2952],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from '@/lib/firebase';\r\nimport { doc, getDoc, setDoc, onSnapshot } from 'firebase/firestore';\r\nimport { ExtendedSystemSettings, SystemTierConfig } from '@/types/system';\r\nimport { TIER_CONFIG } from '@/types/user';\r\n\r\nconst SETTINGS_COLLECTION = 'system';\r\nconst SETTINGS_DOC = 'settings';\r\n\r\n// Map existing strict config to editable config\r\nconst DEFAULT_TIER_CONFIG: SystemTierConfig = {\r\n    free: {\r\n        id: 'free',\r\n        name: 'Free',\r\n        description: 'Forever Free',\r\n        pricing: { monthly: 0, lifetime: 0, currency: 'USD' },\r\n        features: TIER_CONFIG.free,\r\n        metadata: {}\r\n    },\r\n    plus: {\r\n        id: 'plus',\r\n        name: 'Plus',\r\n        description: 'Advanced scanning for enthusiasts',\r\n        pricing: { monthly: 3.99, lifetime: 19.99, currency: 'USD' },\r\n        features: TIER_CONFIG.plus,\r\n        metadata: { originalPriceLifetime: 39.99 }\r\n    },\r\n    pro: {\r\n        id: 'pro',\r\n        name: 'Pro',\r\n        description: 'For power users who need the truth',\r\n        pricing: { monthly: 7.99, lifetime: 49.99, currency: 'USD' },\r\n        features: TIER_CONFIG.pro,\r\n        metadata: { isPopular: true, originalPriceLifetime: 99.99 }\r\n    },\r\n    ultimate: {\r\n        id: 'ultimate',\r\n        name: 'Ultimate',\r\n        description: 'Unlimited everything for professionals',\r\n        pricing: { monthly: 14.99, lifetime: 79.99, currency: 'USD' },\r\n        features: TIER_CONFIG.ultimate,\r\n        metadata: { originalPriceLifetime: 159.99 }\r\n    }\r\n};\r\n\r\nexport const DEFAULT_SETTINGS: ExtendedSystemSettings = {\r\n    maintenanceMode: false,\r\n    betaAccess: false,\r\n    apiKeys: {},\r\n    tierConfig: DEFAULT_TIER_CONFIG,\r\n    pcConsultationPrice: 2000 // Default 20.00 USD\r\n};\r\n\r\n/**\r\n * Get current system settings\r\n */\r\nexport const getSystemSettings = async (): Promise<ExtendedSystemSettings> => {\r\n    try {\r\n        const ref = doc(db, SETTINGS_COLLECTION, SETTINGS_DOC);\r\n        const snap = await getDoc(ref);\r\n\r\n        if (snap.exists()) {\r\n            // Merge with default to ensure new fields (like tierConfig) exist if old doc\r\n            return { ...DEFAULT_SETTINGS, ...snap.data() } as ExtendedSystemSettings;\r\n        } else {\r\n            // Initialize if missing\r\n            await setDoc(ref, DEFAULT_SETTINGS);\r\n            return DEFAULT_SETTINGS;\r\n        }\r\n    } catch (error) {\r\n        console.error('Error fetching system settings:', error);\r\n        return DEFAULT_SETTINGS;\r\n    }\r\n};\r\n\r\n/**\r\n * Update system settings (Admin only)\r\n */\r\nexport const updateSystemSettings = async (settings: Partial<ExtendedSystemSettings>): Promise<void> => {\r\n    try {\r\n        console.log('[SYSTEM] Attempting to save settings:', settings);\r\n        const ref = doc(db, SETTINGS_COLLECTION, SETTINGS_DOC);\r\n        await setDoc(ref, settings, { merge: true });\r\n        console.log('[SYSTEM] Settings saved successfully to Firebase!');\r\n    } catch (error: any) {\r\n        console.error('[SYSTEM] Γ¥î Error updating system settings:', error);\r\n        throw error;\r\n    }\r\n};\r\n\r\n/**\r\n * Subscribe to system settings changes\r\n */\r\nexport const subscribeToSystemSettings = (callback: (settings: ExtendedSystemSettings) => void) => {\r\n    const ref = doc(db, SETTINGS_COLLECTION, SETTINGS_DOC);\r\n    return onSnapshot(ref, (snap) => {\r\n        if (snap.exists()) {\r\n            const data = snap.data();\r\n            // Deep merge safely or just spread\r\n            const merged = { ...DEFAULT_SETTINGS, ...data } as ExtendedSystemSettings;\r\n            console.log('[SYSTEM] Settings updated/synced');\r\n            callback(merged);\r\n        } else {\r\n            console.log('[SYSTEM] No settings found, using defaults');\r\n            callback(DEFAULT_SETTINGS);\r\n        }\r\n    });\r\n};\r\n\r\n\r\n/**\r\n * Public method to fetch event config + server time from API (for Frontend Time Sync)\r\n */\r\nexport const fetchEventConfigFromApi = async () => {\r\n    try {\r\n        const start = Date.now();\r\n        const res = await fetch('/api/v1/event_config', { cache: 'no-store' });\r\n        const end = Date.now();\r\n        const data = await res.json();\r\n\r\n        if (data.status === 'success') {\r\n            return {\r\n                ...data.data,\r\n                latency: (end - start) / 2\r\n            };\r\n        }\r\n        return null;\r\n    } catch (e) {\r\n        console.error('Failed to fetch event config api', e);\r\n        return null;\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\themeService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ThemeColors' is defined but never used.","line":29,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ThemeTypography' is defined but never used.","line":30,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ThemeShape' is defined but never used.","line":31,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4357,4360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4357,4360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4373,4376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4373,4376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Theme Service\r\n * Firebase integration for theme persistence and admin theme management\r\n */\r\n\r\nimport {\r\n    doc,\r\n    getDoc,\r\n    setDoc,\r\n    updateDoc,\r\n    deleteDoc,\r\n    collection,\r\n    getDocs,\r\n    query,\r\n    where,\r\n    orderBy,\r\n    serverTimestamp,\r\n    Timestamp,\r\n    increment\r\n} from 'firebase/firestore';\r\nimport { db } from '@/lib/firebase';\r\nimport {\r\n    ThemeId,\r\n    CustomThemeColors,\r\n    UserThemePreference,\r\n    GlobalTheme,\r\n    ThemeAnalytics,\r\n    ThemeConfig,\r\n    ThemeColors,\r\n    ThemeTypography,\r\n    ThemeShape\r\n} from '@/types/theme';\r\n\r\n// Collection names\r\nconst USERS_COLLECTION = 'users';\r\nconst GLOBAL_THEMES_COLLECTION = 'globalThemes';\r\nconst THEME_ANALYTICS_COLLECTION = 'themeAnalytics';\r\n\r\n// ============================================================================\r\n// USER THEME OPERATIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Save user's theme preference to Firebase\r\n */\r\nexport async function saveUserTheme(\r\n    userId: string,\r\n    themeId: ThemeId,\r\n    customColors?: CustomThemeColors\r\n): Promise<void> {\r\n    try {\r\n        const userRef = doc(db, USERS_COLLECTION, userId);\r\n\r\n        const themeData: UserThemePreference = {\r\n            id: themeId,\r\n            customColors: customColors || undefined,\r\n        };\r\n\r\n        await updateDoc(userRef, {\r\n            'preferences.theme': themeData,\r\n        });\r\n\r\n        // Update analytics\r\n        await updateThemeAnalytics(themeId);\r\n\r\n        console.log('[ThemeService] User theme saved:', themeId);\r\n    } catch (error) {\r\n        console.error('[ThemeService] Error saving user theme:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Load user's theme preference from Firebase\r\n */\r\nexport async function loadUserTheme(userId: string): Promise<UserThemePreference | null> {\r\n    try {\r\n        const userRef = doc(db, USERS_COLLECTION, userId);\r\n        const userDoc = await getDoc(userRef);\r\n\r\n        if (userDoc.exists()) {\r\n            const userData = userDoc.data();\r\n            return userData?.preferences?.theme || userData?.theme || null;\r\n        }\r\n\r\n        return null;\r\n    } catch (error) {\r\n        console.error('[ThemeService] Error loading user theme:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\n/**\r\n * Save admin's theme preference (separate from user theme)\r\n */\r\nexport async function saveAdminTheme(\r\n    adminId: string,\r\n    themeId: ThemeId,\r\n    customColors?: CustomThemeColors\r\n): Promise<void> {\r\n    try {\r\n        const userRef = doc(db, USERS_COLLECTION, adminId);\r\n\r\n        const themeData: UserThemePreference = {\r\n            id: themeId,\r\n            customColors: customColors || undefined,\r\n        };\r\n\r\n        await updateDoc(userRef, {\r\n            'preferences.adminTheme': themeData,\r\n        });\r\n\r\n        console.log('[ThemeService] Admin theme saved:', themeId);\r\n    } catch (error) {\r\n        console.error('[ThemeService] Error saving admin theme:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Load admin's theme preference\r\n */\r\nexport async function loadAdminTheme(adminId: string): Promise<UserThemePreference | null> {\r\n    try {\r\n        const userRef = doc(db, USERS_COLLECTION, adminId);\r\n        const userDoc = await getDoc(userRef);\r\n\r\n        if (userDoc.exists()) {\r\n            const userData = userDoc.data();\r\n            return userData?.preferences?.adminTheme || null;\r\n        }\r\n\r\n        return null;\r\n    } catch (error) {\r\n        console.error('[ThemeService] Error loading admin theme:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// GLOBAL THEME OPERATIONS (Admin Only)\r\n// ============================================================================\r\n\r\n/**\r\n * Create a new global theme (Admin only)\r\n */\r\nexport async function createGlobalTheme(\r\n    adminId: string,\r\n    themeData: Omit<GlobalTheme, 'id' | 'createdBy' | 'createdAt' | 'updatedAt'>\r\n): Promise<string> {\r\n    try {\r\n        // Generate a unique ID based on theme name\r\n        const themeId = themeData.name.toLowerCase().replace(/\\s+/g, '-') + '-' + Date.now();\r\n        const themeRef = doc(db, GLOBAL_THEMES_COLLECTION, themeId);\r\n\r\n        const newTheme: Omit<GlobalTheme, 'createdAt' | 'updatedAt'> & { createdAt: any; updatedAt: any } = {\r\n            ...themeData,\r\n            id: themeId,\r\n            createdBy: adminId,\r\n            createdAt: serverTimestamp(),\r\n            updatedAt: serverTimestamp(),\r\n        };\r\n\r\n        await setDoc(themeRef, newTheme);\r\n\r\n        // Initialize analytics for this theme\r\n        await setDoc(doc(db, THEME_ANALYTICS_COLLECTION, themeId), {\r\n            themeId,\r\n            themeName: themeData.name,\r\n            usageCount: 0,\r\n            lastUsed: serverTimestamp(),\r\n        });\r\n\r\n        console.log('[ThemeService] Global theme created:', themeId);\r\n        return themeId;\r\n    } catch (error) {\r\n        console.error('[ThemeService] Error creating global theme:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Update an existing global theme (Admin only)\r\n */\r\nexport async function updateGlobalTheme(\r\n    themeId: string,\r\n    updates: Partial<Omit<GlobalTheme, 'id' | 'createdBy' | 'createdAt'>>\r\n): Promise<void> {\r\n    try {\r\n        const themeRef = doc(db, GLOBAL_THEMES_COLLECTION, themeId);\r\n\r\n        await updateDoc(themeRef, {\r\n            ...updates,\r\n            updatedAt: serverTimestamp(),\r\n        });\r\n\r\n        // Update analytics theme name if changed\r\n        if (updates.name) {\r\n            await updateDoc(doc(db, THEME_ANALYTICS_COLLECTION, themeId), {\r\n                themeName: updates.name,\r\n            });\r\n        }\r\n\r\n        console.log('[ThemeService] Global theme updated:', themeId);\r\n    } catch (error) {\r\n        console.error('[ThemeService] Error updating global theme:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Delete a global theme (Admin only)\r\n */\r\nexport async function deleteGlobalTheme(themeId: string): Promise<void> {\r\n    try {\r\n        await deleteDoc(doc(db, GLOBAL_THEMES_COLLECTION, themeId));\r\n        await deleteDoc(doc(db, THEME_ANALYTICS_COLLECTION, themeId));\r\n\r\n        console.log('[ThemeService] Global theme deleted:', themeId);\r\n    } catch (error) {\r\n        console.error('[ThemeService] Error deleting global theme:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Get all global themes (available to all users)\r\n */\r\nexport async function getGlobalThemes(): Promise<GlobalTheme[]> {\r\n    try {\r\n        const themesRef = collection(db, GLOBAL_THEMES_COLLECTION);\r\n        const q = query(themesRef, orderBy('createdAt', 'desc'));\r\n        const snapshot = await getDocs(q);\r\n\r\n        return snapshot.docs.map(doc => {\r\n            const data = doc.data();\r\n            return {\r\n                ...data,\r\n                id: doc.id,\r\n                createdAt: (data.createdAt as Timestamp)?.toDate() || new Date(),\r\n                updatedAt: (data.updatedAt as Timestamp)?.toDate() || new Date(),\r\n            } as GlobalTheme;\r\n        });\r\n    } catch (error) {\r\n        console.error('[ThemeService] Error fetching global themes:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\n/**\r\n * Get a single global theme by ID\r\n */\r\nexport async function getGlobalTheme(themeId: string): Promise<GlobalTheme | null> {\r\n    try {\r\n        const themeRef = doc(db, GLOBAL_THEMES_COLLECTION, themeId);\r\n        const themeDoc = await getDoc(themeRef);\r\n\r\n        if (themeDoc.exists()) {\r\n            const data = themeDoc.data();\r\n            return {\r\n                ...data,\r\n                id: themeDoc.id,\r\n                createdAt: (data.createdAt as Timestamp)?.toDate() || new Date(),\r\n                updatedAt: (data.updatedAt as Timestamp)?.toDate() || new Date(),\r\n            } as GlobalTheme;\r\n        }\r\n\r\n        return null;\r\n    } catch (error) {\r\n        console.error('[ThemeService] Error fetching global theme:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\n/**\r\n * Set a theme as the default for new users\r\n */\r\nexport async function setDefaultTheme(themeId: string): Promise<void> {\r\n    try {\r\n        // First, unset any existing default\r\n        const themesRef = collection(db, GLOBAL_THEMES_COLLECTION);\r\n        const defaultQuery = query(themesRef, where('isDefault', '==', true));\r\n        const defaultThemes = await getDocs(defaultQuery);\r\n\r\n        for (const themeDoc of defaultThemes.docs) {\r\n            await updateDoc(doc(db, GLOBAL_THEMES_COLLECTION, themeDoc.id), {\r\n                isDefault: false,\r\n            });\r\n        }\r\n\r\n        // Set the new default\r\n        await updateDoc(doc(db, GLOBAL_THEMES_COLLECTION, themeId), {\r\n            isDefault: true,\r\n        });\r\n\r\n        console.log('[ThemeService] Default theme set:', themeId);\r\n    } catch (error) {\r\n        console.error('[ThemeService] Error setting default theme:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// THEME ANALYTICS\r\n// ============================================================================\r\n\r\n/**\r\n * Update theme usage analytics\r\n */\r\nasync function updateThemeAnalytics(themeId: ThemeId): Promise<void> {\r\n    try {\r\n        const analyticsRef = doc(db, THEME_ANALYTICS_COLLECTION, themeId);\r\n        const analyticsDoc = await getDoc(analyticsRef);\r\n\r\n        if (analyticsDoc.exists()) {\r\n            await updateDoc(analyticsRef, {\r\n                usageCount: increment(1),\r\n                lastUsed: serverTimestamp(),\r\n            });\r\n        } else {\r\n            // Create analytics for built-in themes\r\n            await setDoc(analyticsRef, {\r\n                themeId,\r\n                themeName: themeId,\r\n                usageCount: 1,\r\n                lastUsed: serverTimestamp(),\r\n            });\r\n        }\r\n    } catch (error) {\r\n        console.error('[ThemeService] Error updating theme analytics:', error);\r\n        // Don't throw - analytics failure shouldn't break theme saving\r\n    }\r\n}\r\n\r\n/**\r\n * Get theme analytics (Admin only)\r\n */\r\nexport async function getThemeAnalytics(): Promise<ThemeAnalytics[]> {\r\n    try {\r\n        const analyticsRef = collection(db, THEME_ANALYTICS_COLLECTION);\r\n        const q = query(analyticsRef, orderBy('usageCount', 'desc'));\r\n        const snapshot = await getDocs(q);\r\n\r\n        return snapshot.docs.map(doc => {\r\n            const data = doc.data();\r\n            return {\r\n                themeId: data.themeId,\r\n                themeName: data.themeName,\r\n                usageCount: data.usageCount || 0,\r\n                lastUsed: (data.lastUsed as Timestamp)?.toDate() || new Date(),\r\n            } as ThemeAnalytics;\r\n        });\r\n    } catch (error) {\r\n        console.error('[ThemeService] Error fetching theme analytics:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// HELPER: Convert GlobalTheme to ThemeConfig for MUI\r\n// ============================================================================\r\n\r\n/**\r\n * Convert a GlobalTheme to ThemeConfig format for use with MUI\r\n */\r\nexport function globalThemeToConfig(globalTheme: GlobalTheme): ThemeConfig {\r\n    return {\r\n        id: globalTheme.id,\r\n        name: globalTheme.name,\r\n        mode: globalTheme.mode,\r\n        colors: globalTheme.colors,\r\n        typography: globalTheme.typography,\r\n        shape: globalTheme.shape,\r\n    };\r\n}\r\n\r\n// ============================================================================\r\n// LEGACY EXPORTS (Backward Compatibility)\r\n// ============================================================================\r\n\r\n// Keep old function names for backward compatibility\r\nexport const saveThemeToFirebase = saveUserTheme;\r\nexport const loadThemeFromFirebase = loadUserTheme;\r\n\r\n/**\r\n * Initialize theme field for existing users (legacy)\r\n */\r\nexport async function initializeUserTheme(userId: string): Promise<void> {\r\n    try {\r\n        const userRef = doc(db, USERS_COLLECTION, userId);\r\n        const userDoc = await getDoc(userRef);\r\n\r\n        if (userDoc.exists()) {\r\n            const userData = userDoc.data();\r\n\r\n            // Only initialize if theme doesn't exist\r\n            if (!userData?.preferences?.theme && !userData?.theme) {\r\n                await updateDoc(userRef, {\r\n                    'preferences.theme': {\r\n                        id: 'default',\r\n                    },\r\n                });\r\n                console.log('[ThemeService] Initialized default theme for user');\r\n            }\r\n        }\r\n    } catch (error) {\r\n        console.error('[ThemeService] Error initializing user theme:', error);\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\services\\userService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'auth' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[609,612],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[609,612],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1074,1077],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1074,1077],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { auth } from '@/lib/firebase';\r\nimport { updateProfile, updatePassword, User } from 'firebase/auth';\r\n\r\n/**\r\n * Updates the user's display name and photo URL.\r\n * @param user The current Firebase User object\r\n * @param displayName New display name\r\n * @param photoURL New photo URL (optional)\r\n */\r\nexport const updateUserProfile = async (user: User, displayName: string, photoURL?: string) => {\r\n    try {\r\n        await updateProfile(user, {\r\n            displayName: displayName,\r\n            photoURL: photoURL || user.photoURL\r\n        });\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error(\"Error updating profile:\", error);\r\n        return { success: false, error: error.message };\r\n    }\r\n};\r\n\r\n/**\r\n * Updates the user's password.\r\n * @param user The current Firebase User object\r\n * @param newPassword The new password\r\n */\r\nexport const updateUserPassword = async (user: User, newPassword: string) => {\r\n    try {\r\n        await updatePassword(user, newPassword);\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error(\"Error updating password:\", error);\r\n        // Common error: 'auth/requires-recent-login'\r\n        return { success: false, error: error.message, code: error.code };\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\theme\\ThemeRegistry.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\theme\\theme.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\types\\accessRequest.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\types\\aiChat.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\types\\chat.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\types\\payment.ts","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":25,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":25,"endColumn":38,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[692,843],"text":"type PaymentRequestCreate = Omit<PaymentRequest, 'id' | 'createdAt' | 'updatedAt' | 'status'>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Timestamp } from 'firebase/firestore';\r\nimport { UserTier } from '@/types/user';\r\n\r\nexport type PaymentStatus = 'pending' | 'approved' | 'rejected' | 'completed';\r\n\r\nexport interface PaymentRequest {\r\n    id?: string;\r\n    userId: string;\r\n    userEmail: string;\r\n    userName: string;\r\n    tier: UserTier;\r\n    price: number;\r\n    billingCycle?: 'monthly' | 'lifetime';\r\n    type?: 'manual' | 'paid';\r\n    status: PaymentStatus;\r\n    paypalOrderId?: string;\r\n    createdAt?: Date | Timestamp;\r\n    updatedAt?: Date | Timestamp;\r\n    approvedBy?: string; // Admin UID\r\n    approvedAt?: Date | Timestamp;\r\n    rejectedReason?: string;\r\n    rejectedAt?: Date | Timestamp;\r\n}\r\n\r\nexport interface PaymentRequestCreate extends Omit<PaymentRequest, 'id' | 'createdAt' | 'updatedAt' | 'status'> {\r\n    // For creating new payment requests\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\types\\pcBuilder.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\types\\quest.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\types\\react-qr-scanner.d.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[174,177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[174,177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[213,216],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[213,216],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"declare module 'react-qr-scanner' {\r\n    import * as React from 'react';\r\n\r\n    export interface QrScannerProps {\r\n        delay?: number | false;\r\n        onError?: (error: any) => void;\r\n        onScan?: (data: any) => void;\r\n        style?: React.CSSProperties;\r\n        constraints?: MediaStreamConstraints;\r\n        className?: string;\r\n    }\r\n\r\n    const QrScanner: React.ComponentType<QrScannerProps>;\r\n    export default QrScanner;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\types\\system.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\types\\theme.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\types\\user.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Youssef Boubli\\Desktop\\TruthLens\\utils\\setAdmin.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[913,916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[913,916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Simple client-side script to set admin role\r\n * Run this in browser console OR create a temporary page\r\n */\r\n\r\nimport { doc, updateDoc } from 'firebase/firestore';\r\nimport { db, auth } from '@/lib/firebase';\r\n\r\nexport async function setCurrentUserAsAdmin() {\r\n    const user = auth.currentUser;\r\n\r\n    if (!user) {\r\n        console.error('No user logged in');\r\n        return;\r\n    }\r\n\r\n    try {\r\n        const userRef = doc(db, 'users', user.uid);\r\n        await updateDoc(userRef, {\r\n            role: 'admin'\r\n        });\r\n\r\n        console.log('Γ£à Successfully set', user.email, 'as admin!');\r\n        console.log('≡ƒÄ» Refresh the page to see changes');\r\n\r\n        return true;\r\n    } catch (error) {\r\n        console.error('Γ¥î Error setting admin role:', error);\r\n        return false;\r\n    }\r\n}\r\n\r\n// Make it available globally in browser console\r\nif (typeof window !== 'undefined') {\r\n    (window as any).setCurrentUserAsAdmin = setCurrentUserAsAdmin;\r\n}\r\n","usedDeprecatedRules":[]}]
